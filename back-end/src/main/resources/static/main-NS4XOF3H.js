import{$ as Vp,$a as em,A as Ua,Aa as Zp,B as ru,Ba as Jp,C as eo,Ca as Gt,D as Rp,Da as at,E as hl,Ea as Wt,F as Mr,Fa as rt,G as su,Ga as ot,H as kp,Ha as Dt,I as Op,Ia as fn,J as Ip,Ja as pn,K as zi,Ka as Me,L as Lp,La as Lt,M as Mn,Ma as gt,N as nn,Na as De,O as Ae,Oa as be,P as Np,Pa as we,Q as si,Qa as fe,R as ou,Ra as ln,S as Le,Sa as vn,T as ie,Ta as Vt,U as za,Ua as Kp,V as zt,Va as xl,W as Up,Wa as Qp,X as Va,Xa as tm,Y as zp,Ya as du,Z as ul,Za as xu,_ as xs,_a as fu,a as Ot,aa as Yt,ab as pu,b as dn,ba as qt,bb as nm,ca as fs,cb as im,d as Sp,da as ps,db as oi,e as wC,ea as au,eb as Dr,f as Mp,fa as Hp,fb as rm,g as Ut,ga as cu,gb as io,h as Dp,ha as Ce,hb as rn,i as Bp,ia as Gp,ib as We,j as tu,ja as lu,jb as Wa,k as eu,ka as Wp,kb as sm,l as ds,la as Ha,lb as mu,m as ii,ma as jp,mb as om,n as Sr,na as hu,o as yi,oa as xn,p as ne,pa as no,q as Na,qa as Ga,r as Tp,ra as j,s as Fp,sa as ge,t as Ve,ta as uu,u as nu,ua as Xp,v as ri,va as dl,w as Pp,wa as Yp,x as iu,xa as Ai,y as Qs,ya as qp,z as to,za as $p}from"./chunk-2EPZ623Z.js";var tC=Sp((al,mp)=>{"use strict";(function(t,e){typeof al=="object"&&typeof mp=="object"?mp.exports=e():typeof define=="function"&&define.amd?define([],e):typeof al=="object"?al.jsQR=e():t.jsQR=e()})(typeof self<"u"?self:al,function(){return function(r){var t={};function e(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return r[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=r,e.c=t,e.d=function(n,i,s){e.o(n,i)||Object.defineProperty(n,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(i,"a",i),i},e.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},e.p="",e(e.s=3)}([function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function i(s,o){this.width=o,this.height=s.length/o,this.data=s}return i.createEmpty=function(s,o){return new i(new Uint8ClampedArray(s*o),s)},i.prototype.get=function(s,o){return s<0||s>=this.width||o<0||o>=this.height?!1:!!this.data[o*this.width+s]},i.prototype.set=function(s,o,a){this.data[o*this.width+s]=a?1:0},i.prototype.setRegion=function(s,o,a,c,l){for(var h=o;h<o+c;h++)for(var u=s;u<s+a;u++)this.set(u,h,!!l)},i}();t.BitMatrix=n},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e(2);function i(o,a){return o^a}t.addOrSubtractGF=i;var s=function(){function o(a,c,l){this.primitive=a,this.size=c,this.generatorBase=l,this.expTable=new Array(this.size),this.logTable=new Array(this.size);for(var h=1,u=0;u<this.size;u++)this.expTable[u]=h,h=h*2,h>=this.size&&(h=(h^this.primitive)&this.size-1);for(var u=0;u<this.size-1;u++)this.logTable[this.expTable[u]]=u;this.zero=new n.default(this,Uint8ClampedArray.from([0])),this.one=new n.default(this,Uint8ClampedArray.from([1]))}return o.prototype.multiply=function(a,c){return a===0||c===0?0:this.expTable[(this.logTable[a]+this.logTable[c])%(this.size-1)]},o.prototype.inverse=function(a){if(a===0)throw new Error("Can't invert 0");return this.expTable[this.size-this.logTable[a]-1]},o.prototype.buildMonomial=function(a,c){if(a<0)throw new Error("Invalid monomial degree less than 0");if(c===0)return this.zero;var l=new Uint8ClampedArray(a+1);return l[0]=c,new n.default(this,l)},o.prototype.log=function(a){if(a===0)throw new Error("Can't take log(0)");return this.logTable[a]},o.prototype.exp=function(a){return this.expTable[a]},o}();t.default=s},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e(1),i=function(){function s(o,a){if(a.length===0)throw new Error("No coefficients.");this.field=o;var c=a.length;if(c>1&&a[0]===0){for(var l=1;l<c&&a[l]===0;)l++;if(l===c)this.coefficients=o.zero.coefficients;else{this.coefficients=new Uint8ClampedArray(c-l);for(var h=0;h<this.coefficients.length;h++)this.coefficients[h]=a[l+h]}}else this.coefficients=a}return s.prototype.degree=function(){return this.coefficients.length-1},s.prototype.isZero=function(){return this.coefficients[0]===0},s.prototype.getCoefficient=function(o){return this.coefficients[this.coefficients.length-1-o]},s.prototype.addOrSubtract=function(o){var a;if(this.isZero())return o;if(o.isZero())return this;var c=this.coefficients,l=o.coefficients;c.length>l.length&&(a=[l,c],c=a[0],l=a[1]);for(var h=new Uint8ClampedArray(l.length),u=l.length-c.length,d=0;d<u;d++)h[d]=l[d];for(var d=u;d<l.length;d++)h[d]=n.addOrSubtractGF(c[d-u],l[d]);return new s(this.field,h)},s.prototype.multiply=function(o){if(o===0)return this.field.zero;if(o===1)return this;for(var a=this.coefficients.length,c=new Uint8ClampedArray(a),l=0;l<a;l++)c[l]=this.field.multiply(this.coefficients[l],o);return new s(this.field,c)},s.prototype.multiplyPoly=function(o){if(this.isZero()||o.isZero())return this.field.zero;for(var a=this.coefficients,c=a.length,l=o.coefficients,h=l.length,u=new Uint8ClampedArray(c+h-1),d=0;d<c;d++)for(var x=a[d],m=0;m<h;m++)u[d+m]=n.addOrSubtractGF(u[d+m],this.field.multiply(x,l[m]));return new s(this.field,u)},s.prototype.multiplyByMonomial=function(o,a){if(o<0)throw new Error("Invalid degree less than 0");if(a===0)return this.field.zero;for(var c=this.coefficients.length,l=new Uint8ClampedArray(c+o),h=0;h<c;h++)l[h]=this.field.multiply(this.coefficients[h],a);return new s(this.field,l)},s.prototype.evaluateAt=function(o){var a=0;if(o===0)return this.getCoefficient(0);var c=this.coefficients.length;if(o===1)return this.coefficients.forEach(function(h){a=n.addOrSubtractGF(a,h)}),a;a=this.coefficients[0];for(var l=1;l<c;l++)a=n.addOrSubtractGF(this.field.multiply(o,a),this.coefficients[l]);return a},s}();t.default=i},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e(4),i=e(5),s=e(11),o=e(12);function a(h){var u=o.locate(h);if(!u)return null;for(var d=0,x=u;d<x.length;d++){var m=x[d],g=s.extract(h,m),f=i.decode(g.matrix);if(f)return{binaryData:f.bytes,data:f.text,chunks:f.chunks,version:f.version,location:{topRightCorner:g.mappingFunction(m.dimension,0),topLeftCorner:g.mappingFunction(0,0),bottomRightCorner:g.mappingFunction(m.dimension,m.dimension),bottomLeftCorner:g.mappingFunction(0,m.dimension),topRightFinderPattern:m.topRight,topLeftFinderPattern:m.topLeft,bottomLeftFinderPattern:m.bottomLeft,bottomRightAlignmentPattern:m.alignmentPattern}}}return null}var c={inversionAttempts:"attemptBoth"};function l(h,u,d,x){x===void 0&&(x={});var m=c;Object.keys(m||{}).forEach(function(b){m[b]=x[b]||m[b]});var g=m.inversionAttempts==="attemptBoth"||m.inversionAttempts==="invertFirst",f=m.inversionAttempts==="onlyInvert"||m.inversionAttempts==="invertFirst",p=n.binarize(h,u,d,g),v=p.binarized,E=p.inverted,C=a(f?E:v);return!C&&(m.inversionAttempts==="attemptBoth"||m.inversionAttempts==="invertFirst")&&(C=a(f?v:E)),C}l.default=l,t.default=l},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e(0),i=8,s=24;function o(l,h,u){return l<h?h:l>u?u:l}var a=function(){function l(h,u){this.width=h,this.data=new Uint8ClampedArray(h*u)}return l.prototype.get=function(h,u){return this.data[u*this.width+h]},l.prototype.set=function(h,u,d){this.data[u*this.width+h]=d},l}();function c(l,h,u,d){if(l.length!==h*u*4)throw new Error("Malformed data passed to binarizer.");for(var x=new a(h,u),m=0;m<h;m++)for(var g=0;g<u;g++){var f=l[(g*h+m)*4+0],p=l[(g*h+m)*4+1],v=l[(g*h+m)*4+2];x.set(m,g,.2126*f+.7152*p+.0722*v)}for(var E=Math.ceil(h/i),C=Math.ceil(u/i),b=new a(E,C),A=0;A<C;A++)for(var w=0;w<E;w++){for(var S=0,_=1/0,y=0,g=0;g<i;g++)for(var m=0;m<i;m++){var D=x.get(w*i+m,A*i+g);S+=D,_=Math.min(_,D),y=Math.max(y,D)}var F=S/Math.pow(i,2);if(y-_<=s&&(F=_/2,A>0&&w>0)){var T=(b.get(w,A-1)+2*b.get(w-1,A)+b.get(w-1,A-1))/4;_<T&&(F=T)}b.set(w,A,F)}var L=n.BitMatrix.createEmpty(h,u),N=null;d&&(N=n.BitMatrix.createEmpty(h,u));for(var A=0;A<C;A++)for(var w=0;w<E;w++){for(var J=o(w,2,E-3),tt=o(A,2,C-3),S=0,G=-2;G<=2;G++)for(var X=-2;X<=2;X++)S+=b.get(J+G,tt+X);for(var st=S/25,G=0;G<i;G++)for(var X=0;X<i;X++){var m=w*i+G,g=A*i+X,ft=x.get(m,g);L.set(m,g,ft<=st),d&&N.set(m,g,!(ft<=st))}}return d?{binarized:L,inverted:N}:{binarized:L}}t.binarize=c},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e(0),i=e(6),s=e(9),o=e(10);function a(v,E){for(var C=v^E,b=0;C;)b++,C&=C-1;return b}function c(v,E){return E<<1|v}var l=[{bits:21522,formatInfo:{errorCorrectionLevel:1,dataMask:0}},{bits:20773,formatInfo:{errorCorrectionLevel:1,dataMask:1}},{bits:24188,formatInfo:{errorCorrectionLevel:1,dataMask:2}},{bits:23371,formatInfo:{errorCorrectionLevel:1,dataMask:3}},{bits:17913,formatInfo:{errorCorrectionLevel:1,dataMask:4}},{bits:16590,formatInfo:{errorCorrectionLevel:1,dataMask:5}},{bits:20375,formatInfo:{errorCorrectionLevel:1,dataMask:6}},{bits:19104,formatInfo:{errorCorrectionLevel:1,dataMask:7}},{bits:30660,formatInfo:{errorCorrectionLevel:0,dataMask:0}},{bits:29427,formatInfo:{errorCorrectionLevel:0,dataMask:1}},{bits:32170,formatInfo:{errorCorrectionLevel:0,dataMask:2}},{bits:30877,formatInfo:{errorCorrectionLevel:0,dataMask:3}},{bits:26159,formatInfo:{errorCorrectionLevel:0,dataMask:4}},{bits:25368,formatInfo:{errorCorrectionLevel:0,dataMask:5}},{bits:27713,formatInfo:{errorCorrectionLevel:0,dataMask:6}},{bits:26998,formatInfo:{errorCorrectionLevel:0,dataMask:7}},{bits:5769,formatInfo:{errorCorrectionLevel:3,dataMask:0}},{bits:5054,formatInfo:{errorCorrectionLevel:3,dataMask:1}},{bits:7399,formatInfo:{errorCorrectionLevel:3,dataMask:2}},{bits:6608,formatInfo:{errorCorrectionLevel:3,dataMask:3}},{bits:1890,formatInfo:{errorCorrectionLevel:3,dataMask:4}},{bits:597,formatInfo:{errorCorrectionLevel:3,dataMask:5}},{bits:3340,formatInfo:{errorCorrectionLevel:3,dataMask:6}},{bits:2107,formatInfo:{errorCorrectionLevel:3,dataMask:7}},{bits:13663,formatInfo:{errorCorrectionLevel:2,dataMask:0}},{bits:12392,formatInfo:{errorCorrectionLevel:2,dataMask:1}},{bits:16177,formatInfo:{errorCorrectionLevel:2,dataMask:2}},{bits:14854,formatInfo:{errorCorrectionLevel:2,dataMask:3}},{bits:9396,formatInfo:{errorCorrectionLevel:2,dataMask:4}},{bits:8579,formatInfo:{errorCorrectionLevel:2,dataMask:5}},{bits:11994,formatInfo:{errorCorrectionLevel:2,dataMask:6}},{bits:11245,formatInfo:{errorCorrectionLevel:2,dataMask:7}}],h=[function(v){return(v.y+v.x)%2===0},function(v){return v.y%2===0},function(v){return v.x%3===0},function(v){return(v.y+v.x)%3===0},function(v){return(Math.floor(v.y/2)+Math.floor(v.x/3))%2===0},function(v){return v.x*v.y%2+v.x*v.y%3===0},function(v){return(v.y*v.x%2+v.y*v.x%3)%2===0},function(v){return((v.y+v.x)%2+v.y*v.x%3)%2===0}];function u(v){var E=17+4*v.versionNumber,C=n.BitMatrix.createEmpty(E,E);C.setRegion(0,0,9,9,!0),C.setRegion(E-8,0,8,9,!0),C.setRegion(0,E-8,9,8,!0);for(var b=0,A=v.alignmentPatternCenters;b<A.length;b++)for(var w=A[b],S=0,_=v.alignmentPatternCenters;S<_.length;S++){var y=_[S];w===6&&y===6||w===6&&y===E-7||w===E-7&&y===6||C.setRegion(w-2,y-2,5,5,!0)}return C.setRegion(6,9,1,E-17,!0),C.setRegion(9,6,E-17,1,!0),v.versionNumber>6&&(C.setRegion(E-11,0,3,6,!0),C.setRegion(0,E-11,6,3,!0)),C}function d(v,E,C){for(var b=h[C.dataMask],A=v.height,w=u(E),S=[],_=0,y=0,D=!0,F=A-1;F>0;F-=2){F===6&&F--;for(var T=0;T<A;T++)for(var L=D?A-1-T:T,N=0;N<2;N++){var J=F-N;if(!w.get(J,L)){y++;var tt=v.get(J,L);b({y:L,x:J})&&(tt=!tt),_=c(tt,_),y===8&&(S.push(_),y=0,_=0)}}D=!D}return S}function x(v){var E=v.height,C=Math.floor((E-17)/4);if(C<=6)return o.VERSIONS[C-1];for(var b=0,A=5;A>=0;A--)for(var w=E-9;w>=E-11;w--)b=c(v.get(w,A),b);for(var S=0,w=5;w>=0;w--)for(var A=E-9;A>=E-11;A--)S=c(v.get(w,A),S);for(var _=1/0,y,D=0,F=o.VERSIONS;D<F.length;D++){var T=F[D];if(T.infoBits===b||T.infoBits===S)return T;var L=a(b,T.infoBits);L<_&&(y=T,_=L),L=a(S,T.infoBits),L<_&&(y=T,_=L)}if(_<=3)return y}function m(v){for(var E=0,C=0;C<=8;C++)C!==6&&(E=c(v.get(C,8),E));for(var b=7;b>=0;b--)b!==6&&(E=c(v.get(8,b),E));for(var A=v.height,w=0,b=A-1;b>=A-7;b--)w=c(v.get(8,b),w);for(var C=A-8;C<A;C++)w=c(v.get(C,8),w);for(var S=1/0,_=null,y=0,D=l;y<D.length;y++){var F=D[y],T=F.bits,L=F.formatInfo;if(T===E||T===w)return L;var N=a(E,T);N<S&&(_=L,S=N),E!==w&&(N=a(w,T),N<S&&(_=L,S=N))}return S<=3?_:null}function g(v,E,C){var b=E.errorCorrectionLevels[C],A=[],w=0;if(b.ecBlocks.forEach(function(tt){for(var G=0;G<tt.numBlocks;G++)A.push({numDataCodewords:tt.dataCodewordsPerBlock,codewords:[]}),w+=tt.dataCodewordsPerBlock+b.ecCodewordsPerBlock}),v.length<w)return null;v=v.slice(0,w);for(var S=b.ecBlocks[0].dataCodewordsPerBlock,_=0;_<S;_++)for(var y=0,D=A;y<D.length;y++){var F=D[y];F.codewords.push(v.shift())}if(b.ecBlocks.length>1)for(var T=b.ecBlocks[0].numBlocks,L=b.ecBlocks[1].numBlocks,_=0;_<L;_++)A[T+_].codewords.push(v.shift());for(;v.length>0;)for(var N=0,J=A;N<J.length;N++){var F=J[N];F.codewords.push(v.shift())}return A}function f(v){var E=x(v);if(!E)return null;var C=m(v);if(!C)return null;var b=d(v,E,C),A=g(b,E,C.errorCorrectionLevel);if(!A)return null;for(var w=A.reduce(function(N,J){return N+J.numDataCodewords},0),S=new Uint8ClampedArray(w),_=0,y=0,D=A;y<D.length;y++){var F=D[y],T=s.decode(F.codewords,F.codewords.length-F.numDataCodewords);if(!T)return null;for(var L=0;L<F.numDataCodewords;L++)S[_++]=T[L]}try{return i.decode(S,E.versionNumber)}catch{return null}}function p(v){if(v==null)return null;var E=f(v);if(E)return E;for(var C=0;C<v.width;C++)for(var b=C+1;b<v.height;b++)v.get(C,b)!==v.get(b,C)&&(v.set(C,b,!v.get(C,b)),v.set(b,C,!v.get(b,C)));return f(v)}t.decode=p},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e(7),i=e(8),s;(function(x){x.Numeric="numeric",x.Alphanumeric="alphanumeric",x.Byte="byte",x.Kanji="kanji",x.ECI="eci"})(s=t.Mode||(t.Mode={}));var o=function(x){return x[x.Terminator=0]="Terminator",x[x.Numeric=1]="Numeric",x[x.Alphanumeric=2]="Alphanumeric",x[x.Byte=4]="Byte",x[x.Kanji=8]="Kanji",x[x.ECI=7]="ECI",x}(o||{});function a(x,m){for(var g=[],f="",p=[10,12,14][m],v=x.readBits(p);v>=3;){var E=x.readBits(10);if(E>=1e3)throw new Error("Invalid numeric value above 999");var C=Math.floor(E/100),b=Math.floor(E/10)%10,A=E%10;g.push(48+C,48+b,48+A),f+=C.toString()+b.toString()+A.toString(),v-=3}if(v===2){var E=x.readBits(7);if(E>=100)throw new Error("Invalid numeric value above 99");var C=Math.floor(E/10),b=E%10;g.push(48+C,48+b),f+=C.toString()+b.toString()}else if(v===1){var E=x.readBits(4);if(E>=10)throw new Error("Invalid numeric value above 9");g.push(48+E),f+=E.toString()}return{bytes:g,text:f}}var c=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function l(x,m){for(var g=[],f="",p=[9,11,13][m],v=x.readBits(p);v>=2;){var E=x.readBits(11),C=Math.floor(E/45),b=E%45;g.push(c[C].charCodeAt(0),c[b].charCodeAt(0)),f+=c[C]+c[b],v-=2}if(v===1){var C=x.readBits(6);g.push(c[C].charCodeAt(0)),f+=c[C]}return{bytes:g,text:f}}function h(x,m){for(var g=[],f="",p=[8,16,16][m],v=x.readBits(p),E=0;E<v;E++){var C=x.readBits(8);g.push(C)}try{f+=decodeURIComponent(g.map(function(b){return"%"+("0"+b.toString(16)).substr(-2)}).join(""))}catch{}return{bytes:g,text:f}}function u(x,m){for(var g=[],f="",p=[8,10,12][m],v=x.readBits(p),E=0;E<v;E++){var C=x.readBits(13),b=Math.floor(C/192)<<8|C%192;b<7936?b+=33088:b+=49472,g.push(b>>8,b&255),f+=String.fromCharCode(i.shiftJISTable[b])}return{bytes:g,text:f}}function d(x,m){for(var g,f,p,v,E=new n.BitStream(x),C=m<=9?0:m<=26?1:2,b={text:"",bytes:[],chunks:[],version:m};E.available()>=4;){var A=E.readBits(4);if(A===o.Terminator)return b;if(A===o.ECI)E.readBits(1)===0?b.chunks.push({type:s.ECI,assignmentNumber:E.readBits(7)}):E.readBits(1)===0?b.chunks.push({type:s.ECI,assignmentNumber:E.readBits(14)}):E.readBits(1)===0?b.chunks.push({type:s.ECI,assignmentNumber:E.readBits(21)}):b.chunks.push({type:s.ECI,assignmentNumber:-1});else if(A===o.Numeric){var w=a(E,C);b.text+=w.text,(g=b.bytes).push.apply(g,w.bytes),b.chunks.push({type:s.Numeric,text:w.text})}else if(A===o.Alphanumeric){var S=l(E,C);b.text+=S.text,(f=b.bytes).push.apply(f,S.bytes),b.chunks.push({type:s.Alphanumeric,text:S.text})}else if(A===o.Byte){var _=h(E,C);b.text+=_.text,(p=b.bytes).push.apply(p,_.bytes),b.chunks.push({type:s.Byte,bytes:_.bytes,text:_.text})}else if(A===o.Kanji){var y=u(E,C);b.text+=y.text,(v=b.bytes).push.apply(v,y.bytes),b.chunks.push({type:s.Kanji,bytes:y.bytes,text:y.text})}}if(E.available()===0||E.readBits(E.available())===0)return b}t.decode=d},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function i(s){this.byteOffset=0,this.bitOffset=0,this.bytes=s}return i.prototype.readBits=function(s){if(s<1||s>32||s>this.available())throw new Error("Cannot read "+s.toString()+" bits");var o=0;if(this.bitOffset>0){var a=8-this.bitOffset,c=s<a?s:a,l=a-c,h=255>>8-c<<l;o=(this.bytes[this.byteOffset]&h)>>l,s-=c,this.bitOffset+=c,this.bitOffset===8&&(this.bitOffset=0,this.byteOffset++)}if(s>0){for(;s>=8;)o=o<<8|this.bytes[this.byteOffset]&255,this.byteOffset++,s-=8;if(s>0){var l=8-s,h=255>>l<<l;o=o<<s|(this.bytes[this.byteOffset]&h)>>l,this.bitOffset+=s}}return o},i.prototype.available=function(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset},i}();t.BitStream=n},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shiftJISTable={32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:165,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:8254,33088:12288,33089:12289,33090:12290,33091:65292,33092:65294,33093:12539,33094:65306,33095:65307,33096:65311,33097:65281,33098:12443,33099:12444,33100:180,33101:65344,33102:168,33103:65342,33104:65507,33105:65343,33106:12541,33107:12542,33108:12445,33109:12446,33110:12291,33111:20189,33112:12293,33113:12294,33114:12295,33115:12540,33116:8213,33117:8208,33118:65295,33119:92,33120:12316,33121:8214,33122:65372,33123:8230,33124:8229,33125:8216,33126:8217,33127:8220,33128:8221,33129:65288,33130:65289,33131:12308,33132:12309,33133:65339,33134:65341,33135:65371,33136:65373,33137:12296,33138:12297,33139:12298,33140:12299,33141:12300,33142:12301,33143:12302,33144:12303,33145:12304,33146:12305,33147:65291,33148:8722,33149:177,33150:215,33152:247,33153:65309,33154:8800,33155:65308,33156:65310,33157:8806,33158:8807,33159:8734,33160:8756,33161:9794,33162:9792,33163:176,33164:8242,33165:8243,33166:8451,33167:65509,33168:65284,33169:162,33170:163,33171:65285,33172:65283,33173:65286,33174:65290,33175:65312,33176:167,33177:9734,33178:9733,33179:9675,33180:9679,33181:9678,33182:9671,33183:9670,33184:9633,33185:9632,33186:9651,33187:9650,33188:9661,33189:9660,33190:8251,33191:12306,33192:8594,33193:8592,33194:8593,33195:8595,33196:12307,33208:8712,33209:8715,33210:8838,33211:8839,33212:8834,33213:8835,33214:8746,33215:8745,33224:8743,33225:8744,33226:172,33227:8658,33228:8660,33229:8704,33230:8707,33242:8736,33243:8869,33244:8978,33245:8706,33246:8711,33247:8801,33248:8786,33249:8810,33250:8811,33251:8730,33252:8765,33253:8733,33254:8757,33255:8747,33256:8748,33264:8491,33265:8240,33266:9839,33267:9837,33268:9834,33269:8224,33270:8225,33271:182,33276:9711,33359:65296,33360:65297,33361:65298,33362:65299,33363:65300,33364:65301,33365:65302,33366:65303,33367:65304,33368:65305,33376:65313,33377:65314,33378:65315,33379:65316,33380:65317,33381:65318,33382:65319,33383:65320,33384:65321,33385:65322,33386:65323,33387:65324,33388:65325,33389:65326,33390:65327,33391:65328,33392:65329,33393:65330,33394:65331,33395:65332,33396:65333,33397:65334,33398:65335,33399:65336,33400:65337,33401:65338,33409:65345,33410:65346,33411:65347,33412:65348,33413:65349,33414:65350,33415:65351,33416:65352,33417:65353,33418:65354,33419:65355,33420:65356,33421:65357,33422:65358,33423:65359,33424:65360,33425:65361,33426:65362,33427:65363,33428:65364,33429:65365,33430:65366,33431:65367,33432:65368,33433:65369,33434:65370,33439:12353,33440:12354,33441:12355,33442:12356,33443:12357,33444:12358,33445:12359,33446:12360,33447:12361,33448:12362,33449:12363,33450:12364,33451:12365,33452:12366,33453:12367,33454:12368,33455:12369,33456:12370,33457:12371,33458:12372,33459:12373,33460:12374,33461:12375,33462:12376,33463:12377,33464:12378,33465:12379,33466:12380,33467:12381,33468:12382,33469:12383,33470:12384,33471:12385,33472:12386,33473:12387,33474:12388,33475:12389,33476:12390,33477:12391,33478:12392,33479:12393,33480:12394,33481:12395,33482:12396,33483:12397,33484:12398,33485:12399,33486:12400,33487:12401,33488:12402,33489:12403,33490:12404,33491:12405,33492:12406,33493:12407,33494:12408,33495:12409,33496:12410,33497:12411,33498:12412,33499:12413,33500:12414,33501:12415,33502:12416,33503:12417,33504:12418,33505:12419,33506:12420,33507:12421,33508:12422,33509:12423,33510:12424,33511:12425,33512:12426,33513:12427,33514:12428,33515:12429,33516:12430,33517:12431,33518:12432,33519:12433,33520:12434,33521:12435,33600:12449,33601:12450,33602:12451,33603:12452,33604:12453,33605:12454,33606:12455,33607:12456,33608:12457,33609:12458,33610:12459,33611:12460,33612:12461,33613:12462,33614:12463,33615:12464,33616:12465,33617:12466,33618:12467,33619:12468,33620:12469,33621:12470,33622:12471,33623:12472,33624:12473,33625:12474,33626:12475,33627:12476,33628:12477,33629:12478,33630:12479,33631:12480,33632:12481,33633:12482,33634:12483,33635:12484,33636:12485,33637:12486,33638:12487,33639:12488,33640:12489,33641:12490,33642:12491,33643:12492,33644:12493,33645:12494,33646:12495,33647:12496,33648:12497,33649:12498,33650:12499,33651:12500,33652:12501,33653:12502,33654:12503,33655:12504,33656:12505,33657:12506,33658:12507,33659:12508,33660:12509,33661:12510,33662:12511,33664:12512,33665:12513,33666:12514,33667:12515,33668:12516,33669:12517,33670:12518,33671:12519,33672:12520,33673:12521,33674:12522,33675:12523,33676:12524,33677:12525,33678:12526,33679:12527,33680:12528,33681:12529,33682:12530,33683:12531,33684:12532,33685:12533,33686:12534,33695:913,33696:914,33697:915,33698:916,33699:917,33700:918,33701:919,33702:920,33703:921,33704:922,33705:923,33706:924,33707:925,33708:926,33709:927,33710:928,33711:929,33712:931,33713:932,33714:933,33715:934,33716:935,33717:936,33718:937,33727:945,33728:946,33729:947,33730:948,33731:949,33732:950,33733:951,33734:952,33735:953,33736:954,33737:955,33738:956,33739:957,33740:958,33741:959,33742:960,33743:961,33744:963,33745:964,33746:965,33747:966,33748:967,33749:968,33750:969,33856:1040,33857:1041,33858:1042,33859:1043,33860:1044,33861:1045,33862:1025,33863:1046,33864:1047,33865:1048,33866:1049,33867:1050,33868:1051,33869:1052,33870:1053,33871:1054,33872:1055,33873:1056,33874:1057,33875:1058,33876:1059,33877:1060,33878:1061,33879:1062,33880:1063,33881:1064,33882:1065,33883:1066,33884:1067,33885:1068,33886:1069,33887:1070,33888:1071,33904:1072,33905:1073,33906:1074,33907:1075,33908:1076,33909:1077,33910:1105,33911:1078,33912:1079,33913:1080,33914:1081,33915:1082,33916:1083,33917:1084,33918:1085,33920:1086,33921:1087,33922:1088,33923:1089,33924:1090,33925:1091,33926:1092,33927:1093,33928:1094,33929:1095,33930:1096,33931:1097,33932:1098,33933:1099,33934:1100,33935:1101,33936:1102,33937:1103,33951:9472,33952:9474,33953:9484,33954:9488,33955:9496,33956:9492,33957:9500,33958:9516,33959:9508,33960:9524,33961:9532,33962:9473,33963:9475,33964:9487,33965:9491,33966:9499,33967:9495,33968:9507,33969:9523,33970:9515,33971:9531,33972:9547,33973:9504,33974:9519,33975:9512,33976:9527,33977:9535,33978:9501,33979:9520,33980:9509,33981:9528,33982:9538,34975:20124,34976:21782,34977:23043,34978:38463,34979:21696,34980:24859,34981:25384,34982:23030,34983:36898,34984:33909,34985:33564,34986:31312,34987:24746,34988:25569,34989:28197,34990:26093,34991:33894,34992:33446,34993:39925,34994:26771,34995:22311,34996:26017,34997:25201,34998:23451,34999:22992,35e3:34427,35001:39156,35002:32098,35003:32190,35004:39822,35005:25110,35006:31903,35007:34999,35008:23433,35009:24245,35010:25353,35011:26263,35012:26696,35013:38343,35014:38797,35015:26447,35016:20197,35017:20234,35018:20301,35019:20381,35020:20553,35021:22258,35022:22839,35023:22996,35024:23041,35025:23561,35026:24799,35027:24847,35028:24944,35029:26131,35030:26885,35031:28858,35032:30031,35033:30064,35034:31227,35035:32173,35036:32239,35037:32963,35038:33806,35039:34915,35040:35586,35041:36949,35042:36986,35043:21307,35044:20117,35045:20133,35046:22495,35047:32946,35048:37057,35049:30959,35050:19968,35051:22769,35052:28322,35053:36920,35054:31282,35055:33576,35056:33419,35057:39983,35058:20801,35059:21360,35060:21693,35061:21729,35062:22240,35063:23035,35064:24341,35065:39154,35066:28139,35067:32996,35068:34093,35136:38498,35137:38512,35138:38560,35139:38907,35140:21515,35141:21491,35142:23431,35143:28879,35144:32701,35145:36802,35146:38632,35147:21359,35148:40284,35149:31418,35150:19985,35151:30867,35152:33276,35153:28198,35154:22040,35155:21764,35156:27421,35157:34074,35158:39995,35159:23013,35160:21417,35161:28006,35162:29916,35163:38287,35164:22082,35165:20113,35166:36939,35167:38642,35168:33615,35169:39180,35170:21473,35171:21942,35172:23344,35173:24433,35174:26144,35175:26355,35176:26628,35177:27704,35178:27891,35179:27945,35180:29787,35181:30408,35182:31310,35183:38964,35184:33521,35185:34907,35186:35424,35187:37613,35188:28082,35189:30123,35190:30410,35191:39365,35192:24742,35193:35585,35194:36234,35195:38322,35196:27022,35197:21421,35198:20870,35200:22290,35201:22576,35202:22852,35203:23476,35204:24310,35205:24616,35206:25513,35207:25588,35208:27839,35209:28436,35210:28814,35211:28948,35212:29017,35213:29141,35214:29503,35215:32257,35216:33398,35217:33489,35218:34199,35219:36960,35220:37467,35221:40219,35222:22633,35223:26044,35224:27738,35225:29989,35226:20985,35227:22830,35228:22885,35229:24448,35230:24540,35231:25276,35232:26106,35233:27178,35234:27431,35235:27572,35236:29579,35237:32705,35238:35158,35239:40236,35240:40206,35241:40644,35242:23713,35243:27798,35244:33659,35245:20740,35246:23627,35247:25014,35248:33222,35249:26742,35250:29281,35251:20057,35252:20474,35253:21368,35254:24681,35255:28201,35256:31311,35257:38899,35258:19979,35259:21270,35260:20206,35261:20309,35262:20285,35263:20385,35264:20339,35265:21152,35266:21487,35267:22025,35268:22799,35269:23233,35270:23478,35271:23521,35272:31185,35273:26247,35274:26524,35275:26550,35276:27468,35277:27827,35278:28779,35279:29634,35280:31117,35281:31166,35282:31292,35283:31623,35284:33457,35285:33499,35286:33540,35287:33655,35288:33775,35289:33747,35290:34662,35291:35506,35292:22057,35293:36008,35294:36838,35295:36942,35296:38686,35297:34442,35298:20420,35299:23784,35300:25105,35301:29273,35302:30011,35303:33253,35304:33469,35305:34558,35306:36032,35307:38597,35308:39187,35309:39381,35310:20171,35311:20250,35312:35299,35313:22238,35314:22602,35315:22730,35316:24315,35317:24555,35318:24618,35319:24724,35320:24674,35321:25040,35322:25106,35323:25296,35324:25913,35392:39745,35393:26214,35394:26800,35395:28023,35396:28784,35397:30028,35398:30342,35399:32117,35400:33445,35401:34809,35402:38283,35403:38542,35404:35997,35405:20977,35406:21182,35407:22806,35408:21683,35409:23475,35410:23830,35411:24936,35412:27010,35413:28079,35414:30861,35415:33995,35416:34903,35417:35442,35418:37799,35419:39608,35420:28012,35421:39336,35422:34521,35423:22435,35424:26623,35425:34510,35426:37390,35427:21123,35428:22151,35429:21508,35430:24275,35431:25313,35432:25785,35433:26684,35434:26680,35435:27579,35436:29554,35437:30906,35438:31339,35439:35226,35440:35282,35441:36203,35442:36611,35443:37101,35444:38307,35445:38548,35446:38761,35447:23398,35448:23731,35449:27005,35450:38989,35451:38990,35452:25499,35453:31520,35454:27179,35456:27263,35457:26806,35458:39949,35459:28511,35460:21106,35461:21917,35462:24688,35463:25324,35464:27963,35465:28167,35466:28369,35467:33883,35468:35088,35469:36676,35470:19988,35471:39993,35472:21494,35473:26907,35474:27194,35475:38788,35476:26666,35477:20828,35478:31427,35479:33970,35480:37340,35481:37772,35482:22107,35483:40232,35484:26658,35485:33541,35486:33841,35487:31909,35488:21e3,35489:33477,35490:29926,35491:20094,35492:20355,35493:20896,35494:23506,35495:21002,35496:21208,35497:21223,35498:24059,35499:21914,35500:22570,35501:23014,35502:23436,35503:23448,35504:23515,35505:24178,35506:24185,35507:24739,35508:24863,35509:24931,35510:25022,35511:25563,35512:25954,35513:26577,35514:26707,35515:26874,35516:27454,35517:27475,35518:27735,35519:28450,35520:28567,35521:28485,35522:29872,35523:29976,35524:30435,35525:30475,35526:31487,35527:31649,35528:31777,35529:32233,35530:32566,35531:32752,35532:32925,35533:33382,35534:33694,35535:35251,35536:35532,35537:36011,35538:36996,35539:37969,35540:38291,35541:38289,35542:38306,35543:38501,35544:38867,35545:39208,35546:33304,35547:20024,35548:21547,35549:23736,35550:24012,35551:29609,35552:30284,35553:30524,35554:23721,35555:32747,35556:36107,35557:38593,35558:38929,35559:38996,35560:39e3,35561:20225,35562:20238,35563:21361,35564:21916,35565:22120,35566:22522,35567:22855,35568:23305,35569:23492,35570:23696,35571:24076,35572:24190,35573:24524,35574:25582,35575:26426,35576:26071,35577:26082,35578:26399,35579:26827,35580:26820,35648:27231,35649:24112,35650:27589,35651:27671,35652:27773,35653:30079,35654:31048,35655:23395,35656:31232,35657:32e3,35658:24509,35659:35215,35660:35352,35661:36020,35662:36215,35663:36556,35664:36637,35665:39138,35666:39438,35667:39740,35668:20096,35669:20605,35670:20736,35671:22931,35672:23452,35673:25135,35674:25216,35675:25836,35676:27450,35677:29344,35678:30097,35679:31047,35680:32681,35681:34811,35682:35516,35683:35696,35684:25516,35685:33738,35686:38816,35687:21513,35688:21507,35689:21931,35690:26708,35691:27224,35692:35440,35693:30759,35694:26485,35695:40653,35696:21364,35697:23458,35698:33050,35699:34384,35700:36870,35701:19992,35702:20037,35703:20167,35704:20241,35705:21450,35706:21560,35707:23470,35708:24339,35709:24613,35710:25937,35712:26429,35713:27714,35714:27762,35715:27875,35716:28792,35717:29699,35718:31350,35719:31406,35720:31496,35721:32026,35722:31998,35723:32102,35724:26087,35725:29275,35726:21435,35727:23621,35728:24040,35729:25298,35730:25312,35731:25369,35732:28192,35733:34394,35734:35377,35735:36317,35736:37624,35737:28417,35738:31142,35739:39770,35740:20136,35741:20139,35742:20140,35743:20379,35744:20384,35745:20689,35746:20807,35747:31478,35748:20849,35749:20982,35750:21332,35751:21281,35752:21375,35753:21483,35754:21932,35755:22659,35756:23777,35757:24375,35758:24394,35759:24623,35760:24656,35761:24685,35762:25375,35763:25945,35764:27211,35765:27841,35766:29378,35767:29421,35768:30703,35769:33016,35770:33029,35771:33288,35772:34126,35773:37111,35774:37857,35775:38911,35776:39255,35777:39514,35778:20208,35779:20957,35780:23597,35781:26241,35782:26989,35783:23616,35784:26354,35785:26997,35786:29577,35787:26704,35788:31873,35789:20677,35790:21220,35791:22343,35792:24062,35793:37670,35794:26020,35795:27427,35796:27453,35797:29748,35798:31105,35799:31165,35800:31563,35801:32202,35802:33465,35803:33740,35804:34943,35805:35167,35806:35641,35807:36817,35808:37329,35809:21535,35810:37504,35811:20061,35812:20534,35813:21477,35814:21306,35815:29399,35816:29590,35817:30697,35818:33510,35819:36527,35820:39366,35821:39368,35822:39378,35823:20855,35824:24858,35825:34398,35826:21936,35827:31354,35828:20598,35829:23507,35830:36935,35831:38533,35832:20018,35833:27355,35834:37351,35835:23633,35836:23624,35904:25496,35905:31391,35906:27795,35907:38772,35908:36705,35909:31402,35910:29066,35911:38536,35912:31874,35913:26647,35914:32368,35915:26705,35916:37740,35917:21234,35918:21531,35919:34219,35920:35347,35921:32676,35922:36557,35923:37089,35924:21350,35925:34952,35926:31041,35927:20418,35928:20670,35929:21009,35930:20804,35931:21843,35932:22317,35933:29674,35934:22411,35935:22865,35936:24418,35937:24452,35938:24693,35939:24950,35940:24935,35941:25001,35942:25522,35943:25658,35944:25964,35945:26223,35946:26690,35947:28179,35948:30054,35949:31293,35950:31995,35951:32076,35952:32153,35953:32331,35954:32619,35955:33550,35956:33610,35957:34509,35958:35336,35959:35427,35960:35686,35961:36605,35962:38938,35963:40335,35964:33464,35965:36814,35966:39912,35968:21127,35969:25119,35970:25731,35971:28608,35972:38553,35973:26689,35974:20625,35975:27424,35976:27770,35977:28500,35978:31348,35979:32080,35980:34880,35981:35363,35982:26376,35983:20214,35984:20537,35985:20518,35986:20581,35987:20860,35988:21048,35989:21091,35990:21927,35991:22287,35992:22533,35993:23244,35994:24314,35995:25010,35996:25080,35997:25331,35998:25458,35999:26908,36e3:27177,36001:29309,36002:29356,36003:29486,36004:30740,36005:30831,36006:32121,36007:30476,36008:32937,36009:35211,36010:35609,36011:36066,36012:36562,36013:36963,36014:37749,36015:38522,36016:38997,36017:39443,36018:40568,36019:20803,36020:21407,36021:21427,36022:24187,36023:24358,36024:28187,36025:28304,36026:29572,36027:29694,36028:32067,36029:33335,36030:35328,36031:35578,36032:38480,36033:20046,36034:20491,36035:21476,36036:21628,36037:22266,36038:22993,36039:23396,36040:24049,36041:24235,36042:24359,36043:25144,36044:25925,36045:26543,36046:28246,36047:29392,36048:31946,36049:34996,36050:32929,36051:32993,36052:33776,36053:34382,36054:35463,36055:36328,36056:37431,36057:38599,36058:39015,36059:40723,36060:20116,36061:20114,36062:20237,36063:21320,36064:21577,36065:21566,36066:23087,36067:24460,36068:24481,36069:24735,36070:26791,36071:27278,36072:29786,36073:30849,36074:35486,36075:35492,36076:35703,36077:37264,36078:20062,36079:39881,36080:20132,36081:20348,36082:20399,36083:20505,36084:20502,36085:20809,36086:20844,36087:21151,36088:21177,36089:21246,36090:21402,36091:21475,36092:21521,36160:21518,36161:21897,36162:22353,36163:22434,36164:22909,36165:23380,36166:23389,36167:23439,36168:24037,36169:24039,36170:24055,36171:24184,36172:24195,36173:24218,36174:24247,36175:24344,36176:24658,36177:24908,36178:25239,36179:25304,36180:25511,36181:25915,36182:26114,36183:26179,36184:26356,36185:26477,36186:26657,36187:26775,36188:27083,36189:27743,36190:27946,36191:28009,36192:28207,36193:28317,36194:30002,36195:30343,36196:30828,36197:31295,36198:31968,36199:32005,36200:32024,36201:32094,36202:32177,36203:32789,36204:32771,36205:32943,36206:32945,36207:33108,36208:33167,36209:33322,36210:33618,36211:34892,36212:34913,36213:35611,36214:36002,36215:36092,36216:37066,36217:37237,36218:37489,36219:30783,36220:37628,36221:38308,36222:38477,36224:38917,36225:39321,36226:39640,36227:40251,36228:21083,36229:21163,36230:21495,36231:21512,36232:22741,36233:25335,36234:28640,36235:35946,36236:36703,36237:40633,36238:20811,36239:21051,36240:21578,36241:22269,36242:31296,36243:37239,36244:40288,36245:40658,36246:29508,36247:28425,36248:33136,36249:29969,36250:24573,36251:24794,36252:39592,36253:29403,36254:36796,36255:27492,36256:38915,36257:20170,36258:22256,36259:22372,36260:22718,36261:23130,36262:24680,36263:25031,36264:26127,36265:26118,36266:26681,36267:26801,36268:28151,36269:30165,36270:32058,36271:33390,36272:39746,36273:20123,36274:20304,36275:21449,36276:21766,36277:23919,36278:24038,36279:24046,36280:26619,36281:27801,36282:29811,36283:30722,36284:35408,36285:37782,36286:35039,36287:22352,36288:24231,36289:25387,36290:20661,36291:20652,36292:20877,36293:26368,36294:21705,36295:22622,36296:22971,36297:23472,36298:24425,36299:25165,36300:25505,36301:26685,36302:27507,36303:28168,36304:28797,36305:37319,36306:29312,36307:30741,36308:30758,36309:31085,36310:25998,36311:32048,36312:33756,36313:35009,36314:36617,36315:38555,36316:21092,36317:22312,36318:26448,36319:32618,36320:36001,36321:20916,36322:22338,36323:38442,36324:22586,36325:27018,36326:32948,36327:21682,36328:23822,36329:22524,36330:30869,36331:40442,36332:20316,36333:21066,36334:21643,36335:25662,36336:26152,36337:26388,36338:26613,36339:31364,36340:31574,36341:32034,36342:37679,36343:26716,36344:39853,36345:31545,36346:21273,36347:20874,36348:21047,36416:23519,36417:25334,36418:25774,36419:25830,36420:26413,36421:27578,36422:34217,36423:38609,36424:30352,36425:39894,36426:25420,36427:37638,36428:39851,36429:30399,36430:26194,36431:19977,36432:20632,36433:21442,36434:23665,36435:24808,36436:25746,36437:25955,36438:26719,36439:29158,36440:29642,36441:29987,36442:31639,36443:32386,36444:34453,36445:35715,36446:36059,36447:37240,36448:39184,36449:26028,36450:26283,36451:27531,36452:20181,36453:20180,36454:20282,36455:20351,36456:21050,36457:21496,36458:21490,36459:21987,36460:22235,36461:22763,36462:22987,36463:22985,36464:23039,36465:23376,36466:23629,36467:24066,36468:24107,36469:24535,36470:24605,36471:25351,36472:25903,36473:23388,36474:26031,36475:26045,36476:26088,36477:26525,36478:27490,36480:27515,36481:27663,36482:29509,36483:31049,36484:31169,36485:31992,36486:32025,36487:32043,36488:32930,36489:33026,36490:33267,36491:35222,36492:35422,36493:35433,36494:35430,36495:35468,36496:35566,36497:36039,36498:36060,36499:38604,36500:39164,36501:27503,36502:20107,36503:20284,36504:20365,36505:20816,36506:23383,36507:23546,36508:24904,36509:25345,36510:26178,36511:27425,36512:28363,36513:27835,36514:29246,36515:29885,36516:30164,36517:30913,36518:31034,36519:32780,36520:32819,36521:33258,36522:33940,36523:36766,36524:27728,36525:40575,36526:24335,36527:35672,36528:40235,36529:31482,36530:36600,36531:23437,36532:38635,36533:19971,36534:21489,36535:22519,36536:22833,36537:23241,36538:23460,36539:24713,36540:28287,36541:28422,36542:30142,36543:36074,36544:23455,36545:34048,36546:31712,36547:20594,36548:26612,36549:33437,36550:23649,36551:34122,36552:32286,36553:33294,36554:20889,36555:23556,36556:25448,36557:36198,36558:26012,36559:29038,36560:31038,36561:32023,36562:32773,36563:35613,36564:36554,36565:36974,36566:34503,36567:37034,36568:20511,36569:21242,36570:23610,36571:26451,36572:28796,36573:29237,36574:37196,36575:37320,36576:37675,36577:33509,36578:23490,36579:24369,36580:24825,36581:20027,36582:21462,36583:23432,36584:25163,36585:26417,36586:27530,36587:29417,36588:29664,36589:31278,36590:33131,36591:36259,36592:37202,36593:39318,36594:20754,36595:21463,36596:21610,36597:23551,36598:25480,36599:27193,36600:32172,36601:38656,36602:22234,36603:21454,36604:21608,36672:23447,36673:23601,36674:24030,36675:20462,36676:24833,36677:25342,36678:27954,36679:31168,36680:31179,36681:32066,36682:32333,36683:32722,36684:33261,36685:33311,36686:33936,36687:34886,36688:35186,36689:35728,36690:36468,36691:36655,36692:36913,36693:37195,36694:37228,36695:38598,36696:37276,36697:20160,36698:20303,36699:20805,36700:21313,36701:24467,36702:25102,36703:26580,36704:27713,36705:28171,36706:29539,36707:32294,36708:37325,36709:37507,36710:21460,36711:22809,36712:23487,36713:28113,36714:31069,36715:32302,36716:31899,36717:22654,36718:29087,36719:20986,36720:34899,36721:36848,36722:20426,36723:23803,36724:26149,36725:30636,36726:31459,36727:33308,36728:39423,36729:20934,36730:24490,36731:26092,36732:26991,36733:27529,36734:28147,36736:28310,36737:28516,36738:30462,36739:32020,36740:24033,36741:36981,36742:37255,36743:38918,36744:20966,36745:21021,36746:25152,36747:26257,36748:26329,36749:28186,36750:24246,36751:32210,36752:32626,36753:26360,36754:34223,36755:34295,36756:35576,36757:21161,36758:21465,36759:22899,36760:24207,36761:24464,36762:24661,36763:37604,36764:38500,36765:20663,36766:20767,36767:21213,36768:21280,36769:21319,36770:21484,36771:21736,36772:21830,36773:21809,36774:22039,36775:22888,36776:22974,36777:23100,36778:23477,36779:23558,36780:23567,36781:23569,36782:23578,36783:24196,36784:24202,36785:24288,36786:24432,36787:25215,36788:25220,36789:25307,36790:25484,36791:25463,36792:26119,36793:26124,36794:26157,36795:26230,36796:26494,36797:26786,36798:27167,36799:27189,36800:27836,36801:28040,36802:28169,36803:28248,36804:28988,36805:28966,36806:29031,36807:30151,36808:30465,36809:30813,36810:30977,36811:31077,36812:31216,36813:31456,36814:31505,36815:31911,36816:32057,36817:32918,36818:33750,36819:33931,36820:34121,36821:34909,36822:35059,36823:35359,36824:35388,36825:35412,36826:35443,36827:35937,36828:36062,36829:37284,36830:37478,36831:37758,36832:37912,36833:38556,36834:38808,36835:19978,36836:19976,36837:19998,36838:20055,36839:20887,36840:21104,36841:22478,36842:22580,36843:22732,36844:23330,36845:24120,36846:24773,36847:25854,36848:26465,36849:26454,36850:27972,36851:29366,36852:30067,36853:31331,36854:33976,36855:35698,36856:37304,36857:37664,36858:22065,36859:22516,36860:39166,36928:25325,36929:26893,36930:27542,36931:29165,36932:32340,36933:32887,36934:33394,36935:35302,36936:39135,36937:34645,36938:36785,36939:23611,36940:20280,36941:20449,36942:20405,36943:21767,36944:23072,36945:23517,36946:23529,36947:24515,36948:24910,36949:25391,36950:26032,36951:26187,36952:26862,36953:27035,36954:28024,36955:28145,36956:30003,36957:30137,36958:30495,36959:31070,36960:31206,36961:32051,36962:33251,36963:33455,36964:34218,36965:35242,36966:35386,36967:36523,36968:36763,36969:36914,36970:37341,36971:38663,36972:20154,36973:20161,36974:20995,36975:22645,36976:22764,36977:23563,36978:29978,36979:23613,36980:33102,36981:35338,36982:36805,36983:38499,36984:38765,36985:31525,36986:35535,36987:38920,36988:37218,36989:22259,36990:21416,36992:36887,36993:21561,36994:22402,36995:24101,36996:25512,36997:27700,36998:28810,36999:30561,37e3:31883,37001:32736,37002:34928,37003:36930,37004:37204,37005:37648,37006:37656,37007:38543,37008:29790,37009:39620,37010:23815,37011:23913,37012:25968,37013:26530,37014:36264,37015:38619,37016:25454,37017:26441,37018:26905,37019:33733,37020:38935,37021:38592,37022:35070,37023:28548,37024:25722,37025:23544,37026:19990,37027:28716,37028:30045,37029:26159,37030:20932,37031:21046,37032:21218,37033:22995,37034:24449,37035:24615,37036:25104,37037:25919,37038:25972,37039:26143,37040:26228,37041:26866,37042:26646,37043:27491,37044:28165,37045:29298,37046:29983,37047:30427,37048:31934,37049:32854,37050:22768,37051:35069,37052:35199,37053:35488,37054:35475,37055:35531,37056:36893,37057:37266,37058:38738,37059:38745,37060:25993,37061:31246,37062:33030,37063:38587,37064:24109,37065:24796,37066:25114,37067:26021,37068:26132,37069:26512,37070:30707,37071:31309,37072:31821,37073:32318,37074:33034,37075:36012,37076:36196,37077:36321,37078:36447,37079:30889,37080:20999,37081:25305,37082:25509,37083:25666,37084:25240,37085:35373,37086:31363,37087:31680,37088:35500,37089:38634,37090:32118,37091:33292,37092:34633,37093:20185,37094:20808,37095:21315,37096:21344,37097:23459,37098:23554,37099:23574,37100:24029,37101:25126,37102:25159,37103:25776,37104:26643,37105:26676,37106:27849,37107:27973,37108:27927,37109:26579,37110:28508,37111:29006,37112:29053,37113:26059,37114:31359,37115:31661,37116:32218,37184:32330,37185:32680,37186:33146,37187:33307,37188:33337,37189:34214,37190:35438,37191:36046,37192:36341,37193:36984,37194:36983,37195:37549,37196:37521,37197:38275,37198:39854,37199:21069,37200:21892,37201:28472,37202:28982,37203:20840,37204:31109,37205:32341,37206:33203,37207:31950,37208:22092,37209:22609,37210:23720,37211:25514,37212:26366,37213:26365,37214:26970,37215:29401,37216:30095,37217:30094,37218:30990,37219:31062,37220:31199,37221:31895,37222:32032,37223:32068,37224:34311,37225:35380,37226:38459,37227:36961,37228:40736,37229:20711,37230:21109,37231:21452,37232:21474,37233:20489,37234:21930,37235:22766,37236:22863,37237:29245,37238:23435,37239:23652,37240:21277,37241:24803,37242:24819,37243:25436,37244:25475,37245:25407,37246:25531,37248:25805,37249:26089,37250:26361,37251:24035,37252:27085,37253:27133,37254:28437,37255:29157,37256:20105,37257:30185,37258:30456,37259:31379,37260:31967,37261:32207,37262:32156,37263:32865,37264:33609,37265:33624,37266:33900,37267:33980,37268:34299,37269:35013,37270:36208,37271:36865,37272:36973,37273:37783,37274:38684,37275:39442,37276:20687,37277:22679,37278:24974,37279:33235,37280:34101,37281:36104,37282:36896,37283:20419,37284:20596,37285:21063,37286:21363,37287:24687,37288:25417,37289:26463,37290:28204,37291:36275,37292:36895,37293:20439,37294:23646,37295:36042,37296:26063,37297:32154,37298:21330,37299:34966,37300:20854,37301:25539,37302:23384,37303:23403,37304:23562,37305:25613,37306:26449,37307:36956,37308:20182,37309:22810,37310:22826,37311:27760,37312:35409,37313:21822,37314:22549,37315:22949,37316:24816,37317:25171,37318:26561,37319:33333,37320:26965,37321:38464,37322:39364,37323:39464,37324:20307,37325:22534,37326:23550,37327:32784,37328:23729,37329:24111,37330:24453,37331:24608,37332:24907,37333:25140,37334:26367,37335:27888,37336:28382,37337:32974,37338:33151,37339:33492,37340:34955,37341:36024,37342:36864,37343:36910,37344:38538,37345:40667,37346:39899,37347:20195,37348:21488,37349:22823,37350:31532,37351:37261,37352:38988,37353:40441,37354:28381,37355:28711,37356:21331,37357:21828,37358:23429,37359:25176,37360:25246,37361:25299,37362:27810,37363:28655,37364:29730,37365:35351,37366:37944,37367:28609,37368:35582,37369:33592,37370:20967,37371:34552,37372:21482,37440:21481,37441:20294,37442:36948,37443:36784,37444:22890,37445:33073,37446:24061,37447:31466,37448:36799,37449:26842,37450:35895,37451:29432,37452:40008,37453:27197,37454:35504,37455:20025,37456:21336,37457:22022,37458:22374,37459:25285,37460:25506,37461:26086,37462:27470,37463:28129,37464:28251,37465:28845,37466:30701,37467:31471,37468:31658,37469:32187,37470:32829,37471:32966,37472:34507,37473:35477,37474:37723,37475:22243,37476:22727,37477:24382,37478:26029,37479:26262,37480:27264,37481:27573,37482:30007,37483:35527,37484:20516,37485:30693,37486:22320,37487:24347,37488:24677,37489:26234,37490:27744,37491:30196,37492:31258,37493:32622,37494:33268,37495:34584,37496:36933,37497:39347,37498:31689,37499:30044,37500:31481,37501:31569,37502:33988,37504:36880,37505:31209,37506:31378,37507:33590,37508:23265,37509:30528,37510:20013,37511:20210,37512:23449,37513:24544,37514:25277,37515:26172,37516:26609,37517:27880,37518:34411,37519:34935,37520:35387,37521:37198,37522:37619,37523:39376,37524:27159,37525:28710,37526:29482,37527:33511,37528:33879,37529:36015,37530:19969,37531:20806,37532:20939,37533:21899,37534:23541,37535:24086,37536:24115,37537:24193,37538:24340,37539:24373,37540:24427,37541:24500,37542:25074,37543:25361,37544:26274,37545:26397,37546:28526,37547:29266,37548:30010,37549:30522,37550:32884,37551:33081,37552:33144,37553:34678,37554:35519,37555:35548,37556:36229,37557:36339,37558:37530,37559:38263,37560:38914,37561:40165,37562:21189,37563:25431,37564:30452,37565:26389,37566:27784,37567:29645,37568:36035,37569:37806,37570:38515,37571:27941,37572:22684,37573:26894,37574:27084,37575:36861,37576:37786,37577:30171,37578:36890,37579:22618,37580:26626,37581:25524,37582:27131,37583:20291,37584:28460,37585:26584,37586:36795,37587:34086,37588:32180,37589:37716,37590:26943,37591:28528,37592:22378,37593:22775,37594:23340,37595:32044,37596:29226,37597:21514,37598:37347,37599:40372,37600:20141,37601:20302,37602:20572,37603:20597,37604:21059,37605:35998,37606:21576,37607:22564,37608:23450,37609:24093,37610:24213,37611:24237,37612:24311,37613:24351,37614:24716,37615:25269,37616:25402,37617:25552,37618:26799,37619:27712,37620:30855,37621:31118,37622:31243,37623:32224,37624:33351,37625:35330,37626:35558,37627:36420,37628:36883,37696:37048,37697:37165,37698:37336,37699:40718,37700:27877,37701:25688,37702:25826,37703:25973,37704:28404,37705:30340,37706:31515,37707:36969,37708:37841,37709:28346,37710:21746,37711:24505,37712:25764,37713:36685,37714:36845,37715:37444,37716:20856,37717:22635,37718:22825,37719:23637,37720:24215,37721:28155,37722:32399,37723:29980,37724:36028,37725:36578,37726:39003,37727:28857,37728:20253,37729:27583,37730:28593,37731:3e4,37732:38651,37733:20814,37734:21520,37735:22581,37736:22615,37737:22956,37738:23648,37739:24466,37740:26007,37741:26460,37742:28193,37743:30331,37744:33759,37745:36077,37746:36884,37747:37117,37748:37709,37749:30757,37750:30778,37751:21162,37752:24230,37753:22303,37754:22900,37755:24594,37756:20498,37757:20826,37758:20908,37760:20941,37761:20992,37762:21776,37763:22612,37764:22616,37765:22871,37766:23445,37767:23798,37768:23947,37769:24764,37770:25237,37771:25645,37772:26481,37773:26691,37774:26812,37775:26847,37776:30423,37777:28120,37778:28271,37779:28059,37780:28783,37781:29128,37782:24403,37783:30168,37784:31095,37785:31561,37786:31572,37787:31570,37788:31958,37789:32113,37790:21040,37791:33891,37792:34153,37793:34276,37794:35342,37795:35588,37796:35910,37797:36367,37798:36867,37799:36879,37800:37913,37801:38518,37802:38957,37803:39472,37804:38360,37805:20685,37806:21205,37807:21516,37808:22530,37809:23566,37810:24999,37811:25758,37812:27934,37813:30643,37814:31461,37815:33012,37816:33796,37817:36947,37818:37509,37819:23776,37820:40199,37821:21311,37822:24471,37823:24499,37824:28060,37825:29305,37826:30563,37827:31167,37828:31716,37829:27602,37830:29420,37831:35501,37832:26627,37833:27233,37834:20984,37835:31361,37836:26932,37837:23626,37838:40182,37839:33515,37840:23493,37841:37193,37842:28702,37843:22136,37844:23663,37845:24775,37846:25958,37847:27788,37848:35930,37849:36929,37850:38931,37851:21585,37852:26311,37853:37389,37854:22856,37855:37027,37856:20869,37857:20045,37858:20970,37859:34201,37860:35598,37861:28760,37862:25466,37863:37707,37864:26978,37865:39348,37866:32260,37867:30071,37868:21335,37869:26976,37870:36575,37871:38627,37872:27741,37873:20108,37874:23612,37875:24336,37876:36841,37877:21250,37878:36049,37879:32905,37880:34425,37881:24319,37882:26085,37883:20083,37884:20837,37952:22914,37953:23615,37954:38894,37955:20219,37956:22922,37957:24525,37958:35469,37959:28641,37960:31152,37961:31074,37962:23527,37963:33905,37964:29483,37965:29105,37966:24180,37967:24565,37968:25467,37969:25754,37970:29123,37971:31896,37972:20035,37973:24316,37974:20043,37975:22492,37976:22178,37977:24745,37978:28611,37979:32013,37980:33021,37981:33075,37982:33215,37983:36786,37984:35223,37985:34468,37986:24052,37987:25226,37988:25773,37989:35207,37990:26487,37991:27874,37992:27966,37993:29750,37994:30772,37995:23110,37996:32629,37997:33453,37998:39340,37999:20467,38e3:24259,38001:25309,38002:25490,38003:25943,38004:26479,38005:30403,38006:29260,38007:32972,38008:32954,38009:36649,38010:37197,38011:20493,38012:22521,38013:23186,38014:26757,38016:26995,38017:29028,38018:29437,38019:36023,38020:22770,38021:36064,38022:38506,38023:36889,38024:34687,38025:31204,38026:30695,38027:33833,38028:20271,38029:21093,38030:21338,38031:25293,38032:26575,38033:27850,38034:30333,38035:31636,38036:31893,38037:33334,38038:34180,38039:36843,38040:26333,38041:28448,38042:29190,38043:32283,38044:33707,38045:39361,38046:40614,38047:20989,38048:31665,38049:30834,38050:31672,38051:32903,38052:31560,38053:27368,38054:24161,38055:32908,38056:30033,38057:30048,38058:20843,38059:37474,38060:28300,38061:30330,38062:37271,38063:39658,38064:20240,38065:32624,38066:25244,38067:31567,38068:38309,38069:40169,38070:22138,38071:22617,38072:34532,38073:38588,38074:20276,38075:21028,38076:21322,38077:21453,38078:21467,38079:24070,38080:25644,38081:26001,38082:26495,38083:27710,38084:27726,38085:29256,38086:29359,38087:29677,38088:30036,38089:32321,38090:33324,38091:34281,38092:36009,38093:31684,38094:37318,38095:29033,38096:38930,38097:39151,38098:25405,38099:26217,38100:30058,38101:30436,38102:30928,38103:34115,38104:34542,38105:21290,38106:21329,38107:21542,38108:22915,38109:24199,38110:24444,38111:24754,38112:25161,38113:25209,38114:25259,38115:26e3,38116:27604,38117:27852,38118:30130,38119:30382,38120:30865,38121:31192,38122:32203,38123:32631,38124:32933,38125:34987,38126:35513,38127:36027,38128:36991,38129:38750,38130:39131,38131:27147,38132:31800,38133:20633,38134:23614,38135:24494,38136:26503,38137:27608,38138:29749,38139:30473,38140:32654,38208:40763,38209:26570,38210:31255,38211:21305,38212:30091,38213:39661,38214:24422,38215:33181,38216:33777,38217:32920,38218:24380,38219:24517,38220:30050,38221:31558,38222:36924,38223:26727,38224:23019,38225:23195,38226:32016,38227:30334,38228:35628,38229:20469,38230:24426,38231:27161,38232:27703,38233:28418,38234:29922,38235:31080,38236:34920,38237:35413,38238:35961,38239:24287,38240:25551,38241:30149,38242:31186,38243:33495,38244:37672,38245:37618,38246:33948,38247:34541,38248:39981,38249:21697,38250:24428,38251:25996,38252:27996,38253:28693,38254:36007,38255:36051,38256:38971,38257:25935,38258:29942,38259:19981,38260:20184,38261:22496,38262:22827,38263:23142,38264:23500,38265:20904,38266:24067,38267:24220,38268:24598,38269:25206,38270:25975,38272:26023,38273:26222,38274:28014,38275:29238,38276:31526,38277:33104,38278:33178,38279:33433,38280:35676,38281:36e3,38282:36070,38283:36212,38284:38428,38285:38468,38286:20398,38287:25771,38288:27494,38289:33310,38290:33889,38291:34154,38292:37096,38293:23553,38294:26963,38295:39080,38296:33914,38297:34135,38298:20239,38299:21103,38300:24489,38301:24133,38302:26381,38303:31119,38304:33145,38305:35079,38306:35206,38307:28149,38308:24343,38309:25173,38310:27832,38311:20175,38312:29289,38313:39826,38314:20998,38315:21563,38316:22132,38317:22707,38318:24996,38319:25198,38320:28954,38321:22894,38322:31881,38323:31966,38324:32027,38325:38640,38326:25991,38327:32862,38328:19993,38329:20341,38330:20853,38331:22592,38332:24163,38333:24179,38334:24330,38335:26564,38336:20006,38337:34109,38338:38281,38339:38491,38340:31859,38341:38913,38342:20731,38343:22721,38344:30294,38345:30887,38346:21029,38347:30629,38348:34065,38349:31622,38350:20559,38351:22793,38352:29255,38353:31687,38354:32232,38355:36794,38356:36820,38357:36941,38358:20415,38359:21193,38360:23081,38361:24321,38362:38829,38363:20445,38364:33303,38365:37610,38366:22275,38367:25429,38368:27497,38369:29995,38370:35036,38371:36628,38372:31298,38373:21215,38374:22675,38375:24917,38376:25098,38377:26286,38378:27597,38379:31807,38380:33769,38381:20515,38382:20472,38383:21253,38384:21574,38385:22577,38386:22857,38387:23453,38388:23792,38389:23791,38390:23849,38391:24214,38392:25265,38393:25447,38394:25918,38395:26041,38396:26379,38464:27861,38465:27873,38466:28921,38467:30770,38468:32299,38469:32990,38470:33459,38471:33804,38472:34028,38473:34562,38474:35090,38475:35370,38476:35914,38477:37030,38478:37586,38479:39165,38480:40179,38481:40300,38482:20047,38483:20129,38484:20621,38485:21078,38486:22346,38487:22952,38488:24125,38489:24536,38490:24537,38491:25151,38492:26292,38493:26395,38494:26576,38495:26834,38496:20882,38497:32033,38498:32938,38499:33192,38500:35584,38501:35980,38502:36031,38503:37502,38504:38450,38505:21536,38506:38956,38507:21271,38508:20693,38509:21340,38510:22696,38511:25778,38512:26420,38513:29287,38514:30566,38515:31302,38516:37350,38517:21187,38518:27809,38519:27526,38520:22528,38521:24140,38522:22868,38523:26412,38524:32763,38525:20961,38526:30406,38528:25705,38529:30952,38530:39764,38531:40635,38532:22475,38533:22969,38534:26151,38535:26522,38536:27598,38537:21737,38538:27097,38539:24149,38540:33180,38541:26517,38542:39850,38543:26622,38544:40018,38545:26717,38546:20134,38547:20451,38548:21448,38549:25273,38550:26411,38551:27819,38552:36804,38553:20397,38554:32365,38555:40639,38556:19975,38557:24930,38558:28288,38559:28459,38560:34067,38561:21619,38562:26410,38563:39749,38564:24051,38565:31637,38566:23724,38567:23494,38568:34588,38569:28234,38570:34001,38571:31252,38572:33032,38573:22937,38574:31885,38575:27665,38576:30496,38577:21209,38578:22818,38579:28961,38580:29279,38581:30683,38582:38695,38583:40289,38584:26891,38585:23167,38586:23064,38587:20901,38588:21517,38589:21629,38590:26126,38591:30431,38592:36855,38593:37528,38594:40180,38595:23018,38596:29277,38597:28357,38598:20813,38599:26825,38600:32191,38601:32236,38602:38754,38603:40634,38604:25720,38605:27169,38606:33538,38607:22916,38608:23391,38609:27611,38610:29467,38611:30450,38612:32178,38613:32791,38614:33945,38615:20786,38616:26408,38617:40665,38618:30446,38619:26466,38620:21247,38621:39173,38622:23588,38623:25147,38624:31870,38625:36016,38626:21839,38627:24758,38628:32011,38629:38272,38630:21249,38631:20063,38632:20918,38633:22812,38634:29242,38635:32822,38636:37326,38637:24357,38638:30690,38639:21380,38640:24441,38641:32004,38642:34220,38643:35379,38644:36493,38645:38742,38646:26611,38647:34222,38648:37971,38649:24841,38650:24840,38651:27833,38652:30290,38720:35565,38721:36664,38722:21807,38723:20305,38724:20778,38725:21191,38726:21451,38727:23461,38728:24189,38729:24736,38730:24962,38731:25558,38732:26377,38733:26586,38734:28263,38735:28044,38736:29494,38737:29495,38738:30001,38739:31056,38740:35029,38741:35480,38742:36938,38743:37009,38744:37109,38745:38596,38746:34701,38747:22805,38748:20104,38749:20313,38750:19982,38751:35465,38752:36671,38753:38928,38754:20653,38755:24188,38756:22934,38757:23481,38758:24248,38759:25562,38760:25594,38761:25793,38762:26332,38763:26954,38764:27096,38765:27915,38766:28342,38767:29076,38768:29992,38769:31407,38770:32650,38771:32768,38772:33865,38773:33993,38774:35201,38775:35617,38776:36362,38777:36965,38778:38525,38779:39178,38780:24958,38781:25233,38782:27442,38784:27779,38785:28020,38786:32716,38787:32764,38788:28096,38789:32645,38790:34746,38791:35064,38792:26469,38793:33713,38794:38972,38795:38647,38796:27931,38797:32097,38798:33853,38799:37226,38800:20081,38801:21365,38802:23888,38803:27396,38804:28651,38805:34253,38806:34349,38807:35239,38808:21033,38809:21519,38810:23653,38811:26446,38812:26792,38813:29702,38814:29827,38815:30178,38816:35023,38817:35041,38818:37324,38819:38626,38820:38520,38821:24459,38822:29575,38823:31435,38824:33870,38825:25504,38826:30053,38827:21129,38828:27969,38829:28316,38830:29705,38831:30041,38832:30827,38833:31890,38834:38534,38835:31452,38836:40845,38837:20406,38838:24942,38839:26053,38840:34396,38841:20102,38842:20142,38843:20698,38844:20001,38845:20940,38846:23534,38847:26009,38848:26753,38849:28092,38850:29471,38851:30274,38852:30637,38853:31260,38854:31975,38855:33391,38856:35538,38857:36988,38858:37327,38859:38517,38860:38936,38861:21147,38862:32209,38863:20523,38864:21400,38865:26519,38866:28107,38867:29136,38868:29747,38869:33256,38870:36650,38871:38563,38872:40023,38873:40607,38874:29792,38875:22593,38876:28057,38877:32047,38878:39006,38879:20196,38880:20278,38881:20363,38882:20919,38883:21169,38884:23994,38885:24604,38886:29618,38887:31036,38888:33491,38889:37428,38890:38583,38891:38646,38892:38666,38893:40599,38894:40802,38895:26278,38896:27508,38897:21015,38898:21155,38899:28872,38900:35010,38901:24265,38902:24651,38903:24976,38904:28451,38905:29001,38906:31806,38907:32244,38908:32879,38976:34030,38977:36899,38978:37676,38979:21570,38980:39791,38981:27347,38982:28809,38983:36034,38984:36335,38985:38706,38986:21172,38987:23105,38988:24266,38989:24324,38990:26391,38991:27004,38992:27028,38993:28010,38994:28431,38995:29282,38996:29436,38997:31725,38998:32769,38999:32894,39e3:34635,39001:37070,39002:20845,39003:40595,39004:31108,39005:32907,39006:37682,39007:35542,39008:20525,39009:21644,39010:35441,39011:27498,39012:36036,39013:33031,39014:24785,39015:26528,39016:40434,39017:20121,39018:20120,39019:39952,39020:35435,39021:34241,39022:34152,39023:26880,39024:28286,39025:30871,39026:33109,39071:24332,39072:19984,39073:19989,39074:20010,39075:20017,39076:20022,39077:20028,39078:20031,39079:20034,39080:20054,39081:20056,39082:20098,39083:20101,39084:35947,39085:20106,39086:33298,39087:24333,39088:20110,39089:20126,39090:20127,39091:20128,39092:20130,39093:20144,39094:20147,39095:20150,39096:20174,39097:20173,39098:20164,39099:20166,39100:20162,39101:20183,39102:20190,39103:20205,39104:20191,39105:20215,39106:20233,39107:20314,39108:20272,39109:20315,39110:20317,39111:20311,39112:20295,39113:20342,39114:20360,39115:20367,39116:20376,39117:20347,39118:20329,39119:20336,39120:20369,39121:20335,39122:20358,39123:20374,39124:20760,39125:20436,39126:20447,39127:20430,39128:20440,39129:20443,39130:20433,39131:20442,39132:20432,39133:20452,39134:20453,39135:20506,39136:20520,39137:20500,39138:20522,39139:20517,39140:20485,39141:20252,39142:20470,39143:20513,39144:20521,39145:20524,39146:20478,39147:20463,39148:20497,39149:20486,39150:20547,39151:20551,39152:26371,39153:20565,39154:20560,39155:20552,39156:20570,39157:20566,39158:20588,39159:20600,39160:20608,39161:20634,39162:20613,39163:20660,39164:20658,39232:20681,39233:20682,39234:20659,39235:20674,39236:20694,39237:20702,39238:20709,39239:20717,39240:20707,39241:20718,39242:20729,39243:20725,39244:20745,39245:20737,39246:20738,39247:20758,39248:20757,39249:20756,39250:20762,39251:20769,39252:20794,39253:20791,39254:20796,39255:20795,39256:20799,39257:20800,39258:20818,39259:20812,39260:20820,39261:20834,39262:31480,39263:20841,39264:20842,39265:20846,39266:20864,39267:20866,39268:22232,39269:20876,39270:20873,39271:20879,39272:20881,39273:20883,39274:20885,39275:20886,39276:20900,39277:20902,39278:20898,39279:20905,39280:20906,39281:20907,39282:20915,39283:20913,39284:20914,39285:20912,39286:20917,39287:20925,39288:20933,39289:20937,39290:20955,39291:20960,39292:34389,39293:20969,39294:20973,39296:20976,39297:20981,39298:20990,39299:20996,39300:21003,39301:21012,39302:21006,39303:21031,39304:21034,39305:21038,39306:21043,39307:21049,39308:21071,39309:21060,39310:21067,39311:21068,39312:21086,39313:21076,39314:21098,39315:21108,39316:21097,39317:21107,39318:21119,39319:21117,39320:21133,39321:21140,39322:21138,39323:21105,39324:21128,39325:21137,39326:36776,39327:36775,39328:21164,39329:21165,39330:21180,39331:21173,39332:21185,39333:21197,39334:21207,39335:21214,39336:21219,39337:21222,39338:39149,39339:21216,39340:21235,39341:21237,39342:21240,39343:21241,39344:21254,39345:21256,39346:30008,39347:21261,39348:21264,39349:21263,39350:21269,39351:21274,39352:21283,39353:21295,39354:21297,39355:21299,39356:21304,39357:21312,39358:21318,39359:21317,39360:19991,39361:21321,39362:21325,39363:20950,39364:21342,39365:21353,39366:21358,39367:22808,39368:21371,39369:21367,39370:21378,39371:21398,39372:21408,39373:21414,39374:21413,39375:21422,39376:21424,39377:21430,39378:21443,39379:31762,39380:38617,39381:21471,39382:26364,39383:29166,39384:21486,39385:21480,39386:21485,39387:21498,39388:21505,39389:21565,39390:21568,39391:21548,39392:21549,39393:21564,39394:21550,39395:21558,39396:21545,39397:21533,39398:21582,39399:21647,39400:21621,39401:21646,39402:21599,39403:21617,39404:21623,39405:21616,39406:21650,39407:21627,39408:21632,39409:21622,39410:21636,39411:21648,39412:21638,39413:21703,39414:21666,39415:21688,39416:21669,39417:21676,39418:21700,39419:21704,39420:21672,39488:21675,39489:21698,39490:21668,39491:21694,39492:21692,39493:21720,39494:21733,39495:21734,39496:21775,39497:21780,39498:21757,39499:21742,39500:21741,39501:21754,39502:21730,39503:21817,39504:21824,39505:21859,39506:21836,39507:21806,39508:21852,39509:21829,39510:21846,39511:21847,39512:21816,39513:21811,39514:21853,39515:21913,39516:21888,39517:21679,39518:21898,39519:21919,39520:21883,39521:21886,39522:21912,39523:21918,39524:21934,39525:21884,39526:21891,39527:21929,39528:21895,39529:21928,39530:21978,39531:21957,39532:21983,39533:21956,39534:21980,39535:21988,39536:21972,39537:22036,39538:22007,39539:22038,39540:22014,39541:22013,39542:22043,39543:22009,39544:22094,39545:22096,39546:29151,39547:22068,39548:22070,39549:22066,39550:22072,39552:22123,39553:22116,39554:22063,39555:22124,39556:22122,39557:22150,39558:22144,39559:22154,39560:22176,39561:22164,39562:22159,39563:22181,39564:22190,39565:22198,39566:22196,39567:22210,39568:22204,39569:22209,39570:22211,39571:22208,39572:22216,39573:22222,39574:22225,39575:22227,39576:22231,39577:22254,39578:22265,39579:22272,39580:22271,39581:22276,39582:22281,39583:22280,39584:22283,39585:22285,39586:22291,39587:22296,39588:22294,39589:21959,39590:22300,39591:22310,39592:22327,39593:22328,39594:22350,39595:22331,39596:22336,39597:22351,39598:22377,39599:22464,39600:22408,39601:22369,39602:22399,39603:22409,39604:22419,39605:22432,39606:22451,39607:22436,39608:22442,39609:22448,39610:22467,39611:22470,39612:22484,39613:22482,39614:22483,39615:22538,39616:22486,39617:22499,39618:22539,39619:22553,39620:22557,39621:22642,39622:22561,39623:22626,39624:22603,39625:22640,39626:27584,39627:22610,39628:22589,39629:22649,39630:22661,39631:22713,39632:22687,39633:22699,39634:22714,39635:22750,39636:22715,39637:22712,39638:22702,39639:22725,39640:22739,39641:22737,39642:22743,39643:22745,39644:22744,39645:22757,39646:22748,39647:22756,39648:22751,39649:22767,39650:22778,39651:22777,39652:22779,39653:22780,39654:22781,39655:22786,39656:22794,39657:22800,39658:22811,39659:26790,39660:22821,39661:22828,39662:22829,39663:22834,39664:22840,39665:22846,39666:31442,39667:22869,39668:22864,39669:22862,39670:22874,39671:22872,39672:22882,39673:22880,39674:22887,39675:22892,39676:22889,39744:22904,39745:22913,39746:22941,39747:20318,39748:20395,39749:22947,39750:22962,39751:22982,39752:23016,39753:23004,39754:22925,39755:23001,39756:23002,39757:23077,39758:23071,39759:23057,39760:23068,39761:23049,39762:23066,39763:23104,39764:23148,39765:23113,39766:23093,39767:23094,39768:23138,39769:23146,39770:23194,39771:23228,39772:23230,39773:23243,39774:23234,39775:23229,39776:23267,39777:23255,39778:23270,39779:23273,39780:23254,39781:23290,39782:23291,39783:23308,39784:23307,39785:23318,39786:23346,39787:23248,39788:23338,39789:23350,39790:23358,39791:23363,39792:23365,39793:23360,39794:23377,39795:23381,39796:23386,39797:23387,39798:23397,39799:23401,39800:23408,39801:23411,39802:23413,39803:23416,39804:25992,39805:23418,39806:23424,39808:23427,39809:23462,39810:23480,39811:23491,39812:23495,39813:23497,39814:23508,39815:23504,39816:23524,39817:23526,39818:23522,39819:23518,39820:23525,39821:23531,39822:23536,39823:23542,39824:23539,39825:23557,39826:23559,39827:23560,39828:23565,39829:23571,39830:23584,39831:23586,39832:23592,39833:23608,39834:23609,39835:23617,39836:23622,39837:23630,39838:23635,39839:23632,39840:23631,39841:23409,39842:23660,39843:23662,39844:20066,39845:23670,39846:23673,39847:23692,39848:23697,39849:23700,39850:22939,39851:23723,39852:23739,39853:23734,39854:23740,39855:23735,39856:23749,39857:23742,39858:23751,39859:23769,39860:23785,39861:23805,39862:23802,39863:23789,39864:23948,39865:23786,39866:23819,39867:23829,39868:23831,39869:23900,39870:23839,39871:23835,39872:23825,39873:23828,39874:23842,39875:23834,39876:23833,39877:23832,39878:23884,39879:23890,39880:23886,39881:23883,39882:23916,39883:23923,39884:23926,39885:23943,39886:23940,39887:23938,39888:23970,39889:23965,39890:23980,39891:23982,39892:23997,39893:23952,39894:23991,39895:23996,39896:24009,39897:24013,39898:24019,39899:24018,39900:24022,39901:24027,39902:24043,39903:24050,39904:24053,39905:24075,39906:24090,39907:24089,39908:24081,39909:24091,39910:24118,39911:24119,39912:24132,39913:24131,39914:24128,39915:24142,39916:24151,39917:24148,39918:24159,39919:24162,39920:24164,39921:24135,39922:24181,39923:24182,39924:24186,39925:40636,39926:24191,39927:24224,39928:24257,39929:24258,39930:24264,39931:24272,39932:24271,4e4:24278,40001:24291,40002:24285,40003:24282,40004:24283,40005:24290,40006:24289,40007:24296,40008:24297,40009:24300,40010:24305,40011:24307,40012:24304,40013:24308,40014:24312,40015:24318,40016:24323,40017:24329,40018:24413,40019:24412,40020:24331,40021:24337,40022:24342,40023:24361,40024:24365,40025:24376,40026:24385,40027:24392,40028:24396,40029:24398,40030:24367,40031:24401,40032:24406,40033:24407,40034:24409,40035:24417,40036:24429,40037:24435,40038:24439,40039:24451,40040:24450,40041:24447,40042:24458,40043:24456,40044:24465,40045:24455,40046:24478,40047:24473,40048:24472,40049:24480,40050:24488,40051:24493,40052:24508,40053:24534,40054:24571,40055:24548,40056:24568,40057:24561,40058:24541,40059:24755,40060:24575,40061:24609,40062:24672,40064:24601,40065:24592,40066:24617,40067:24590,40068:24625,40069:24603,40070:24597,40071:24619,40072:24614,40073:24591,40074:24634,40075:24666,40076:24641,40077:24682,40078:24695,40079:24671,40080:24650,40081:24646,40082:24653,40083:24675,40084:24643,40085:24676,40086:24642,40087:24684,40088:24683,40089:24665,40090:24705,40091:24717,40092:24807,40093:24707,40094:24730,40095:24708,40096:24731,40097:24726,40098:24727,40099:24722,40100:24743,40101:24715,40102:24801,40103:24760,40104:24800,40105:24787,40106:24756,40107:24560,40108:24765,40109:24774,40110:24757,40111:24792,40112:24909,40113:24853,40114:24838,40115:24822,40116:24823,40117:24832,40118:24820,40119:24826,40120:24835,40121:24865,40122:24827,40123:24817,40124:24845,40125:24846,40126:24903,40127:24894,40128:24872,40129:24871,40130:24906,40131:24895,40132:24892,40133:24876,40134:24884,40135:24893,40136:24898,40137:24900,40138:24947,40139:24951,40140:24920,40141:24921,40142:24922,40143:24939,40144:24948,40145:24943,40146:24933,40147:24945,40148:24927,40149:24925,40150:24915,40151:24949,40152:24985,40153:24982,40154:24967,40155:25004,40156:24980,40157:24986,40158:24970,40159:24977,40160:25003,40161:25006,40162:25036,40163:25034,40164:25033,40165:25079,40166:25032,40167:25027,40168:25030,40169:25018,40170:25035,40171:32633,40172:25037,40173:25062,40174:25059,40175:25078,40176:25082,40177:25076,40178:25087,40179:25085,40180:25084,40181:25086,40182:25088,40183:25096,40184:25097,40185:25101,40186:25100,40187:25108,40188:25115,40256:25118,40257:25121,40258:25130,40259:25134,40260:25136,40261:25138,40262:25139,40263:25153,40264:25166,40265:25182,40266:25187,40267:25179,40268:25184,40269:25192,40270:25212,40271:25218,40272:25225,40273:25214,40274:25234,40275:25235,40276:25238,40277:25300,40278:25219,40279:25236,40280:25303,40281:25297,40282:25275,40283:25295,40284:25343,40285:25286,40286:25812,40287:25288,40288:25308,40289:25292,40290:25290,40291:25282,40292:25287,40293:25243,40294:25289,40295:25356,40296:25326,40297:25329,40298:25383,40299:25346,40300:25352,40301:25327,40302:25333,40303:25424,40304:25406,40305:25421,40306:25628,40307:25423,40308:25494,40309:25486,40310:25472,40311:25515,40312:25462,40313:25507,40314:25487,40315:25481,40316:25503,40317:25525,40318:25451,40320:25449,40321:25534,40322:25577,40323:25536,40324:25542,40325:25571,40326:25545,40327:25554,40328:25590,40329:25540,40330:25622,40331:25652,40332:25606,40333:25619,40334:25638,40335:25654,40336:25885,40337:25623,40338:25640,40339:25615,40340:25703,40341:25711,40342:25718,40343:25678,40344:25898,40345:25749,40346:25747,40347:25765,40348:25769,40349:25736,40350:25788,40351:25818,40352:25810,40353:25797,40354:25799,40355:25787,40356:25816,40357:25794,40358:25841,40359:25831,40360:33289,40361:25824,40362:25825,40363:25260,40364:25827,40365:25839,40366:25900,40367:25846,40368:25844,40369:25842,40370:25850,40371:25856,40372:25853,40373:25880,40374:25884,40375:25861,40376:25892,40377:25891,40378:25899,40379:25908,40380:25909,40381:25911,40382:25910,40383:25912,40384:30027,40385:25928,40386:25942,40387:25941,40388:25933,40389:25944,40390:25950,40391:25949,40392:25970,40393:25976,40394:25986,40395:25987,40396:35722,40397:26011,40398:26015,40399:26027,40400:26039,40401:26051,40402:26054,40403:26049,40404:26052,40405:26060,40406:26066,40407:26075,40408:26073,40409:26080,40410:26081,40411:26097,40412:26482,40413:26122,40414:26115,40415:26107,40416:26483,40417:26165,40418:26166,40419:26164,40420:26140,40421:26191,40422:26180,40423:26185,40424:26177,40425:26206,40426:26205,40427:26212,40428:26215,40429:26216,40430:26207,40431:26210,40432:26224,40433:26243,40434:26248,40435:26254,40436:26249,40437:26244,40438:26264,40439:26269,40440:26305,40441:26297,40442:26313,40443:26302,40444:26300,40512:26308,40513:26296,40514:26326,40515:26330,40516:26336,40517:26175,40518:26342,40519:26345,40520:26352,40521:26357,40522:26359,40523:26383,40524:26390,40525:26398,40526:26406,40527:26407,40528:38712,40529:26414,40530:26431,40531:26422,40532:26433,40533:26424,40534:26423,40535:26438,40536:26462,40537:26464,40538:26457,40539:26467,40540:26468,40541:26505,40542:26480,40543:26537,40544:26492,40545:26474,40546:26508,40547:26507,40548:26534,40549:26529,40550:26501,40551:26551,40552:26607,40553:26548,40554:26604,40555:26547,40556:26601,40557:26552,40558:26596,40559:26590,40560:26589,40561:26594,40562:26606,40563:26553,40564:26574,40565:26566,40566:26599,40567:27292,40568:26654,40569:26694,40570:26665,40571:26688,40572:26701,40573:26674,40574:26702,40576:26803,40577:26667,40578:26713,40579:26723,40580:26743,40581:26751,40582:26783,40583:26767,40584:26797,40585:26772,40586:26781,40587:26779,40588:26755,40589:27310,40590:26809,40591:26740,40592:26805,40593:26784,40594:26810,40595:26895,40596:26765,40597:26750,40598:26881,40599:26826,40600:26888,40601:26840,40602:26914,40603:26918,40604:26849,40605:26892,40606:26829,40607:26836,40608:26855,40609:26837,40610:26934,40611:26898,40612:26884,40613:26839,40614:26851,40615:26917,40616:26873,40617:26848,40618:26863,40619:26920,40620:26922,40621:26906,40622:26915,40623:26913,40624:26822,40625:27001,40626:26999,40627:26972,40628:27e3,40629:26987,40630:26964,40631:27006,40632:26990,40633:26937,40634:26996,40635:26941,40636:26969,40637:26928,40638:26977,40639:26974,40640:26973,40641:27009,40642:26986,40643:27058,40644:27054,40645:27088,40646:27071,40647:27073,40648:27091,40649:27070,40650:27086,40651:23528,40652:27082,40653:27101,40654:27067,40655:27075,40656:27047,40657:27182,40658:27025,40659:27040,40660:27036,40661:27029,40662:27060,40663:27102,40664:27112,40665:27138,40666:27163,40667:27135,40668:27402,40669:27129,40670:27122,40671:27111,40672:27141,40673:27057,40674:27166,40675:27117,40676:27156,40677:27115,40678:27146,40679:27154,40680:27329,40681:27171,40682:27155,40683:27204,40684:27148,40685:27250,40686:27190,40687:27256,40688:27207,40689:27234,40690:27225,40691:27238,40692:27208,40693:27192,40694:27170,40695:27280,40696:27277,40697:27296,40698:27268,40699:27298,40700:27299,40768:27287,40769:34327,40770:27323,40771:27331,40772:27330,40773:27320,40774:27315,40775:27308,40776:27358,40777:27345,40778:27359,40779:27306,40780:27354,40781:27370,40782:27387,40783:27397,40784:34326,40785:27386,40786:27410,40787:27414,40788:39729,40789:27423,40790:27448,40791:27447,40792:30428,40793:27449,40794:39150,40795:27463,40796:27459,40797:27465,40798:27472,40799:27481,40800:27476,40801:27483,40802:27487,40803:27489,40804:27512,40805:27513,40806:27519,40807:27520,40808:27524,40809:27523,40810:27533,40811:27544,40812:27541,40813:27550,40814:27556,40815:27562,40816:27563,40817:27567,40818:27570,40819:27569,40820:27571,40821:27575,40822:27580,40823:27590,40824:27595,40825:27603,40826:27615,40827:27628,40828:27627,40829:27635,40830:27631,40832:40638,40833:27656,40834:27667,40835:27668,40836:27675,40837:27684,40838:27683,40839:27742,40840:27733,40841:27746,40842:27754,40843:27778,40844:27789,40845:27802,40846:27777,40847:27803,40848:27774,40849:27752,40850:27763,40851:27794,40852:27792,40853:27844,40854:27889,40855:27859,40856:27837,40857:27863,40858:27845,40859:27869,40860:27822,40861:27825,40862:27838,40863:27834,40864:27867,40865:27887,40866:27865,40867:27882,40868:27935,40869:34893,40870:27958,40871:27947,40872:27965,40873:27960,40874:27929,40875:27957,40876:27955,40877:27922,40878:27916,40879:28003,40880:28051,40881:28004,40882:27994,40883:28025,40884:27993,40885:28046,40886:28053,40887:28644,40888:28037,40889:28153,40890:28181,40891:28170,40892:28085,40893:28103,40894:28134,40895:28088,40896:28102,40897:28140,40898:28126,40899:28108,40900:28136,40901:28114,40902:28101,40903:28154,40904:28121,40905:28132,40906:28117,40907:28138,40908:28142,40909:28205,40910:28270,40911:28206,40912:28185,40913:28274,40914:28255,40915:28222,40916:28195,40917:28267,40918:28203,40919:28278,40920:28237,40921:28191,40922:28227,40923:28218,40924:28238,40925:28196,40926:28415,40927:28189,40928:28216,40929:28290,40930:28330,40931:28312,40932:28361,40933:28343,40934:28371,40935:28349,40936:28335,40937:28356,40938:28338,40939:28372,40940:28373,40941:28303,40942:28325,40943:28354,40944:28319,40945:28481,40946:28433,40947:28748,40948:28396,40949:28408,40950:28414,40951:28479,40952:28402,40953:28465,40954:28399,40955:28466,40956:28364,161:65377,162:65378,163:65379,164:65380,165:65381,166:65382,167:65383,168:65384,169:65385,170:65386,171:65387,172:65388,173:65389,174:65390,175:65391,176:65392,177:65393,178:65394,179:65395,180:65396,181:65397,182:65398,183:65399,184:65400,185:65401,186:65402,187:65403,188:65404,189:65405,190:65406,191:65407,192:65408,193:65409,194:65410,195:65411,196:65412,197:65413,198:65414,199:65415,200:65416,201:65417,202:65418,203:65419,204:65420,205:65421,206:65422,207:65423,208:65424,209:65425,210:65426,211:65427,212:65428,213:65429,214:65430,215:65431,216:65432,217:65433,218:65434,219:65435,220:65436,221:65437,222:65438,223:65439,57408:28478,57409:28435,57410:28407,57411:28550,57412:28538,57413:28536,57414:28545,57415:28544,57416:28527,57417:28507,57418:28659,57419:28525,57420:28546,57421:28540,57422:28504,57423:28558,57424:28561,57425:28610,57426:28518,57427:28595,57428:28579,57429:28577,57430:28580,57431:28601,57432:28614,57433:28586,57434:28639,57435:28629,57436:28652,57437:28628,57438:28632,57439:28657,57440:28654,57441:28635,57442:28681,57443:28683,57444:28666,57445:28689,57446:28673,57447:28687,57448:28670,57449:28699,57450:28698,57451:28532,57452:28701,57453:28696,57454:28703,57455:28720,57456:28734,57457:28722,57458:28753,57459:28771,57460:28825,57461:28818,57462:28847,57463:28913,57464:28844,57465:28856,57466:28851,57467:28846,57468:28895,57469:28875,57470:28893,57472:28889,57473:28937,57474:28925,57475:28956,57476:28953,57477:29029,57478:29013,57479:29064,57480:29030,57481:29026,57482:29004,57483:29014,57484:29036,57485:29071,57486:29179,57487:29060,57488:29077,57489:29096,57490:29100,57491:29143,57492:29113,57493:29118,57494:29138,57495:29129,57496:29140,57497:29134,57498:29152,57499:29164,57500:29159,57501:29173,57502:29180,57503:29177,57504:29183,57505:29197,57506:29200,57507:29211,57508:29224,57509:29229,57510:29228,57511:29232,57512:29234,57513:29243,57514:29244,57515:29247,57516:29248,57517:29254,57518:29259,57519:29272,57520:29300,57521:29310,57522:29314,57523:29313,57524:29319,57525:29330,57526:29334,57527:29346,57528:29351,57529:29369,57530:29362,57531:29379,57532:29382,57533:29380,57534:29390,57535:29394,57536:29410,57537:29408,57538:29409,57539:29433,57540:29431,57541:20495,57542:29463,57543:29450,57544:29468,57545:29462,57546:29469,57547:29492,57548:29487,57549:29481,57550:29477,57551:29502,57552:29518,57553:29519,57554:40664,57555:29527,57556:29546,57557:29544,57558:29552,57559:29560,57560:29557,57561:29563,57562:29562,57563:29640,57564:29619,57565:29646,57566:29627,57567:29632,57568:29669,57569:29678,57570:29662,57571:29858,57572:29701,57573:29807,57574:29733,57575:29688,57576:29746,57577:29754,57578:29781,57579:29759,57580:29791,57581:29785,57582:29761,57583:29788,57584:29801,57585:29808,57586:29795,57587:29802,57588:29814,57589:29822,57590:29835,57591:29854,57592:29863,57593:29898,57594:29903,57595:29908,57596:29681,57664:29920,57665:29923,57666:29927,57667:29929,57668:29934,57669:29938,57670:29936,57671:29937,57672:29944,57673:29943,57674:29956,57675:29955,57676:29957,57677:29964,57678:29966,57679:29965,57680:29973,57681:29971,57682:29982,57683:29990,57684:29996,57685:30012,57686:30020,57687:30029,57688:30026,57689:30025,57690:30043,57691:30022,57692:30042,57693:30057,57694:30052,57695:30055,57696:30059,57697:30061,57698:30072,57699:30070,57700:30086,57701:30087,57702:30068,57703:30090,57704:30089,57705:30082,57706:30100,57707:30106,57708:30109,57709:30117,57710:30115,57711:30146,57712:30131,57713:30147,57714:30133,57715:30141,57716:30136,57717:30140,57718:30129,57719:30157,57720:30154,57721:30162,57722:30169,57723:30179,57724:30174,57725:30206,57726:30207,57728:30204,57729:30209,57730:30192,57731:30202,57732:30194,57733:30195,57734:30219,57735:30221,57736:30217,57737:30239,57738:30247,57739:30240,57740:30241,57741:30242,57742:30244,57743:30260,57744:30256,57745:30267,57746:30279,57747:30280,57748:30278,57749:30300,57750:30296,57751:30305,57752:30306,57753:30312,57754:30313,57755:30314,57756:30311,57757:30316,57758:30320,57759:30322,57760:30326,57761:30328,57762:30332,57763:30336,57764:30339,57765:30344,57766:30347,57767:30350,57768:30358,57769:30355,57770:30361,57771:30362,57772:30384,57773:30388,57774:30392,57775:30393,57776:30394,57777:30402,57778:30413,57779:30422,57780:30418,57781:30430,57782:30433,57783:30437,57784:30439,57785:30442,57786:34351,57787:30459,57788:30472,57789:30471,57790:30468,57791:30505,57792:30500,57793:30494,57794:30501,57795:30502,57796:30491,57797:30519,57798:30520,57799:30535,57800:30554,57801:30568,57802:30571,57803:30555,57804:30565,57805:30591,57806:30590,57807:30585,57808:30606,57809:30603,57810:30609,57811:30624,57812:30622,57813:30640,57814:30646,57815:30649,57816:30655,57817:30652,57818:30653,57819:30651,57820:30663,57821:30669,57822:30679,57823:30682,57824:30684,57825:30691,57826:30702,57827:30716,57828:30732,57829:30738,57830:31014,57831:30752,57832:31018,57833:30789,57834:30862,57835:30836,57836:30854,57837:30844,57838:30874,57839:30860,57840:30883,57841:30901,57842:30890,57843:30895,57844:30929,57845:30918,57846:30923,57847:30932,57848:30910,57849:30908,57850:30917,57851:30922,57852:30956,57920:30951,57921:30938,57922:30973,57923:30964,57924:30983,57925:30994,57926:30993,57927:31001,57928:31020,57929:31019,57930:31040,57931:31072,57932:31063,57933:31071,57934:31066,57935:31061,57936:31059,57937:31098,57938:31103,57939:31114,57940:31133,57941:31143,57942:40779,57943:31146,57944:31150,57945:31155,57946:31161,57947:31162,57948:31177,57949:31189,57950:31207,57951:31212,57952:31201,57953:31203,57954:31240,57955:31245,57956:31256,57957:31257,57958:31264,57959:31263,57960:31104,57961:31281,57962:31291,57963:31294,57964:31287,57965:31299,57966:31319,57967:31305,57968:31329,57969:31330,57970:31337,57971:40861,57972:31344,57973:31353,57974:31357,57975:31368,57976:31383,57977:31381,57978:31384,57979:31382,57980:31401,57981:31432,57982:31408,57984:31414,57985:31429,57986:31428,57987:31423,57988:36995,57989:31431,57990:31434,57991:31437,57992:31439,57993:31445,57994:31443,57995:31449,57996:31450,57997:31453,57998:31457,57999:31458,58e3:31462,58001:31469,58002:31472,58003:31490,58004:31503,58005:31498,58006:31494,58007:31539,58008:31512,58009:31513,58010:31518,58011:31541,58012:31528,58013:31542,58014:31568,58015:31610,58016:31492,58017:31565,58018:31499,58019:31564,58020:31557,58021:31605,58022:31589,58023:31604,58024:31591,58025:31600,58026:31601,58027:31596,58028:31598,58029:31645,58030:31640,58031:31647,58032:31629,58033:31644,58034:31642,58035:31627,58036:31634,58037:31631,58038:31581,58039:31641,58040:31691,58041:31681,58042:31692,58043:31695,58044:31668,58045:31686,58046:31709,58047:31721,58048:31761,58049:31764,58050:31718,58051:31717,58052:31840,58053:31744,58054:31751,58055:31763,58056:31731,58057:31735,58058:31767,58059:31757,58060:31734,58061:31779,58062:31783,58063:31786,58064:31775,58065:31799,58066:31787,58067:31805,58068:31820,58069:31811,58070:31828,58071:31823,58072:31808,58073:31824,58074:31832,58075:31839,58076:31844,58077:31830,58078:31845,58079:31852,58080:31861,58081:31875,58082:31888,58083:31908,58084:31917,58085:31906,58086:31915,58087:31905,58088:31912,58089:31923,58090:31922,58091:31921,58092:31918,58093:31929,58094:31933,58095:31936,58096:31941,58097:31938,58098:31960,58099:31954,58100:31964,58101:31970,58102:39739,58103:31983,58104:31986,58105:31988,58106:31990,58107:31994,58108:32006,58176:32002,58177:32028,58178:32021,58179:32010,58180:32069,58181:32075,58182:32046,58183:32050,58184:32063,58185:32053,58186:32070,58187:32115,58188:32086,58189:32078,58190:32114,58191:32104,58192:32110,58193:32079,58194:32099,58195:32147,58196:32137,58197:32091,58198:32143,58199:32125,58200:32155,58201:32186,58202:32174,58203:32163,58204:32181,58205:32199,58206:32189,58207:32171,58208:32317,58209:32162,58210:32175,58211:32220,58212:32184,58213:32159,58214:32176,58215:32216,58216:32221,58217:32228,58218:32222,58219:32251,58220:32242,58221:32225,58222:32261,58223:32266,58224:32291,58225:32289,58226:32274,58227:32305,58228:32287,58229:32265,58230:32267,58231:32290,58232:32326,58233:32358,58234:32315,58235:32309,58236:32313,58237:32323,58238:32311,58240:32306,58241:32314,58242:32359,58243:32349,58244:32342,58245:32350,58246:32345,58247:32346,58248:32377,58249:32362,58250:32361,58251:32380,58252:32379,58253:32387,58254:32213,58255:32381,58256:36782,58257:32383,58258:32392,58259:32393,58260:32396,58261:32402,58262:32400,58263:32403,58264:32404,58265:32406,58266:32398,58267:32411,58268:32412,58269:32568,58270:32570,58271:32581,58272:32588,58273:32589,58274:32590,58275:32592,58276:32593,58277:32597,58278:32596,58279:32600,58280:32607,58281:32608,58282:32616,58283:32617,58284:32615,58285:32632,58286:32642,58287:32646,58288:32643,58289:32648,58290:32647,58291:32652,58292:32660,58293:32670,58294:32669,58295:32666,58296:32675,58297:32687,58298:32690,58299:32697,58300:32686,58301:32694,58302:32696,58303:35697,58304:32709,58305:32710,58306:32714,58307:32725,58308:32724,58309:32737,58310:32742,58311:32745,58312:32755,58313:32761,58314:39132,58315:32774,58316:32772,58317:32779,58318:32786,58319:32792,58320:32793,58321:32796,58322:32801,58323:32808,58324:32831,58325:32827,58326:32842,58327:32838,58328:32850,58329:32856,58330:32858,58331:32863,58332:32866,58333:32872,58334:32883,58335:32882,58336:32880,58337:32886,58338:32889,58339:32893,58340:32895,58341:32900,58342:32902,58343:32901,58344:32923,58345:32915,58346:32922,58347:32941,58348:20880,58349:32940,58350:32987,58351:32997,58352:32985,58353:32989,58354:32964,58355:32986,58356:32982,58357:33033,58358:33007,58359:33009,58360:33051,58361:33065,58362:33059,58363:33071,58364:33099,58432:38539,58433:33094,58434:33086,58435:33107,58436:33105,58437:33020,58438:33137,58439:33134,58440:33125,58441:33126,58442:33140,58443:33155,58444:33160,58445:33162,58446:33152,58447:33154,58448:33184,58449:33173,58450:33188,58451:33187,58452:33119,58453:33171,58454:33193,58455:33200,58456:33205,58457:33214,58458:33208,58459:33213,58460:33216,58461:33218,58462:33210,58463:33225,58464:33229,58465:33233,58466:33241,58467:33240,58468:33224,58469:33242,58470:33247,58471:33248,58472:33255,58473:33274,58474:33275,58475:33278,58476:33281,58477:33282,58478:33285,58479:33287,58480:33290,58481:33293,58482:33296,58483:33302,58484:33321,58485:33323,58486:33336,58487:33331,58488:33344,58489:33369,58490:33368,58491:33373,58492:33370,58493:33375,58494:33380,58496:33378,58497:33384,58498:33386,58499:33387,58500:33326,58501:33393,58502:33399,58503:33400,58504:33406,58505:33421,58506:33426,58507:33451,58508:33439,58509:33467,58510:33452,58511:33505,58512:33507,58513:33503,58514:33490,58515:33524,58516:33523,58517:33530,58518:33683,58519:33539,58520:33531,58521:33529,58522:33502,58523:33542,58524:33500,58525:33545,58526:33497,58527:33589,58528:33588,58529:33558,58530:33586,58531:33585,58532:33600,58533:33593,58534:33616,58535:33605,58536:33583,58537:33579,58538:33559,58539:33560,58540:33669,58541:33690,58542:33706,58543:33695,58544:33698,58545:33686,58546:33571,58547:33678,58548:33671,58549:33674,58550:33660,58551:33717,58552:33651,58553:33653,58554:33696,58555:33673,58556:33704,58557:33780,58558:33811,58559:33771,58560:33742,58561:33789,58562:33795,58563:33752,58564:33803,58565:33729,58566:33783,58567:33799,58568:33760,58569:33778,58570:33805,58571:33826,58572:33824,58573:33725,58574:33848,58575:34054,58576:33787,58577:33901,58578:33834,58579:33852,58580:34138,58581:33924,58582:33911,58583:33899,58584:33965,58585:33902,58586:33922,58587:33897,58588:33862,58589:33836,58590:33903,58591:33913,58592:33845,58593:33994,58594:33890,58595:33977,58596:33983,58597:33951,58598:34009,58599:33997,58600:33979,58601:34010,58602:34e3,58603:33985,58604:33990,58605:34006,58606:33953,58607:34081,58608:34047,58609:34036,58610:34071,58611:34072,58612:34092,58613:34079,58614:34069,58615:34068,58616:34044,58617:34112,58618:34147,58619:34136,58620:34120,58688:34113,58689:34306,58690:34123,58691:34133,58692:34176,58693:34212,58694:34184,58695:34193,58696:34186,58697:34216,58698:34157,58699:34196,58700:34203,58701:34282,58702:34183,58703:34204,58704:34167,58705:34174,58706:34192,58707:34249,58708:34234,58709:34255,58710:34233,58711:34256,58712:34261,58713:34269,58714:34277,58715:34268,58716:34297,58717:34314,58718:34323,58719:34315,58720:34302,58721:34298,58722:34310,58723:34338,58724:34330,58725:34352,58726:34367,58727:34381,58728:20053,58729:34388,58730:34399,58731:34407,58732:34417,58733:34451,58734:34467,58735:34473,58736:34474,58737:34443,58738:34444,58739:34486,58740:34479,58741:34500,58742:34502,58743:34480,58744:34505,58745:34851,58746:34475,58747:34516,58748:34526,58749:34537,58750:34540,58752:34527,58753:34523,58754:34543,58755:34578,58756:34566,58757:34568,58758:34560,58759:34563,58760:34555,58761:34577,58762:34569,58763:34573,58764:34553,58765:34570,58766:34612,58767:34623,58768:34615,58769:34619,58770:34597,58771:34601,58772:34586,58773:34656,58774:34655,58775:34680,58776:34636,58777:34638,58778:34676,58779:34647,58780:34664,58781:34670,58782:34649,58783:34643,58784:34659,58785:34666,58786:34821,58787:34722,58788:34719,58789:34690,58790:34735,58791:34763,58792:34749,58793:34752,58794:34768,58795:38614,58796:34731,58797:34756,58798:34739,58799:34759,58800:34758,58801:34747,58802:34799,58803:34802,58804:34784,58805:34831,58806:34829,58807:34814,58808:34806,58809:34807,58810:34830,58811:34770,58812:34833,58813:34838,58814:34837,58815:34850,58816:34849,58817:34865,58818:34870,58819:34873,58820:34855,58821:34875,58822:34884,58823:34882,58824:34898,58825:34905,58826:34910,58827:34914,58828:34923,58829:34945,58830:34942,58831:34974,58832:34933,58833:34941,58834:34997,58835:34930,58836:34946,58837:34967,58838:34962,58839:34990,58840:34969,58841:34978,58842:34957,58843:34980,58844:34992,58845:35007,58846:34993,58847:35011,58848:35012,58849:35028,58850:35032,58851:35033,58852:35037,58853:35065,58854:35074,58855:35068,58856:35060,58857:35048,58858:35058,58859:35076,58860:35084,58861:35082,58862:35091,58863:35139,58864:35102,58865:35109,58866:35114,58867:35115,58868:35137,58869:35140,58870:35131,58871:35126,58872:35128,58873:35148,58874:35101,58875:35168,58876:35166,58944:35174,58945:35172,58946:35181,58947:35178,58948:35183,58949:35188,58950:35191,58951:35198,58952:35203,58953:35208,58954:35210,58955:35219,58956:35224,58957:35233,58958:35241,58959:35238,58960:35244,58961:35247,58962:35250,58963:35258,58964:35261,58965:35263,58966:35264,58967:35290,58968:35292,58969:35293,58970:35303,58971:35316,58972:35320,58973:35331,58974:35350,58975:35344,58976:35340,58977:35355,58978:35357,58979:35365,58980:35382,58981:35393,58982:35419,58983:35410,58984:35398,58985:35400,58986:35452,58987:35437,58988:35436,58989:35426,58990:35461,58991:35458,58992:35460,58993:35496,58994:35489,58995:35473,58996:35493,58997:35494,58998:35482,58999:35491,59e3:35524,59001:35533,59002:35522,59003:35546,59004:35563,59005:35571,59006:35559,59008:35556,59009:35569,59010:35604,59011:35552,59012:35554,59013:35575,59014:35550,59015:35547,59016:35596,59017:35591,59018:35610,59019:35553,59020:35606,59021:35600,59022:35607,59023:35616,59024:35635,59025:38827,59026:35622,59027:35627,59028:35646,59029:35624,59030:35649,59031:35660,59032:35663,59033:35662,59034:35657,59035:35670,59036:35675,59037:35674,59038:35691,59039:35679,59040:35692,59041:35695,59042:35700,59043:35709,59044:35712,59045:35724,59046:35726,59047:35730,59048:35731,59049:35734,59050:35737,59051:35738,59052:35898,59053:35905,59054:35903,59055:35912,59056:35916,59057:35918,59058:35920,59059:35925,59060:35938,59061:35948,59062:35960,59063:35962,59064:35970,59065:35977,59066:35973,59067:35978,59068:35981,59069:35982,59070:35988,59071:35964,59072:35992,59073:25117,59074:36013,59075:36010,59076:36029,59077:36018,59078:36019,59079:36014,59080:36022,59081:36040,59082:36033,59083:36068,59084:36067,59085:36058,59086:36093,59087:36090,59088:36091,59089:36100,59090:36101,59091:36106,59092:36103,59093:36111,59094:36109,59095:36112,59096:40782,59097:36115,59098:36045,59099:36116,59100:36118,59101:36199,59102:36205,59103:36209,59104:36211,59105:36225,59106:36249,59107:36290,59108:36286,59109:36282,59110:36303,59111:36314,59112:36310,59113:36300,59114:36315,59115:36299,59116:36330,59117:36331,59118:36319,59119:36323,59120:36348,59121:36360,59122:36361,59123:36351,59124:36381,59125:36382,59126:36368,59127:36383,59128:36418,59129:36405,59130:36400,59131:36404,59132:36426,59200:36423,59201:36425,59202:36428,59203:36432,59204:36424,59205:36441,59206:36452,59207:36448,59208:36394,59209:36451,59210:36437,59211:36470,59212:36466,59213:36476,59214:36481,59215:36487,59216:36485,59217:36484,59218:36491,59219:36490,59220:36499,59221:36497,59222:36500,59223:36505,59224:36522,59225:36513,59226:36524,59227:36528,59228:36550,59229:36529,59230:36542,59231:36549,59232:36552,59233:36555,59234:36571,59235:36579,59236:36604,59237:36603,59238:36587,59239:36606,59240:36618,59241:36613,59242:36629,59243:36626,59244:36633,59245:36627,59246:36636,59247:36639,59248:36635,59249:36620,59250:36646,59251:36659,59252:36667,59253:36665,59254:36677,59255:36674,59256:36670,59257:36684,59258:36681,59259:36678,59260:36686,59261:36695,59262:36700,59264:36706,59265:36707,59266:36708,59267:36764,59268:36767,59269:36771,59270:36781,59271:36783,59272:36791,59273:36826,59274:36837,59275:36834,59276:36842,59277:36847,59278:36999,59279:36852,59280:36869,59281:36857,59282:36858,59283:36881,59284:36885,59285:36897,59286:36877,59287:36894,59288:36886,59289:36875,59290:36903,59291:36918,59292:36917,59293:36921,59294:36856,59295:36943,59296:36944,59297:36945,59298:36946,59299:36878,59300:36937,59301:36926,59302:36950,59303:36952,59304:36958,59305:36968,59306:36975,59307:36982,59308:38568,59309:36978,59310:36994,59311:36989,59312:36993,59313:36992,59314:37002,59315:37001,59316:37007,59317:37032,59318:37039,59319:37041,59320:37045,59321:37090,59322:37092,59323:25160,59324:37083,59325:37122,59326:37138,59327:37145,59328:37170,59329:37168,59330:37194,59331:37206,59332:37208,59333:37219,59334:37221,59335:37225,59336:37235,59337:37234,59338:37259,59339:37257,59340:37250,59341:37282,59342:37291,59343:37295,59344:37290,59345:37301,59346:37300,59347:37306,59348:37312,59349:37313,59350:37321,59351:37323,59352:37328,59353:37334,59354:37343,59355:37345,59356:37339,59357:37372,59358:37365,59359:37366,59360:37406,59361:37375,59362:37396,59363:37420,59364:37397,59365:37393,59366:37470,59367:37463,59368:37445,59369:37449,59370:37476,59371:37448,59372:37525,59373:37439,59374:37451,59375:37456,59376:37532,59377:37526,59378:37523,59379:37531,59380:37466,59381:37583,59382:37561,59383:37559,59384:37609,59385:37647,59386:37626,59387:37700,59388:37678,59456:37657,59457:37666,59458:37658,59459:37667,59460:37690,59461:37685,59462:37691,59463:37724,59464:37728,59465:37756,59466:37742,59467:37718,59468:37808,59469:37804,59470:37805,59471:37780,59472:37817,59473:37846,59474:37847,59475:37864,59476:37861,59477:37848,59478:37827,59479:37853,59480:37840,59481:37832,59482:37860,59483:37914,59484:37908,59485:37907,59486:37891,59487:37895,59488:37904,59489:37942,59490:37931,59491:37941,59492:37921,59493:37946,59494:37953,59495:37970,59496:37956,59497:37979,59498:37984,59499:37986,59500:37982,59501:37994,59502:37417,59503:38e3,59504:38005,59505:38007,59506:38013,59507:37978,59508:38012,59509:38014,59510:38017,59511:38015,59512:38274,59513:38279,59514:38282,59515:38292,59516:38294,59517:38296,59518:38297,59520:38304,59521:38312,59522:38311,59523:38317,59524:38332,59525:38331,59526:38329,59527:38334,59528:38346,59529:28662,59530:38339,59531:38349,59532:38348,59533:38357,59534:38356,59535:38358,59536:38364,59537:38369,59538:38373,59539:38370,59540:38433,59541:38440,59542:38446,59543:38447,59544:38466,59545:38476,59546:38479,59547:38475,59548:38519,59549:38492,59550:38494,59551:38493,59552:38495,59553:38502,59554:38514,59555:38508,59556:38541,59557:38552,59558:38549,59559:38551,59560:38570,59561:38567,59562:38577,59563:38578,59564:38576,59565:38580,59566:38582,59567:38584,59568:38585,59569:38606,59570:38603,59571:38601,59572:38605,59573:35149,59574:38620,59575:38669,59576:38613,59577:38649,59578:38660,59579:38662,59580:38664,59581:38675,59582:38670,59583:38673,59584:38671,59585:38678,59586:38681,59587:38692,59588:38698,59589:38704,59590:38713,59591:38717,59592:38718,59593:38724,59594:38726,59595:38728,59596:38722,59597:38729,59598:38748,59599:38752,59600:38756,59601:38758,59602:38760,59603:21202,59604:38763,59605:38769,59606:38777,59607:38789,59608:38780,59609:38785,59610:38778,59611:38790,59612:38795,59613:38799,59614:38800,59615:38812,59616:38824,59617:38822,59618:38819,59619:38835,59620:38836,59621:38851,59622:38854,59623:38856,59624:38859,59625:38876,59626:38893,59627:40783,59628:38898,59629:31455,59630:38902,59631:38901,59632:38927,59633:38924,59634:38968,59635:38948,59636:38945,59637:38967,59638:38973,59639:38982,59640:38991,59641:38987,59642:39019,59643:39023,59644:39024,59712:39025,59713:39028,59714:39027,59715:39082,59716:39087,59717:39089,59718:39094,59719:39108,59720:39107,59721:39110,59722:39145,59723:39147,59724:39171,59725:39177,59726:39186,59727:39188,59728:39192,59729:39201,59730:39197,59731:39198,59732:39204,59733:39200,59734:39212,59735:39214,59736:39229,59737:39230,59738:39234,59739:39241,59740:39237,59741:39248,59742:39243,59743:39249,59744:39250,59745:39244,59746:39253,59747:39319,59748:39320,59749:39333,59750:39341,59751:39342,59752:39356,59753:39391,59754:39387,59755:39389,59756:39384,59757:39377,59758:39405,59759:39406,59760:39409,59761:39410,59762:39419,59763:39416,59764:39425,59765:39439,59766:39429,59767:39394,59768:39449,59769:39467,59770:39479,59771:39493,59772:39490,59773:39488,59774:39491,59776:39486,59777:39509,59778:39501,59779:39515,59780:39511,59781:39519,59782:39522,59783:39525,59784:39524,59785:39529,59786:39531,59787:39530,59788:39597,59789:39600,59790:39612,59791:39616,59792:39631,59793:39633,59794:39635,59795:39636,59796:39646,59797:39647,59798:39650,59799:39651,59800:39654,59801:39663,59802:39659,59803:39662,59804:39668,59805:39665,59806:39671,59807:39675,59808:39686,59809:39704,59810:39706,59811:39711,59812:39714,59813:39715,59814:39717,59815:39719,59816:39720,59817:39721,59818:39722,59819:39726,59820:39727,59821:39730,59822:39748,59823:39747,59824:39759,59825:39757,59826:39758,59827:39761,59828:39768,59829:39796,59830:39827,59831:39811,59832:39825,59833:39830,59834:39831,59835:39839,59836:39840,59837:39848,59838:39860,59839:39872,59840:39882,59841:39865,59842:39878,59843:39887,59844:39889,59845:39890,59846:39907,59847:39906,59848:39908,59849:39892,59850:39905,59851:39994,59852:39922,59853:39921,59854:39920,59855:39957,59856:39956,59857:39945,59858:39955,59859:39948,59860:39942,59861:39944,59862:39954,59863:39946,59864:39940,59865:39982,59866:39963,59867:39973,59868:39972,59869:39969,59870:39984,59871:40007,59872:39986,59873:40006,59874:39998,59875:40026,59876:40032,59877:40039,59878:40054,59879:40056,59880:40167,59881:40172,59882:40176,59883:40201,59884:40200,59885:40171,59886:40195,59887:40198,59888:40234,59889:40230,59890:40367,59891:40227,59892:40223,59893:40260,59894:40213,59895:40210,59896:40257,59897:40255,59898:40254,59899:40262,59900:40264,59968:40285,59969:40286,59970:40292,59971:40273,59972:40272,59973:40281,59974:40306,59975:40329,59976:40327,59977:40363,59978:40303,59979:40314,59980:40346,59981:40356,59982:40361,59983:40370,59984:40388,59985:40385,59986:40379,59987:40376,59988:40378,59989:40390,59990:40399,59991:40386,59992:40409,59993:40403,59994:40440,59995:40422,59996:40429,59997:40431,59998:40445,59999:40474,6e4:40475,60001:40478,60002:40565,60003:40569,60004:40573,60005:40577,60006:40584,60007:40587,60008:40588,60009:40594,60010:40597,60011:40593,60012:40605,60013:40613,60014:40617,60015:40632,60016:40618,60017:40621,60018:38753,60019:40652,60020:40654,60021:40655,60022:40656,60023:40660,60024:40668,60025:40670,60026:40669,60027:40672,60028:40677,60029:40680,60030:40687,60032:40692,60033:40694,60034:40695,60035:40697,60036:40699,60037:40700,60038:40701,60039:40711,60040:40712,60041:30391,60042:40725,60043:40737,60044:40748,60045:40766,60046:40778,60047:40786,60048:40788,60049:40803,60050:40799,60051:40800,60052:40801,60053:40806,60054:40807,60055:40812,60056:40810,60057:40823,60058:40818,60059:40822,60060:40853,60061:40860,60062:40864,60063:22575,60064:27079,60065:36953,60066:29796,60067:20956,60068:29081}},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e(1),i=e(2);function s(l,h,u,d){var x;h.degree()<u.degree()&&(x=[u,h],h=x[0],u=x[1]);for(var m=h,g=u,f=l.zero,p=l.one;g.degree()>=d/2;){var v=m,E=f;if(m=g,f=p,m.isZero())return null;g=v;for(var C=l.zero,b=m.getCoefficient(m.degree()),A=l.inverse(b);g.degree()>=m.degree()&&!g.isZero();){var w=g.degree()-m.degree(),S=l.multiply(g.getCoefficient(g.degree()),A);C=C.addOrSubtract(l.buildMonomial(w,S)),g=g.addOrSubtract(m.multiplyByMonomial(w,S))}if(p=C.multiplyPoly(f).addOrSubtract(E),g.degree()>=m.degree())return null}var _=p.getCoefficient(0);if(_===0)return null;var y=l.inverse(_);return[p.multiply(y),g.multiply(y)]}function o(l,h){var u=h.degree();if(u===1)return[h.getCoefficient(1)];for(var d=new Array(u),x=0,m=1;m<l.size&&x<u;m++)h.evaluateAt(m)===0&&(d[x]=l.inverse(m),x++);return x!==u?null:d}function a(l,h,u){for(var d=u.length,x=new Array(d),m=0;m<d;m++){for(var g=l.inverse(u[m]),f=1,p=0;p<d;p++)m!==p&&(f=l.multiply(f,n.addOrSubtractGF(1,l.multiply(u[p],g))));x[m]=l.multiply(h.evaluateAt(g),l.inverse(f)),l.generatorBase!==0&&(x[m]=l.multiply(x[m],g))}return x}function c(l,h){var u=new Uint8ClampedArray(l.length);u.set(l);for(var d=new n.default(285,256,0),x=new i.default(d,u),m=new Uint8ClampedArray(h),g=!1,f=0;f<h;f++){var p=x.evaluateAt(d.exp(f+d.generatorBase));m[m.length-1-f]=p,p!==0&&(g=!0)}if(!g)return u;var v=new i.default(d,m),E=s(d,d.buildMonomial(h,1),v,h);if(E===null)return null;var C=o(d,E[0]);if(C==null)return null;for(var b=a(d,E[1],C),A=0;A<C.length;A++){var w=u.length-1-d.log(C[A]);if(w<0)return null;u[w]=n.addOrSubtractGF(u[w],b[A])}return u}t.decode=c},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSIONS=[{infoBits:null,versionNumber:1,alignmentPatternCenters:[],errorCorrectionLevels:[{ecCodewordsPerBlock:7,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:10,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:16}]},{ecCodewordsPerBlock:13,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:13}]},{ecCodewordsPerBlock:17,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:9}]}]},{infoBits:null,versionNumber:2,alignmentPatternCenters:[6,18],errorCorrectionLevels:[{ecCodewordsPerBlock:10,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:34}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:28}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:22}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:16}]}]},{infoBits:null,versionNumber:3,alignmentPatternCenters:[6,22],errorCorrectionLevels:[{ecCodewordsPerBlock:15,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:55}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:13}]}]},{infoBits:null,versionNumber:4,alignmentPatternCenters:[6,26],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:80}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:32}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:9}]}]},{infoBits:null,versionNumber:5,alignmentPatternCenters:[6,30],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:43}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:15},{numBlocks:2,dataCodewordsPerBlock:16}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:11},{numBlocks:2,dataCodewordsPerBlock:12}]}]},{infoBits:null,versionNumber:6,alignmentPatternCenters:[6,34],errorCorrectionLevels:[{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:68}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:27}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:15}]}]},{infoBits:31892,versionNumber:7,alignmentPatternCenters:[6,22,38],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:78}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:31}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:4,dataCodewordsPerBlock:15}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:13},{numBlocks:1,dataCodewordsPerBlock:14}]}]},{infoBits:34236,versionNumber:8,alignmentPatternCenters:[6,24,42],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:97}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:38},{numBlocks:2,dataCodewordsPerBlock:39}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:18},{numBlocks:2,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:14},{numBlocks:2,dataCodewordsPerBlock:15}]}]},{infoBits:39577,versionNumber:9,alignmentPatternCenters:[6,26,46],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:36},{numBlocks:2,dataCodewordsPerBlock:37}]},{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:16},{numBlocks:4,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:12},{numBlocks:4,dataCodewordsPerBlock:13}]}]},{infoBits:42195,versionNumber:10,alignmentPatternCenters:[6,28,50],errorCorrectionLevels:[{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:68},{numBlocks:2,dataCodewordsPerBlock:69}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:43},{numBlocks:1,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:19},{numBlocks:2,dataCodewordsPerBlock:20}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:15},{numBlocks:2,dataCodewordsPerBlock:16}]}]},{infoBits:48118,versionNumber:11,alignmentPatternCenters:[6,30,54],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:81}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:50},{numBlocks:4,dataCodewordsPerBlock:51}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:22},{numBlocks:4,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:12},{numBlocks:8,dataCodewordsPerBlock:13}]}]},{infoBits:51042,versionNumber:12,alignmentPatternCenters:[6,32,58],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:92},{numBlocks:2,dataCodewordsPerBlock:93}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:36},{numBlocks:2,dataCodewordsPerBlock:37}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:20},{numBlocks:6,dataCodewordsPerBlock:21}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:14},{numBlocks:4,dataCodewordsPerBlock:15}]}]},{infoBits:55367,versionNumber:13,alignmentPatternCenters:[6,34,62],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:107}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:37},{numBlocks:1,dataCodewordsPerBlock:38}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:20},{numBlocks:4,dataCodewordsPerBlock:21}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:11},{numBlocks:4,dataCodewordsPerBlock:12}]}]},{infoBits:58893,versionNumber:14,alignmentPatternCenters:[6,26,46,66],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:115},{numBlocks:1,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:40},{numBlocks:5,dataCodewordsPerBlock:41}]},{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:16},{numBlocks:5,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:12},{numBlocks:5,dataCodewordsPerBlock:13}]}]},{infoBits:63784,versionNumber:15,alignmentPatternCenters:[6,26,48,70],errorCorrectionLevels:[{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:87},{numBlocks:1,dataCodewordsPerBlock:88}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:41},{numBlocks:5,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:24},{numBlocks:7,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:12},{numBlocks:7,dataCodewordsPerBlock:13}]}]},{infoBits:68472,versionNumber:16,alignmentPatternCenters:[6,26,50,74],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:98},{numBlocks:1,dataCodewordsPerBlock:99}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:45},{numBlocks:3,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:19},{numBlocks:2,dataCodewordsPerBlock:20}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:15},{numBlocks:13,dataCodewordsPerBlock:16}]}]},{infoBits:70749,versionNumber:17,alignmentPatternCenters:[6,30,54,78],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:107},{numBlocks:5,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:46},{numBlocks:1,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:22},{numBlocks:15,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:17,dataCodewordsPerBlock:15}]}]},{infoBits:76311,versionNumber:18,alignmentPatternCenters:[6,30,56,82],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:120},{numBlocks:1,dataCodewordsPerBlock:121}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:9,dataCodewordsPerBlock:43},{numBlocks:4,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:22},{numBlocks:1,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:19,dataCodewordsPerBlock:15}]}]},{infoBits:79154,versionNumber:19,alignmentPatternCenters:[6,30,58,86],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:113},{numBlocks:4,dataCodewordsPerBlock:114}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:44},{numBlocks:11,dataCodewordsPerBlock:45}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:21},{numBlocks:4,dataCodewordsPerBlock:22}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:9,dataCodewordsPerBlock:13},{numBlocks:16,dataCodewordsPerBlock:14}]}]},{infoBits:84390,versionNumber:20,alignmentPatternCenters:[6,34,62,90],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:107},{numBlocks:5,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:41},{numBlocks:13,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:24},{numBlocks:5,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:15},{numBlocks:10,dataCodewordsPerBlock:16}]}]},{infoBits:87683,versionNumber:21,alignmentPatternCenters:[6,28,50,72,94],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:116},{numBlocks:4,dataCodewordsPerBlock:117}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:22},{numBlocks:6,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:16},{numBlocks:6,dataCodewordsPerBlock:17}]}]},{infoBits:92361,versionNumber:22,alignmentPatternCenters:[6,26,50,74,98],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:111},{numBlocks:7,dataCodewordsPerBlock:112}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:24},{numBlocks:16,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:34,dataCodewordsPerBlock:13}]}]},{infoBits:96236,versionNumber:23,alignmentPatternCenters:[6,30,54,74,102],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:121},{numBlocks:5,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:47},{numBlocks:14,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:16,dataCodewordsPerBlock:15},{numBlocks:14,dataCodewordsPerBlock:16}]}]},{infoBits:102084,versionNumber:24,alignmentPatternCenters:[6,28,54,80,106],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:117},{numBlocks:4,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:45},{numBlocks:14,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:24},{numBlocks:16,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:30,dataCodewordsPerBlock:16},{numBlocks:2,dataCodewordsPerBlock:17}]}]},{infoBits:102881,versionNumber:25,alignmentPatternCenters:[6,32,58,84,110],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:106},{numBlocks:4,dataCodewordsPerBlock:107}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:47},{numBlocks:13,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:24},{numBlocks:22,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:15},{numBlocks:13,dataCodewordsPerBlock:16}]}]},{infoBits:110507,versionNumber:26,alignmentPatternCenters:[6,30,58,86,114],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:114},{numBlocks:2,dataCodewordsPerBlock:115}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:46},{numBlocks:4,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:28,dataCodewordsPerBlock:22},{numBlocks:6,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:33,dataCodewordsPerBlock:16},{numBlocks:4,dataCodewordsPerBlock:17}]}]},{infoBits:110734,versionNumber:27,alignmentPatternCenters:[6,34,62,90,118],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:122},{numBlocks:4,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:45},{numBlocks:3,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:23},{numBlocks:26,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:15},{numBlocks:28,dataCodewordsPerBlock:16}]}]},{infoBits:117786,versionNumber:28,alignmentPatternCenters:[6,26,50,74,98,122],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:117},{numBlocks:10,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:45},{numBlocks:23,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:24},{numBlocks:31,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:15},{numBlocks:31,dataCodewordsPerBlock:16}]}]},{infoBits:119615,versionNumber:29,alignmentPatternCenters:[6,30,54,78,102,126],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:116},{numBlocks:7,dataCodewordsPerBlock:117}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:21,dataCodewordsPerBlock:45},{numBlocks:7,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:23},{numBlocks:37,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:15},{numBlocks:26,dataCodewordsPerBlock:16}]}]},{infoBits:126325,versionNumber:30,alignmentPatternCenters:[6,26,52,78,104,130],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:115},{numBlocks:10,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:47},{numBlocks:10,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:24},{numBlocks:25,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:23,dataCodewordsPerBlock:15},{numBlocks:25,dataCodewordsPerBlock:16}]}]},{infoBits:127568,versionNumber:31,alignmentPatternCenters:[6,30,56,82,108,134],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:115},{numBlocks:3,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:46},{numBlocks:29,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:42,dataCodewordsPerBlock:24},{numBlocks:1,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:23,dataCodewordsPerBlock:15},{numBlocks:28,dataCodewordsPerBlock:16}]}]},{infoBits:133589,versionNumber:32,alignmentPatternCenters:[6,34,60,86,112,138],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:115}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:46},{numBlocks:23,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:24},{numBlocks:35,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:15},{numBlocks:35,dataCodewordsPerBlock:16}]}]},{infoBits:136944,versionNumber:33,alignmentPatternCenters:[6,30,58,86,114,142],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:115},{numBlocks:1,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:14,dataCodewordsPerBlock:46},{numBlocks:21,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:29,dataCodewordsPerBlock:24},{numBlocks:19,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:15},{numBlocks:46,dataCodewordsPerBlock:16}]}]},{infoBits:141498,versionNumber:34,alignmentPatternCenters:[6,34,62,90,118,146],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:115},{numBlocks:6,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:14,dataCodewordsPerBlock:46},{numBlocks:23,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:44,dataCodewordsPerBlock:24},{numBlocks:7,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:59,dataCodewordsPerBlock:16},{numBlocks:1,dataCodewordsPerBlock:17}]}]},{infoBits:145311,versionNumber:35,alignmentPatternCenters:[6,30,54,78,102,126,150],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:121},{numBlocks:7,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:47},{numBlocks:26,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:39,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:15},{numBlocks:41,dataCodewordsPerBlock:16}]}]},{infoBits:150283,versionNumber:36,alignmentPatternCenters:[6,24,50,76,102,128,154],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:121},{numBlocks:14,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:47},{numBlocks:34,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:46,dataCodewordsPerBlock:24},{numBlocks:10,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:15},{numBlocks:64,dataCodewordsPerBlock:16}]}]},{infoBits:152622,versionNumber:37,alignmentPatternCenters:[6,28,54,80,106,132,158],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:122},{numBlocks:4,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:29,dataCodewordsPerBlock:46},{numBlocks:14,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:49,dataCodewordsPerBlock:24},{numBlocks:10,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:24,dataCodewordsPerBlock:15},{numBlocks:46,dataCodewordsPerBlock:16}]}]},{infoBits:158308,versionNumber:38,alignmentPatternCenters:[6,32,58,84,110,136,162],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:122},{numBlocks:18,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:46},{numBlocks:32,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:48,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:42,dataCodewordsPerBlock:15},{numBlocks:32,dataCodewordsPerBlock:16}]}]},{infoBits:161089,versionNumber:39,alignmentPatternCenters:[6,26,54,82,110,138,166],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:20,dataCodewordsPerBlock:117},{numBlocks:4,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:40,dataCodewordsPerBlock:47},{numBlocks:7,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:43,dataCodewordsPerBlock:24},{numBlocks:22,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:15},{numBlocks:67,dataCodewordsPerBlock:16}]}]},{infoBits:167017,versionNumber:40,alignmentPatternCenters:[6,30,58,86,114,142,170],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:118},{numBlocks:6,dataCodewordsPerBlock:119}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:18,dataCodewordsPerBlock:47},{numBlocks:31,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:34,dataCodewordsPerBlock:24},{numBlocks:34,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:20,dataCodewordsPerBlock:15},{numBlocks:61,dataCodewordsPerBlock:16}]}]}]},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e(0);function i(c,l,h,u){var d=c.x-l.x+h.x-u.x,x=c.y-l.y+h.y-u.y;if(d===0&&x===0)return{a11:l.x-c.x,a12:l.y-c.y,a13:0,a21:h.x-l.x,a22:h.y-l.y,a23:0,a31:c.x,a32:c.y,a33:1};var m=l.x-h.x,g=u.x-h.x,f=l.y-h.y,p=u.y-h.y,v=m*p-g*f,E=(d*p-g*x)/v,C=(m*x-d*f)/v;return{a11:l.x-c.x+E*l.x,a12:l.y-c.y+E*l.y,a13:E,a21:u.x-c.x+C*u.x,a22:u.y-c.y+C*u.y,a23:C,a31:c.x,a32:c.y,a33:1}}function s(c,l,h,u){var d=i(c,l,h,u);return{a11:d.a22*d.a33-d.a23*d.a32,a12:d.a13*d.a32-d.a12*d.a33,a13:d.a12*d.a23-d.a13*d.a22,a21:d.a23*d.a31-d.a21*d.a33,a22:d.a11*d.a33-d.a13*d.a31,a23:d.a13*d.a21-d.a11*d.a23,a31:d.a21*d.a32-d.a22*d.a31,a32:d.a12*d.a31-d.a11*d.a32,a33:d.a11*d.a22-d.a12*d.a21}}function o(c,l){return{a11:c.a11*l.a11+c.a21*l.a12+c.a31*l.a13,a12:c.a12*l.a11+c.a22*l.a12+c.a32*l.a13,a13:c.a13*l.a11+c.a23*l.a12+c.a33*l.a13,a21:c.a11*l.a21+c.a21*l.a22+c.a31*l.a23,a22:c.a12*l.a21+c.a22*l.a22+c.a32*l.a23,a23:c.a13*l.a21+c.a23*l.a22+c.a33*l.a23,a31:c.a11*l.a31+c.a21*l.a32+c.a31*l.a33,a32:c.a12*l.a31+c.a22*l.a32+c.a32*l.a33,a33:c.a13*l.a31+c.a23*l.a32+c.a33*l.a33}}function a(c,l){for(var h=s({x:3.5,y:3.5},{x:l.dimension-3.5,y:3.5},{x:l.dimension-6.5,y:l.dimension-6.5},{x:3.5,y:l.dimension-3.5}),u=i(l.topLeft,l.topRight,l.alignmentPattern,l.bottomLeft),d=o(u,h),x=n.BitMatrix.createEmpty(l.dimension,l.dimension),m=function(C,b){var A=d.a13*C+d.a23*b+d.a33;return{x:(d.a11*C+d.a21*b+d.a31)/A,y:(d.a12*C+d.a22*b+d.a32)/A}},g=0;g<l.dimension;g++)for(var f=0;f<l.dimension;f++){var p=f+.5,v=g+.5,E=m(p,v);x.set(f,g,c.get(Math.floor(E.x),Math.floor(E.y)))}return{matrix:x,mappingFunction:m}}t.extract=a},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=4,i=.5,s=1.5,o=function(p,v){return Math.sqrt(Math.pow(v.x-p.x,2)+Math.pow(v.y-p.y,2))};function a(p){return p.reduce(function(v,E){return v+E})}function c(p,v,E){var C,b,A,w,S=o(p,v),_=o(v,E),y=o(p,E),D,F,T;return _>=S&&_>=y?(C=[v,p,E],D=C[0],F=C[1],T=C[2]):y>=_&&y>=S?(b=[p,v,E],D=b[0],F=b[1],T=b[2]):(A=[p,E,v],D=A[0],F=A[1],T=A[2]),(T.x-F.x)*(D.y-F.y)-(T.y-F.y)*(D.x-F.x)<0&&(w=[T,D],D=w[0],T=w[1]),{bottomLeft:D,topLeft:F,topRight:T}}function l(p,v,E,C){var b=(a(u(p,E,C,5))/7+a(u(p,v,C,5))/7+a(u(E,p,C,5))/7+a(u(v,p,C,5))/7)/4;if(b<1)throw new Error("Invalid module size");var A=Math.round(o(p,v)/b),w=Math.round(o(p,E)/b),S=Math.floor((A+w)/2)+7;switch(S%4){case 0:S++;break;case 2:S--;break}return{dimension:S,moduleSize:b}}function h(p,v,E,C){var b=[{x:Math.floor(p.x),y:Math.floor(p.y)}],A=Math.abs(v.y-p.y)>Math.abs(v.x-p.x),w,S,_,y;A?(w=Math.floor(p.y),S=Math.floor(p.x),_=Math.floor(v.y),y=Math.floor(v.x)):(w=Math.floor(p.x),S=Math.floor(p.y),_=Math.floor(v.x),y=Math.floor(v.y));for(var D=Math.abs(_-w),F=Math.abs(y-S),T=Math.floor(-D/2),L=w<_?1:-1,N=S<y?1:-1,J=!0,tt=w,G=S;tt!==_+L;tt+=L){var X=A?G:tt,st=A?tt:G;if(E.get(X,st)!==J&&(J=!J,b.push({x:X,y:st}),b.length===C+1))break;if(T+=F,T>0){if(G===y)break;G+=N,T-=D}}for(var ft=[],mt=0;mt<C;mt++)b[mt]&&b[mt+1]?ft.push(o(b[mt],b[mt+1])):ft.push(0);return ft}function u(p,v,E,C){var b,A=v.y-p.y,w=v.x-p.x,S=h(p,v,E,Math.ceil(C/2)),_=h(p,{x:p.x-w,y:p.y-A},E,Math.ceil(C/2)),y=S.shift()+_.shift()-1;return(b=_.concat(y)).concat.apply(b,S)}function d(p,v){var E=a(p)/a(v),C=0;return v.forEach(function(b,A){C+=Math.pow(p[A]-b*E,2)}),{averageSize:E,error:C}}function x(p,v,E){try{var C=u(p,{x:-1,y:p.y},E,v.length),b=u(p,{x:p.x,y:-1},E,v.length),A={x:Math.max(0,p.x-p.y)-1,y:Math.max(0,p.y-p.x)-1},w=u(p,A,E,v.length),S={x:Math.min(E.width,p.x+p.y)+1,y:Math.min(E.height,p.y+p.x)+1},_=u(p,S,E,v.length),y=d(C,v),D=d(b,v),F=d(w,v),T=d(_,v),L=Math.sqrt(y.error*y.error+D.error*D.error+F.error*F.error+T.error*T.error),N=(y.averageSize+D.averageSize+F.averageSize+T.averageSize)/4,J=(Math.pow(y.averageSize-N,2)+Math.pow(D.averageSize-N,2)+Math.pow(F.averageSize-N,2)+Math.pow(T.averageSize-N,2))/N;return L+J}catch{return 1/0}}function m(p,v){for(var E=Math.round(v.x);p.get(E,Math.round(v.y));)E--;for(var C=Math.round(v.x);p.get(C,Math.round(v.y));)C++;for(var b=(E+C)/2,A=Math.round(v.y);p.get(Math.round(b),A);)A--;for(var w=Math.round(v.y);p.get(Math.round(b),w);)w++;var S=(A+w)/2;return{x:b,y:S}}function g(p){for(var v=[],E=[],C=[],b=[],A=function(X){for(var st=0,ft=!1,mt=[0,0,0,0,0],Jt=function(O){var V=p.get(O,X);if(V===ft)st++;else{mt=[mt[1],mt[2],mt[3],mt[4],st],st=1,ft=V;var k=a(mt)/7,K=Math.abs(mt[0]-k)<k&&Math.abs(mt[1]-k)<k&&Math.abs(mt[2]-3*k)<3*k&&Math.abs(mt[3]-k)<k&&Math.abs(mt[4]-k)<k&&!V,Y=a(mt.slice(-3))/3,R=Math.abs(mt[2]-Y)<Y&&Math.abs(mt[3]-Y)<Y&&Math.abs(mt[4]-Y)<Y&&V;if(K){var vt=O-mt[3]-mt[4],ht=vt-mt[2],Tt={startX:ht,endX:vt,y:X},Ct=E.filter(function(Ft){return ht>=Ft.bottom.startX&&ht<=Ft.bottom.endX||vt>=Ft.bottom.startX&&ht<=Ft.bottom.endX||ht<=Ft.bottom.startX&&vt>=Ft.bottom.endX&&mt[2]/(Ft.bottom.endX-Ft.bottom.startX)<s&&mt[2]/(Ft.bottom.endX-Ft.bottom.startX)>i});Ct.length>0?Ct[0].bottom=Tt:E.push({top:Tt,bottom:Tt})}if(R){var pt=O-mt[4],Rt=pt-mt[3],Tt={startX:Rt,y:X,endX:pt},Ct=b.filter(function(P){return Rt>=P.bottom.startX&&Rt<=P.bottom.endX||pt>=P.bottom.startX&&Rt<=P.bottom.endX||Rt<=P.bottom.startX&&pt>=P.bottom.endX&&mt[2]/(P.bottom.endX-P.bottom.startX)<s&&mt[2]/(P.bottom.endX-P.bottom.startX)>i});Ct.length>0?Ct[0].bottom=Tt:b.push({top:Tt,bottom:Tt})}}},q=-1;q<=p.width;q++)Jt(q);v.push.apply(v,E.filter(function(O){return O.bottom.y!==X&&O.bottom.y-O.top.y>=2})),E=E.filter(function(O){return O.bottom.y===X}),C.push.apply(C,b.filter(function(O){return O.bottom.y!==X})),b=b.filter(function(O){return O.bottom.y===X})},w=0;w<=p.height;w++)A(w);v.push.apply(v,E.filter(function(X){return X.bottom.y-X.top.y>=2})),C.push.apply(C,b);var S=v.filter(function(X){return X.bottom.y-X.top.y>=2}).map(function(X){var st=(X.top.startX+X.top.endX+X.bottom.startX+X.bottom.endX)/4,ft=(X.top.y+X.bottom.y+1)/2;if(p.get(Math.round(st),Math.round(ft))){var mt=[X.top.endX-X.top.startX,X.bottom.endX-X.bottom.startX,X.bottom.y-X.top.y+1],Jt=a(mt)/mt.length,q=x({x:Math.round(st),y:Math.round(ft)},[1,1,3,1,1],p);return{score:q,x:st,y:ft,size:Jt}}}).filter(function(X){return!!X}).sort(function(X,st){return X.score-st.score}).map(function(X,st,ft){if(st>n)return null;var mt=ft.filter(function(q,O){return st!==O}).map(function(q){return{x:q.x,y:q.y,score:q.score+Math.pow(q.size-X.size,2)/X.size,size:q.size}}).sort(function(q,O){return q.score-O.score});if(mt.length<2)return null;var Jt=X.score+mt[0].score+mt[1].score;return{points:[X].concat(mt.slice(0,2)),score:Jt}}).filter(function(X){return!!X}).sort(function(X,st){return X.score-st.score});if(S.length===0)return null;var _=c(S[0].points[0],S[0].points[1],S[0].points[2]),y=_.topRight,D=_.topLeft,F=_.bottomLeft,T=f(p,C,y,D,F),L=[];T&&L.push({alignmentPattern:{x:T.alignmentPattern.x,y:T.alignmentPattern.y},bottomLeft:{x:F.x,y:F.y},dimension:T.dimension,topLeft:{x:D.x,y:D.y},topRight:{x:y.x,y:y.y}});var N=m(p,y),J=m(p,D),tt=m(p,F),G=f(p,C,N,J,tt);return G&&L.push({alignmentPattern:{x:G.alignmentPattern.x,y:G.alignmentPattern.y},bottomLeft:{x:tt.x,y:tt.y},topLeft:{x:J.x,y:J.y},topRight:{x:N.x,y:N.y},dimension:G.dimension}),L.length===0?null:L}t.locate=g;function f(p,v,E,C,b){var A,w,S;try{A=l(C,E,b,p),w=A.dimension,S=A.moduleSize}catch{return null}var _={x:E.x-C.x+b.x,y:E.y-C.y+b.y},y=(o(C,b)+o(C,E))/2/S,D=1-3/y,F={x:C.x+D*(_.x-C.x),y:C.y+D*(_.y-C.y)},T=v.map(function(N){var J=(N.top.startX+N.top.endX+N.bottom.startX+N.bottom.endX)/4,tt=(N.top.y+N.bottom.y+1)/2;if(p.get(Math.floor(J),Math.floor(tt))){var G=[N.top.endX-N.top.startX,N.bottom.endX-N.bottom.startX,N.bottom.y-N.top.y+1],X=a(G)/G.length,st=x({x:Math.floor(J),y:Math.floor(tt)},[1,1,1],p),ft=st+o({x:J,y:tt},F);return{x:J,y:tt,score:ft}}}).filter(function(N){return!!N}).sort(function(N,J){return N.score-J.score}),L=y>=15&&T.length?T[0]:F;return{alignmentPattern:L,dimension:w}}}]).default})});var rC=Sp((nC,iC)=>{"use strict";var eC=function(){var r=function(v,E){var C=236,b=17,A=v,w=e[E],S=null,_=0,y=null,D=[],F={},T=function(O,V){_=A*4+17,S=function(k){for(var K=new Array(k),Y=0;Y<k;Y+=1){K[Y]=new Array(k);for(var R=0;R<k;R+=1)K[Y][R]=null}return K}(_),L(0,0),L(_-7,0),L(0,_-7),tt(),J(),X(O,V),A>=7&&G(O),y==null&&(y=mt(A,w,D)),st(y,V)},L=function(O,V){for(var k=-1;k<=7;k+=1)if(!(O+k<=-1||_<=O+k))for(var K=-1;K<=7;K+=1)V+K<=-1||_<=V+K||(0<=k&&k<=6&&(K==0||K==6)||0<=K&&K<=6&&(k==0||k==6)||2<=k&&k<=4&&2<=K&&K<=4?S[O+k][V+K]=!0:S[O+k][V+K]=!1)},N=function(){for(var O=0,V=0,k=0;k<8;k+=1){T(!0,k);var K=i.getLostPoint(F);(k==0||O>K)&&(O=K,V=k)}return V},J=function(){for(var O=8;O<_-8;O+=1)S[O][6]==null&&(S[O][6]=O%2==0);for(var V=8;V<_-8;V+=1)S[6][V]==null&&(S[6][V]=V%2==0)},tt=function(){for(var O=i.getPatternPosition(A),V=0;V<O.length;V+=1)for(var k=0;k<O.length;k+=1){var K=O[V],Y=O[k];if(S[K][Y]==null)for(var R=-2;R<=2;R+=1)for(var vt=-2;vt<=2;vt+=1)R==-2||R==2||vt==-2||vt==2||R==0&&vt==0?S[K+R][Y+vt]=!0:S[K+R][Y+vt]=!1}},G=function(O){for(var V=i.getBCHTypeNumber(A),k=0;k<18;k+=1){var K=!O&&(V>>k&1)==1;S[Math.floor(k/3)][k%3+_-8-3]=K}for(var k=0;k<18;k+=1){var K=!O&&(V>>k&1)==1;S[k%3+_-8-3][Math.floor(k/3)]=K}},X=function(O,V){for(var k=w<<3|V,K=i.getBCHTypeInfo(k),Y=0;Y<15;Y+=1){var R=!O&&(K>>Y&1)==1;Y<6?S[Y][8]=R:Y<8?S[Y+1][8]=R:S[_-15+Y][8]=R}for(var Y=0;Y<15;Y+=1){var R=!O&&(K>>Y&1)==1;Y<8?S[8][_-Y-1]=R:Y<9?S[8][15-Y-1+1]=R:S[8][15-Y-1]=R}S[_-8][8]=!O},st=function(O,V){for(var k=-1,K=_-1,Y=7,R=0,vt=i.getMaskFunction(V),ht=_-1;ht>0;ht-=2)for(ht==6&&(ht-=1);;){for(var Tt=0;Tt<2;Tt+=1)if(S[K][ht-Tt]==null){var Ct=!1;R<O.length&&(Ct=(O[R]>>>Y&1)==1);var pt=vt(K,ht-Tt);pt&&(Ct=!Ct),S[K][ht-Tt]=Ct,Y-=1,Y==-1&&(R+=1,Y=7)}if(K+=k,K<0||_<=K){K-=k,k=-k;break}}},ft=function(O,V){for(var k=0,K=0,Y=0,R=new Array(V.length),vt=new Array(V.length),ht=0;ht<V.length;ht+=1){var Tt=V[ht].dataCount,Ct=V[ht].totalCount-Tt;K=Math.max(K,Tt),Y=Math.max(Y,Ct),R[ht]=new Array(Tt);for(var pt=0;pt<R[ht].length;pt+=1)R[ht][pt]=255&O.getBuffer()[pt+k];k+=Tt;var Rt=i.getErrorCorrectPolynomial(Ct),Ft=o(R[ht],Rt.getLength()-1),Ue=Ft.mod(Rt);vt[ht]=new Array(Rt.getLength()-1);for(var pt=0;pt<vt[ht].length;pt+=1){var P=pt+Ue.getLength()-vt[ht].length;vt[ht][pt]=P>=0?Ue.getAt(P):0}}for(var M=0,pt=0;pt<V.length;pt+=1)M+=V[pt].totalCount;for(var nt=new Array(M),lt=0,pt=0;pt<K;pt+=1)for(var ht=0;ht<V.length;ht+=1)pt<R[ht].length&&(nt[lt]=R[ht][pt],lt+=1);for(var pt=0;pt<Y;pt+=1)for(var ht=0;ht<V.length;ht+=1)pt<vt[ht].length&&(nt[lt]=vt[ht][pt],lt+=1);return nt},mt=function(O,V,k){for(var K=a.getRSBlocks(O,V),Y=c(),R=0;R<k.length;R+=1){var vt=k[R];Y.put(vt.getMode(),4),Y.put(vt.getLength(),i.getLengthInBits(vt.getMode(),O)),vt.write(Y)}for(var ht=0,R=0;R<K.length;R+=1)ht+=K[R].dataCount;if(Y.getLengthInBits()>ht*8)throw"code length overflow. ("+Y.getLengthInBits()+">"+ht*8+")";for(Y.getLengthInBits()+4<=ht*8&&Y.put(0,4);Y.getLengthInBits()%8!=0;)Y.putBit(!1);for(;!(Y.getLengthInBits()>=ht*8||(Y.put(C,8),Y.getLengthInBits()>=ht*8));)Y.put(b,8);return ft(Y,K)};F.addData=function(O,V){V=V||"Byte";var k=null;switch(V){case"Numeric":k=l(O);break;case"Alphanumeric":k=h(O);break;case"Byte":k=u(O);break;case"Kanji":k=d(O);break;default:throw"mode:"+V}D.push(k),y=null},F.isDark=function(O,V){if(O<0||_<=O||V<0||_<=V)throw O+","+V;return S[O][V]},F.getModuleCount=function(){return _},F.make=function(){if(A<1){for(var O=1;O<40;O++){for(var V=a.getRSBlocks(O,w),k=c(),K=0;K<D.length;K++){var Y=D[K];k.put(Y.getMode(),4),k.put(Y.getLength(),i.getLengthInBits(Y.getMode(),O)),Y.write(k)}for(var R=0,K=0;K<V.length;K++)R+=V[K].dataCount;if(k.getLengthInBits()<=R*8)break}A=O}T(!1,N())},F.createTableTag=function(O,V){O=O||2,V=typeof V>"u"?O*4:V;var k="";k+='<table style="',k+=" border-width: 0px; border-style: none;",k+=" border-collapse: collapse;",k+=" padding: 0px; margin: "+V+"px;",k+='">',k+="<tbody>";for(var K=0;K<F.getModuleCount();K+=1){k+="<tr>";for(var Y=0;Y<F.getModuleCount();Y+=1)k+='<td style="',k+=" border-width: 0px; border-style: none;",k+=" border-collapse: collapse;",k+=" padding: 0px; margin: 0px;",k+=" width: "+O+"px;",k+=" height: "+O+"px;",k+=" background-color: ",k+=F.isDark(K,Y)?"#000000":"#ffffff",k+=";",k+='"/>';k+="</tr>"}return k+="</tbody>",k+="</table>",k},F.createSvgTag=function(O,V,k,K){var Y={};typeof arguments[0]=="object"&&(Y=arguments[0],O=Y.cellSize,V=Y.margin,k=Y.alt,K=Y.title),O=O||2,V=typeof V>"u"?O*4:V,k=typeof k=="string"?{text:k}:k||{},k.text=k.text||null,k.id=k.text?k.id||"qrcode-description":null,K=typeof K=="string"?{text:K}:K||{},K.text=K.text||null,K.id=K.text?K.id||"qrcode-title":null;var R=F.getModuleCount()*O+V*2,vt,ht,Tt,Ct,pt="",Rt;for(Rt="l"+O+",0 0,"+O+" -"+O+",0 0,-"+O+"z ",pt+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"',pt+=Y.scalable?"":' width="'+R+'px" height="'+R+'px"',pt+=' viewBox="0 0 '+R+" "+R+'" ',pt+=' preserveAspectRatio="xMinYMin meet"',pt+=K.text||k.text?' role="img" aria-labelledby="'+Jt([K.id,k.id].join(" ").trim())+'"':"",pt+=">",pt+=K.text?'<title id="'+Jt(K.id)+'">'+Jt(K.text)+"</title>":"",pt+=k.text?'<description id="'+Jt(k.id)+'">'+Jt(k.text)+"</description>":"",pt+='<rect width="100%" height="100%" fill="white" cx="0" cy="0"/>',pt+='<path d="',Tt=0;Tt<F.getModuleCount();Tt+=1)for(Ct=Tt*O+V,vt=0;vt<F.getModuleCount();vt+=1)F.isDark(Tt,vt)&&(ht=vt*O+V,pt+="M"+ht+","+Ct+Rt);return pt+='" stroke="transparent" fill="black"/>',pt+="</svg>",pt},F.createDataURL=function(O,V){O=O||2,V=typeof V>"u"?O*4:V;var k=F.getModuleCount()*O+V*2,K=V,Y=k-V;return p(k,k,function(R,vt){if(K<=R&&R<Y&&K<=vt&&vt<Y){var ht=Math.floor((R-K)/O),Tt=Math.floor((vt-K)/O);return F.isDark(Tt,ht)?0:1}else return 1})},F.createImgTag=function(O,V,k){O=O||2,V=typeof V>"u"?O*4:V;var K=F.getModuleCount()*O+V*2,Y="";return Y+="<img",Y+=' src="',Y+=F.createDataURL(O,V),Y+='"',Y+=' width="',Y+=K,Y+='"',Y+=' height="',Y+=K,Y+='"',k&&(Y+=' alt="',Y+=Jt(k),Y+='"'),Y+="/>",Y};var Jt=function(O){for(var V="",k=0;k<O.length;k+=1){var K=O.charAt(k);switch(K){case"<":V+="&lt;";break;case">":V+="&gt;";break;case"&":V+="&amp;";break;case'"':V+="&quot;";break;default:V+=K;break}}return V},q=function(O){var V=1;O=typeof O>"u"?V*2:O;var k=F.getModuleCount()*V+O*2,K=O,Y=k-O,R,vt,ht,Tt,Ct,pt={"\u2588\u2588":"\u2588","\u2588 ":"\u2580"," \u2588":"\u2584","  ":" "},Rt={"\u2588\u2588":"\u2580","\u2588 ":"\u2580"," \u2588":" ","  ":" "},Ft="";for(R=0;R<k;R+=2){for(ht=Math.floor((R-K)/V),Tt=Math.floor((R+1-K)/V),vt=0;vt<k;vt+=1)Ct="\u2588",K<=vt&&vt<Y&&K<=R&&R<Y&&F.isDark(ht,Math.floor((vt-K)/V))&&(Ct=" "),K<=vt&&vt<Y&&K<=R+1&&R+1<Y&&F.isDark(Tt,Math.floor((vt-K)/V))?Ct+=" ":Ct+="\u2588",Ft+=O<1&&R+1>=Y?Rt[Ct]:pt[Ct];Ft+=`
`}return k%2&&O>0?Ft.substring(0,Ft.length-k-1)+Array(k+1).join("\u2580"):Ft.substring(0,Ft.length-1)};return F.createASCII=function(O,V){if(O=O||1,O<2)return q(V);O-=1,V=typeof V>"u"?O*2:V;var k=F.getModuleCount()*O+V*2,K=V,Y=k-V,R,vt,ht,Tt,Ct=Array(O+1).join("\u2588\u2588"),pt=Array(O+1).join("  "),Rt="",Ft="";for(R=0;R<k;R+=1){for(ht=Math.floor((R-K)/O),Ft="",vt=0;vt<k;vt+=1)Tt=1,K<=vt&&vt<Y&&K<=R&&R<Y&&F.isDark(ht,Math.floor((vt-K)/O))&&(Tt=0),Ft+=Tt?Ct:pt;for(ht=0;ht<O;ht+=1)Rt+=Ft+`
`}return Rt.substring(0,Rt.length-1)},F.renderTo2dContext=function(O,V){V=V||2;for(var k=F.getModuleCount(),K=0;K<k;K++)for(var Y=0;Y<k;Y++)O.fillStyle=F.isDark(K,Y)?"black":"white",O.fillRect(K*V,Y*V,V,V)},F};r.stringToBytesFuncs={default:function(v){for(var E=[],C=0;C<v.length;C+=1){var b=v.charCodeAt(C);E.push(b&255)}return E}},r.stringToBytes=r.stringToBytesFuncs.default,r.createStringToBytes=function(v,E){var C=function(){for(var A=g(v),w=function(){var J=A.read();if(J==-1)throw"eof";return J},S=0,_={};;){var y=A.read();if(y==-1)break;var D=w(),F=w(),T=w(),L=String.fromCharCode(y<<8|D),N=F<<8|T;_[L]=N,S+=1}if(S!=E)throw S+" != "+E;return _}(),b=63;return function(A){for(var w=[],S=0;S<A.length;S+=1){var _=A.charCodeAt(S);if(_<128)w.push(_);else{var y=C[A.charAt(S)];typeof y=="number"?(y&255)==y?w.push(y):(w.push(y>>>8),w.push(y&255)):w.push(b)}}return w}};var t={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},e={L:1,M:0,Q:3,H:2},n={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},i=function(){var v=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],E=1335,C=7973,b=21522,A={},w=function(S){for(var _=0;S!=0;)_+=1,S>>>=1;return _};return A.getBCHTypeInfo=function(S){for(var _=S<<10;w(_)-w(E)>=0;)_^=E<<w(_)-w(E);return(S<<10|_)^b},A.getBCHTypeNumber=function(S){for(var _=S<<12;w(_)-w(C)>=0;)_^=C<<w(_)-w(C);return S<<12|_},A.getPatternPosition=function(S){return v[S-1]},A.getMaskFunction=function(S){switch(S){case n.PATTERN000:return function(_,y){return(_+y)%2==0};case n.PATTERN001:return function(_,y){return _%2==0};case n.PATTERN010:return function(_,y){return y%3==0};case n.PATTERN011:return function(_,y){return(_+y)%3==0};case n.PATTERN100:return function(_,y){return(Math.floor(_/2)+Math.floor(y/3))%2==0};case n.PATTERN101:return function(_,y){return _*y%2+_*y%3==0};case n.PATTERN110:return function(_,y){return(_*y%2+_*y%3)%2==0};case n.PATTERN111:return function(_,y){return(_*y%3+(_+y)%2)%2==0};default:throw"bad maskPattern:"+S}},A.getErrorCorrectPolynomial=function(S){for(var _=o([1],0),y=0;y<S;y+=1)_=_.multiply(o([1,s.gexp(y)],0));return _},A.getLengthInBits=function(S,_){if(1<=_&&_<10)switch(S){case t.MODE_NUMBER:return 10;case t.MODE_ALPHA_NUM:return 9;case t.MODE_8BIT_BYTE:return 8;case t.MODE_KANJI:return 8;default:throw"mode:"+S}else if(_<27)switch(S){case t.MODE_NUMBER:return 12;case t.MODE_ALPHA_NUM:return 11;case t.MODE_8BIT_BYTE:return 16;case t.MODE_KANJI:return 10;default:throw"mode:"+S}else if(_<41)switch(S){case t.MODE_NUMBER:return 14;case t.MODE_ALPHA_NUM:return 13;case t.MODE_8BIT_BYTE:return 16;case t.MODE_KANJI:return 12;default:throw"mode:"+S}else throw"type:"+_},A.getLostPoint=function(S){for(var _=S.getModuleCount(),y=0,D=0;D<_;D+=1)for(var F=0;F<_;F+=1){for(var T=0,L=S.isDark(D,F),N=-1;N<=1;N+=1)if(!(D+N<0||_<=D+N))for(var J=-1;J<=1;J+=1)F+J<0||_<=F+J||N==0&&J==0||L==S.isDark(D+N,F+J)&&(T+=1);T>5&&(y+=3+T-5)}for(var D=0;D<_-1;D+=1)for(var F=0;F<_-1;F+=1){var tt=0;S.isDark(D,F)&&(tt+=1),S.isDark(D+1,F)&&(tt+=1),S.isDark(D,F+1)&&(tt+=1),S.isDark(D+1,F+1)&&(tt+=1),(tt==0||tt==4)&&(y+=3)}for(var D=0;D<_;D+=1)for(var F=0;F<_-6;F+=1)S.isDark(D,F)&&!S.isDark(D,F+1)&&S.isDark(D,F+2)&&S.isDark(D,F+3)&&S.isDark(D,F+4)&&!S.isDark(D,F+5)&&S.isDark(D,F+6)&&(y+=40);for(var F=0;F<_;F+=1)for(var D=0;D<_-6;D+=1)S.isDark(D,F)&&!S.isDark(D+1,F)&&S.isDark(D+2,F)&&S.isDark(D+3,F)&&S.isDark(D+4,F)&&!S.isDark(D+5,F)&&S.isDark(D+6,F)&&(y+=40);for(var G=0,F=0;F<_;F+=1)for(var D=0;D<_;D+=1)S.isDark(D,F)&&(G+=1);var X=Math.abs(100*G/_/_-50)/5;return y+=X*10,y},A}(),s=function(){for(var v=new Array(256),E=new Array(256),C=0;C<8;C+=1)v[C]=1<<C;for(var C=8;C<256;C+=1)v[C]=v[C-4]^v[C-5]^v[C-6]^v[C-8];for(var C=0;C<255;C+=1)E[v[C]]=C;var b={};return b.glog=function(A){if(A<1)throw"glog("+A+")";return E[A]},b.gexp=function(A){for(;A<0;)A+=255;for(;A>=256;)A-=255;return v[A]},b}();function o(v,E){if(typeof v.length>"u")throw v.length+"/"+E;var C=function(){for(var A=0;A<v.length&&v[A]==0;)A+=1;for(var w=new Array(v.length-A+E),S=0;S<v.length-A;S+=1)w[S]=v[S+A];return w}(),b={};return b.getAt=function(A){return C[A]},b.getLength=function(){return C.length},b.multiply=function(A){for(var w=new Array(b.getLength()+A.getLength()-1),S=0;S<b.getLength();S+=1)for(var _=0;_<A.getLength();_+=1)w[S+_]^=s.gexp(s.glog(b.getAt(S))+s.glog(A.getAt(_)));return o(w,0)},b.mod=function(A){if(b.getLength()-A.getLength()<0)return b;for(var w=s.glog(b.getAt(0))-s.glog(A.getAt(0)),S=new Array(b.getLength()),_=0;_<b.getLength();_+=1)S[_]=b.getAt(_);for(var _=0;_<A.getLength();_+=1)S[_]^=s.gexp(s.glog(A.getAt(_))+w);return o(S,0).mod(A)},b}var a=function(){var v=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],E=function(A,w){var S={};return S.totalCount=A,S.dataCount=w,S},C={},b=function(A,w){switch(w){case e.L:return v[(A-1)*4+0];case e.M:return v[(A-1)*4+1];case e.Q:return v[(A-1)*4+2];case e.H:return v[(A-1)*4+3];default:return}};return C.getRSBlocks=function(A,w){var S=b(A,w);if(typeof S>"u")throw"bad rs block @ typeNumber:"+A+"/errorCorrectionLevel:"+w;for(var _=S.length/3,y=[],D=0;D<_;D+=1)for(var F=S[D*3+0],T=S[D*3+1],L=S[D*3+2],N=0;N<F;N+=1)y.push(E(T,L));return y},C}(),c=function(){var v=[],E=0,C={};return C.getBuffer=function(){return v},C.getAt=function(b){var A=Math.floor(b/8);return(v[A]>>>7-b%8&1)==1},C.put=function(b,A){for(var w=0;w<A;w+=1)C.putBit((b>>>A-w-1&1)==1)},C.getLengthInBits=function(){return E},C.putBit=function(b){var A=Math.floor(E/8);v.length<=A&&v.push(0),b&&(v[A]|=128>>>E%8),E+=1},C},l=function(v){var E=t.MODE_NUMBER,C=v,b={};b.getMode=function(){return E},b.getLength=function(S){return C.length},b.write=function(S){for(var _=C,y=0;y+2<_.length;)S.put(A(_.substring(y,y+3)),10),y+=3;y<_.length&&(_.length-y==1?S.put(A(_.substring(y,y+1)),4):_.length-y==2&&S.put(A(_.substring(y,y+2)),7))};var A=function(S){for(var _=0,y=0;y<S.length;y+=1)_=_*10+w(S.charAt(y));return _},w=function(S){if("0"<=S&&S<="9")return S.charCodeAt(0)-48;throw"illegal char :"+S};return b},h=function(v){var E=t.MODE_ALPHA_NUM,C=v,b={};b.getMode=function(){return E},b.getLength=function(w){return C.length},b.write=function(w){for(var S=C,_=0;_+1<S.length;)w.put(A(S.charAt(_))*45+A(S.charAt(_+1)),11),_+=2;_<S.length&&w.put(A(S.charAt(_)),6)};var A=function(w){if("0"<=w&&w<="9")return w.charCodeAt(0)-48;if("A"<=w&&w<="Z")return w.charCodeAt(0)-65+10;switch(w){case" ":return 36;case"$":return 37;case"%":return 38;case"*":return 39;case"+":return 40;case"-":return 41;case".":return 42;case"/":return 43;case":":return 44;default:throw"illegal char :"+w}};return b},u=function(v){var E=t.MODE_8BIT_BYTE,C=v,b=r.stringToBytes(v),A={};return A.getMode=function(){return E},A.getLength=function(w){return b.length},A.write=function(w){for(var S=0;S<b.length;S+=1)w.put(b[S],8)},A},d=function(v){var E=t.MODE_KANJI,C=v,b=r.stringToBytesFuncs.SJIS;if(!b)throw"sjis not supported.";(function(S,_){var y=b(S);if(y.length!=2||(y[0]<<8|y[1])!=_)throw"sjis not supported."})("\u53CB",38726);var A=b(v),w={};return w.getMode=function(){return E},w.getLength=function(S){return~~(A.length/2)},w.write=function(S){for(var _=A,y=0;y+1<_.length;){var D=(255&_[y])<<8|255&_[y+1];if(33088<=D&&D<=40956)D-=33088;else if(57408<=D&&D<=60351)D-=49472;else throw"illegal char at "+(y+1)+"/"+D;D=(D>>>8&255)*192+(D&255),S.put(D,13),y+=2}if(y<_.length)throw"illegal char at "+(y+1)},w},x=function(){var v=[],E={};return E.writeByte=function(C){v.push(C&255)},E.writeShort=function(C){E.writeByte(C),E.writeByte(C>>>8)},E.writeBytes=function(C,b,A){b=b||0,A=A||C.length;for(var w=0;w<A;w+=1)E.writeByte(C[w+b])},E.writeString=function(C){for(var b=0;b<C.length;b+=1)E.writeByte(C.charCodeAt(b))},E.toByteArray=function(){return v},E.toString=function(){var C="";C+="[";for(var b=0;b<v.length;b+=1)b>0&&(C+=","),C+=v[b];return C+="]",C},E},m=function(){var v=0,E=0,C=0,b="",A={},w=function(_){b+=String.fromCharCode(S(_&63))},S=function(_){if(!(_<0)){if(_<26)return 65+_;if(_<52)return 97+(_-26);if(_<62)return 48+(_-52);if(_==62)return 43;if(_==63)return 47}throw"n:"+_};return A.writeByte=function(_){for(v=v<<8|_&255,E+=8,C+=1;E>=6;)w(v>>>E-6),E-=6},A.flush=function(){if(E>0&&(w(v<<6-E),v=0,E=0),C%3!=0)for(var _=3-C%3,y=0;y<_;y+=1)b+="="},A.toString=function(){return b},A},g=function(v){var E=v,C=0,b=0,A=0,w={};w.read=function(){for(;A<8;){if(C>=E.length){if(A==0)return-1;throw"unexpected end of file./"+A}var _=E.charAt(C);if(C+=1,_=="=")return A=0,-1;if(_.match(/^\s$/))continue;b=b<<6|S(_.charCodeAt(0)),A+=6}var y=b>>>A-8&255;return A-=8,y};var S=function(_){if(65<=_&&_<=90)return _-65;if(97<=_&&_<=122)return _-97+26;if(48<=_&&_<=57)return _-48+52;if(_==43)return 62;if(_==47)return 63;throw"c:"+_};return w},f=function(v,E){var C=v,b=E,A=new Array(v*E),w={};w.setPixel=function(D,F,T){A[F*C+D]=T},w.write=function(D){D.writeString("GIF87a"),D.writeShort(C),D.writeShort(b),D.writeByte(128),D.writeByte(0),D.writeByte(0),D.writeByte(0),D.writeByte(0),D.writeByte(0),D.writeByte(255),D.writeByte(255),D.writeByte(255),D.writeString(","),D.writeShort(0),D.writeShort(0),D.writeShort(C),D.writeShort(b),D.writeByte(0);var F=2,T=_(F);D.writeByte(F);for(var L=0;T.length-L>255;)D.writeByte(255),D.writeBytes(T,L,255),L+=255;D.writeByte(T.length-L),D.writeBytes(T,L,T.length-L),D.writeByte(0),D.writeString(";")};var S=function(D){var F=D,T=0,L=0,N={};return N.write=function(J,tt){if(J>>>tt)throw"length over";for(;T+tt>=8;)F.writeByte(255&(J<<T|L)),tt-=8-T,J>>>=8-T,L=0,T=0;L=J<<T|L,T=T+tt},N.flush=function(){T>0&&F.writeByte(L)},N},_=function(D){for(var F=1<<D,T=(1<<D)+1,L=D+1,N=y(),J=0;J<F;J+=1)N.add(String.fromCharCode(J));N.add(String.fromCharCode(F)),N.add(String.fromCharCode(T));var tt=x(),G=S(tt);G.write(F,L);var X=0,st=String.fromCharCode(A[X]);for(X+=1;X<A.length;){var ft=String.fromCharCode(A[X]);X+=1,N.contains(st+ft)?st=st+ft:(G.write(N.indexOf(st),L),N.size()<4095&&(N.size()==1<<L&&(L+=1),N.add(st+ft)),st=ft)}return G.write(N.indexOf(st),L),G.write(T,L),G.flush(),tt.toByteArray()},y=function(){var D={},F=0,T={};return T.add=function(L){if(T.contains(L))throw"dup key:"+L;D[L]=F,F+=1},T.size=function(){return F},T.indexOf=function(L){return D[L]},T.contains=function(L){return typeof D[L]<"u"},T};return w},p=function(v,E,C){for(var b=f(v,E),A=0;A<E;A+=1)for(var w=0;w<v;w+=1)b.setPixel(w,A,C(w,A));var S=x();b.write(S);for(var _=m(),y=S.toByteArray(),D=0;D<y.length;D+=1)_.writeByte(y[D]);return _.flush(),"data:image/gif;base64,"+_};return r}();(function(){eC.stringToBytesFuncs["UTF-8"]=function(r){function t(e){for(var n=[],i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?n.push(s):s<2048?n.push(192|s>>6,128|s&63):s<55296||s>=57344?n.push(224|s>>12,128|s>>6&63,128|s&63):(i++,s=65536+((s&1023)<<10|e.charCodeAt(i)&1023),n.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63))}return n}return t(r)}})();(function(r){typeof define=="function"&&define.amd?define([],r):typeof nC=="object"&&(iC.exports=r())})(function(){return eC})});var Eu=class extends im{constructor(){super(...arguments),this.supportsDOMEvents=!0}},_u=class r extends Eu{static makeCurrent(){nm(new r)}onAndCancel(t,e,n){return t.addEventListener(e,n),()=>{t.removeEventListener(e,n)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return e=e||this.getDefaultDocument(),e.createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return e==="window"?window:e==="document"?t:e==="body"?t.body:null}getBaseHref(t){let e=FC();return e==null?null:PC(e)}resetBaseElement(){ja=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return rm(document.cookie,t)}},ja=null;function FC(){return ja=ja||document.querySelector("base"),ja?ja.getAttribute("href"):null}function PC(r){return new URL(r,document.baseURI).pathname}var RC=(()=>{let t=class t{build(){return new XMLHttpRequest}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:t.\u0275fac});let r=t;return r})(),Cu=new si(""),lm=(()=>{let t=class t{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(s=>{s.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,i,s){return this._findPluginFor(i).addEventListener(n,i,s)}getZone(){return this._zone}_findPluginFor(n){let i=this._eventNameToPlugin.get(n);if(i)return i;if(i=this._plugins.find(o=>o.supports(n)),!i)throw new nn(5101,!1);return this._eventNameToPlugin.set(n,i),i}};t.\u0275fac=function(i){return new(i||t)(Le(Cu),Le(Ai))},t.\u0275prov=Ae({token:t,factory:t.\u0275fac});let r=t;return r})(),fl=class{constructor(t){this._doc=t}},gu="ng-app-id",hm=(()=>{let t=class t{constructor(n,i,s,o={}){this.doc=n,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=mu(o),this.resetHostNodes()}addStyles(n){for(let i of n)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(n){for(let i of n)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let n=this.styleNodesInDOM;n&&(n.forEach(i=>i.remove()),n.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(let i of this.getAllStyles())this.addStyleToHost(n,i)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(let i of this.hostNodes)this.addStyleToHost(i,n)}onStyleRemoved(n){let i=this.styleRef;i.get(n)?.elements?.forEach(s=>s.remove()),i.delete(n)}collectServerRenderedStyles(){let n=this.doc.head?.querySelectorAll(`style[${gu}="${this.appId}"]`);if(n?.length){let i=new Map;return n.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(n,i){let s=this.styleRef;if(s.has(n)){let o=s.get(n);return o.usage+=i,o.usage}return s.set(n,{usage:i,elements:[]}),i}getStyleElement(n,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===n)return s.delete(i),o.removeAttribute(gu),o;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(gu,this.appId),n.appendChild(a),a}}addStyleToHost(n,i){let s=this.getStyleElement(n,i),o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let n=this.hostNodes;n.clear(),n.add(this.doc.head)}};t.\u0275fac=function(i){return new(i||t)(Le(oi),Le(lu),Le(hu,8),Le(Ha))},t.\u0275prov=Ae({token:t,factory:t.\u0275fac});let r=t;return r})(),vu={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Au=/%COMP%/g,um="%COMP%",kC=`_nghost-${um}`,OC=`_ngcontent-${um}`,IC=!0,LC=new si("",{providedIn:"root",factory:()=>IC});function NC(r){return OC.replace(Au,r)}function UC(r){return kC.replace(Au,r)}function dm(r,t){return t.map(e=>e.replace(Au,r))}var pl=(()=>{let t=class t{constructor(n,i,s,o,a,c,l,h=null){this.eventManager=n,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=c,this.ngZone=l,this.nonce=h,this.rendererByCompId=new Map,this.platformIsServer=mu(c),this.defaultRenderer=new Xa(n,a,l,this.platformIsServer)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===za.ShadowDom&&(i=dn(Ot({},i),{encapsulation:za.Emulated}));let s=this.getOrCreateRenderer(n,i);return s instanceof ml?s.applyToHost(n):s instanceof Ya&&s.applyStyles(),s}getOrCreateRenderer(n,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let a=this.doc,c=this.ngZone,l=this.eventManager,h=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(i.encapsulation){case za.Emulated:o=new ml(l,h,i,this.appId,u,a,c,d);break;case za.ShadowDom:return new yu(l,h,n,i,a,c,this.nonce,d);default:o=new Ya(l,h,i,u,a,c,d);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};t.\u0275fac=function(i){return new(i||t)(Le(lm),Le(hm),Le(lu),Le(LC),Le(oi),Le(Ha),Le(Ai),Le(hu))},t.\u0275prov=Ae({token:t,factory:t.\u0275fac});let r=t;return r})(),Xa=class{constructor(t,e,n,i){this.eventManager=t,this.doc=e,this.ngZone=n,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(t,e){return e?this.doc.createElementNS(vu[e]||e,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,e){(am(t)?t.content:t).appendChild(e)}insertBefore(t,e,n){t&&(am(t)?t.content:t).insertBefore(e,n)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let n=typeof t=="string"?this.doc.querySelector(t):t;if(!n)throw new nn(-5104,!1);return e||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,n,i){if(i){e=i+":"+e;let s=vu[i];s?t.setAttributeNS(s,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)}removeAttribute(t,e,n){if(n){let i=vu[n];i?t.removeAttributeNS(i,e):t.removeAttribute(`${n}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,n,i){i&(Ga.DashCase|Ga.Important)?t.style.setProperty(e,n,i&Ga.Important?"important":""):t.style[e]=n}removeStyle(t,e,n){n&Ga.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,n){t!=null&&(t[e]=n)}setValue(t,e){t.nodeValue=e}listen(t,e,n){if(typeof t=="string"&&(t=pu().getGlobalEventTarget(this.doc,t),!t))throw new Error(`Unsupported event target ${t} for event ${e}`);return this.eventManager.addEventListener(t,e,this.decoratePreventDefault(n))}decoratePreventDefault(t){return e=>{if(e==="__ngUnwrap__")return t;(this.platformIsServer?this.ngZone.runGuarded(()=>t(e)):t(e))===!1&&e.preventDefault()}}};function am(r){return r.tagName==="TEMPLATE"&&r.content!==void 0}var yu=class extends Xa{constructor(t,e,n,i,s,o,a,c){super(t,s,o,c),this.sharedStylesHost=e,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let l=dm(i.id,i.styles);for(let h of l){let u=document.createElement("style");a&&u.setAttribute("nonce",a),u.textContent=h,this.shadowRoot.appendChild(u)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,n){return super.insertBefore(this.nodeOrShadowRoot(t),e,n)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Ya=class extends Xa{constructor(t,e,n,i,s,o,a,c){super(t,s,o,a),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=i,this.styles=c?dm(c,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},ml=class extends Ya{constructor(t,e,n,i,s,o,a,c){let l=i+"-"+n.id;super(t,e,n,s,o,a,c,l),this.contentAttr=NC(l),this.hostAttr=UC(l)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,e){let n=super.createElement(t,e);return super.setAttribute(n,this.contentAttr,""),n}},zC=(()=>{let t=class t extends fl{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,s){return n.addEventListener(i,s,!1),()=>this.removeEventListener(n,i,s)}removeEventListener(n,i,s){return n.removeEventListener(i,s)}};t.\u0275fac=function(i){return new(i||t)(Le(oi))},t.\u0275prov=Ae({token:t,factory:t.\u0275fac});let r=t;return r})(),cm=["alt","control","meta","shift"],VC={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},HC={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey},GC=(()=>{let t=class t extends fl{constructor(n){super(n)}supports(n){return t.parseEventName(n)!=null}addEventListener(n,i,s){let o=t.parseEventName(i),a=t.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>pu().onAndCancel(n,o.domEventName,a))}static parseEventName(n){let i=n.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=t._normalizeKey(i.pop()),a="",c=i.indexOf("code");if(c>-1&&(i.splice(c,1),a="code."),cm.forEach(h=>{let u=i.indexOf(h);u>-1&&(i.splice(u,1),a+=h+".")}),a+=o,i.length!=0||o.length===0)return null;let l={};return l.domEventName=s,l.fullKey=a,l}static matchEventFullKeyCode(n,i){let s=VC[n.key]||n.key,o="";return i.indexOf("code.")>-1&&(s=n.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),cm.forEach(a=>{if(a!==s){let c=HC[a];c(n)&&(o+=a+".")}}),o+=s,o===i)}static eventCallback(n,i,s){return o=>{t.matchEventFullKeyCode(o,n)&&s.runGuarded(()=>i(o))}}static _normalizeKey(n){return n==="esc"?"escape":n}};t.\u0275fac=function(i){return new(i||t)(Le(oi))},t.\u0275prov=Ae({token:t,factory:t.\u0275fac});let r=t;return r})();function xm(r,t){return em(Ot({rootComponent:r},WC(t)))}function WC(r){return{appProviders:[...$C,...r?.providers??[]],platformProviders:qC}}function jC(){_u.makeCurrent()}function XC(){return new cu}function YC(){return Gp(document),document}var qC=[{provide:Ha,useValue:sm},{provide:Wp,useValue:jC,multi:!0},{provide:oi,useFactory:YC,deps:[]}];var $C=[{provide:zp,useValue:"root"},{provide:cu,useFactory:XC,deps:[]},{provide:Cu,useClass:zC,multi:!0,deps:[oi,Ai,Ha]},{provide:Cu,useClass:GC,multi:!0,deps:[oi]},pl,hm,lm,{provide:dl,useExisting:pl},{provide:om,useClass:RC,deps:[]},[]];var fm=(()=>{let t=class t{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}};t.\u0275fac=function(i){return new(i||t)(Le(oi))},t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();var re="primary",cc=Symbol("RouteTitle"),Du=class{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){let e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){let e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function co(r){return new Du(r)}function JC(r,t,e){let n=e.path.split("/");if(n.length>r.length||e.pathMatch==="full"&&(t.hasChildren()||n.length<r.length))return null;let i={};for(let s=0;s<n.length;s++){let o=n[s],a=r[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:r.slice(0,n.length),posParams:i}}function KC(r,t){if(r.length!==t.length)return!1;for(let e=0;e<r.length;++e)if(!Vi(r[e],t[e]))return!1;return!0}function Vi(r,t){let e=r?Bu(r):void 0,n=t?Bu(t):void 0;if(!e||!n||e.length!=n.length)return!1;let i;for(let s=0;s<e.length;s++)if(i=e[s],!_m(r[i],t[i]))return!1;return!0}function Bu(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}function _m(r,t){if(Array.isArray(r)&&Array.isArray(t)){if(r.length!==t.length)return!1;let e=[...r].sort(),n=[...t].sort();return e.every((i,s)=>n[s]===i)}else return r===t}function Cm(r){return r.length>0?r[r.length-1]:null}function Fr(r){return Tp(r)?r:Qp(r)?yi(Promise.resolve(r)):ne(r)}var QC={exact:Am,subset:bm},ym={exact:ty,subset:ey,ignored:()=>!0};function pm(r,t,e){return QC[e.paths](r.root,t.root,e.matrixParams)&&ym[e.queryParams](r.queryParams,t.queryParams)&&!(e.fragment==="exact"&&r.fragment!==t.fragment)}function ty(r,t){return Vi(r,t)}function Am(r,t,e){if(!gs(r.segments,t.segments)||!El(r.segments,t.segments,e)||r.numberOfChildren!==t.numberOfChildren)return!1;for(let n in t.children)if(!r.children[n]||!Am(r.children[n],t.children[n],e))return!1;return!0}function ey(r,t){return Object.keys(t).length<=Object.keys(r).length&&Object.keys(t).every(e=>_m(r[e],t[e]))}function bm(r,t,e){return wm(r,t,t.segments,e)}function wm(r,t,e,n){if(r.segments.length>e.length){let i=r.segments.slice(0,e.length);return!(!gs(i,e)||t.hasChildren()||!El(i,e,n))}else if(r.segments.length===e.length){if(!gs(r.segments,e)||!El(r.segments,e,n))return!1;for(let i in t.children)if(!r.children[i]||!bm(r.children[i],t.children[i],n))return!1;return!0}else{let i=e.slice(0,r.segments.length),s=e.slice(r.segments.length);return!gs(r.segments,i)||!El(r.segments,i,n)||!r.children[re]?!1:wm(r.children[re],t,s,n)}}function El(r,t,e){return t.every((n,i)=>ym[e](r[i].parameters,n.parameters))}var Br=class{constructor(t=new Fe([],{}),e={},n=null){this.root=t,this.queryParams=e,this.fragment=n}get queryParamMap(){return this._queryParamMap??=co(this.queryParams),this._queryParamMap}toString(){return ry.serialize(this)}},Fe=class{constructor(t,e){this.segments=t,this.children=e,this.parent=null,Object.values(e).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return _l(this)}},ms=class{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap??=co(this.parameters),this._parameterMap}toString(){return Mm(this)}};function ny(r,t){return gs(r,t)&&r.every((e,n)=>Vi(e.parameters,t[n].parameters))}function gs(r,t){return r.length!==t.length?!1:r.every((e,n)=>e.path===t[n].path)}function iy(r,t){let e=[];return Object.entries(r.children).forEach(([n,i])=>{n===re&&(e=e.concat(t(i,n)))}),Object.entries(r.children).forEach(([n,i])=>{n!==re&&(e=e.concat(t(i,n)))}),e}var ed=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:()=>new yl,providedIn:"root"});let r=t;return r})(),yl=class{parse(t){let e=new Fu(t);return new Br(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){let e=`/${qa(t.root,!0)}`,n=ay(t.queryParams),i=typeof t.fragment=="string"?`#${sy(t.fragment)}`:"";return`${e}${n}${i}`}},ry=new yl;function _l(r){return r.segments.map(t=>Mm(t)).join("/")}function qa(r,t){if(!r.hasChildren())return _l(r);if(t){let e=r.children[re]?qa(r.children[re],!1):"",n=[];return Object.entries(r.children).forEach(([i,s])=>{i!==re&&n.push(`${i}:${qa(s,!1)}`)}),n.length>0?`${e}(${n.join("//")})`:e}else{let e=iy(r,(n,i)=>i===re?[qa(r.children[re],!1)]:[`${i}:${qa(n,!1)}`]);return Object.keys(r.children).length===1&&r.children[re]!=null?`${_l(r)}/${e[0]}`:`${_l(r)}/(${e.join("//")})`}}function Sm(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function gl(r){return Sm(r).replace(/%3B/gi,";")}function sy(r){return encodeURI(r)}function Tu(r){return Sm(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Cl(r){return decodeURIComponent(r)}function mm(r){return Cl(r.replace(/\+/g,"%20"))}function Mm(r){return`${Tu(r.path)}${oy(r.parameters)}`}function oy(r){return Object.entries(r).map(([t,e])=>`;${Tu(t)}=${Tu(e)}`).join("")}function ay(r){let t=Object.entries(r).map(([e,n])=>Array.isArray(n)?n.map(i=>`${gl(e)}=${gl(i)}`).join("&"):`${gl(e)}=${gl(n)}`).filter(e=>e);return t.length?`?${t.join("&")}`:""}var cy=/^[^\/()?;#]+/;function bu(r){let t=r.match(cy);return t?t[0]:""}var ly=/^[^\/()?;=#]+/;function hy(r){let t=r.match(ly);return t?t[0]:""}var uy=/^[^=?&#]+/;function dy(r){let t=r.match(uy);return t?t[0]:""}var xy=/^[^&#]+/;function fy(r){let t=r.match(xy);return t?t[0]:""}var Fu=class{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Fe([],{}):new Fe([],this.parseChildren())}parseQueryParams(){let t={};if(this.consumeOptional("?"))do this.parseQueryParam(t);while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(n[re]=new Fe(t,e)),n}parseSegment(){let t=bu(this.remaining);if(t===""&&this.peekStartsWith(";"))throw new nn(4009,!1);return this.capture(t),new ms(Cl(t),this.parseMatrixParams())}parseMatrixParams(){let t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){let e=hy(this.remaining);if(!e)return;this.capture(e);let n="";if(this.consumeOptional("=")){let i=bu(this.remaining);i&&(n=i,this.capture(n))}t[Cl(e)]=Cl(n)}parseQueryParam(t){let e=dy(this.remaining);if(!e)return;this.capture(e);let n="";if(this.consumeOptional("=")){let o=fy(this.remaining);o&&(n=o,this.capture(n))}let i=mm(e),s=mm(n);if(t.hasOwnProperty(i)){let o=t[i];Array.isArray(o)||(o=[o],t[i]=o),o.push(s)}else t[i]=s}parseParens(t){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let n=bu(this.remaining),i=this.remaining[n.length];if(i!=="/"&&i!==")"&&i!==";")throw new nn(4010,!1);let s;n.indexOf(":")>-1?(s=n.slice(0,n.indexOf(":")),this.capture(s),this.capture(":")):t&&(s=re);let o=this.parseChildren();e[s]=Object.keys(o).length===1?o[re]:new Fe([],o),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return this.peekStartsWith(t)?(this.remaining=this.remaining.substring(t.length),!0):!1}capture(t){if(!this.consumeOptional(t))throw new nn(4011,!1)}};function Dm(r){return r.segments.length>0?new Fe([],{[re]:r}):r}function Bm(r){let t={};for(let[n,i]of Object.entries(r.children)){let s=Bm(i);if(n===re&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))t[o]=a;else(s.segments.length>0||s.hasChildren())&&(t[n]=s)}let e=new Fe(r.segments,t);return py(e)}function py(r){if(r.numberOfChildren===1&&r.children[re]){let t=r.children[re];return new Fe(r.segments.concat(t.segments),t.children)}return r}function lo(r){return r instanceof Br}function my(r,t,e=null,n=null){let i=Tm(r);return Fm(i,t,e,n)}function Tm(r){let t;function e(s){let o={};for(let c of s.children){let l=e(c);o[c.outlet]=l}let a=new Fe(s.url,o);return s===r&&(t=a),a}let n=e(r.root),i=Dm(n);return t??i}function Fm(r,t,e,n){let i=r;for(;i.parent;)i=i.parent;if(t.length===0)return wu(i,i,i,e,n);let s=gy(t);if(s.toRoot())return wu(i,i,new Fe([],{}),e,n);let o=vy(s,i,r),a=o.processChildren?Ja(o.segmentGroup,o.index,s.commands):Rm(o.segmentGroup,o.index,s.commands);return wu(i,o.segmentGroup,a,e,n)}function Al(r){return typeof r=="object"&&r!=null&&!r.outlets&&!r.segmentPath}function tc(r){return typeof r=="object"&&r!=null&&r.outlets}function wu(r,t,e,n,i){let s={};n&&Object.entries(n).forEach(([c,l])=>{s[c]=Array.isArray(l)?l.map(h=>`${h}`):`${l}`});let o;r===t?o=e:o=Pm(r,t,e);let a=Dm(Bm(o));return new Br(a,s,i)}function Pm(r,t,e){let n={};return Object.entries(r.children).forEach(([i,s])=>{s===t?n[i]=e:n[i]=Pm(s,t,e)}),new Fe(r.segments,n)}var bl=class{constructor(t,e,n){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=n,t&&n.length>0&&Al(n[0]))throw new nn(4003,!1);let i=n.find(tc);if(i&&i!==Cm(n))throw new nn(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function gy(r){if(typeof r[0]=="string"&&r.length===1&&r[0]==="/")return new bl(!0,0,r);let t=0,e=!1,n=r.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([c,l])=>{a[c]=typeof l=="string"?l.split("/"):l}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,c)=>{c==0&&a==="."||(c==0&&a===""?e=!0:a===".."?t++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new bl(e,t,n)}var oo=class{constructor(t,e,n){this.segmentGroup=t,this.processChildren=e,this.index=n}};function vy(r,t,e){if(r.isAbsolute)return new oo(t,!0,0);if(!e)return new oo(t,!1,NaN);if(e.parent===null)return new oo(e,!0,0);let n=Al(r.commands[0])?0:1,i=e.segments.length-1+n;return Ey(e,i,r.numberOfDoubleDots)}function Ey(r,t,e){let n=r,i=t,s=e;for(;s>i;){if(s-=i,n=n.parent,!n)throw new nn(4005,!1);i=n.segments.length}return new oo(n,!1,i-s)}function _y(r){return tc(r[0])?r[0].outlets:{[re]:r}}function Rm(r,t,e){if(r??=new Fe([],{}),r.segments.length===0&&r.hasChildren())return Ja(r,t,e);let n=Cy(r,t,e),i=e.slice(n.commandIndex);if(n.match&&n.pathIndex<r.segments.length){let s=new Fe(r.segments.slice(0,n.pathIndex),{});return s.children[re]=new Fe(r.segments.slice(n.pathIndex),r.children),Ja(s,0,i)}else return n.match&&i.length===0?new Fe(r.segments,{}):n.match&&!r.hasChildren()?Pu(r,t,e):n.match?Ja(r,0,i):Pu(r,t,e)}function Ja(r,t,e){if(e.length===0)return new Fe(r.segments,{});{let n=_y(e),i={};if(Object.keys(n).some(s=>s!==re)&&r.children[re]&&r.numberOfChildren===1&&r.children[re].segments.length===0){let s=Ja(r.children[re],t,e);return new Fe(r.segments,s.children)}return Object.entries(n).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=Rm(r.children[s],t,o))}),Object.entries(r.children).forEach(([s,o])=>{n[s]===void 0&&(i[s]=o)}),new Fe(r.segments,i)}}function Cy(r,t,e){let n=0,i=t,s={match:!1,pathIndex:0,commandIndex:0};for(;i<r.segments.length;){if(n>=e.length)return s;let o=r.segments[i],a=e[n];if(tc(a))break;let c=`${a}`,l=n<e.length-1?e[n+1]:null;if(i>0&&c===void 0)break;if(c&&l&&typeof l=="object"&&l.outlets===void 0){if(!vm(c,l,o))return s;n+=2}else{if(!vm(c,{},o))return s;n++}i++}return{match:!0,pathIndex:i,commandIndex:n}}function Pu(r,t,e){let n=r.segments.slice(0,t),i=0;for(;i<e.length;){let s=e[i];if(tc(s)){let c=yy(s.outlets);return new Fe(n,c)}if(i===0&&Al(e[0])){let c=r.segments[t];n.push(new ms(c.path,gm(e[0]))),i++;continue}let o=tc(s)?s.outlets[re]:`${s}`,a=i<e.length-1?e[i+1]:null;o&&a&&Al(a)?(n.push(new ms(o,gm(a))),i+=2):(n.push(new ms(o,{})),i++)}return new Fe(n,{})}function yy(r){let t={};return Object.entries(r).forEach(([e,n])=>{typeof n=="string"&&(n=[n]),n!==null&&(t[e]=Pu(new Fe([],{}),0,n))}),t}function gm(r){let t={};return Object.entries(r).forEach(([e,n])=>t[e]=`${n}`),t}function vm(r,t,e){return r==e.path&&Vi(t,e.parameters)}var Ka="imperative",En=function(r){return r[r.NavigationStart=0]="NavigationStart",r[r.NavigationEnd=1]="NavigationEnd",r[r.NavigationCancel=2]="NavigationCancel",r[r.NavigationError=3]="NavigationError",r[r.RoutesRecognized=4]="RoutesRecognized",r[r.ResolveStart=5]="ResolveStart",r[r.ResolveEnd=6]="ResolveEnd",r[r.GuardsCheckStart=7]="GuardsCheckStart",r[r.GuardsCheckEnd=8]="GuardsCheckEnd",r[r.RouteConfigLoadStart=9]="RouteConfigLoadStart",r[r.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",r[r.ChildActivationStart=11]="ChildActivationStart",r[r.ChildActivationEnd=12]="ChildActivationEnd",r[r.ActivationStart=13]="ActivationStart",r[r.ActivationEnd=14]="ActivationEnd",r[r.Scroll=15]="Scroll",r[r.NavigationSkipped=16]="NavigationSkipped",r}(En||{}),ai=class{constructor(t,e){this.id=t,this.url=e}},ec=class extends ai{constructor(t,e,n="imperative",i=null){super(t,e),this.type=En.NavigationStart,this.navigationTrigger=n,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},vs=class extends ai{constructor(t,e,n){super(t,e),this.urlAfterRedirects=n,this.type=En.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Zn=function(r){return r[r.Redirect=0]="Redirect",r[r.SupersededByNewNavigation=1]="SupersededByNewNavigation",r[r.NoDataFromResolver=2]="NoDataFromResolver",r[r.GuardRejected=3]="GuardRejected",r}(Zn||{}),Ru=function(r){return r[r.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",r[r.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",r}(Ru||{}),Tr=class extends ai{constructor(t,e,n,i){super(t,e),this.reason=n,this.code=i,this.type=En.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Es=class extends ai{constructor(t,e,n,i){super(t,e),this.reason=n,this.code=i,this.type=En.NavigationSkipped}},nc=class extends ai{constructor(t,e,n,i){super(t,e),this.error=n,this.target=i,this.type=En.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},wl=class extends ai{constructor(t,e,n,i){super(t,e),this.urlAfterRedirects=n,this.state=i,this.type=En.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},ku=class extends ai{constructor(t,e,n,i){super(t,e),this.urlAfterRedirects=n,this.state=i,this.type=En.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Ou=class extends ai{constructor(t,e,n,i,s){super(t,e),this.urlAfterRedirects=n,this.state=i,this.shouldActivate=s,this.type=En.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Iu=class extends ai{constructor(t,e,n,i){super(t,e),this.urlAfterRedirects=n,this.state=i,this.type=En.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Lu=class extends ai{constructor(t,e,n,i){super(t,e),this.urlAfterRedirects=n,this.state=i,this.type=En.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Nu=class{constructor(t){this.route=t,this.type=En.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Uu=class{constructor(t){this.route=t,this.type=En.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},zu=class{constructor(t){this.snapshot=t,this.type=En.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Vu=class{constructor(t){this.snapshot=t,this.type=En.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Hu=class{constructor(t){this.snapshot=t,this.type=En.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Gu=class{constructor(t){this.snapshot=t,this.type=En.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var ic=class{},rc=class{constructor(t){this.url=t}};var Wu=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Fl,this.attachRef=null}},Fl=(()=>{let t=class t{constructor(){this.contexts=new Map}onChildOutletCreated(n,i){let s=this.getOrCreateContext(n);s.outlet=i,this.contexts.set(n,s)}onChildOutletDestroyed(n){let i=this.getContext(n);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let i=this.getContext(n);return i||(i=new Wu,this.contexts.set(n,i)),i}getContext(n){return this.contexts.get(n)||null}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})(),Sl=class{constructor(t){this._root=t}get root(){return this._root.value}parent(t){let e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){let e=ju(t,this._root);return e?e.children.map(n=>n.value):[]}firstChild(t){let e=ju(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){let e=Xu(t,this._root);return e.length<2?[]:e[e.length-2].children.map(i=>i.value).filter(i=>i!==t)}pathFromRoot(t){return Xu(t,this._root).map(e=>e.value)}};function ju(r,t){if(r===t.value)return t;for(let e of t.children){let n=ju(r,e);if(n)return n}return null}function Xu(r,t){if(r===t.value)return[t];for(let e of t.children){let n=Xu(r,e);if(n.length)return n.unshift(t),n}return[]}var $n=class{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}};function so(r){let t={};return r&&r.children.forEach(e=>t[e.value.outlet]=e),t}var Ml=class extends Sl{constructor(t,e){super(t),this.snapshot=e,id(this,t)}toString(){return this.snapshot.toString()}};function km(r){let t=Ay(r),e=new ii([new ms("",{})]),n=new ii({}),i=new ii({}),s=new ii({}),o=new ii(""),a=new Gn(e,n,s,o,i,re,r,t.root);return a.snapshot=t.root,new Ml(new $n(a,[]),t)}function Ay(r){let t={},e={},n={},i="",s=new sc([],t,n,i,e,re,r,null,{});return new Dl("",new $n(s,[]))}var Gn=class{constructor(t,e,n,i,s,o,a,c){this.urlSubject=t,this.paramsSubject=e,this.queryParamsSubject=n,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(Ve(l=>l[cc]))??ne(void 0),this.url=t,this.params=e,this.queryParams=n,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Ve(t=>co(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Ve(t=>co(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function nd(r,t,e="emptyOnly"){let n,{routeConfig:i}=r;return t!==null&&(e==="always"||i?.path===""||!t.component&&!t.routeConfig?.loadComponent)?n={params:Ot(Ot({},t.params),r.params),data:Ot(Ot({},t.data),r.data),resolve:Ot(Ot(Ot(Ot({},r.data),t.data),i?.data),r._resolvedData)}:n={params:Ot({},r.params),data:Ot({},r.data),resolve:Ot(Ot({},r.data),r._resolvedData??{})},i&&Im(i)&&(n.resolve[cc]=i.title),n}var sc=class{get title(){return this.data?.[cc]}constructor(t,e,n,i,s,o,a,c,l){this.url=t,this.params=e,this.queryParams=n,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=c,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=co(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=co(this.queryParams),this._queryParamMap}toString(){let t=this.url.map(n=>n.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${t}', path:'${e}')`}},Dl=class extends Sl{constructor(t,e){super(e),this.url=t,id(this,e)}toString(){return Om(this._root)}};function id(r,t){t.value._routerState=r,t.children.forEach(e=>id(r,e))}function Om(r){let t=r.children.length>0?` { ${r.children.map(Om).join(", ")} } `:"";return`${r.value}${t}`}function Su(r){if(r.snapshot){let t=r.snapshot,e=r._futureSnapshot;r.snapshot=e,Vi(t.queryParams,e.queryParams)||r.queryParamsSubject.next(e.queryParams),t.fragment!==e.fragment&&r.fragmentSubject.next(e.fragment),Vi(t.params,e.params)||r.paramsSubject.next(e.params),KC(t.url,e.url)||r.urlSubject.next(e.url),Vi(t.data,e.data)||r.dataSubject.next(e.data)}else r.snapshot=r._futureSnapshot,r.dataSubject.next(r._futureSnapshot.data)}function Yu(r,t){let e=Vi(r.params,t.params)&&ny(r.url,t.url),n=!r.parent!=!t.parent;return e&&!n&&(!r.parent||Yu(r.parent,t.parent))}function Im(r){return typeof r.title=="string"||r.title===null}var rd=(()=>{let t=class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=re,this.activateEvents=new Ce,this.deactivateEvents=new Ce,this.attachEvents=new Ce,this.detachEvents=new Ce,this.parentContexts=ie(Fl),this.location=ie(qp),this.changeDetector=ie(fu),this.environmentInjector=ie(ul),this.inputBinder=ie(sd,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){let{firstChange:i,previousValue:s}=n.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new nn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new nn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new nn(4012,!1);this.location.detach();let n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){let n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new nn(4013,!1);this._activatedRoute=n;let s=this.location,a=n.snapshot.component,c=this.parentContexts.getOrCreateContext(this.name).children,l=new qu(n,c,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:l,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};t.\u0275fac=function(i){return new(i||t)},t.\u0275dir=Up({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Vp]});let r=t;return r})(),qu=class r{__ngOutletInjector(t){return new r(this.route,this.childContexts,t)}constructor(t,e,n){this.route=t,this.childContexts=e,this.parent=n}get(t,e){return t===Gn?this.route:t===Fl?this.childContexts:this.parent.get(t,e)}},sd=new si("");function by(r,t,e){let n=oc(r,t._root,e?e._root:void 0);return new Ml(n,t)}function oc(r,t,e){if(e&&r.shouldReuseRoute(t.value,e.value.snapshot)){let n=e.value;n._futureSnapshot=t.value;let i=wy(r,t,e);return new $n(n,i)}else{if(r.shouldAttach(t.value)){let s=r.retrieve(t.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=t.value,o.children=t.children.map(a=>oc(r,a)),o}}let n=Sy(t.value),i=t.children.map(s=>oc(r,s));return new $n(n,i)}}function wy(r,t,e){return t.children.map(n=>{for(let i of e.children)if(r.shouldReuseRoute(n.value,i.value.snapshot))return oc(r,n,i);return oc(r,n)})}function Sy(r){return new Gn(new ii(r.url),new ii(r.params),new ii(r.queryParams),new ii(r.fragment),new ii(r.data),r.outlet,r.component,r)}var Lm="ngNavigationCancelingError";function Nm(r,t){let{redirectTo:e,navigationBehaviorOptions:n}=lo(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,i=Um(!1,Zn.Redirect);return i.url=e,i.navigationBehaviorOptions=n,i}function Um(r,t){let e=new Error(`NavigationCancelingError: ${r||""}`);return e[Lm]=!0,e.cancellationCode=t,e}function My(r){return zm(r)&&lo(r.url)}function zm(r){return!!r&&r[Lm]}var Dy=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["ng-component"]],standalone:!0,features:[Vt],decls:1,vars:0,template:function(i,s){i&1&&Dt(0,"router-outlet")},dependencies:[rd],encapsulation:2});let r=t;return r})();function By(r,t){return r.providers&&!r._injector&&(r._injector=Zp(r.providers,t,`Route: ${r.path}`)),r._injector??t}function od(r){let t=r.children&&r.children.map(od),e=t?dn(Ot({},r),{children:t}):Ot({},r);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==re&&(e.component=Dy),e}function Hi(r){return r.outlet||re}function Ty(r,t){let e=r.filter(n=>Hi(n)===t);return e.push(...r.filter(n=>Hi(n)!==t)),e}function lc(r){if(!r)return null;if(r.routeConfig?._injector)return r.routeConfig._injector;for(let t=r.parent;t;t=t.parent){let e=t.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var Fy=(r,t,e,n)=>Ve(i=>(new $u(t,i.targetRouterState,i.currentRouterState,e,n).activate(r),i)),$u=class{constructor(t,e,n,i,s){this.routeReuseStrategy=t,this.futureState=e,this.currState=n,this.forwardEvent=i,this.inputBindingEnabled=s}activate(t){let e=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,n,t),Su(this.futureState.root),this.activateChildRoutes(e,n,t)}deactivateChildRoutes(t,e,n){let i=so(e);t.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],n),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,n)})}deactivateRoutes(t,e,n){let i=t.value,s=e?e.value:null;if(i===s)if(i.component){let o=n.getContext(i.outlet);o&&this.deactivateChildRoutes(t,e,o.children)}else this.deactivateChildRoutes(t,e,n);else s&&this.deactivateRouteAndItsChildren(e,n)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){let n=e.getContext(t.value.outlet),i=n&&t.value.component?n.children:e,s=so(t);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(n&&n.outlet){let o=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:o,route:t,contexts:a})}}deactivateRouteAndOutlet(t,e){let n=e.getContext(t.value.outlet),i=n&&t.value.component?n.children:e,s=so(t);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(t,e,n){let i=so(e);t.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],n),this.forwardEvent(new Gu(s.value.snapshot))}),t.children.length&&this.forwardEvent(new Vu(t.value.snapshot))}activateRoutes(t,e,n){let i=t.value,s=e?e.value:null;if(Su(i),i===s)if(i.component){let o=n.getOrCreateContext(i.outlet);this.activateChildRoutes(t,e,o.children)}else this.activateChildRoutes(t,e,n);else if(i.component){let o=n.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),Su(a.route.value),this.activateChildRoutes(t,null,o.children)}else{let a=lc(i.snapshot);o.attachRef=null,o.route=i,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(t,null,o.children)}}else this.activateChildRoutes(t,null,n)}},Bl=class{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}},ao=class{constructor(t,e){this.component=t,this.route=e}};function Py(r,t,e){let n=r._root,i=t?t._root:null;return $a(n,i,e,[n.value])}function Ry(r){let t=r.routeConfig?r.routeConfig.canActivateChild:null;return!t||t.length===0?null:{node:r,guards:t}}function uo(r,t){let e=Symbol(),n=t.get(r,e);return n===e?typeof r=="function"&&!Np(r)?r:t.get(r):n}function $a(r,t,e,n,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=so(t);return r.children.forEach(o=>{ky(o,s[o.value.outlet],e,n.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>Qa(a,e.getContext(o),i)),i}function ky(r,t,e,n,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=r.value,o=t?t.value:null,a=e?e.getContext(r.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let c=Oy(o,s,s.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new Bl(n)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?$a(r,t,a?a.children:null,n,i):$a(r,t,e,n,i),c&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new ao(a.outlet.component,o))}else o&&Qa(t,a,i),i.canActivateChecks.push(new Bl(n)),s.component?$a(r,null,a?a.children:null,n,i):$a(r,null,e,n,i);return i}function Oy(r,t,e){if(typeof e=="function")return e(r,t);switch(e){case"pathParamsChange":return!gs(r.url,t.url);case"pathParamsOrQueryParamsChange":return!gs(r.url,t.url)||!Vi(r.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Yu(r,t)||!Vi(r.queryParams,t.queryParams);case"paramsChange":default:return!Yu(r,t)}}function Qa(r,t,e){let n=so(r),i=r.value;Object.entries(n).forEach(([s,o])=>{i.component?t?Qa(o,t.children.getContext(s),e):Qa(o,null,e):Qa(o,t,e)}),i.component?t&&t.outlet&&t.outlet.isActivated?e.canDeactivateChecks.push(new ao(t.outlet.component,i)):e.canDeactivateChecks.push(new ao(null,i)):e.canDeactivateChecks.push(new ao(null,i))}function hc(r){return typeof r=="function"}function Iy(r){return typeof r=="boolean"}function Ly(r){return r&&hc(r.canLoad)}function Ny(r){return r&&hc(r.canActivate)}function Uy(r){return r&&hc(r.canActivateChild)}function zy(r){return r&&hc(r.canDeactivate)}function Vy(r){return r&&hc(r.canMatch)}function Vm(r){return r instanceof Fp||r?.name==="EmptyError"}var vl=Symbol("INITIAL_VALUE");function ho(){return zi(r=>nu(r.map(t=>t.pipe(eo(1),Ip(vl)))).pipe(Ve(t=>{for(let e of t)if(e!==!0){if(e===vl)return vl;if(e===!1||e instanceof Br)return e}return!0}),Qs(t=>t!==vl),eo(1)))}function Hy(r,t){return ri(e=>{let{targetSnapshot:n,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=e;return o.length===0&&s.length===0?ne(dn(Ot({},e),{guardsResult:!0})):Gy(o,n,i,r).pipe(ri(a=>a&&Iy(a)?Wy(n,s,r,t):ne(a)),Ve(a=>dn(Ot({},e),{guardsResult:a})))})}function Gy(r,t,e,n){return yi(r).pipe(ri(i=>$y(i.component,i.route,e,t,n)),Mr(i=>i!==!0,!0))}function Wy(r,t,e,n){return yi(t).pipe(Ua(i=>Pp(Xy(i.route.parent,n),jy(i.route,n),qy(r,i.path,e),Yy(r,i.route,e))),Mr(i=>i!==!0,!0))}function jy(r,t){return r!==null&&t&&t(new Hu(r)),ne(!0)}function Xy(r,t){return r!==null&&t&&t(new zu(r)),ne(!0)}function Yy(r,t,e){let n=t.routeConfig?t.routeConfig.canActivate:null;if(!n||n.length===0)return ne(!0);let i=n.map(s=>iu(()=>{let o=lc(t)??e,a=uo(s,o),c=Ny(a)?a.canActivate(t,r):xs(o,()=>a(t,r));return Fr(c).pipe(Mr())}));return ne(i).pipe(ho())}function qy(r,t,e){let n=t[t.length-1],s=t.slice(0,t.length-1).reverse().map(o=>Ry(o)).filter(o=>o!==null).map(o=>iu(()=>{let a=o.guards.map(c=>{let l=lc(o.node)??e,h=uo(c,l),u=Uy(h)?h.canActivateChild(n,r):xs(l,()=>h(n,r));return Fr(u).pipe(Mr())});return ne(a).pipe(ho())}));return ne(s).pipe(ho())}function $y(r,t,e,n,i){let s=t&&t.routeConfig?t.routeConfig.canDeactivate:null;if(!s||s.length===0)return ne(!0);let o=s.map(a=>{let c=lc(t)??i,l=uo(a,c),h=zy(l)?l.canDeactivate(r,t,e,n):xs(c,()=>l(r,t,e,n));return Fr(h).pipe(Mr())});return ne(o).pipe(ho())}function Zy(r,t,e,n){let i=t.canLoad;if(i===void 0||i.length===0)return ne(!0);let s=i.map(o=>{let a=uo(o,r),c=Ly(a)?a.canLoad(t,e):xs(r,()=>a(t,e));return Fr(c)});return ne(s).pipe(ho(),Hm(n))}function Hm(r){return Bp(Mn(t=>{if(lo(t))throw Nm(r,t)}),Ve(t=>t===!0))}function Jy(r,t,e,n){let i=t.canMatch;if(!i||i.length===0)return ne(!0);let s=i.map(o=>{let a=uo(o,r),c=Vy(a)?a.canMatch(t,e):xs(r,()=>a(t,e));return Fr(c)});return ne(s).pipe(ho(),Hm(n))}var ac=class{constructor(t){this.segmentGroup=t||null}},Tl=class extends Error{constructor(t){super(),this.urlTree=t}};function ro(r){return Na(new ac(r))}function Ky(r){return Na(new nn(4e3,!1))}function Qy(r){return Na(Um(!1,Zn.GuardRejected))}var Zu=class{constructor(t,e){this.urlSerializer=t,this.urlTree=e}lineralizeSegments(t,e){let n=[],i=e.root;for(;;){if(n=n.concat(i.segments),i.numberOfChildren===0)return ne(n);if(i.numberOfChildren>1||!i.children[re])return Ky(t.redirectTo);i=i.children[re]}}applyRedirectCommands(t,e,n){let i=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),t,n);if(e.startsWith("/"))throw new Tl(i);return i}applyRedirectCreateUrlTree(t,e,n,i){let s=this.createSegmentGroup(t,e.root,n,i);return new Br(s,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){let n={};return Object.entries(t).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let a=s.substring(1);n[i]=e[a]}else n[i]=s}),n}createSegmentGroup(t,e,n,i){let s=this.createSegments(t,e.segments,n,i),o={};return Object.entries(e.children).forEach(([a,c])=>{o[a]=this.createSegmentGroup(t,c,n,i)}),new Fe(s,o)}createSegments(t,e,n,i){return e.map(s=>s.path.startsWith(":")?this.findPosParam(t,s,i):this.findOrReturn(s,n))}findPosParam(t,e,n){let i=n[e.path.substring(1)];if(!i)throw new nn(4001,!1);return i}findOrReturn(t,e){let n=0;for(let i of e){if(i.path===t.path)return e.splice(n),i;n++}return t}},Ju={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function tA(r,t,e,n,i){let s=ad(r,t,e);return s.matched?(n=By(t,n),Jy(n,t,e,i).pipe(Ve(o=>o===!0?s:Ot({},Ju)))):ne(s)}function ad(r,t,e){if(t.path==="**")return eA(e);if(t.path==="")return t.pathMatch==="full"&&(r.hasChildren()||e.length>0)?Ot({},Ju):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let i=(t.matcher||JC)(e,r,t);if(!i)return Ot({},Ju);let s={};Object.entries(i.posParams??{}).forEach(([a,c])=>{s[a]=c.path});let o=i.consumed.length>0?Ot(Ot({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:e.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function eA(r){return{matched:!0,parameters:r.length>0?Cm(r).parameters:{},consumedSegments:r,remainingSegments:[],positionalParamSegments:{}}}function Em(r,t,e,n){return e.length>0&&rA(r,e,n)?{segmentGroup:new Fe(t,iA(n,new Fe(e,r.children))),slicedSegments:[]}:e.length===0&&sA(r,e,n)?{segmentGroup:new Fe(r.segments,nA(r,e,n,r.children)),slicedSegments:e}:{segmentGroup:new Fe(r.segments,r.children),slicedSegments:e}}function nA(r,t,e,n){let i={};for(let s of e)if(Pl(r,t,s)&&!n[Hi(s)]){let o=new Fe([],{});i[Hi(s)]=o}return Ot(Ot({},n),i)}function iA(r,t){let e={};e[re]=t;for(let n of r)if(n.path===""&&Hi(n)!==re){let i=new Fe([],{});e[Hi(n)]=i}return e}function rA(r,t,e){return e.some(n=>Pl(r,t,n)&&Hi(n)!==re)}function sA(r,t,e){return e.some(n=>Pl(r,t,n))}function Pl(r,t,e){return(r.hasChildren()||t.length>0)&&e.pathMatch==="full"?!1:e.path===""}function oA(r,t,e,n){return Hi(r)!==n&&(n===re||!Pl(t,e,r))?!1:ad(t,r,e).matched}function aA(r,t,e){return t.length===0&&!r.children[e]}var Ku=class{};function cA(r,t,e,n,i,s,o="emptyOnly"){return new Qu(r,t,e,n,i,o,s).recognize()}var lA=31,Qu=class{constructor(t,e,n,i,s,o,a){this.injector=t,this.configLoader=e,this.rootComponentType=n,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new Zu(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(t){return new nn(4002,`'${t.segmentGroup}'`)}recognize(){let t=Em(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(Ve(e=>{let n=new sc([],Object.freeze({}),Object.freeze(Ot({},this.urlTree.queryParams)),this.urlTree.fragment,{},re,this.rootComponentType,null,{}),i=new $n(n,e),s=new Dl("",i),o=my(n,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t,re).pipe(to(n=>{if(n instanceof Tl)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof ac?this.noMatchError(n):n}))}inheritParamsAndData(t,e){let n=t.value,i=nd(n,e,this.paramsInheritanceStrategy);n.params=Object.freeze(i.params),n.data=Object.freeze(i.data),t.children.forEach(s=>this.inheritParamsAndData(s,n))}processSegmentGroup(t,e,n,i){return n.segments.length===0&&n.hasChildren()?this.processChildren(t,e,n):this.processSegment(t,e,n,n.segments,i,!0).pipe(Ve(s=>s instanceof $n?[s]:[]))}processChildren(t,e,n){let i=[];for(let s of Object.keys(n.children))s==="primary"?i.unshift(s):i.push(s);return yi(i).pipe(Ua(s=>{let o=n.children[s],a=Ty(e,s);return this.processSegmentGroup(t,a,o,s)}),Op((s,o)=>(s.push(...o),s)),ru(null),kp(),ri(s=>{if(s===null)return ro(n);let o=Gm(s);return hA(o),ne(o)}))}processSegment(t,e,n,i,s,o){return yi(e).pipe(Ua(a=>this.processSegmentAgainstRoute(a._injector??t,e,a,n,i,s,o).pipe(to(c=>{if(c instanceof ac)return ne(null);throw c}))),Mr(a=>!!a),to(a=>{if(Vm(a))return aA(n,i,s)?ne(new Ku):ro(n);throw a}))}processSegmentAgainstRoute(t,e,n,i,s,o,a){return oA(n,i,s,o)?n.redirectTo===void 0?this.matchSegmentAgainstRoute(t,i,n,s,o):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(t,i,e,n,s,o):ro(i):ro(i)}expandSegmentAgainstRouteUsingRedirect(t,e,n,i,s,o){let{matched:a,consumedSegments:c,positionalParamSegments:l,remainingSegments:h}=ad(e,i,s);if(!a)return ro(e);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>lA&&(this.allowRedirects=!1));let u=this.applyRedirects.applyRedirectCommands(c,i.redirectTo,l);return this.applyRedirects.lineralizeSegments(i,u).pipe(ri(d=>this.processSegment(t,n,e,d.concat(h),o,!1)))}matchSegmentAgainstRoute(t,e,n,i,s){let o=tA(e,n,i,t,this.urlSerializer);return n.path==="**"&&(e.children={}),o.pipe(zi(a=>a.matched?(t=n._injector??t,this.getChildConfig(t,n,i).pipe(zi(({routes:c})=>{let l=n._loadedInjector??t,{consumedSegments:h,remainingSegments:u,parameters:d}=a,x=new sc(h,d,Object.freeze(Ot({},this.urlTree.queryParams)),this.urlTree.fragment,dA(n),Hi(n),n.component??n._loadedComponent??null,n,xA(n)),{segmentGroup:m,slicedSegments:g}=Em(e,h,u,c);if(g.length===0&&m.hasChildren())return this.processChildren(l,c,m).pipe(Ve(p=>p===null?null:new $n(x,p)));if(c.length===0&&g.length===0)return ne(new $n(x,[]));let f=Hi(n)===s;return this.processSegment(l,c,m,g,f?re:s,!0).pipe(Ve(p=>new $n(x,p instanceof $n?[p]:[])))}))):ro(e)))}getChildConfig(t,e,n){return e.children?ne({routes:e.children,injector:t}):e.loadChildren?e._loadedRoutes!==void 0?ne({routes:e._loadedRoutes,injector:e._loadedInjector}):Zy(t,e,n,this.urlSerializer).pipe(ri(i=>i?this.configLoader.loadChildren(t,e).pipe(Mn(s=>{e._loadedRoutes=s.routes,e._loadedInjector=s.injector})):Qy(e))):ne({routes:[],injector:t})}};function hA(r){r.sort((t,e)=>t.value.outlet===re?-1:e.value.outlet===re?1:t.value.outlet.localeCompare(e.value.outlet))}function uA(r){let t=r.value.routeConfig;return t&&t.path===""}function Gm(r){let t=[],e=new Set;for(let n of r){if(!uA(n)){t.push(n);continue}let i=t.find(s=>n.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...n.children),e.add(i)):t.push(n)}for(let n of e){let i=Gm(n.children);t.push(new $n(n.value,i))}return t.filter(n=>!e.has(n))}function dA(r){return r.data||{}}function xA(r){return r.resolve||{}}function fA(r,t,e,n,i,s){return ri(o=>cA(r,t,e,n,o.extractedUrl,i,s).pipe(Ve(({state:a,tree:c})=>dn(Ot({},o),{targetSnapshot:a,urlAfterRedirects:c}))))}function pA(r,t){return ri(e=>{let{targetSnapshot:n,guards:{canActivateChecks:i}}=e;if(!i.length)return ne(e);let s=new Set(i.map(c=>c.route)),o=new Set;for(let c of s)if(!o.has(c))for(let l of Wm(c))o.add(l);let a=0;return yi(o).pipe(Ua(c=>s.has(c)?mA(c,n,r,t):(c.data=nd(c,c.parent,r).resolve,ne(void 0))),Mn(()=>a++),su(1),ri(c=>a===o.size?ne(e):Sr))})}function Wm(r){let t=r.children.map(e=>Wm(e)).flat();return[r,...t]}function mA(r,t,e,n){let i=r.routeConfig,s=r._resolve;return i?.title!==void 0&&!Im(i)&&(s[cc]=i.title),gA(s,r,t,n).pipe(Ve(o=>(r._resolvedData=o,r.data=nd(r,r.parent,e).resolve,null)))}function gA(r,t,e,n){let i=Bu(r);if(i.length===0)return ne({});let s={};return yi(i).pipe(ri(o=>vA(r[o],t,e,n).pipe(Mr(),Mn(a=>{s[o]=a}))),su(1),Rp(s),to(o=>Vm(o)?Sr:Na(o)))}function vA(r,t,e,n){let i=lc(t)??n,s=uo(r,i),o=s.resolve?s.resolve(t,e):xs(i,()=>s(t,e));return Fr(o)}function Mu(r){return zi(t=>{let e=r(t);return e?yi(e).pipe(Ve(()=>t)):ne(t)})}var jm=(()=>{let t=class t{buildTitle(n){let i,s=n.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===re);return i}getResolvedTitleForRoute(n){return n.data[cc]}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:()=>ie(EA),providedIn:"root"});let r=t;return r})(),EA=(()=>{let t=class t extends jm{constructor(n){super(),this.title=n}updateTitle(n){let i=this.buildTitle(n);i!==void 0&&this.title.setTitle(i)}};t.\u0275fac=function(i){return new(i||t)(Le(fm))},t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})(),cd=new si("",{providedIn:"root",factory:()=>({})}),ld=new si(""),_A=(()=>{let t=class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ie(xu)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return ne(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);let i=Fr(n.loadComponent()).pipe(Ve(Xm),Mn(o=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=o}),hl(()=>{this.componentLoaders.delete(n)})),s=new eu(i,()=>new ds).pipe(tu());return this.componentLoaders.set(n,s),s}loadChildren(n,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return ne({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=CA(i,this.compiler,n,this.onLoadEndListener).pipe(hl(()=>{this.childrenLoaders.delete(i)})),a=new eu(o,()=>new ds).pipe(tu());return this.childrenLoaders.set(i,a),a}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();function CA(r,t,e,n){return Fr(r.loadChildren()).pipe(Ve(Xm),ri(i=>i instanceof $p||Array.isArray(i)?ne(i):yi(t.compileModuleAsync(i))),Ve(i=>{n&&n(r);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(e).injector,o=s.get(ld,[],{optional:!0,self:!0}).flat()),{routes:o.map(od),injector:s}}))}function yA(r){return r&&typeof r=="object"&&"default"in r}function Xm(r){return yA(r)?r.default:r}var hd=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:()=>ie(AA),providedIn:"root"});let r=t;return r})(),AA=(()=>{let t=class t{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,i){return n}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})(),bA=new si("");var wA=(()=>{let t=class t{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new ds,this.transitionAbortSubject=new ds,this.configLoader=ie(_A),this.environmentInjector=ie(ul),this.urlSerializer=ie(ed),this.rootContexts=ie(Fl),this.location=ie(Dr),this.inputBindingEnabled=ie(sd,{optional:!0})!==null,this.titleStrategy=ie(jm),this.options=ie(cd,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=ie(hd),this.createViewTransition=ie(bA,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>ne(void 0),this.rootComponentType=null;let n=s=>this.events.next(new Nu(s)),i=s=>this.events.next(new Uu(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=n}complete(){this.transitions?.complete()}handleNavigationRequest(n){let i=++this.navigationId;this.transitions?.next(dn(Ot(Ot({},this.transitions.value),n),{id:i}))}setupNavigations(n,i,s){return this.transitions=new ii({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Ka,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Qs(o=>o.id!==0),Ve(o=>dn(Ot({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),zi(o=>{let a=!1,c=!1;return ne(o).pipe(zi(l=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",Zn.SupersededByNewNavigation),Sr;this.currentTransition=o,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?dn(Ot({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let h=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),u=l.extras.onSameUrlNavigation??n.onSameUrlNavigation;if(!h&&u!=="reload"){let d="";return this.events.next(new Es(l.id,this.urlSerializer.serialize(l.rawUrl),d,Ru.IgnoredSameUrlNavigation)),l.resolve(null),Sr}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return ne(l).pipe(zi(d=>{let x=this.transitions?.getValue();return this.events.next(new ec(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),x!==this.transitions?.getValue()?Sr:Promise.resolve(d)}),fA(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),Mn(d=>{o.targetSnapshot=d.targetSnapshot,o.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=dn(Ot({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let x=new wl(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(x)}));if(h&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:d,extractedUrl:x,source:m,restoredState:g,extras:f}=l,p=new ec(d,this.urlSerializer.serialize(x),m,g);this.events.next(p);let v=km(this.rootComponentType).snapshot;return this.currentTransition=o=dn(Ot({},l),{targetSnapshot:v,urlAfterRedirects:x,extras:dn(Ot({},f),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=x,ne(o)}else{let d="";return this.events.next(new Es(l.id,this.urlSerializer.serialize(l.extractedUrl),d,Ru.IgnoredByUrlHandlingStrategy)),l.resolve(null),Sr}}),Mn(l=>{let h=new ku(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}),Ve(l=>(this.currentTransition=o=dn(Ot({},l),{guards:Py(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),o)),Hy(this.environmentInjector,l=>this.events.next(l)),Mn(l=>{if(o.guardsResult=l.guardsResult,lo(l.guardsResult))throw Nm(this.urlSerializer,l.guardsResult);let h=new Ou(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(h)}),Qs(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",Zn.GuardRejected),!1)),Mu(l=>{if(l.guards.canActivateChecks.length)return ne(l).pipe(Mn(h=>{let u=new Iu(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(u)}),zi(h=>{let u=!1;return ne(h).pipe(pA(this.paramsInheritanceStrategy,this.environmentInjector),Mn({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(h,"",Zn.NoDataFromResolver)}}))}),Mn(h=>{let u=new Lu(h.id,this.urlSerializer.serialize(h.extractedUrl),this.urlSerializer.serialize(h.urlAfterRedirects),h.targetSnapshot);this.events.next(u)}))}),Mu(l=>{let h=u=>{let d=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(u.routeConfig).pipe(Mn(x=>{u.component=x}),Ve(()=>{})));for(let x of u.children)d.push(...h(x));return d};return nu(h(l.targetSnapshot.root)).pipe(ru(null),eo(1))}),Mu(()=>this.afterPreactivation()),zi(()=>{let{currentSnapshot:l,targetSnapshot:h}=o,u=this.createViewTransition?.(this.environmentInjector,l.root,h.root);return u?yi(u).pipe(Ve(()=>o)):ne(o)}),Ve(l=>{let h=by(n.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=o=dn(Ot({},l),{targetRouterState:h}),this.currentNavigation.targetRouterState=h,o}),Mn(()=>{this.events.next(new ic)}),Fy(this.rootContexts,n.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),eo(1),Mn({next:l=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new vs(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{a=!0}}),Lp(this.transitionAbortSubject.pipe(Mn(l=>{throw l}))),hl(()=>{!a&&!c&&this.cancelNavigationTransition(o,"",Zn.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),to(l=>{if(c=!0,zm(l))this.events.next(new Tr(o.id,this.urlSerializer.serialize(o.extractedUrl),l.message,l.cancellationCode)),My(l)?this.events.next(new rc(l.url)):o.resolve(!1);else{this.events.next(new nc(o.id,this.urlSerializer.serialize(o.extractedUrl),l,o.targetSnapshot??void 0));try{o.resolve(n.errorHandler(l))}catch(h){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(h)}}return Sr}))}))}cancelNavigationTransition(n,i,s){let o=new Tr(n.id,this.urlSerializer.serialize(n.extractedUrl),i,s);this.events.next(o),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();function SA(r){return r!==Ka}var MA=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:()=>ie(DA),providedIn:"root"});let r=t;return r})(),td=class{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}},DA=(()=>{let t=class t extends td{};t.\u0275fac=(()=>{let n;return function(s){return(n||(n=au(t)))(s||t)}})(),t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})(),Ym=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:()=>ie(BA),providedIn:"root"});let r=t;return r})(),BA=(()=>{let t=class t extends Ym{constructor(){super(...arguments),this.location=ie(Dr),this.urlSerializer=ie(ed),this.options=ie(cd,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=ie(hd),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new Br,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=km(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(i=>{i.type==="popstate"&&n(i.url,i.state)})}handleRouterEvent(n,i){if(n instanceof ec)this.stateMemento=this.createStateMemento();else if(n instanceof Es)this.rawUrlTree=i.initialUrl;else if(n instanceof wl){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else n instanceof ic?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):n instanceof Tr&&(n.code===Zn.GuardRejected||n.code===Zn.NoDataFromResolver)?this.restoreHistory(i):n instanceof nc?this.restoreHistory(i,!0):n instanceof vs&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,i){let s=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,a=Ot(Ot({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",a)}else{let o=Ot(Ot({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(n,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===n.finalUrl&&o===0&&(this.resetState(n),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,i){return this.canceledNavigationResolution==="computed"?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}};t.\u0275fac=(()=>{let n;return function(s){return(n||(n=au(t)))(s||t)}})(),t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})(),Za=function(r){return r[r.COMPLETE=0]="COMPLETE",r[r.FAILED=1]="FAILED",r[r.REDIRECTING=2]="REDIRECTING",r}(Za||{});function TA(r,t){r.events.pipe(Qs(e=>e instanceof vs||e instanceof Tr||e instanceof nc||e instanceof Es),Ve(e=>e instanceof vs||e instanceof Es?Za.COMPLETE:(e instanceof Tr?e.code===Zn.Redirect||e.code===Zn.SupersededByNewNavigation:!1)?Za.REDIRECTING:Za.FAILED),Qs(e=>e!==Za.REDIRECTING),eo(1)).subscribe(()=>{t()})}function FA(r){throw r}var PA={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},RA={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Gi=(()=>{let t=class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=ie(xl),this.stateManager=ie(Ym),this.options=ie(cd,{optional:!0})||{},this.pendingTasks=ie(Jp),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=ie(wA),this.urlSerializer=ie(ed),this.location=ie(Dr),this.urlHandlingStrategy=ie(hd),this._events=new ds,this.errorHandler=this.options.errorHandler||FA,this.navigated=!1,this.routeReuseStrategy=ie(MA),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=ie(ld,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!ie(sd,{optional:!0}),this.eventsSubscription=new Dp,this.isNgZoneEnabled=ie(Ai)instanceof Ai&&Ai.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let n=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof Tr&&i.code!==Zn.Redirect&&i.code!==Zn.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof vs)this.navigated=!0;else if(i instanceof rc){let a=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),c={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||SA(s.source)};this.scheduleNavigation(a,Ka,null,c,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}OA(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ka,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(n,"popstate",i)},0)})}navigateToSyncWithBrowser(n,i,s){let o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let l=Ot({},s);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(o.state=l)}let c=this.parseUrl(n);this.scheduleNavigation(c,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(od),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,i={}){let{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:c,preserveFragment:l}=i,h=l?this.currentUrlTree.fragment:a,u=null;switch(c){case"merge":u=Ot(Ot({},this.currentUrlTree.queryParams),o);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=o||null}u!==null&&(u=this.removeEmptyProps(u));let d;try{let x=s?s.snapshot:this.routerState.snapshot.root;d=Tm(x)}catch{(typeof n[0]!="string"||!n[0].startsWith("/"))&&(n=[]),d=this.currentUrlTree.root}return Fm(d,n,u,h??null)}navigateByUrl(n,i={skipLocationChange:!1}){let s=lo(n)?n:this.parseUrl(n),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,Ka,null,i)}navigate(n,i={skipLocationChange:!1}){return kA(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.urlSerializer.parse("/")}}isActive(n,i){let s;if(i===!0?s=Ot({},PA):i===!1?s=Ot({},RA):s=i,lo(n))return pm(this.currentUrlTree,n,s);let o=this.parseUrl(n);return pm(this.currentUrlTree,o,s)}removeEmptyProps(n){return Object.entries(n).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(n,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let c,l,h;a?(c=a.resolve,l=a.reject,h=a.promise):h=new Promise((d,x)=>{c=d,l=x});let u=this.pendingTasks.add();return TA(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:o,resolve:c,reject:l,promise:h,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),h.catch(d=>Promise.reject(d))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();function kA(r){for(let t=0;t<r.length;t++)if(r[t]==null)throw new nn(4008,!1)}function OA(r){return!(r instanceof ic)&&!(r instanceof rc)}var IA=new si("");function qm(r,...t){return Va([{provide:ld,multi:!0,useValue:r},[],{provide:Gn,useFactory:LA,deps:[Gi]},{provide:tm,multi:!0,useFactory:NA},t.map(e=>e.\u0275providers)])}function LA(r){return r.routerState.root}function NA(){let r=ie(Hp);return t=>{let e=r.get(du);if(t!==e.components[0])return;let n=r.get(Gi),i=r.get(UA);r.get(zA)===1&&n.initialNavigation(),r.get(VA,null,ou.Optional)?.setUpPreloading(),r.get(IA,null,ou.Optional)?.init(),n.resetRootComponentType(e.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var UA=new si("",{factory:()=>new ds}),zA=new si("",{providedIn:"root",factory:()=>1});var VA=new si("");function HA(r,t){if(r&1&&(rt(0,"span",6),fe(1),ot()),r&2){let e=gt(2);Wt("color",e.extraLabelColor),j(),ln(e.extraLabel)}}function GA(r,t){if(r&1&&(rt(0,"div",4),fe(1),Gt(2,HA,2,3,"span",5),ot()),r&2){let e=gt();j(),vn(" ",e.label," "),j(),at("ngIf",e.extraLabel!=="")}}var $m=(()=>{let t=class t{constructor(){this.label="",this.extraLabel="",this.extraLabelColor="",this.placeholder="",this.maxWidth=300}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-simple-input"]],inputs:{label:"label",extraLabel:"extraLabel",extraLabelColor:"extraLabelColor",placeholder:"placeholder",maxWidth:"maxWidth"},standalone:!0,features:[Vt],decls:4,vars:2,consts:[["id","simple-input-component-container"],["id","label-container",4,"ngIf"],["id","input-container"],["id","input","autocomplete","",3,"placeholder"],["id","label-container"],["id","extra-label-container",3,"color",4,"ngIf"],["id","extra-label-container"]],template:function(i,s){i&1&&(rt(0,"div",0),Gt(1,GA,3,2,"div",1),rt(2,"div",2),Dt(3,"input",3),ot()()),i&2&&(j(),at("ngIf",s.label!==""),j(2),at("placeholder",s.placeholder))},dependencies:[We],styles:["#simple-input-component-container[_ngcontent-%COMP%]{margin-top:6px;margin-bottom:6px;height:77px;width:350px}#extra-label-container[_ngcontent-%COMP%]{font-size:14px}#label-container[_ngcontent-%COMP%]{font-size:14px;margin-bottom:6px;width:100%}#input-container[_ngcontent-%COMP%]{height:48px;width:100%;margin-top:6px}#input[_ngcontent-%COMP%]{font-family:Pretendard;font-size:16px;width:100%;height:48px;border:solid;border-width:1.5px;border-color:#d8d8da;border-radius:5px;border-spacing:0px;margin:0;padding:0 10px;box-sizing:border-box}#input[_ngcontent-%COMP%]:focus{border-color:#2c2c2c}#input[_ngcontent-%COMP%]::placeholder{color:#5c5c5c}"]});let r=t;return r})();function WA(r,t){r&1&&Dt(0,"img",3)}var Zm=(()=>{let t=class t{constructor(){this.imgSize=96,this.imgSrc="assets/heart.png",this.isEditable=!0}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-profile-img"]],inputs:{imgSize:"imgSize",imgSrc:"imgSrc",isEditable:"isEditable"},standalone:!0,features:[Vt],decls:3,vars:2,consts:[["id","profile-img-container"],["id","profile-img",3,"src"],["id","edit-icon","width","32","height","32","src","assets/edit_icon.png",4,"ngIf"],["id","edit-icon","width","32","height","32","src","assets/edit_icon.png"]],template:function(i,s){i&1&&(rt(0,"div",0),Dt(1,"img",1),Gt(2,WA,1,0,"img",2),ot()),i&2&&(j(),at("src",s.imgSrc,xn),j(),at("ngIf",s.isEditable))},dependencies:[We],styles:["#profile-img-container[_ngcontent-%COMP%]{width:96px;height:96px;border-radius:50%;display:flex;justify-content:center;align-items:center;margin-top:8px;margin-bottom:8px;position:relative}#profile-img[_ngcontent-%COMP%]{width:96px;height:96px;border-radius:50%}#edit-icon[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0}#edit-icon[_ngcontent-%COMP%]:hover{cursor:pointer}"]});let r=t;return r})();function jA(r,t){if(r&1&&(rt(0,"span",7),fe(1),ot()),r&2){let e=gt(2);Wt("color",e.extraLabelColor),j(),ln(e.extraLabel)}}function XA(r,t){if(r&1&&(rt(0,"div",5),fe(1),Gt(2,jA,2,3,"span",6),ot()),r&2){let e=gt();j(),vn(" ",e.label," "),j(),at("ngIf",e.extraLabel!=="")}}function YA(r,t){if(r&1&&Dt(0,"img",12),r&2){let e=gt().$implicit;at("src",e.imgSrc,xn)}}function qA(r,t){if(r&1){let e=Me();fn(0),rt(1,"div",9,0),Lt("click",function(){let i=Yt(e).$implicit,s=gt(2);return qt(s.onClickToggleButton(i.value))}),Gt(3,YA,1,1,"img",10),rt(4,"span",11),fe(5),ot()(),pn()}if(r&2){let e=t.$implicit,n=t.index,i=gt().$implicit,s=gt();j(),Wt("justify-content",s.align)("width",s.buttonWidth,"px")("height",s.buttonHeight,"px")("margin-right",n!==i.length-1?10:0,"px")("background-color",e.selected&&e.solid?"black":e.backgroundColor)("color",e.selected&&e.fontColor?e.fontColor:"black"),at("ngClass",s.getClass(e)),j(2),at("ngIf",e.imgSrc!==void 0),j(),Wt("font-size",s.fontSize,"px"),j(),ln(e.label)}}function $A(r,t){if(r&1&&(fn(0),rt(1,"div",8),Gt(2,qA,6,17,"ng-container",4),ot(),pn()),r&2){let e=t.$implicit,n=gt();j(),Wt("margin-bottom",n.modifiedButtonElements.length>1?16:0,"px")("width",e.length*n.buttonWidth+(e.length-1)*10,"px"),j(),at("ngForOf",e)}}var xo=(()=>{let t=class t{constructor(){this.label="",this.extraLabel="",this.extraLabelColor="",this.componentWidth=350,this.buttonElements=[],this.buttonWidth=350,this.buttonHeight=48,this.fontSize=16,this.columnNum=3,this.multiSelection=!1,this.align="center",this.onClickToggleButtonEvent=new Ce,this.modifiedButtonElements=[]}ngOnInit(){this._setButtonLayout()}_setButtonLayout(){if(this.columnNum!==-1){let n=[];for(let i=0;i<this.buttonElements.length;i+=this.columnNum)n.push(this.buttonElements.slice(i,i+this.columnNum));this.modifiedButtonElements=n}else this.modifiedButtonElements=[this.buttonElements]}getClass(n){return n.solid?n.selected?"selected-button-solid":"unselected-button-solid":n.selected?"selected-button":"unselected-button"}onClickToggleButton(n){this.multiSelection?this.buttonElements.find(i=>i.value===n).selected=!this.buttonElements.find(i=>i.value===n).selected:(this.buttonElements.forEach(i=>i.selected=!1),this.buttonElements.find(i=>i.value===n).selected=!0),this.onClickToggleButtonEvent.emit(n)}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-simple-toggle"]],inputs:{label:"label",extraLabel:"extraLabel",extraLabelColor:"extraLabelColor",componentWidth:"componentWidth",buttonElements:"buttonElements",buttonWidth:"buttonWidth",buttonHeight:"buttonHeight",fontSize:"fontSize",columnNum:"columnNum",multiSelection:"multiSelection",align:"align"},outputs:{onClickToggleButtonEvent:"onClickToggleButtonEvent"},standalone:!0,features:[Vt],decls:4,vars:2,consts:[["toggleButton",""],[1,"container"],["id","label-container",4,"ngIf"],["id","row-container"],[4,"ngFor","ngForOf"],["id","label-container"],["id","extra-label-container",3,"color",4,"ngIf"],["id","extra-label-container"],[1,"toggle-group-row-container"],[3,"click","ngClass"],["class","img","height","24px",3,"src",4,"ngIf"],[1,"label"],["height","24px",1,"img",3,"src"]],template:function(i,s){i&1&&(rt(0,"div",1),Gt(1,XA,3,2,"div",2),rt(2,"div",3),Gt(3,$A,3,5,"ng-container",4),ot()()),i&2&&(j(),at("ngIf",s.label!==""),j(2),at("ngForOf",s.modifiedButtonElements))},dependencies:[Wa,io,rn,We],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:350px;margin-top:6px;margin-bottom:6px}.container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}#extra-label-container[_ngcontent-%COMP%]{font-size:14px}#label-container[_ngcontent-%COMP%]{font-size:14px;margin-bottom:6px;width:100%}#row-container[_ngcontent-%COMP%]{width:350px;overflow:scroll}#row-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.toggle-group-row-container[_ngcontent-%COMP%]{display:flex;margin-bottom:16px}.label[_ngcontent-%COMP%]{font-size:16px;font-family:Pretendard}.img[_ngcontent-%COMP%]{margin-right:8px}.unselected-button[_ngcontent-%COMP%]{width:110px;height:48px;border-width:1.5px;border-radius:5px;border-color:#d8d8da;border-style:solid;box-sizing:border-box;display:flex;justify-content:center;align-items:center;padding:0 10px;margin-right:10px;font-family:Pretendard;font-size:16px;font-weight:500}.selected-button[_ngcontent-%COMP%]{width:110px;height:48px;border-width:1.5px;border-radius:5px;border-color:#2c2c2c;border-style:solid;box-sizing:border-box;display:flex;justify-content:center;align-items:center;padding:0 10px;margin-right:10px;font-family:Pretendard;font-size:16px;font-weight:500}.unselected-button-solid[_ngcontent-%COMP%]{width:110px;height:48px;background-color:#f8f8f8;display:flex;justify-content:center;align-items:center;padding:0 10px;margin-right:10px;border-radius:4px;font-family:Pretendard;font-size:16px;font-weight:500}.selected-button-solid[_ngcontent-%COMP%]{width:110px;height:48px;display:flex;background-color:#000;color:#fff;justify-content:center;align-items:center;padding:0 10px;margin-right:10px;border-radius:4px;font-family:Pretendard;font-size:16px;font-weight:500}"]});let r=t;return r})();function ZA(r,t){if(r&1&&Dt(0,"img",3),r&2){let e=gt();at("src",e.buttonElement.imgSrc,xn)("height",e.heightSize)}}function JA(r,t){if(r&1&&(rt(0,"div",4),fe(1),ot()),r&2){let e=gt();Wt("font-size",e.heightSize,"px")("color",e.highContrast?"#f0f0f0":"black"),j(),vn(" ",e.buttonElement.label," ")}}var Rl=(()=>{let t=class t{constructor(){this.heightSize=20,this.buttonElement=null,this.type="img",this.highContrast=!1,this.onClickEvent=new Ce}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-simple-button"]],inputs:{heightSize:"heightSize",buttonElement:"buttonElement",type:"type",highContrast:"highContrast"},outputs:{onClickEvent:"onClickEvent"},standalone:!0,features:[Vt],decls:3,vars:2,consts:[["id","simple-button",3,"click"],[3,"src","height",4,"ngIf"],["id","text-div",3,"font-size","color",4,"ngIf"],[3,"src","height"],["id","text-div"]],template:function(i,s){i&1&&(rt(0,"div",0),Lt("click",function(){return s.onClickEvent.emit()}),Gt(1,ZA,1,2,"img",1)(2,JA,2,5,"div",2),ot()),i&2&&(j(),at("ngIf",s.type==="img"),j(),at("ngIf",s.type==="text"))},dependencies:[We],styles:["#simple-button[_ngcontent-%COMP%]{margin:10px;display:flex;justify-content:center;align-items:center;border-radius:5px}#simple-button[_ngcontent-%COMP%]:hover{cursor:pointer}#text-div[_ngcontent-%COMP%]{text-align:center}"]});let r=t;return r})();function KA(r,t){if(r&1){let e=Me();fn(0),rt(1,"div",2),Lt("click",function(){let i=Yt(e).$implicit,s=gt();return qt(s.onClickButton(i.value))}),fe(2),ot(),pn()}if(r&2){let e=t.$implicit,n=gt();j(),Wt("width",350-10*n.buttonElements.length/n.buttonElements.length,"px"),at("ngClass",n.getClass(e.value)),j(),ln(e.label)}}var kl=(()=>{let t=class t{constructor(){this.buttonElements=[{selected:!0,value:0,label:"\uB2E4\uC74C"}],this.onClickEvent=new Ce}onClickButton(n){this.onClickEvent.emit(n)}getClass(n){return this.buttonElements.find(i=>i.value===n).selected?"ready-button":"wait-button"}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-square-button"]],inputs:{buttonElements:"buttonElements"},outputs:{onClickEvent:"onClickEvent"},standalone:!0,features:[Vt],decls:2,vars:1,consts:[["id","container"],[4,"ngFor","ngForOf"],[3,"click","ngClass"]],template:function(i,s){i&1&&(rt(0,"div",0),Gt(1,KA,3,4,"ng-container",1),ot()),i&2&&(j(),at("ngForOf",s.buttonElements))},dependencies:[rn,io],styles:["#container[_ngcontent-%COMP%]{width:350px;height:48px;display:flex;justify-content:center;align-items:center}.ready-button[_ngcontent-%COMP%]{width:350px;height:48px;border-radius:4px;background-color:#006bff;font-size:16px;font-weight:500;font-family:Pretendard;color:#fff;display:flex;justify-content:center;align-items:center}.wait-button[_ngcontent-%COMP%]{width:350px;height:48px;border-radius:4px;background-color:#bcbcbc;font-size:16px;font-weight:500;font-family:Pretendard;color:#fff;display:flex;justify-content:center;align-items:center}"]});let r=t;return r})();var QA=["progressBar"],t9=["nextButton"];function e9(r,t){if(r&1&&(rt(0,"div",2),Dt(1,"app-profile-img",8)(2,"app-simple-input",9)(3,"app-simple-toggle",10)(4,"app-simple-input",11),ot()),r&2){let e=gt();j(),at("imgSrc","assets/default_profile.png"),j(),at("label","\uB2C9\uB124\uC784")("extraLabel","(\uD544\uC218)")("extraLabelColor","#0090f2")("placeholder","\uB2C9\uB124\uC784\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694"),j(),at("label","\uC131\uBCC4")("extraLabel","(\uD544\uC218)")("extraLabelColor","#0090f2")("buttonElements",e.genderSelectionButtons)("buttonWidth",110),j(),at("label","\uC18C\uAC1C")("placeholder","\uAC04\uB2E8\uD55C \uC18C\uAC1C\uB97C \uD574\uC8FC\uC138\uC694")}}function n9(r,t){if(r&1&&(rt(0,"div",2),Dt(1,"app-simple-toggle",12),ot()),r&2){let e=gt();j(),at("buttonElements",e.locationSelectionButtons)("columnNum",1)("buttonWidth",350)("align","left")("multiSelection",!0)}}function i9(r,t){if(r&1&&(rt(0,"div",2),Dt(1,"app-simple-toggle",12),ot()),r&2){let e=gt();j(),at("buttonElements",e.interestSelectionButtons)("columnNum",1)("buttonWidth",350)("align","left")("multiSelection",!0)}}var Km=(()=>{let t=class t{constructor(n){this._router=n,this.progressBar=null,this.nextButton=null,this.onBoardingStep=[{label:"\uD504\uB85C\uD544\uC744 \uC791\uC131\uD574\uC8FC\uC138\uC694",value:0},{label:"\uBAA8\uC784\uC744 \uD560 \uC7A5\uC18C\uB97C \uC120\uD0DD\uD574\uC8FC\uC138\uC694",value:1},{label:"\uAD00\uC2EC \uC788\uB294 \uCE74\uD14C\uACE0\uB9AC\uB97C \uC120\uD0DD\uD574\uC8FC\uC138\uC694",value:2}],this.nowOnboardingStep=this.onBoardingStep[0],this.genderSelectionButtons=[{selected:!0,value:0,label:"\uB0A8\uC790"},{selected:!1,value:1,label:"\uC5EC\uC790"},{selected:!1,value:2,label:"\uAE30\uD0C0"}],this.locationSelectionButtons=[{selected:!0,value:0,label:"\uC11C\uC6B8\uD2B9\uBCC4\uC2DC"},{selected:!1,value:1,label:"\uACBD\uAE30\uB3C4"},{selected:!1,value:2,label:"\uAC15\uC6D0\uB3C4"},{selected:!1,value:3,label:"\uCDA9\uCCAD\uBD81\uB3C4"},{selected:!1,value:4,label:"\uCDA9\uCCAD\uB0A8\uB3C4"},{selected:!1,value:5,label:"\uC804\uB77C\uB0A8\uB3C4"},{selected:!1,value:6,label:"\uC804\uB77C\uBD81\uB3C4"},{selected:!1,value:7,label:"\uACBD\uC0C1\uBD81\uB3C4"},{selected:!1,value:8,label:"\uACBD\uC0C1\uB0A8\uB3C4"},{selected:!1,value:9,label:"\uC778\uCC9C\uAD11\uC5ED\uC2DC"}],this.interestSelectionButtons=[{selected:!0,value:0,label:"\uC6B4\uB3D9",imgSrc:"assets/interest-icons/excersize.png"},{selected:!1,value:1,label:"\uAC8C\uC784",imgSrc:"assets/interest-icons/game.png"},{selected:!1,value:2,label:"\uC74C\uC545",imgSrc:"assets/interest-icons/music.png"},{selected:!1,value:3,label:"\uC74C\uC2DD",imgSrc:"assets/interest-icons/food.png"},{selected:!1,value:4,label:"\uB3C5\uC11C",imgSrc:"assets/interest-icons/book.png"}]}onClickNextButton(n){let i=this.nowOnboardingStep.value+1;i>=this.onBoardingStep.length?this._router.navigate(["/main"]):this.nowOnboardingStep=this.onBoardingStep[i]}};t.\u0275fac=function(i){return new(i||t)(ge(Gi))},t.\u0275cmp=zt({type:t,selectors:[["app-onboarding"]],viewQuery:function(i,s){if(i&1&&(De(QA,7),De(t9,7)),i&2){let o;be(o=we())&&(s.progressBar=o.first),be(o=we())&&(s.nextButton=o.first)}},standalone:!0,features:[Vt],decls:12,vars:6,consts:[["progressBar",""],["nextButton",""],[1,"container"],["id","progress-bar",3,"value","max"],["id","onboarding-label"],["class","container",4,"ngIf"],["id","next-button-container"],[3,"onClickEvent"],["id","profile-img",3,"imgSrc"],[3,"label","extraLabel","extraLabelColor","placeholder"],[3,"label","extraLabel","extraLabelColor","buttonElements","buttonWidth"],[3,"label","placeholder"],[3,"buttonElements","columnNum","buttonWidth","align","multiSelection"]],template:function(i,s){if(i&1){let o=Me();rt(0,"div",2),Dt(1,"progress",3,0),rt(3,"div",4)(4,"span"),fe(5),ot()(),Gt(6,e9,5,12,"div",5)(7,n9,2,5,"div",5)(8,i9,2,5,"div",5),rt(9,"div",6)(10,"app-square-button",7,1),Lt("onClickEvent",function(c){return Yt(o),qt(s.onClickNextButton(c))}),ot()()()}i&2&&(j(),at("value",s.nowOnboardingStep.value+1)("max",s.onBoardingStep.length),j(4),ln(s.nowOnboardingStep.label),j(),at("ngIf",s.nowOnboardingStep.value===0),j(),at("ngIf",s.nowOnboardingStep.value===1),j(),at("ngIf",s.nowOnboardingStep.value===2))},dependencies:[We,$m,Zm,xo,kl],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;overflow-y:scroll;height:100%;width:100%;position:relative}#progress-bar[_ngcontent-%COMP%]{width:350px;height:10px;margin-top:28px;margin-bottom:28px;appearance:none}#progress-bar[_ngcontent-%COMP%]::-webkit-progress-bar{background-color:#efefef;border-radius:12px;overflow:hidden}#progress-bar[_ngcontent-%COMP%]::-webkit-progress-value{background-color:#006bff}#onboarding-label[_ngcontent-%COMP%]{width:350px;font-size:24px;font-weight:600;margin-bottom:16px;display:flex;align-items:left}#profile-img[_ngcontent-%COMP%]{margin-bottom:24px}#next-button-container[_ngcontent-%COMP%]{margin-bottom:20px}"]});let r=t;return r})();function r9(r,t){if(r&1&&(rt(0,"span",4),fe(1),ot()),r&2){let e=gt(2);Wt("color",e.extraLabelColor),j(),ln(e.extraLabel)}}function s9(r,t){if(r&1&&(rt(0,"div",2),fe(1),Gt(2,r9,2,3,"span",3),ot()),r&2){let e=gt();j(),vn(" ",e.label," "),j(),at("ngIf",e.extraLabel!=="")}}function o9(r,t){if(r&1){let e=Me();fn(0),rt(1,"div",7),Lt("click",function(){let i=Yt(e).$implicit,s=gt(2);return qt(s.onClickImage(i.moimId))}),fs(),rt(2,"svg",8),Dt(3,"path",9),ot(),ps(),Dt(4,"img",10),ot(),pn()}if(r&2){let e=t.$implicit;j(2),Wt("fill",e.backgroundColor),j(2),at("src",e.thumbnailUrl,xn)}}function a9(r,t){if(r&1&&(rt(0,"div",5),Gt(1,o9,5,3,"ng-container",6),ot()),r&2){let e=gt();j(),at("ngForOf",e.tickets)}}function c9(r,t){if(r&1){let e=Me();fn(0),rt(1,"img",11),Lt("click",function(){let i=Yt(e).$implicit,s=gt(2);return qt(s.onClickImage(i.value))}),ot(),pn()}if(r&2){let e=t.$implicit,n=gt(2);j(),at("src",e.imgSrc,xn)("height",n.imageHeight)}}function l9(r,t){if(r&1&&(rt(0,"div",5),Gt(1,c9,2,2,"ng-container",6),ot()),r&2){let e=gt();j(),at("ngForOf",e.images)}}var Ol=(()=>{let t=class t{constructor(){this.label="",this.extraLabel="",this.extraLabelColor="",this.moreButton=!1,this.imageHeight=200,this.isTicketContainer=!0,this.images=[{imgSrc:"assets/heart.png",value:0,label:"heart",selected:!1}],this.tickets=[{thumbnailUrl:"assets/heart.png",backgroundColor:"red",fabric:{},moimId:0},{thumbnailUrl:"assets/heart.png",backgroundColor:"black",fabric:{},moimId:1},{thumbnailUrl:"assets/heart.png",backgroundColor:"gray",fabric:{},moimId:2},{thumbnailUrl:"assets/heart.png",backgroundColor:"green",fabric:{},moimId:3},{thumbnailUrl:"assets/heart.png",backgroundColor:"yellow",fabric:{},moimId:4},{thumbnailUrl:"assets/heart.png",backgroundColor:"purple",fabric:{},moimId:5}],this.onClickImageEvent=new Ce}onClickImage(n){this.onClickImageEvent.emit(n)}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-image-row-container"]],inputs:{label:"label",extraLabel:"extraLabel",extraLabelColor:"extraLabelColor",moreButton:"moreButton",imageHeight:"imageHeight",isTicketContainer:"isTicketContainer",images:"images",tickets:"tickets"},outputs:{onClickImageEvent:"onClickImageEvent"},standalone:!0,features:[Vt],decls:5,vars:3,consts:[["id","label-container",4,"ngIf"],["class","image-row-container",4,"ngIf"],["id","label-container"],["id","extra-label-container",3,"color",4,"ngIf"],["id","extra-label-container"],[1,"image-row-container"],[4,"ngFor","ngForOf"],[1,"image-container",3,"click"],["width","117","height","200","viewBox","0 0 117 200","fill","none","xmlns","http://www.w3.org/2000/svg"],["fill-rule","evenodd","clip-rule","evenodd","d","M0 10C0 7.4375 0.96875 5.09375 2.55469 3.32031C4.38281 1.28125 7.03906 0 10 0H106.664C112.188 0 116.664 4.47656 116.664 10V140.008C111.297 140.188 107 144.586 107 150C107 155.414 111.297 159.812 116.664 159.992V190C116.664 195.523 112.188 200 106.664 200H10C4.47656 200 0 195.523 0 190V160C5.52344 160 10 155.523 10 150C10 144.477 5.52344 140 0 140V10Z","fill","${backgroundColor}"],["height","200",1,"deco-container",3,"src"],[1,"image-container",3,"click","src","height"]],template:function(i,s){i&1&&(rt(0,"div"),Gt(1,s9,3,2,"div",0),rt(2,"div"),Gt(3,a9,2,1,"div",1)(4,l9,2,1,"div",1),ot()()),i&2&&(j(),at("ngIf",s.label!==""),j(2),at("ngIf",s.isTicketContainer),j(),at("ngIf",!s.isTicketContainer))},dependencies:[We,rn],styles:[".image-row-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:350px;justify-content:space-between;margin-bottom:16px;overflow:scroll}.image-row-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.image-container[_ngcontent-%COMP%]{margin-right:10px;position:relative}.deco-container[_ngcontent-%COMP%]{position:absolute;left:0;top:0}#extra-label-container[_ngcontent-%COMP%]{font-size:14px}#label-container[_ngcontent-%COMP%]{font-size:14px;margin-bottom:6px;width:100%}"]});let r=t;return r})();var Qm=(()=>{let t=class t{constructor(){}getThumbnail(n,i,s){return`<svg width="117" height="200" viewBox="0 0 117 200" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd"
        d="M0 10C0 7.4375 0.96875 5.09375 2.55469 3.32031C4.38281 1.28125 7.03906 0 10 0H106.664C112.188 0 116.664 4.47656 116.664 10V140.008C111.297 140.188 107 144.586 107 150C107 155.414 111.297 159.812 116.664 159.992V190C116.664 195.523 112.188 200 106.664 200H10C4.47656 200 0 195.523 0 190V160C5.52344 160 10 155.523 10 150C10 144.477 5.52344 140 0 140V10Z"
        fill="${n}" />
        <img src="${s}" />
</svg>`}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();var u9=["ticketContainer"];function d9(r,t){if(r&1){let e=Me();fn(0),rt(1,"app-image-row-container",16),Lt("onClickImageEvent",function(i){Yt(e);let s=gt();return qt(s.onClickTicket(i))}),ot(),pn()}if(r&2){let e=t.$implicit;j(),at("label",e.label)}}var tg=(()=>{let t=class t{constructor(n,i){this._router=n,this.thumbnailMakerService=i,this.ticketContainer=null,this.categorySelectionButtons=[{selected:!0,value:0,label:"\uC804\uCCB4",solid:!0,fontColor:"#ffffff"},{selected:!1,value:1,label:"\uC6B4\uB3D9",solid:!0,fontColor:"#ffffff"},{selected:!1,value:2,label:"\uAC8C\uC784",solid:!0,fontColor:"#ffffff"},{selected:!1,value:3,label:"\uC74C\uC545",solid:!0,fontColor:"#ffffff"},{selected:!1,value:4,label:"\uC74C\uC2DD",solid:!0,fontColor:"#ffffff"},{selected:!1,value:5,label:"\uB3C5\uC11C",solid:!0,fontColor:"#ffffff"},{selected:!1,value:6,label:"\uC601\uD654",solid:!0,fontColor:"#ffffff"}],this.navigatorSelectionButtons=[{selected:!0,value:0,label:"\uBA54\uC778"},{selected:!1,value:1,label:"\uAC80\uC0C9"},{selected:!1,value:2,label:"\uAC1C\uCD5C"},{selected:!1,value:3,label:"\uC99D\uD45C"},{selected:!1,value:4,label:"\uD504\uB85C\uD544"}]}ngOnInit(){}onClickCategoryButton(n){this.ticketContainer.nativeElement.scrollTop=n*223}onClickNavigatorButton(n){}getNavigatorButtonClass(n){return n?"navigator-button-selected":"navigator-button"}onClickTicket(n){this._router.navigate(["/web/meeting-info"],{queryParams:{moimId:n}})}};t.\u0275fac=function(i){return new(i||t)(ge(Gi),ge(Qm))},t.\u0275cmp=zt({type:t,selectors:[["app-main"]],viewQuery:function(i,s){if(i&1&&De(u9,5),i&2){let o;be(o=we())&&(s.ticketContainer=o.first)}},standalone:!0,features:[Vt],decls:20,vars:7,consts:[["ticketContainer",""],[1,"container"],["id","logo-container"],["src","assets/ssalon_logo_hand.svg","height","30px"],["id","category-container"],[3,"onClickToggleButtonEvent","buttonElements","columnNum","buttonWidth","buttonHeight","componentWidth","fontSize"],["id","ticket-container"],[4,"ngFor","ngForOf"],["id","navigator-container"],["id","navigator-button-container"],[3,"click"],["data",no`assets/navigator_icons/main.svg`,1,"navigator-button-selected"],["data",no`assets/navigator_icons/search.svg`,"height","24px"],["data",no`assets/navigator_icons/make.svg`,"height","24px"],["data",no`assets/navigator_icons/ticket.svg`,"height","24px"],["data",no`assets/navigator_icons/profile.svg`,"height","24px"],[3,"onClickImageEvent","label"]],template:function(i,s){if(i&1){let o=Me();rt(0,"div",1)(1,"div",2),Dt(2,"img",3),ot(),rt(3,"div",4)(4,"app-simple-toggle",5),Lt("onClickToggleButtonEvent",function(c){return Yt(o),qt(s.onClickCategoryButton(c))}),ot()(),rt(5,"div",6,0),Gt(7,d9,2,1,"ng-container",7),ot(),rt(8,"div",8)(9,"div",9)(10,"div",10),Lt("click",function(){return Yt(o),qt(s.onClickNavigatorButton(0))}),Dt(11,"object",11),ot(),rt(12,"div",10),Lt("click",function(){return Yt(o),qt(s.onClickNavigatorButton(1))}),Dt(13,"object",12),ot(),rt(14,"div",10),Lt("click",function(){return Yt(o),qt(s.onClickNavigatorButton(2))}),Dt(15,"object",13),ot(),rt(16,"div",10),Lt("click",function(){return Yt(o),qt(s.onClickNavigatorButton(3))}),Dt(17,"object",14),ot(),rt(18,"div",10),Lt("click",function(){return Yt(o),qt(s.onClickNavigatorButton(4))}),Dt(19,"object",15),ot()()()()}i&2&&(j(4),at("buttonElements",s.categorySelectionButtons)("columnNum",-1)("buttonWidth",50)("buttonHeight",30)("componentWidth",430)("fontSize",14),j(3),at("ngForOf",s.categorySelectionButtons))},dependencies:[rn,xo,Ol],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;overflow-y:scroll;height:100%;width:100%;position:relative}#logo-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:left;margin-top:14px;width:350px}#category-container[_ngcontent-%COMP%]{display:flex;align-items:center;width:350px;height:50px;margin-top:20px;overflow-x:scroll}#ticket-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:column;overflow-y:scroll;width:100%;position:relative;height:calc(100% - 50px);background-color:#fff;margin-top:20px}#ticket-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}#navigator-button-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;position:absolute;bottom:0;left:50%;transform:translate(-50%);height:50px;width:350px;background-color:#fff}.navigator-button[_ngcontent-%COMP%]{height:20px}.navigator-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#bcbcbc}.navigator-button-selected[_ngcontent-%COMP%]{height:20px;fill:#000;stroke:#0000}.navigator-button-selected[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#2c2c2c}"]});let r=t;return r})();var Tx="164";var x9=0,eg=1,f9=2;var Lv=1,p9=2,ur=3,Yi=0,jn=1,xr=2,zr=0,ko=1,ng=2,ig=3,rg=4,m9=5,Ds=100,g9=101,v9=102,E9=103,_9=104,C9=200,y9=201,A9=202,b9=203,jd=204,Xd=205,w9=206,S9=207,M9=208,D9=209,B9=210,T9=211,F9=212,P9=213,R9=214,k9=0,O9=1,I9=2,lh=3,L9=4,N9=5,U9=6,z9=7,Fx=0,V9=1,H9=2,Vr=0,G9=1,W9=2,j9=3,X9=4,Y9=5,q9=6,$9=7;var sg=300,No=301,Uo=302,Yd=303,qd=304,Lh=306,Cc=1e3,Ts=1001,$d=1002,hi=1003,Z9=1004;var Il=1005;var Mi=1006,ud=1007;var Fs=1008;var Hr=1009,J9=1010,K9=1011,Nv=1012,Uv=1013,zo=1014,Ur=1015,Nh=1016,zv=1017,Vv=1018,Bc=1020,Q9=35902,tb=1021,eb=1022,ji=1023,nb=1024,ib=1025,Oo=1026,yc=1027,rb=1028,Hv=1029,sb=1030,Gv=1031,Wv=1033,dd=33776,xd=33777,fd=33778,pd=33779,og=35840,ag=35841,cg=35842,lg=35843,hg=36196,ug=37492,dg=37496,xg=37808,fg=37809,pg=37810,mg=37811,gg=37812,vg=37813,Eg=37814,_g=37815,Cg=37816,yg=37817,Ag=37818,bg=37819,wg=37820,Sg=37821,md=36492,Mg=36494,Dg=36495,ob=36283,Bg=36284,Tg=36285,Fg=36286;var hh=2300,uh=2301,gd=2302,Pg=2400,Rg=2401,kg=2402;var ab=3200,cb=3201,jv=0,lb=1,Nr="",li="srgb",Wr="srgb-linear",Px="display-p3",Uh="display-p3-linear",dh="linear",He="srgb",xh="rec709",fh="p3";var fo=7680;var Og=519,hb=512,ub=513,db=514,Xv=515,xb=516,fb=517,pb=518,mb=519,Ig=35044;var Lg="300 es",fr=2e3,ph=2001,qi=class{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});let n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;let n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;let i=this._listeners[t];if(i!==void 0){let s=i.indexOf(e);s!==-1&&i.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;let n=this._listeners[t.type];if(n!==void 0){t.target=this;let i=n.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,t);t.target=null}}},Dn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Ng=1234567,vc=Math.PI/180,Ac=180/Math.PI;function qo(){let r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Dn[r&255]+Dn[r>>8&255]+Dn[r>>16&255]+Dn[r>>24&255]+"-"+Dn[t&255]+Dn[t>>8&255]+"-"+Dn[t>>16&15|64]+Dn[t>>24&255]+"-"+Dn[e&63|128]+Dn[e>>8&255]+"-"+Dn[e>>16&255]+Dn[e>>24&255]+Dn[n&255]+Dn[n>>8&255]+Dn[n>>16&255]+Dn[n>>24&255]).toLowerCase()}function _n(r,t,e){return Math.max(t,Math.min(e,r))}function Rx(r,t){return(r%t+t)%t}function gb(r,t,e,n,i){return n+(r-t)*(i-n)/(e-t)}function vb(r,t,e){return r!==t?(e-r)/(t-r):0}function Ec(r,t,e){return(1-e)*r+e*t}function Eb(r,t,e,n){return Ec(r,t,1-Math.exp(-e*n))}function _b(r,t=1){return t-Math.abs(Rx(r,t*2)-t)}function Cb(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*(3-2*r))}function yb(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*r*(r*(r*6-15)+10))}function Ab(r,t){return r+Math.floor(Math.random()*(t-r+1))}function bb(r,t){return r+Math.random()*(t-r)}function wb(r){return r*(.5-Math.random())}function Sb(r){r!==void 0&&(Ng=r);let t=Ng+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function Mb(r){return r*vc}function Db(r){return r*Ac}function Bb(r){return(r&r-1)===0&&r!==0}function Tb(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Fb(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function Pb(r,t,e,n,i){let s=Math.cos,o=Math.sin,a=s(e/2),c=o(e/2),l=s((t+n)/2),h=o((t+n)/2),u=s((t-n)/2),d=o((t-n)/2),x=s((n-t)/2),m=o((n-t)/2);switch(i){case"XYX":r.set(a*h,c*u,c*d,a*l);break;case"YZY":r.set(c*d,a*h,c*u,a*l);break;case"ZXZ":r.set(c*u,c*d,a*h,a*l);break;case"XZX":r.set(a*h,c*m,c*x,a*l);break;case"YXY":r.set(c*x,a*h,c*m,a*l);break;case"ZYZ":r.set(c*m,c*x,a*h,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Fo(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function On(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}var Xe={DEG2RAD:vc,RAD2DEG:Ac,generateUUID:qo,clamp:_n,euclideanModulo:Rx,mapLinear:gb,inverseLerp:vb,lerp:Ec,damp:Eb,pingpong:_b,smoothstep:Cb,smootherstep:yb,randInt:Ab,randFloat:bb,randFloatSpread:wb,seededRandom:Sb,degToRad:Mb,radToDeg:Db,isPowerOfTwo:Bb,ceilPowerOfTwo:Tb,floorPowerOfTwo:Fb,setQuaternionFromProperEuler:Pb,normalize:On,denormalize:Fo},Zt=class r{constructor(t=0,e=0){r.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(_n(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let n=Math.cos(e),i=Math.sin(e),s=this.x-t.x,o=this.y-t.y;return this.x=s*n-o*i+t.x,this.y=s*i+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},ae=class r{constructor(t,e,n,i,s,o,a,c,l){r.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,n,i,s,o,a,c,l)}set(t,e,n,i,s,o,a,c,l){let h=this.elements;return h[0]=t,h[1]=i,h[2]=a,h[3]=e,h[4]=s,h[5]=c,h[6]=n,h[7]=o,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,i=e.elements,s=this.elements,o=n[0],a=n[3],c=n[6],l=n[1],h=n[4],u=n[7],d=n[2],x=n[5],m=n[8],g=i[0],f=i[3],p=i[6],v=i[1],E=i[4],C=i[7],b=i[2],A=i[5],w=i[8];return s[0]=o*g+a*v+c*b,s[3]=o*f+a*E+c*A,s[6]=o*p+a*C+c*w,s[1]=l*g+h*v+u*b,s[4]=l*f+h*E+u*A,s[7]=l*p+h*C+u*w,s[2]=d*g+x*v+m*b,s[5]=d*f+x*E+m*A,s[8]=d*p+x*C+m*w,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8];return e*o*h-e*a*l-n*s*h+n*a*c+i*s*l-i*o*c}invert(){let t=this.elements,e=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],u=h*o-a*l,d=a*c-h*s,x=l*s-o*c,m=e*u+n*d+i*x;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);let g=1/m;return t[0]=u*g,t[1]=(i*l-h*n)*g,t[2]=(a*n-i*o)*g,t[3]=d*g,t[4]=(h*e-i*c)*g,t[5]=(i*s-a*e)*g,t[6]=x*g,t[7]=(n*c-l*e)*g,t[8]=(o*e-n*s)*g,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,s,o,a){let c=Math.cos(s),l=Math.sin(s);return this.set(n*c,n*l,-n*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(vd.makeScale(t,e)),this}rotate(t){return this.premultiply(vd.makeRotation(-t)),this}translate(t,e){return this.premultiply(vd.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){let e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){let n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}},vd=new ae;function Yv(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}function bc(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function Rb(){let r=bc("canvas");return r.style.display="block",r}var Ug={};function kb(r){r in Ug||(Ug[r]=!0,console.warn(r))}var zg=new ae().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Vg=new ae().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Ll={[Wr]:{transfer:dh,primaries:xh,toReference:r=>r,fromReference:r=>r},[li]:{transfer:He,primaries:xh,toReference:r=>r.convertSRGBToLinear(),fromReference:r=>r.convertLinearToSRGB()},[Uh]:{transfer:dh,primaries:fh,toReference:r=>r.applyMatrix3(Vg),fromReference:r=>r.applyMatrix3(zg)},[Px]:{transfer:He,primaries:fh,toReference:r=>r.convertSRGBToLinear().applyMatrix3(Vg),fromReference:r=>r.applyMatrix3(zg).convertLinearToSRGB()}},Ob=new Set([Wr,Uh]),Oe={enabled:!0,_workingColorSpace:Wr,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(r){if(!Ob.has(r))throw new Error(`Unsupported working color space, "${r}".`);this._workingColorSpace=r},convert:function(r,t,e){if(this.enabled===!1||t===e||!t||!e)return r;let n=Ll[t].toReference,i=Ll[e].fromReference;return i(n(r))},fromWorkingColorSpace:function(r,t){return this.convert(r,this._workingColorSpace,t)},toWorkingColorSpace:function(r,t){return this.convert(r,t,this._workingColorSpace)},getPrimaries:function(r){return Ll[r].primaries},getTransfer:function(r){return r===Nr?dh:Ll[r].transfer}};function Io(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function Ed(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}var po,Zd=class{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{po===void 0&&(po=bc("canvas")),po.width=t.width,po.height=t.height;let n=po.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=po}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){let e=bc("canvas");e.width=t.width,e.height=t.height;let n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);let i=n.getImageData(0,0,t.width,t.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=Io(s[o]/255)*255;return n.putImageData(i,0,0),e}else if(t.data){let e=t.data.slice(0);for(let n=0;n<e.length;n++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[n]=Math.floor(Io(e[n]/255)*255):e[n]=Io(e[n]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},Ib=0,mh=class{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Ib++}),this.uuid=qo(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];let n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(_d(i[o].image)):s.push(_d(i[o]))}else s=_d(i);n.url=s}return e||(t.images[this.uuid]=n),n}};function _d(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?Zd.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Lb=0,jr=(()=>{class r extends qi{constructor(e=r.DEFAULT_IMAGE,n=r.DEFAULT_MAPPING,i=Ts,s=Ts,o=Mi,a=Fs,c=ji,l=Hr,h=r.DEFAULT_ANISOTROPY,u=Nr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Lb++}),this.uuid=qo(),this.name="",this.source=new mh(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=h,this.format=c,this.internalFormat=null,this.type=l,this.offset=new Zt(0,0),this.repeat=new Zt(1,1),this.center=new Zt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ae,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),n||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==sg)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Cc:e.x=e.x-Math.floor(e.x);break;case Ts:e.x=e.x<0?0:1;break;case $d:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Cc:e.y=e.y-Math.floor(e.y);break;case Ts:e.y=e.y<0?0:1;break;case $d:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}return r.DEFAULT_IMAGE=null,r.DEFAULT_MAPPING=sg,r.DEFAULT_ANISOTROPY=1,r})(),je=class r{constructor(t=0,e=0,n=0,i=1){r.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,n=this.y,i=this.z,s=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i+o[12]*s,this.y=o[1]*e+o[5]*n+o[9]*i+o[13]*s,this.z=o[2]*e+o[6]*n+o[10]*i+o[14]*s,this.w=o[3]*e+o[7]*n+o[11]*i+o[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,s,c=t.elements,l=c[0],h=c[4],u=c[8],d=c[1],x=c[5],m=c[9],g=c[2],f=c[6],p=c[10];if(Math.abs(h-d)<.01&&Math.abs(u-g)<.01&&Math.abs(m-f)<.01){if(Math.abs(h+d)<.1&&Math.abs(u+g)<.1&&Math.abs(m+f)<.1&&Math.abs(l+x+p-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let E=(l+1)/2,C=(x+1)/2,b=(p+1)/2,A=(h+d)/4,w=(u+g)/4,S=(m+f)/4;return E>C&&E>b?E<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(E),i=A/n,s=w/n):C>b?C<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(C),n=A/i,s=S/i):b<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(b),n=w/s,i=S/s),this.set(n,i,s,e),this}let v=Math.sqrt((f-m)*(f-m)+(u-g)*(u-g)+(d-h)*(d-h));return Math.abs(v)<.001&&(v=1),this.x=(f-m)/v,this.y=(u-g)/v,this.z=(d-h)/v,this.w=Math.acos((l+x+p-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Jd=class extends qi{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new je(0,0,t,e),this.scissorTest=!1,this.viewport=new je(0,0,t,e);let i={width:t,height:e,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Mi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);let s=new jr(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);s.flipY=!1,s.generateMipmaps=n.generateMipmaps,s.internalFormat=n.internalFormat,this.textures=[];let o=n.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let n=0,i=t.textures.length;n<i;n++)this.textures[n]=t.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;let e=Object.assign({},t.texture.image);return this.texture.source=new mh(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},pr=class extends Jd{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}},gh=class extends jr{constructor(t=null,e=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=hi,this.minFilter=hi,this.wrapR=Ts,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};var Kd=class extends jr{constructor(t=null,e=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=hi,this.minFilter=hi,this.wrapR=Ts,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};var di=class{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,s,o,a){let c=n[i+0],l=n[i+1],h=n[i+2],u=n[i+3],d=s[o+0],x=s[o+1],m=s[o+2],g=s[o+3];if(a===0){t[e+0]=c,t[e+1]=l,t[e+2]=h,t[e+3]=u;return}if(a===1){t[e+0]=d,t[e+1]=x,t[e+2]=m,t[e+3]=g;return}if(u!==g||c!==d||l!==x||h!==m){let f=1-a,p=c*d+l*x+h*m+u*g,v=p>=0?1:-1,E=1-p*p;if(E>Number.EPSILON){let b=Math.sqrt(E),A=Math.atan2(b,p*v);f=Math.sin(f*A)/b,a=Math.sin(a*A)/b}let C=a*v;if(c=c*f+d*C,l=l*f+x*C,h=h*f+m*C,u=u*f+g*C,f===1-a){let b=1/Math.sqrt(c*c+l*l+h*h+u*u);c*=b,l*=b,h*=b,u*=b}}t[e]=c,t[e+1]=l,t[e+2]=h,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,i,s,o){let a=n[i],c=n[i+1],l=n[i+2],h=n[i+3],u=s[o],d=s[o+1],x=s[o+2],m=s[o+3];return t[e]=a*m+h*u+c*x-l*d,t[e+1]=c*m+h*d+l*u-a*x,t[e+2]=l*m+h*x+a*d-c*u,t[e+3]=h*m-a*u-c*d-l*x,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){let n=t._x,i=t._y,s=t._z,o=t._order,a=Math.cos,c=Math.sin,l=a(n/2),h=a(i/2),u=a(s/2),d=c(n/2),x=c(i/2),m=c(s/2);switch(o){case"XYZ":this._x=d*h*u+l*x*m,this._y=l*x*u-d*h*m,this._z=l*h*m+d*x*u,this._w=l*h*u-d*x*m;break;case"YXZ":this._x=d*h*u+l*x*m,this._y=l*x*u-d*h*m,this._z=l*h*m-d*x*u,this._w=l*h*u+d*x*m;break;case"ZXY":this._x=d*h*u-l*x*m,this._y=l*x*u+d*h*m,this._z=l*h*m+d*x*u,this._w=l*h*u-d*x*m;break;case"ZYX":this._x=d*h*u-l*x*m,this._y=l*x*u+d*h*m,this._z=l*h*m-d*x*u,this._w=l*h*u+d*x*m;break;case"YZX":this._x=d*h*u+l*x*m,this._y=l*x*u+d*h*m,this._z=l*h*m-d*x*u,this._w=l*h*u-d*x*m;break;case"XZY":this._x=d*h*u-l*x*m,this._y=l*x*u-d*h*m,this._z=l*h*m+d*x*u,this._w=l*h*u+d*x*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,n=e[0],i=e[4],s=e[8],o=e[1],a=e[5],c=e[9],l=e[2],h=e[6],u=e[10],d=n+a+u;if(d>0){let x=.5/Math.sqrt(d+1);this._w=.25/x,this._x=(h-c)*x,this._y=(s-l)*x,this._z=(o-i)*x}else if(n>a&&n>u){let x=2*Math.sqrt(1+n-a-u);this._w=(h-c)/x,this._x=.25*x,this._y=(i+o)/x,this._z=(s+l)/x}else if(a>u){let x=2*Math.sqrt(1+a-n-u);this._w=(s-l)/x,this._x=(i+o)/x,this._y=.25*x,this._z=(c+h)/x}else{let x=2*Math.sqrt(1+u-n-a);this._w=(o-i)/x,this._x=(s+l)/x,this._y=(c+h)/x,this._z=.25*x}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(_n(this.dot(t),-1,1)))}rotateTowards(t,e){let n=this.angleTo(t);if(n===0)return this;let i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let n=t._x,i=t._y,s=t._z,o=t._w,a=e._x,c=e._y,l=e._z,h=e._w;return this._x=n*h+o*a+i*l-s*c,this._y=i*h+o*c+s*a-n*l,this._z=s*h+o*l+n*c-i*a,this._w=o*h-n*a-i*c-s*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);let n=this._x,i=this._y,s=this._z,o=this._w,a=o*t._w+n*t._x+i*t._y+s*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=i,this._z=s,this;let c=1-a*a;if(c<=Number.EPSILON){let x=1-e;return this._w=x*o+e*this._w,this._x=x*n+e*this._x,this._y=x*i+e*this._y,this._z=x*s+e*this._z,this.normalize(),this}let l=Math.sqrt(c),h=Math.atan2(l,a),u=Math.sin((1-e)*h)/l,d=Math.sin(e*h)/l;return this._w=o*u+this._w*d,this._x=n*u+this._x*d,this._y=i*u+this._y*d,this._z=s*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){let t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(i*Math.sin(t),i*Math.cos(t),s*Math.sin(e),s*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},I=class r{constructor(t=0,e=0,n=0){r.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Hg.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Hg.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,n=this.y,i=this.z,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6]*i,this.y=s[1]*e+s[4]*n+s[7]*i,this.z=s[2]*e+s[5]*n+s[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,n=this.y,i=this.z,s=t.elements,o=1/(s[3]*e+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*e+s[4]*n+s[8]*i+s[12])*o,this.y=(s[1]*e+s[5]*n+s[9]*i+s[13])*o,this.z=(s[2]*e+s[6]*n+s[10]*i+s[14])*o,this}applyQuaternion(t){let e=this.x,n=this.y,i=this.z,s=t.x,o=t.y,a=t.z,c=t.w,l=2*(o*i-a*n),h=2*(a*e-s*i),u=2*(s*n-o*e);return this.x=e+c*l+o*u-a*h,this.y=n+c*h+a*l-s*u,this.z=i+c*u+s*h-o*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,n=this.y,i=this.z,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i,this.y=s[1]*e+s[5]*n+s[9]*i,this.z=s[2]*e+s[6]*n+s[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){let n=t.x,i=t.y,s=t.z,o=e.x,a=e.y,c=e.z;return this.x=i*c-s*a,this.y=s*o-n*c,this.z=n*a-i*o,this}projectOnVector(t){let e=t.lengthSq();if(e===0)return this.set(0,0,0);let n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Cd.copy(this).projectOnVector(t),this.sub(Cd)}reflect(t){return this.sub(Cd.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(_n(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){let i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=Math.random()*Math.PI*2,e=Math.random()*2-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},Cd=new I,Hg=new di,mr=class{constructor(t=new I(1/0,1/0,1/0),e=new I(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(bi.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(bi.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let n=bi.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);let n=t.geometry;if(n!==void 0){let s=n.getAttribute("position");if(e===!0&&s!==void 0&&t.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)t.isMesh===!0?t.getVertexPosition(o,bi):bi.fromBufferAttribute(s,o),bi.applyMatrix4(t.matrixWorld),this.expandByPoint(bi);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),Nl.copy(t.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),Nl.copy(n.boundingBox)),Nl.applyMatrix4(t.matrixWorld),this.union(Nl)}let i=t.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,bi),bi.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(uc),Ul.subVectors(this.max,uc),mo.subVectors(t.a,uc),go.subVectors(t.b,uc),vo.subVectors(t.c,uc),Pr.subVectors(go,mo),Rr.subVectors(vo,go),Cs.subVectors(mo,vo);let e=[0,-Pr.z,Pr.y,0,-Rr.z,Rr.y,0,-Cs.z,Cs.y,Pr.z,0,-Pr.x,Rr.z,0,-Rr.x,Cs.z,0,-Cs.x,-Pr.y,Pr.x,0,-Rr.y,Rr.x,0,-Cs.y,Cs.x,0];return!yd(e,mo,go,vo,Ul)||(e=[1,0,0,0,1,0,0,0,1],!yd(e,mo,go,vo,Ul))?!1:(zl.crossVectors(Pr,Rr),e=[zl.x,zl.y,zl.z],yd(e,mo,go,vo,Ul))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,bi).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(bi).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(sr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),sr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),sr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),sr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),sr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),sr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),sr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),sr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(sr),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},sr=[new I,new I,new I,new I,new I,new I,new I,new I],bi=new I,Nl=new mr,mo=new I,go=new I,vo=new I,Pr=new I,Rr=new I,Cs=new I,uc=new I,Ul=new I,zl=new I,ys=new I;function yd(r,t,e,n,i){for(let s=0,o=r.length-3;s<=o;s+=3){ys.fromArray(r,s);let a=i.x*Math.abs(ys.x)+i.y*Math.abs(ys.y)+i.z*Math.abs(ys.z),c=t.dot(ys),l=e.dot(ys),h=n.dot(ys);if(Math.max(-Math.max(c,l,h),Math.min(c,l,h))>a)return!1}return!0}var Nb=new mr,dc=new I,Ad=new I,gr=class{constructor(t=new I,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){let n=this.center;e!==void 0?n.copy(e):Nb.setFromPoints(t).getCenter(n);let i=0;for(let s=0,o=t.length;s<o;s++)i=Math.max(i,n.distanceToSquared(t[s]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){let n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;dc.subVectors(t,this.center);let e=dc.lengthSq();if(e>this.radius*this.radius){let n=Math.sqrt(e),i=(n-this.radius)*.5;this.center.addScaledVector(dc,i/n),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Ad.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(dc.copy(t.center).add(Ad)),this.expandByPoint(dc.copy(t.center).sub(Ad))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}},or=new I,bd=new I,Vl=new I,kr=new I,wd=new I,Hl=new I,Sd=new I,Vo=class{constructor(t=new I,e=new I(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,or)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);let n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){let e=or.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(or.copy(this.origin).addScaledVector(this.direction,e),or.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){bd.copy(t).add(e).multiplyScalar(.5),Vl.copy(e).sub(t).normalize(),kr.copy(this.origin).sub(bd);let s=t.distanceTo(e)*.5,o=-this.direction.dot(Vl),a=kr.dot(this.direction),c=-kr.dot(Vl),l=kr.lengthSq(),h=Math.abs(1-o*o),u,d,x,m;if(h>0)if(u=o*c-a,d=o*a-c,m=s*h,u>=0)if(d>=-m)if(d<=m){let g=1/h;u*=g,d*=g,x=u*(u+o*d+2*a)+d*(o*u+d+2*c)+l}else d=s,u=Math.max(0,-(o*d+a)),x=-u*u+d*(d+2*c)+l;else d=-s,u=Math.max(0,-(o*d+a)),x=-u*u+d*(d+2*c)+l;else d<=-m?(u=Math.max(0,-(-o*s+a)),d=u>0?-s:Math.min(Math.max(-s,-c),s),x=-u*u+d*(d+2*c)+l):d<=m?(u=0,d=Math.min(Math.max(-s,-c),s),x=d*(d+2*c)+l):(u=Math.max(0,-(o*s+a)),d=u>0?s:Math.min(Math.max(-s,-c),s),x=-u*u+d*(d+2*c)+l);else d=o>0?-s:s,u=Math.max(0,-(o*d+a)),x=-u*u+d*(d+2*c)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(bd).addScaledVector(Vl,d),x}intersectSphere(t,e){or.subVectors(t.center,this.origin);let n=or.dot(this.direction),i=or.dot(or)-n*n,s=t.radius*t.radius;if(i>s)return null;let o=Math.sqrt(s-i),a=n-o,c=n+o;return c<0?null:a<0?this.at(c,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){let e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;let n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){let n=this.distanceToPlane(t);return n===null?null:this.at(n,e)}intersectsPlane(t){let e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,s,o,a,c,l=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(t.min.x-d.x)*l,i=(t.max.x-d.x)*l):(n=(t.max.x-d.x)*l,i=(t.min.x-d.x)*l),h>=0?(s=(t.min.y-d.y)*h,o=(t.max.y-d.y)*h):(s=(t.max.y-d.y)*h,o=(t.min.y-d.y)*h),n>o||s>i||((s>n||isNaN(n))&&(n=s),(o<i||isNaN(i))&&(i=o),u>=0?(a=(t.min.z-d.z)*u,c=(t.max.z-d.z)*u):(a=(t.max.z-d.z)*u,c=(t.min.z-d.z)*u),n>c||a>i)||((a>n||n!==n)&&(n=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(n>=0?n:i,e)}intersectsBox(t){return this.intersectBox(t,or)!==null}intersectTriangle(t,e,n,i,s){wd.subVectors(e,t),Hl.subVectors(n,t),Sd.crossVectors(wd,Hl);let o=this.direction.dot(Sd),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;kr.subVectors(this.origin,t);let c=a*this.direction.dot(Hl.crossVectors(kr,Hl));if(c<0)return null;let l=a*this.direction.dot(wd.cross(kr));if(l<0||c+l>o)return null;let h=-a*kr.dot(Sd);return h<0?null:this.at(h/o,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Kt=class r{constructor(t,e,n,i,s,o,a,c,l,h,u,d,x,m,g,f){r.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,n,i,s,o,a,c,l,h,u,d,x,m,g,f)}set(t,e,n,i,s,o,a,c,l,h,u,d,x,m,g,f){let p=this.elements;return p[0]=t,p[4]=e,p[8]=n,p[12]=i,p[1]=s,p[5]=o,p[9]=a,p[13]=c,p[2]=l,p[6]=h,p[10]=u,p[14]=d,p[3]=x,p[7]=m,p[11]=g,p[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new r().fromArray(this.elements)}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){let e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,n=t.elements,i=1/Eo.setFromMatrixColumn(t,0).length(),s=1/Eo.setFromMatrixColumn(t,1).length(),o=1/Eo.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){let e=this.elements,n=t.x,i=t.y,s=t.z,o=Math.cos(n),a=Math.sin(n),c=Math.cos(i),l=Math.sin(i),h=Math.cos(s),u=Math.sin(s);if(t.order==="XYZ"){let d=o*h,x=o*u,m=a*h,g=a*u;e[0]=c*h,e[4]=-c*u,e[8]=l,e[1]=x+m*l,e[5]=d-g*l,e[9]=-a*c,e[2]=g-d*l,e[6]=m+x*l,e[10]=o*c}else if(t.order==="YXZ"){let d=c*h,x=c*u,m=l*h,g=l*u;e[0]=d+g*a,e[4]=m*a-x,e[8]=o*l,e[1]=o*u,e[5]=o*h,e[9]=-a,e[2]=x*a-m,e[6]=g+d*a,e[10]=o*c}else if(t.order==="ZXY"){let d=c*h,x=c*u,m=l*h,g=l*u;e[0]=d-g*a,e[4]=-o*u,e[8]=m+x*a,e[1]=x+m*a,e[5]=o*h,e[9]=g-d*a,e[2]=-o*l,e[6]=a,e[10]=o*c}else if(t.order==="ZYX"){let d=o*h,x=o*u,m=a*h,g=a*u;e[0]=c*h,e[4]=m*l-x,e[8]=d*l+g,e[1]=c*u,e[5]=g*l+d,e[9]=x*l-m,e[2]=-l,e[6]=a*c,e[10]=o*c}else if(t.order==="YZX"){let d=o*c,x=o*l,m=a*c,g=a*l;e[0]=c*h,e[4]=g-d*u,e[8]=m*u+x,e[1]=u,e[5]=o*h,e[9]=-a*h,e[2]=-l*h,e[6]=x*u+m,e[10]=d-g*u}else if(t.order==="XZY"){let d=o*c,x=o*l,m=a*c,g=a*l;e[0]=c*h,e[4]=-u,e[8]=l*h,e[1]=d*u+g,e[5]=o*h,e[9]=x*u-m,e[2]=m*u-x,e[6]=a*h,e[10]=g*u+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ub,t,zb)}lookAt(t,e,n){let i=this.elements;return Jn.subVectors(t,e),Jn.lengthSq()===0&&(Jn.z=1),Jn.normalize(),Or.crossVectors(n,Jn),Or.lengthSq()===0&&(Math.abs(n.z)===1?Jn.x+=1e-4:Jn.z+=1e-4,Jn.normalize(),Or.crossVectors(n,Jn)),Or.normalize(),Gl.crossVectors(Jn,Or),i[0]=Or.x,i[4]=Gl.x,i[8]=Jn.x,i[1]=Or.y,i[5]=Gl.y,i[9]=Jn.y,i[2]=Or.z,i[6]=Gl.z,i[10]=Jn.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,i=e.elements,s=this.elements,o=n[0],a=n[4],c=n[8],l=n[12],h=n[1],u=n[5],d=n[9],x=n[13],m=n[2],g=n[6],f=n[10],p=n[14],v=n[3],E=n[7],C=n[11],b=n[15],A=i[0],w=i[4],S=i[8],_=i[12],y=i[1],D=i[5],F=i[9],T=i[13],L=i[2],N=i[6],J=i[10],tt=i[14],G=i[3],X=i[7],st=i[11],ft=i[15];return s[0]=o*A+a*y+c*L+l*G,s[4]=o*w+a*D+c*N+l*X,s[8]=o*S+a*F+c*J+l*st,s[12]=o*_+a*T+c*tt+l*ft,s[1]=h*A+u*y+d*L+x*G,s[5]=h*w+u*D+d*N+x*X,s[9]=h*S+u*F+d*J+x*st,s[13]=h*_+u*T+d*tt+x*ft,s[2]=m*A+g*y+f*L+p*G,s[6]=m*w+g*D+f*N+p*X,s[10]=m*S+g*F+f*J+p*st,s[14]=m*_+g*T+f*tt+p*ft,s[3]=v*A+E*y+C*L+b*G,s[7]=v*w+E*D+C*N+b*X,s[11]=v*S+E*F+C*J+b*st,s[15]=v*_+E*T+C*tt+b*ft,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[4],i=t[8],s=t[12],o=t[1],a=t[5],c=t[9],l=t[13],h=t[2],u=t[6],d=t[10],x=t[14],m=t[3],g=t[7],f=t[11],p=t[15];return m*(+s*c*u-i*l*u-s*a*d+n*l*d+i*a*x-n*c*x)+g*(+e*c*x-e*l*d+s*o*d-i*o*x+i*l*h-s*c*h)+f*(+e*l*u-e*a*x-s*o*u+n*o*x+s*a*h-n*l*h)+p*(-i*a*h-e*c*u+e*a*d+i*o*u-n*o*d+n*c*h)}transpose(){let t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){let i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){let t=this.elements,e=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],u=t[9],d=t[10],x=t[11],m=t[12],g=t[13],f=t[14],p=t[15],v=u*f*l-g*d*l+g*c*x-a*f*x-u*c*p+a*d*p,E=m*d*l-h*f*l-m*c*x+o*f*x+h*c*p-o*d*p,C=h*g*l-m*u*l+m*a*x-o*g*x-h*a*p+o*u*p,b=m*u*c-h*g*c-m*a*d+o*g*d+h*a*f-o*u*f,A=e*v+n*E+i*C+s*b;if(A===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/A;return t[0]=v*w,t[1]=(g*d*s-u*f*s-g*i*x+n*f*x+u*i*p-n*d*p)*w,t[2]=(a*f*s-g*c*s+g*i*l-n*f*l-a*i*p+n*c*p)*w,t[3]=(u*c*s-a*d*s-u*i*l+n*d*l+a*i*x-n*c*x)*w,t[4]=E*w,t[5]=(h*f*s-m*d*s+m*i*x-e*f*x-h*i*p+e*d*p)*w,t[6]=(m*c*s-o*f*s-m*i*l+e*f*l+o*i*p-e*c*p)*w,t[7]=(o*d*s-h*c*s+h*i*l-e*d*l-o*i*x+e*c*x)*w,t[8]=C*w,t[9]=(m*u*s-h*g*s-m*n*x+e*g*x+h*n*p-e*u*p)*w,t[10]=(o*g*s-m*a*s+m*n*l-e*g*l-o*n*p+e*a*p)*w,t[11]=(h*a*s-o*u*s-h*n*l+e*u*l+o*n*x-e*a*x)*w,t[12]=b*w,t[13]=(h*g*i-m*u*i+m*n*d-e*g*d-h*n*f+e*u*f)*w,t[14]=(m*a*i-o*g*i-m*n*c+e*g*c+o*n*f-e*a*f)*w,t[15]=(o*u*i-h*a*i+h*n*c-e*u*c-o*n*d+e*a*d)*w,this}scale(t){let e=this.elements,n=t.x,i=t.y,s=t.z;return e[0]*=n,e[4]*=i,e[8]*=s,e[1]*=n,e[5]*=i,e[9]*=s,e[2]*=n,e[6]*=i,e[10]*=s,e[3]*=n,e[7]*=i,e[11]*=s,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let n=Math.cos(e),i=Math.sin(e),s=1-n,o=t.x,a=t.y,c=t.z,l=s*o,h=s*a;return this.set(l*o+n,l*a-i*c,l*c+i*a,0,l*a+i*c,h*a+n,h*c-i*o,0,l*c-i*a,h*c+i*o,s*c*c+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,s,o){return this.set(1,n,s,0,t,1,o,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){let i=this.elements,s=e._x,o=e._y,a=e._z,c=e._w,l=s+s,h=o+o,u=a+a,d=s*l,x=s*h,m=s*u,g=o*h,f=o*u,p=a*u,v=c*l,E=c*h,C=c*u,b=n.x,A=n.y,w=n.z;return i[0]=(1-(g+p))*b,i[1]=(x+C)*b,i[2]=(m-E)*b,i[3]=0,i[4]=(x-C)*A,i[5]=(1-(d+p))*A,i[6]=(f+v)*A,i[7]=0,i[8]=(m+E)*w,i[9]=(f-v)*w,i[10]=(1-(d+g))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){let i=this.elements,s=Eo.set(i[0],i[1],i[2]).length(),o=Eo.set(i[4],i[5],i[6]).length(),a=Eo.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),t.x=i[12],t.y=i[13],t.z=i[14],wi.copy(this);let l=1/s,h=1/o,u=1/a;return wi.elements[0]*=l,wi.elements[1]*=l,wi.elements[2]*=l,wi.elements[4]*=h,wi.elements[5]*=h,wi.elements[6]*=h,wi.elements[8]*=u,wi.elements[9]*=u,wi.elements[10]*=u,e.setFromRotationMatrix(wi),n.x=s,n.y=o,n.z=a,this}makePerspective(t,e,n,i,s,o,a=fr){let c=this.elements,l=2*s/(e-t),h=2*s/(n-i),u=(e+t)/(e-t),d=(n+i)/(n-i),x,m;if(a===fr)x=-(o+s)/(o-s),m=-2*o*s/(o-s);else if(a===ph)x=-o/(o-s),m=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=u,c[12]=0,c[1]=0,c[5]=h,c[9]=d,c[13]=0,c[2]=0,c[6]=0,c[10]=x,c[14]=m,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(t,e,n,i,s,o,a=fr){let c=this.elements,l=1/(e-t),h=1/(n-i),u=1/(o-s),d=(e+t)*l,x=(n+i)*h,m,g;if(a===fr)m=(o+s)*u,g=-2*u;else if(a===ph)m=s*u,g=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-d,c[1]=0,c[5]=2*h,c[9]=0,c[13]=-x,c[2]=0,c[6]=0,c[10]=g,c[14]=-m,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(t){let e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){let n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}},Eo=new I,wi=new Kt,Ub=new I(0,0,0),zb=new I(1,1,1),Or=new I,Gl=new I,Jn=new I,Gg=new Kt,Wg=new di,Ps=(()=>{class r{constructor(e=0,n=0,i=0,s=r.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,i,s=this._order){return this._x=e,this._y=n,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,i=!0){let s=e.elements,o=s[0],a=s[4],c=s[8],l=s[1],h=s[5],u=s[9],d=s[2],x=s[6],m=s[10];switch(n){case"XYZ":this._y=Math.asin(_n(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,m),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(x,h),this._z=0);break;case"YXZ":this._x=Math.asin(-_n(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(c,m),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(_n(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(-d,m),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-_n(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(x,m),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(_n(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(c,m));break;case"XZY":this._z=Math.asin(-_n(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(x,h),this._y=Math.atan2(c,o)):(this._x=Math.atan2(-u,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,i){return Gg.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Gg,n,i)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return Wg.setFromEuler(this),this.setFromQuaternion(Wg,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return r.DEFAULT_ORDER="XYZ",r})(),wc=class{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}},Vb=0,jg=new I,_o=new di,ar=new Kt,Wl=new I,xc=new I,Hb=new I,Gb=new di,Xg=new I(1,0,0),Yg=new I(0,1,0),qg=new I(0,0,1),$g={type:"added"},Wb={type:"removed"},Co={type:"childadded",child:null},Md={type:"childremoved",child:null},Bi=(()=>{class r extends qi{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Vb++}),this.uuid=qo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=r.DEFAULT_UP.clone();let e=new I,n=new Ps,i=new di,s=new I(1,1,1);function o(){i.setFromEuler(n,!1)}function a(){n.setFromQuaternion(i,void 0,!1)}n._onChange(o),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Kt},normalMatrix:{value:new ae}}),this.matrix=new Kt,this.matrixWorld=new Kt,this.matrixAutoUpdate=r.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=r.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new wc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return _o.setFromAxisAngle(e,n),this.quaternion.multiply(_o),this}rotateOnWorldAxis(e,n){return _o.setFromAxisAngle(e,n),this.quaternion.premultiply(_o),this}rotateX(e){return this.rotateOnAxis(Xg,e)}rotateY(e){return this.rotateOnAxis(Yg,e)}rotateZ(e){return this.rotateOnAxis(qg,e)}translateOnAxis(e,n){return jg.copy(e).applyQuaternion(this.quaternion),this.position.add(jg.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(Xg,e)}translateY(e){return this.translateOnAxis(Yg,e)}translateZ(e){return this.translateOnAxis(qg,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ar.copy(this.matrixWorld).invert())}lookAt(e,n,i){e.isVector3?Wl.copy(e):Wl.set(e,n,i);let s=this.parent;this.updateWorldMatrix(!0,!1),xc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ar.lookAt(xc,Wl,this.up):ar.lookAt(Wl,xc,this.up),this.quaternion.setFromRotationMatrix(ar),s&&(ar.extractRotation(s.matrixWorld),_o.setFromRotationMatrix(ar),this.quaternion.premultiply(_o.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent($g),Co.child=e,this.dispatchEvent(Co),Co.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Wb),Md.child=e,this.dispatchEvent(Md),Md.child=null),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ar.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ar.multiply(e.parent.matrixWorld)),e.applyMatrix4(ar),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent($g),Co.child=e,this.dispatchEvent(Co),Co.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let i=0,s=this.children.length;i<s;i++){let a=this.children[i].getObjectByProperty(e,n);if(a!==void 0)return a}}getObjectsByProperty(e,n,i=[]){this[e]===n&&i.push(this);let s=this.children;for(let o=0,a=s.length;o<a;o++)s[o].getObjectsByProperty(e,n,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xc,e,Hb),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xc,Gb,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);let n=this.children;for(let i=0,s=n.length;i<s;i++)n[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let n=this.children;for(let i=0,s=n.length;i<s;i++)n[i].traverseVisible(e)}traverseAncestors(e){let n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let n=this.children;for(let i=0,s=n.length;i<s;i++){let o=n[i];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,n){let i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n===!0){let s=this.children;for(let o=0,a=s.length;o<a;o++){let c=s[o];c.matrixWorldAutoUpdate===!0&&c.updateWorldMatrix(!1,!0)}}}toJSON(e){let n=e===void 0||typeof e=="string",i={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(c=>({boxInitialized:c.boxInitialized,boxMin:c.box.min.toArray(),boxMax:c.box.max.toArray(),sphereInitialized:c.sphereInitialized,sphereRadius:c.sphere.radius,sphereCenter:c.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(c,l){return c[l.uuid]===void 0&&(c[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);let c=this.geometry.parameters;if(c!==void 0&&c.shapes!==void 0){let l=c.shapes;if(Array.isArray(l))for(let h=0,u=l.length;h<u;h++){let d=l[h];o(e.shapes,d)}else o(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let c=[];for(let l=0,h=this.material.length;l<h;l++)c.push(o(e.materials,this.material[l]));s.material=c}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let c=0;c<this.children.length;c++)s.children.push(this.children[c].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let c=0;c<this.animations.length;c++){let l=this.animations[c];s.animations.push(o(e.animations,l))}}if(n){let c=a(e.geometries),l=a(e.materials),h=a(e.textures),u=a(e.images),d=a(e.shapes),x=a(e.skeletons),m=a(e.animations),g=a(e.nodes);c.length>0&&(i.geometries=c),l.length>0&&(i.materials=l),h.length>0&&(i.textures=h),u.length>0&&(i.images=u),d.length>0&&(i.shapes=d),x.length>0&&(i.skeletons=x),m.length>0&&(i.animations=m),g.length>0&&(i.nodes=g)}return i.object=s,i;function a(c){let l=[];for(let h in c){let u=c[h];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let i=0;i<e.children.length;i++){let s=e.children[i];this.add(s.clone())}return this}}return r.DEFAULT_UP=new I(0,1,0),r.DEFAULT_MATRIX_AUTO_UPDATE=!0,r.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,r})(),Si=new I,cr=new I,Dd=new I,lr=new I,yo=new I,Ao=new I,Zg=new I,Bd=new I,Td=new I,Fd=new I,Po=class r{constructor(t=new I,e=new I,n=new I){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),Si.subVectors(t,e),i.cross(Si);let s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(t,e,n,i,s){Si.subVectors(i,e),cr.subVectors(n,e),Dd.subVectors(t,e);let o=Si.dot(Si),a=Si.dot(cr),c=Si.dot(Dd),l=cr.dot(cr),h=cr.dot(Dd),u=o*l-a*a;if(u===0)return s.set(0,0,0),null;let d=1/u,x=(l*c-a*h)*d,m=(o*h-a*c)*d;return s.set(1-x-m,m,x)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,lr)===null?!1:lr.x>=0&&lr.y>=0&&lr.x+lr.y<=1}static getInterpolation(t,e,n,i,s,o,a,c){return this.getBarycoord(t,e,n,i,lr)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,lr.x),c.addScaledVector(o,lr.y),c.addScaledVector(a,lr.z),c)}static isFrontFacing(t,e,n,i){return Si.subVectors(n,e),cr.subVectors(t,e),Si.cross(cr).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Si.subVectors(this.c,this.b),cr.subVectors(this.a,this.b),Si.cross(cr).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return r.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return r.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,i,s){return r.getInterpolation(t,this.a,this.b,this.c,e,n,i,s)}containsPoint(t){return r.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return r.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){let n=this.a,i=this.b,s=this.c,o,a;yo.subVectors(i,n),Ao.subVectors(s,n),Bd.subVectors(t,n);let c=yo.dot(Bd),l=Ao.dot(Bd);if(c<=0&&l<=0)return e.copy(n);Td.subVectors(t,i);let h=yo.dot(Td),u=Ao.dot(Td);if(h>=0&&u<=h)return e.copy(i);let d=c*u-h*l;if(d<=0&&c>=0&&h<=0)return o=c/(c-h),e.copy(n).addScaledVector(yo,o);Fd.subVectors(t,s);let x=yo.dot(Fd),m=Ao.dot(Fd);if(m>=0&&x<=m)return e.copy(s);let g=x*l-c*m;if(g<=0&&l>=0&&m<=0)return a=l/(l-m),e.copy(n).addScaledVector(Ao,a);let f=h*m-x*u;if(f<=0&&u-h>=0&&x-m>=0)return Zg.subVectors(s,i),a=(u-h)/(u-h+(x-m)),e.copy(i).addScaledVector(Zg,a);let p=1/(f+g+d);return o=g*p,a=d*p,e.copy(n).addScaledVector(yo,o).addScaledVector(Ao,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},qv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ir={h:0,s:0,l:0},jl={h:0,s:0,l:0};function Pd(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*6*(2/3-e):r}var $t=class{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(e===void 0&&n===void 0){let i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=li){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Oe.toWorkingColorSpace(this,e),this}setRGB(t,e,n,i=Oe.workingColorSpace){return this.r=t,this.g=e,this.b=n,Oe.toWorkingColorSpace(this,i),this}setHSL(t,e,n,i=Oe.workingColorSpace){if(t=Rx(t,1),e=_n(e,0,1),n=_n(n,0,1),e===0)this.r=this.g=this.b=n;else{let s=n<=.5?n*(1+e):n+e-n*e,o=2*n-s;this.r=Pd(o,s,t+1/3),this.g=Pd(o,s,t),this.b=Pd(o,s,t-1/3)}return Oe.toWorkingColorSpace(this,i),this}setStyle(t,e=li){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s,o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){let s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=li){let n=qv[t.toLowerCase()];return n!==void 0?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Io(t.r),this.g=Io(t.g),this.b=Io(t.b),this}copyLinearToSRGB(t){return this.r=Ed(t.r),this.g=Ed(t.g),this.b=Ed(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=li){return Oe.fromWorkingColorSpace(Bn.copy(this),t),Math.round(_n(Bn.r*255,0,255))*65536+Math.round(_n(Bn.g*255,0,255))*256+Math.round(_n(Bn.b*255,0,255))}getHexString(t=li){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Oe.workingColorSpace){Oe.fromWorkingColorSpace(Bn.copy(this),e);let n=Bn.r,i=Bn.g,s=Bn.b,o=Math.max(n,i,s),a=Math.min(n,i,s),c,l,h=(a+o)/2;if(a===o)c=0,l=0;else{let u=o-a;switch(l=h<=.5?u/(o+a):u/(2-o-a),o){case n:c=(i-s)/u+(i<s?6:0);break;case i:c=(s-n)/u+2;break;case s:c=(n-i)/u+4;break}c/=6}return t.h=c,t.s=l,t.l=h,t}getRGB(t,e=Oe.workingColorSpace){return Oe.fromWorkingColorSpace(Bn.copy(this),e),t.r=Bn.r,t.g=Bn.g,t.b=Bn.b,t}getStyle(t=li){Oe.fromWorkingColorSpace(Bn.copy(this),t);let e=Bn.r,n=Bn.g,i=Bn.b;return t!==li?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(t,e,n){return this.getHSL(Ir),this.setHSL(Ir.h+t,Ir.s+e,Ir.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Ir),t.getHSL(jl);let n=Ec(Ir.h,jl.h,e),i=Ec(Ir.s,jl.s,e),s=Ec(Ir.l,jl.l,e);return this.setHSL(n,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){let e=this.r,n=this.g,i=this.b,s=t.elements;return this.r=s[0]*e+s[3]*n+s[6]*i,this.g=s[1]*e+s[4]*n+s[7]*i,this.b=s[2]*e+s[5]*n+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},Bn=new $t;$t.NAMES=qv;var jb=0,xi=class extends qi{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:jb++}),this.uuid=qo(),this.name="",this.type="Material",this.blending=ko,this.side=Yi,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=jd,this.blendDst=Xd,this.blendEquation=Ds,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new $t(0,0,0),this.blendAlpha=0,this.depthFunc=lh,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Og,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=fo,this.stencilZFail=fo,this.stencilZPass=fo,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(let e in t){let n=t[e];if(n===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}let i=this[e];if(i===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n}}toJSON(t){let e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});let n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==ko&&(n.blending=this.blending),this.side!==Yi&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==jd&&(n.blendSrc=this.blendSrc),this.blendDst!==Xd&&(n.blendDst=this.blendDst),this.blendEquation!==Ds&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==lh&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Og&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==fo&&(n.stencilFail=this.stencilFail),this.stencilZFail!==fo&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==fo&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(s){let o=[];for(let a in s){let c=s[a];delete c.metadata,o.push(c)}return o}if(e){let s=i(t.textures),o=i(t.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;let e=t.clippingPlanes,n=null;if(e!==null){let i=e.length;n=new Array(i);for(let s=0;s!==i;++s)n[s]=e[s].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}},vh=class extends xi{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new $t(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ps,this.combine=Fx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}};var sn=new I,Xl=new Zt,ui=class{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n,this.usage=Ig,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Ur,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return kb("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,n=this.count;e<n;e++)Xl.fromBufferAttribute(this,e),Xl.applyMatrix3(t),this.setXY(e,Xl.x,Xl.y);else if(this.itemSize===3)for(let e=0,n=this.count;e<n;e++)sn.fromBufferAttribute(this,e),sn.applyMatrix3(t),this.setXYZ(e,sn.x,sn.y,sn.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)sn.fromBufferAttribute(this,e),sn.applyMatrix4(t),this.setXYZ(e,sn.x,sn.y,sn.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)sn.fromBufferAttribute(this,e),sn.applyNormalMatrix(t),this.setXYZ(e,sn.x,sn.y,sn.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)sn.fromBufferAttribute(this,e),sn.transformDirection(t),this.setXYZ(e,sn.x,sn.y,sn.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Fo(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=On(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Fo(e,this.array)),e}setX(t,e){return this.normalized&&(e=On(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Fo(e,this.array)),e}setY(t,e){return this.normalized&&(e=On(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Fo(e,this.array)),e}setZ(t,e){return this.normalized&&(e=On(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Fo(e,this.array)),e}setW(t,e){return this.normalized&&(e=On(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=On(e,this.array),n=On(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=On(e,this.array),n=On(n,this.array),i=On(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,s){return t*=this.itemSize,this.normalized&&(e=On(e,this.array),n=On(n,this.array),i=On(i,this.array),s=On(s,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Ig&&(t.usage=this.usage),t}};var Eh=class extends ui{constructor(t,e,n){super(new Uint16Array(t),e,n)}};var _h=class extends ui{constructor(t,e,n){super(new Uint32Array(t),e,n)}};var on=class extends ui{constructor(t,e,n){super(new Float32Array(t),e,n)}},Xb=0,ci=new Kt,Rd=new Bi,bo=new I,Kn=new mr,fc=new mr,mn=new I,gn=class r extends qi{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Xb++}),this.uuid=qo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Yv(t)?_h:Eh)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);let n=this.attributes.normal;if(n!==void 0){let s=new ae().getNormalMatrix(t);n.applyNormalMatrix(s),n.needsUpdate=!0}let i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return ci.makeRotationFromQuaternion(t),this.applyMatrix4(ci),this}rotateX(t){return ci.makeRotationX(t),this.applyMatrix4(ci),this}rotateY(t){return ci.makeRotationY(t),this.applyMatrix4(ci),this}rotateZ(t){return ci.makeRotationZ(t),this.applyMatrix4(ci),this}translate(t,e,n){return ci.makeTranslation(t,e,n),this.applyMatrix4(ci),this}scale(t,e,n){return ci.makeScale(t,e,n),this.applyMatrix4(ci),this}lookAt(t){return Rd.lookAt(t),Rd.updateMatrix(),this.applyMatrix4(Rd.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(bo).negate(),this.translate(bo.x,bo.y,bo.z),this}setFromPoints(t){let e=[];for(let n=0,i=t.length;n<i;n++){let s=t[n];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new on(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new mr);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new I(-1/0,-1/0,-1/0),new I(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,i=e.length;n<i;n++){let s=e[n];Kn.setFromBufferAttribute(s),this.morphTargetsRelative?(mn.addVectors(this.boundingBox.min,Kn.min),this.boundingBox.expandByPoint(mn),mn.addVectors(this.boundingBox.max,Kn.max),this.boundingBox.expandByPoint(mn)):(this.boundingBox.expandByPoint(Kn.min),this.boundingBox.expandByPoint(Kn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new gr);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new I,1/0);return}if(t){let n=this.boundingSphere.center;if(Kn.setFromBufferAttribute(t),e)for(let s=0,o=e.length;s<o;s++){let a=e[s];fc.setFromBufferAttribute(a),this.morphTargetsRelative?(mn.addVectors(Kn.min,fc.min),Kn.expandByPoint(mn),mn.addVectors(Kn.max,fc.max),Kn.expandByPoint(mn)):(Kn.expandByPoint(fc.min),Kn.expandByPoint(fc.max))}Kn.getCenter(n);let i=0;for(let s=0,o=t.count;s<o;s++)mn.fromBufferAttribute(t,s),i=Math.max(i,n.distanceToSquared(mn));if(e)for(let s=0,o=e.length;s<o;s++){let a=e[s],c=this.morphTargetsRelative;for(let l=0,h=a.count;l<h;l++)mn.fromBufferAttribute(a,l),c&&(bo.fromBufferAttribute(t,l),mn.add(bo)),i=Math.max(i,n.distanceToSquared(mn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let n=e.position,i=e.normal,s=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ui(new Float32Array(4*n.count),4));let o=this.getAttribute("tangent"),a=[],c=[];for(let S=0;S<n.count;S++)a[S]=new I,c[S]=new I;let l=new I,h=new I,u=new I,d=new Zt,x=new Zt,m=new Zt,g=new I,f=new I;function p(S,_,y){l.fromBufferAttribute(n,S),h.fromBufferAttribute(n,_),u.fromBufferAttribute(n,y),d.fromBufferAttribute(s,S),x.fromBufferAttribute(s,_),m.fromBufferAttribute(s,y),h.sub(l),u.sub(l),x.sub(d),m.sub(d);let D=1/(x.x*m.y-m.x*x.y);isFinite(D)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(u,-x.y).multiplyScalar(D),f.copy(u).multiplyScalar(x.x).addScaledVector(h,-m.x).multiplyScalar(D),a[S].add(g),a[_].add(g),a[y].add(g),c[S].add(f),c[_].add(f),c[y].add(f))}let v=this.groups;v.length===0&&(v=[{start:0,count:t.count}]);for(let S=0,_=v.length;S<_;++S){let y=v[S],D=y.start,F=y.count;for(let T=D,L=D+F;T<L;T+=3)p(t.getX(T+0),t.getX(T+1),t.getX(T+2))}let E=new I,C=new I,b=new I,A=new I;function w(S){b.fromBufferAttribute(i,S),A.copy(b);let _=a[S];E.copy(_),E.sub(b.multiplyScalar(b.dot(_))).normalize(),C.crossVectors(A,_);let D=C.dot(c[S])<0?-1:1;o.setXYZW(S,E.x,E.y,E.z,D)}for(let S=0,_=v.length;S<_;++S){let y=v[S],D=y.start,F=y.count;for(let T=D,L=D+F;T<L;T+=3)w(t.getX(T+0)),w(t.getX(T+1)),w(t.getX(T+2))}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(e!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new ui(new Float32Array(e.count*3),3),this.setAttribute("normal",n);else for(let d=0,x=n.count;d<x;d++)n.setXYZ(d,0,0,0);let i=new I,s=new I,o=new I,a=new I,c=new I,l=new I,h=new I,u=new I;if(t)for(let d=0,x=t.count;d<x;d+=3){let m=t.getX(d+0),g=t.getX(d+1),f=t.getX(d+2);i.fromBufferAttribute(e,m),s.fromBufferAttribute(e,g),o.fromBufferAttribute(e,f),h.subVectors(o,s),u.subVectors(i,s),h.cross(u),a.fromBufferAttribute(n,m),c.fromBufferAttribute(n,g),l.fromBufferAttribute(n,f),a.add(h),c.add(h),l.add(h),n.setXYZ(m,a.x,a.y,a.z),n.setXYZ(g,c.x,c.y,c.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let d=0,x=e.count;d<x;d+=3)i.fromBufferAttribute(e,d+0),s.fromBufferAttribute(e,d+1),o.fromBufferAttribute(e,d+2),h.subVectors(o,s),u.subVectors(i,s),h.cross(u),n.setXYZ(d+0,h.x,h.y,h.z),n.setXYZ(d+1,h.x,h.y,h.z),n.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){let t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)mn.fromBufferAttribute(t,e),mn.normalize(),t.setXYZ(e,mn.x,mn.y,mn.z)}toNonIndexed(){function t(a,c){let l=a.array,h=a.itemSize,u=a.normalized,d=new l.constructor(c.length*h),x=0,m=0;for(let g=0,f=c.length;g<f;g++){a.isInterleavedBufferAttribute?x=c[g]*a.data.stride+a.offset:x=c[g]*h;for(let p=0;p<h;p++)d[m++]=l[x++]}return new ui(d,h,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let e=new r,n=this.index.array,i=this.attributes;for(let a in i){let c=i[a],l=t(c,n);e.setAttribute(a,l)}let s=this.morphAttributes;for(let a in s){let c=[],l=s[a];for(let h=0,u=l.length;h<u;h++){let d=l[h],x=t(d,n);c.push(x)}e.morphAttributes[a]=c}e.morphTargetsRelative=this.morphTargetsRelative;let o=this.groups;for(let a=0,c=o.length;a<c;a++){let l=o[a];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){let t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){let c=this.parameters;for(let l in c)c[l]!==void 0&&(t[l]=c[l]);return t}t.data={attributes:{}};let e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let n=this.attributes;for(let c in n){let l=n[c];t.data.attributes[c]=l.toJSON(t.data)}let i={},s=!1;for(let c in this.morphAttributes){let l=this.morphAttributes[c],h=[];for(let u=0,d=l.length;u<d;u++){let x=l[u];h.push(x.toJSON(t.data))}h.length>0&&(i[c]=h,s=!0)}s&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);let o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));let a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let n=t.index;n!==null&&this.setIndex(n.clone(e));let i=t.attributes;for(let l in i){let h=i[l];this.setAttribute(l,h.clone(e))}let s=t.morphAttributes;for(let l in s){let h=[],u=s[l];for(let d=0,x=u.length;d<x;d++)h.push(u[d].clone(e));this.morphAttributes[l]=h}this.morphTargetsRelative=t.morphTargetsRelative;let o=t.groups;for(let l=0,h=o.length;l<h;l++){let u=o[l];this.addGroup(u.start,u.count,u.materialIndex)}let a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());let c=t.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}},Jg=new Kt,As=new Vo,Yl=new gr,Kg=new I,wo=new I,So=new I,Mo=new I,kd=new I,ql=new I,$l=new Zt,Zl=new Zt,Jl=new Zt,Qg=new I,tv=new I,ev=new I,Kl=new I,Ql=new I,Wn=class extends Bi{constructor(t=new gn,e=new vh){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){let i=e[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){let a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(t,e){let n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;e.fromBufferAttribute(i,t);let a=this.morphTargetInfluences;if(s&&a){ql.set(0,0,0);for(let c=0,l=s.length;c<l;c++){let h=a[c],u=s[c];h!==0&&(kd.fromBufferAttribute(u,t),o?ql.addScaledVector(kd,h):ql.addScaledVector(kd.sub(e),h))}e.add(ql)}return e}raycast(t,e){let n=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Yl.copy(n.boundingSphere),Yl.applyMatrix4(s),As.copy(t.ray).recast(t.near),!(Yl.containsPoint(As.origin)===!1&&(As.intersectSphere(Yl,Kg)===null||As.origin.distanceToSquared(Kg)>(t.far-t.near)**2))&&(Jg.copy(s).invert(),As.copy(t.ray).applyMatrix4(Jg),!(n.boundingBox!==null&&As.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(t,e,As)))}_computeIntersections(t,e,n){let i,s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,h=s.attributes.uv1,u=s.attributes.normal,d=s.groups,x=s.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,g=d.length;m<g;m++){let f=d[m],p=o[f.materialIndex],v=Math.max(f.start,x.start),E=Math.min(a.count,Math.min(f.start+f.count,x.start+x.count));for(let C=v,b=E;C<b;C+=3){let A=a.getX(C),w=a.getX(C+1),S=a.getX(C+2);i=th(this,p,t,n,l,h,u,A,w,S),i&&(i.faceIndex=Math.floor(C/3),i.face.materialIndex=f.materialIndex,e.push(i))}}else{let m=Math.max(0,x.start),g=Math.min(a.count,x.start+x.count);for(let f=m,p=g;f<p;f+=3){let v=a.getX(f),E=a.getX(f+1),C=a.getX(f+2);i=th(this,o,t,n,l,h,u,v,E,C),i&&(i.faceIndex=Math.floor(f/3),e.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let m=0,g=d.length;m<g;m++){let f=d[m],p=o[f.materialIndex],v=Math.max(f.start,x.start),E=Math.min(c.count,Math.min(f.start+f.count,x.start+x.count));for(let C=v,b=E;C<b;C+=3){let A=C,w=C+1,S=C+2;i=th(this,p,t,n,l,h,u,A,w,S),i&&(i.faceIndex=Math.floor(C/3),i.face.materialIndex=f.materialIndex,e.push(i))}}else{let m=Math.max(0,x.start),g=Math.min(c.count,x.start+x.count);for(let f=m,p=g;f<p;f+=3){let v=f,E=f+1,C=f+2;i=th(this,o,t,n,l,h,u,v,E,C),i&&(i.faceIndex=Math.floor(f/3),e.push(i))}}}};function Yb(r,t,e,n,i,s,o,a){let c;if(t.side===jn?c=n.intersectTriangle(o,s,i,!0,a):c=n.intersectTriangle(i,s,o,t.side===Yi,a),c===null)return null;Ql.copy(a),Ql.applyMatrix4(r.matrixWorld);let l=e.ray.origin.distanceTo(Ql);return l<e.near||l>e.far?null:{distance:l,point:Ql.clone(),object:r}}function th(r,t,e,n,i,s,o,a,c,l){r.getVertexPosition(a,wo),r.getVertexPosition(c,So),r.getVertexPosition(l,Mo);let h=Yb(r,t,e,n,wo,So,Mo,Kl);if(h){i&&($l.fromBufferAttribute(i,a),Zl.fromBufferAttribute(i,c),Jl.fromBufferAttribute(i,l),h.uv=Po.getInterpolation(Kl,wo,So,Mo,$l,Zl,Jl,new Zt)),s&&($l.fromBufferAttribute(s,a),Zl.fromBufferAttribute(s,c),Jl.fromBufferAttribute(s,l),h.uv1=Po.getInterpolation(Kl,wo,So,Mo,$l,Zl,Jl,new Zt)),o&&(Qg.fromBufferAttribute(o,a),tv.fromBufferAttribute(o,c),ev.fromBufferAttribute(o,l),h.normal=Po.getInterpolation(Kl,wo,So,Mo,Qg,tv,ev,new I),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));let u={a,b:c,c:l,normal:new I,materialIndex:0};Po.getNormal(wo,So,Mo,u.normal),h.face=u}return h}var Sc=class r extends gn{constructor(t=1,e=1,n=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:s,depthSegments:o};let a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);let c=[],l=[],h=[],u=[],d=0,x=0;m("z","y","x",-1,-1,n,e,t,o,s,0),m("z","y","x",1,-1,n,e,-t,o,s,1),m("x","z","y",1,1,t,n,e,i,o,2),m("x","z","y",1,-1,t,n,-e,i,o,3),m("x","y","z",1,-1,t,e,n,i,s,4),m("x","y","z",-1,-1,t,e,-n,i,s,5),this.setIndex(c),this.setAttribute("position",new on(l,3)),this.setAttribute("normal",new on(h,3)),this.setAttribute("uv",new on(u,2));function m(g,f,p,v,E,C,b,A,w,S,_){let y=C/w,D=b/S,F=C/2,T=b/2,L=A/2,N=w+1,J=S+1,tt=0,G=0,X=new I;for(let st=0;st<J;st++){let ft=st*D-T;for(let mt=0;mt<N;mt++){let Jt=mt*y-F;X[g]=Jt*v,X[f]=ft*E,X[p]=L,l.push(X.x,X.y,X.z),X[g]=0,X[f]=0,X[p]=A>0?1:-1,h.push(X.x,X.y,X.z),u.push(mt/w),u.push(1-st/S),tt+=1}}for(let st=0;st<S;st++)for(let ft=0;ft<w;ft++){let mt=d+ft+N*st,Jt=d+ft+N*(st+1),q=d+(ft+1)+N*(st+1),O=d+(ft+1)+N*st;c.push(mt,Jt,O),c.push(Jt,q,O),G+=6}a.addGroup(x,G,_),x+=G,d+=tt}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new r(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}};function Ho(r){let t={};for(let e in r){t[e]={};for(let n in r[e]){let i=r[e][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][n]=null):t[e][n]=i.clone():Array.isArray(i)?t[e][n]=i.slice():t[e][n]=i}}return t}function In(r){let t={};for(let e=0;e<r.length;e++){let n=Ho(r[e]);for(let i in n)t[i]=n[i]}return t}function qb(r){let t=[];for(let e=0;e<r.length;e++)t.push(r[e].clone());return t}function $v(r){let t=r.getRenderTarget();return t===null?r.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:Oe.workingColorSpace}var $b={clone:Ho,merge:In},Zb=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Jb=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,$i=class extends xi{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Zb,this.fragmentShader=Jb,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ho(t.uniforms),this.uniformsGroups=qb(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){let e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(let i in this.uniforms){let o=this.uniforms[i].value;o&&o.isTexture?e.uniforms[i]={type:"t",value:o.toJSON(t).uuid}:o&&o.isColor?e.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?e.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?e.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?e.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?e.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?e.uniforms[i]={type:"m4",value:o.toArray()}:e.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;let n={};for(let i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}},Ch=class extends Bi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Kt,this.projectionMatrix=new Kt,this.projectionMatrixInverse=new Kt,this.coordinateSystem=fr}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Lr=new I,nv=new Zt,iv=new Zt,Tn=class extends Ch{constructor(t=50,e=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){let e=.5*this.getFilmHeight()/t;this.fov=Ac*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){let t=Math.tan(vc*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Ac*2*Math.atan(Math.tan(vc*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){Lr.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Lr.x,Lr.y).multiplyScalar(-t/Lr.z),Lr.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Lr.x,Lr.y).multiplyScalar(-t/Lr.z)}getViewSize(t,e){return this.getViewBounds(t,nv,iv),e.subVectors(iv,nv)}setViewOffset(t,e,n,i,s,o){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=this.near,e=t*Math.tan(vc*.5*this.fov)/this.zoom,n=2*e,i=this.aspect*n,s=-.5*i,o=this.view;if(this.view!==null&&this.view.enabled){let c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*i/c,e-=o.offsetY*n/l,i*=o.width/c,n*=o.height/l}let a=this.filmOffset;a!==0&&(s+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}},Do=-90,Bo=1,Qd=class extends Bi{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;let i=new Tn(Do,Bo,t,e);i.layers=this.layers,this.add(i);let s=new Tn(Do,Bo,t,e);s.layers=this.layers,this.add(s);let o=new Tn(Do,Bo,t,e);o.layers=this.layers,this.add(o);let a=new Tn(Do,Bo,t,e);a.layers=this.layers,this.add(a);let c=new Tn(Do,Bo,t,e);c.layers=this.layers,this.add(c);let l=new Tn(Do,Bo,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){let t=this.coordinateSystem,e=this.children.concat(),[n,i,s,o,a,c]=e;for(let l of e)this.remove(l);if(t===fr)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(t===ph)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(let l of e)this.add(l),l.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();let{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());let[s,o,a,c,l,h]=this.children,u=t.getRenderTarget(),d=t.getActiveCubeFace(),x=t.getActiveMipmapLevel(),m=t.xr.enabled;t.xr.enabled=!1;let g=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,i),t.render(e,s),t.setRenderTarget(n,1,i),t.render(e,o),t.setRenderTarget(n,2,i),t.render(e,a),t.setRenderTarget(n,3,i),t.render(e,c),t.setRenderTarget(n,4,i),t.render(e,l),n.texture.generateMipmaps=g,t.setRenderTarget(n,5,i),t.render(e,h),t.setRenderTarget(u,d,x),t.xr.enabled=m,n.texture.needsPMREMUpdate=!0}},yh=class extends jr{constructor(t,e,n,i,s,o,a,c,l,h){t=t!==void 0?t:[],e=e!==void 0?e:No,super(t,e,n,i,s,o,a,c,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}},tx=class extends pr{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;let n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];this.texture=new yh(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:Mi}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;let n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Sc(5,5,5),s=new $i({name:"CubemapFromEquirect",uniforms:Ho(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:jn,blending:zr});s.uniforms.tEquirect.value=e;let o=new Wn(i,s),a=e.minFilter;return e.minFilter===Fs&&(e.minFilter=Mi),new Qd(1,10,this).update(t,o),e.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(t,e,n,i){let s=t.getRenderTarget();for(let o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,n,i);t.setRenderTarget(s)}},Od=new I,Kb=new I,Qb=new ae,dr=class{constructor(t=new I(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){let i=Od.subVectors(n,e).cross(Kb.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){let t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){let n=t.delta(Od),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;let s=-(t.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:e.copy(t.start).addScaledVector(n,s)}intersectsLine(t){let e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){let n=e||Qb.getNormalMatrix(t),i=this.coplanarPoint(Od).applyMatrix4(t),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}},bs=new gr,eh=new I,Mc=class{constructor(t=new dr,e=new dr,n=new dr,i=new dr,s=new dr,o=new dr){this.planes=[t,e,n,i,s,o]}set(t,e,n,i,s,o){let a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(t){let e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=fr){let n=this.planes,i=t.elements,s=i[0],o=i[1],a=i[2],c=i[3],l=i[4],h=i[5],u=i[6],d=i[7],x=i[8],m=i[9],g=i[10],f=i[11],p=i[12],v=i[13],E=i[14],C=i[15];if(n[0].setComponents(c-s,d-l,f-x,C-p).normalize(),n[1].setComponents(c+s,d+l,f+x,C+p).normalize(),n[2].setComponents(c+o,d+h,f+m,C+v).normalize(),n[3].setComponents(c-o,d-h,f-m,C-v).normalize(),n[4].setComponents(c-a,d-u,f-g,C-E).normalize(),e===fr)n[5].setComponents(c+a,d+u,f+g,C+E).normalize();else if(e===ph)n[5].setComponents(a,u,g,E).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),bs.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{let e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),bs.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(bs)}intersectsSprite(t){return bs.center.set(0,0,0),bs.radius=.7071067811865476,bs.applyMatrix4(t.matrixWorld),this.intersectsSphere(bs)}intersectsSphere(t){let e=this.planes,n=t.center,i=-t.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(n)<i)return!1;return!0}intersectsBox(t){let e=this.planes;for(let n=0;n<6;n++){let i=e[n];if(eh.x=i.normal.x>0?t.max.x:t.min.x,eh.y=i.normal.y>0?t.max.y:t.min.y,eh.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(eh)<0)return!1}return!0}containsPoint(t){let e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function Zv(){let r=null,t=!1,e=null,n=null;function i(s,o){e(s,o),n=r.requestAnimationFrame(i)}return{start:function(){t!==!0&&e!==null&&(n=r.requestAnimationFrame(i),t=!0)},stop:function(){r.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(s){e=s},setContext:function(s){r=s}}}function t2(r){let t=new WeakMap;function e(a,c){let l=a.array,h=a.usage,u=l.byteLength,d=r.createBuffer();r.bindBuffer(c,d),r.bufferData(c,l,h),a.onUploadCallback();let x;if(l instanceof Float32Array)x=r.FLOAT;else if(l instanceof Uint16Array)a.isFloat16BufferAttribute?x=r.HALF_FLOAT:x=r.UNSIGNED_SHORT;else if(l instanceof Int16Array)x=r.SHORT;else if(l instanceof Uint32Array)x=r.UNSIGNED_INT;else if(l instanceof Int32Array)x=r.INT;else if(l instanceof Int8Array)x=r.BYTE;else if(l instanceof Uint8Array)x=r.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)x=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:d,type:x,bytesPerElement:l.BYTES_PER_ELEMENT,version:a.version,size:u}}function n(a,c,l){let h=c.array,u=c._updateRange,d=c.updateRanges;if(r.bindBuffer(l,a),u.count===-1&&d.length===0&&r.bufferSubData(l,0,h),d.length!==0){for(let x=0,m=d.length;x<m;x++){let g=d[x];r.bufferSubData(l,g.start*h.BYTES_PER_ELEMENT,h,g.start,g.count)}c.clearUpdateRanges()}u.count!==-1&&(r.bufferSubData(l,u.offset*h.BYTES_PER_ELEMENT,h,u.offset,u.count),u.count=-1),c.onUploadCallback()}function i(a){return a.isInterleavedBufferAttribute&&(a=a.data),t.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);let c=t.get(a);c&&(r.deleteBuffer(c.buffer),t.delete(a))}function o(a,c){if(a.isGLBufferAttribute){let h=t.get(a);(!h||h.version<a.version)&&t.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}a.isInterleavedBufferAttribute&&(a=a.data);let l=t.get(a);if(l===void 0)t.set(a,e(a,c));else if(l.version<a.version){if(l.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(l.buffer,a,c),l.version=a.version}}return{get:i,remove:s,update:o}}var Ah=class r extends gn{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};let s=t/2,o=e/2,a=Math.floor(n),c=Math.floor(i),l=a+1,h=c+1,u=t/a,d=e/c,x=[],m=[],g=[],f=[];for(let p=0;p<h;p++){let v=p*d-o;for(let E=0;E<l;E++){let C=E*u-s;m.push(C,-v,0),g.push(0,0,1),f.push(E/a),f.push(1-p/c)}}for(let p=0;p<c;p++)for(let v=0;v<a;v++){let E=v+l*p,C=v+l*(p+1),b=v+1+l*(p+1),A=v+1+l*p;x.push(E,C,A),x.push(C,b,A)}this.setIndex(x),this.setAttribute("position",new on(m,3)),this.setAttribute("normal",new on(g,3)),this.setAttribute("uv",new on(f,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new r(t.width,t.height,t.widthSegments,t.heightSegments)}},e2=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,n2=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,i2=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,r2=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,s2=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,o2=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,a2=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,c2=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,l2=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,h2=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,u2=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,d2=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,x2=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,f2=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,p2=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,m2=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,g2=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,v2=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,E2=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,_2=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,C2=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,y2=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,A2=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,b2=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,w2=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,S2=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,M2=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,D2=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,B2=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,T2=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,F2="gl_FragColor = linearToOutputTexel( gl_FragColor );",P2=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,R2=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,k2=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,O2=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,I2=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,L2=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,N2=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,U2=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,z2=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,V2=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,H2=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,G2=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,W2=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,j2=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,X2=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Y2=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,q2=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,$2=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Z2=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,J2=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,K2=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Q2=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,tw=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,ew=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,nw=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,iw=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,rw=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,sw=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,ow=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,aw=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,cw=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,lw=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,hw=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,uw=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,dw=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,xw=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,fw=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,pw=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,mw=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,gw=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,vw=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Ew=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,_w=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Cw=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,yw=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Aw=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,bw=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,ww=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Sw=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Mw=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Dw=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Bw=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Tw=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Fw=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Pw=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Rw=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,kw=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Ow=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Iw=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,Lw=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Nw=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Uw=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,zw=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Vw=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Hw=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Gw=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Ww=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,jw=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Xw=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Yw=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,qw=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,$w=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Zw=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Jw=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Kw=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Qw=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,tS=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,eS=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,nS=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,iS=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,rS=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,sS=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,oS=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,aS=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,cS=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,lS=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,hS=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,uS=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,dS=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,xS=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,fS=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,pS=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mS=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gS=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vS=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ES=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_S=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,CS=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,yS=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,AS=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bS=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,wS=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,SS=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,MS=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,DS=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,BS=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,TS=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,FS=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,PS=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,RS=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,oe={alphahash_fragment:e2,alphahash_pars_fragment:n2,alphamap_fragment:i2,alphamap_pars_fragment:r2,alphatest_fragment:s2,alphatest_pars_fragment:o2,aomap_fragment:a2,aomap_pars_fragment:c2,batching_pars_vertex:l2,batching_vertex:h2,begin_vertex:u2,beginnormal_vertex:d2,bsdfs:x2,iridescence_fragment:f2,bumpmap_pars_fragment:p2,clipping_planes_fragment:m2,clipping_planes_pars_fragment:g2,clipping_planes_pars_vertex:v2,clipping_planes_vertex:E2,color_fragment:_2,color_pars_fragment:C2,color_pars_vertex:y2,color_vertex:A2,common:b2,cube_uv_reflection_fragment:w2,defaultnormal_vertex:S2,displacementmap_pars_vertex:M2,displacementmap_vertex:D2,emissivemap_fragment:B2,emissivemap_pars_fragment:T2,colorspace_fragment:F2,colorspace_pars_fragment:P2,envmap_fragment:R2,envmap_common_pars_fragment:k2,envmap_pars_fragment:O2,envmap_pars_vertex:I2,envmap_physical_pars_fragment:Y2,envmap_vertex:L2,fog_vertex:N2,fog_pars_vertex:U2,fog_fragment:z2,fog_pars_fragment:V2,gradientmap_pars_fragment:H2,lightmap_pars_fragment:G2,lights_lambert_fragment:W2,lights_lambert_pars_fragment:j2,lights_pars_begin:X2,lights_toon_fragment:q2,lights_toon_pars_fragment:$2,lights_phong_fragment:Z2,lights_phong_pars_fragment:J2,lights_physical_fragment:K2,lights_physical_pars_fragment:Q2,lights_fragment_begin:tw,lights_fragment_maps:ew,lights_fragment_end:nw,logdepthbuf_fragment:iw,logdepthbuf_pars_fragment:rw,logdepthbuf_pars_vertex:sw,logdepthbuf_vertex:ow,map_fragment:aw,map_pars_fragment:cw,map_particle_fragment:lw,map_particle_pars_fragment:hw,metalnessmap_fragment:uw,metalnessmap_pars_fragment:dw,morphinstance_vertex:xw,morphcolor_vertex:fw,morphnormal_vertex:pw,morphtarget_pars_vertex:mw,morphtarget_vertex:gw,normal_fragment_begin:vw,normal_fragment_maps:Ew,normal_pars_fragment:_w,normal_pars_vertex:Cw,normal_vertex:yw,normalmap_pars_fragment:Aw,clearcoat_normal_fragment_begin:bw,clearcoat_normal_fragment_maps:ww,clearcoat_pars_fragment:Sw,iridescence_pars_fragment:Mw,opaque_fragment:Dw,packing:Bw,premultiplied_alpha_fragment:Tw,project_vertex:Fw,dithering_fragment:Pw,dithering_pars_fragment:Rw,roughnessmap_fragment:kw,roughnessmap_pars_fragment:Ow,shadowmap_pars_fragment:Iw,shadowmap_pars_vertex:Lw,shadowmap_vertex:Nw,shadowmask_pars_fragment:Uw,skinbase_vertex:zw,skinning_pars_vertex:Vw,skinning_vertex:Hw,skinnormal_vertex:Gw,specularmap_fragment:Ww,specularmap_pars_fragment:jw,tonemapping_fragment:Xw,tonemapping_pars_fragment:Yw,transmission_fragment:qw,transmission_pars_fragment:$w,uv_pars_fragment:Zw,uv_pars_vertex:Jw,uv_vertex:Kw,worldpos_vertex:Qw,background_vert:tS,background_frag:eS,backgroundCube_vert:nS,backgroundCube_frag:iS,cube_vert:rS,cube_frag:sS,depth_vert:oS,depth_frag:aS,distanceRGBA_vert:cS,distanceRGBA_frag:lS,equirect_vert:hS,equirect_frag:uS,linedashed_vert:dS,linedashed_frag:xS,meshbasic_vert:fS,meshbasic_frag:pS,meshlambert_vert:mS,meshlambert_frag:gS,meshmatcap_vert:vS,meshmatcap_frag:ES,meshnormal_vert:_S,meshnormal_frag:CS,meshphong_vert:yS,meshphong_frag:AS,meshphysical_vert:bS,meshphysical_frag:wS,meshtoon_vert:SS,meshtoon_frag:MS,points_vert:DS,points_frag:BS,shadow_vert:TS,shadow_frag:FS,sprite_vert:PS,sprite_frag:RS},_t={common:{diffuse:{value:new $t(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ae},alphaMap:{value:null},alphaMapTransform:{value:new ae},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ae}},envmap:{envMap:{value:null},envMapRotation:{value:new ae},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ae}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ae}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ae},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ae},normalScale:{value:new Zt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ae},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ae}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ae}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ae}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new $t(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new $t(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ae},alphaTest:{value:0},uvTransform:{value:new ae}},sprite:{diffuse:{value:new $t(16777215)},opacity:{value:1},center:{value:new Zt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ae},alphaMap:{value:null},alphaMapTransform:{value:new ae},alphaTest:{value:0}}},Wi={basic:{uniforms:In([_t.common,_t.specularmap,_t.envmap,_t.aomap,_t.lightmap,_t.fog]),vertexShader:oe.meshbasic_vert,fragmentShader:oe.meshbasic_frag},lambert:{uniforms:In([_t.common,_t.specularmap,_t.envmap,_t.aomap,_t.lightmap,_t.emissivemap,_t.bumpmap,_t.normalmap,_t.displacementmap,_t.fog,_t.lights,{emissive:{value:new $t(0)}}]),vertexShader:oe.meshlambert_vert,fragmentShader:oe.meshlambert_frag},phong:{uniforms:In([_t.common,_t.specularmap,_t.envmap,_t.aomap,_t.lightmap,_t.emissivemap,_t.bumpmap,_t.normalmap,_t.displacementmap,_t.fog,_t.lights,{emissive:{value:new $t(0)},specular:{value:new $t(1118481)},shininess:{value:30}}]),vertexShader:oe.meshphong_vert,fragmentShader:oe.meshphong_frag},standard:{uniforms:In([_t.common,_t.envmap,_t.aomap,_t.lightmap,_t.emissivemap,_t.bumpmap,_t.normalmap,_t.displacementmap,_t.roughnessmap,_t.metalnessmap,_t.fog,_t.lights,{emissive:{value:new $t(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:oe.meshphysical_vert,fragmentShader:oe.meshphysical_frag},toon:{uniforms:In([_t.common,_t.aomap,_t.lightmap,_t.emissivemap,_t.bumpmap,_t.normalmap,_t.displacementmap,_t.gradientmap,_t.fog,_t.lights,{emissive:{value:new $t(0)}}]),vertexShader:oe.meshtoon_vert,fragmentShader:oe.meshtoon_frag},matcap:{uniforms:In([_t.common,_t.bumpmap,_t.normalmap,_t.displacementmap,_t.fog,{matcap:{value:null}}]),vertexShader:oe.meshmatcap_vert,fragmentShader:oe.meshmatcap_frag},points:{uniforms:In([_t.points,_t.fog]),vertexShader:oe.points_vert,fragmentShader:oe.points_frag},dashed:{uniforms:In([_t.common,_t.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:oe.linedashed_vert,fragmentShader:oe.linedashed_frag},depth:{uniforms:In([_t.common,_t.displacementmap]),vertexShader:oe.depth_vert,fragmentShader:oe.depth_frag},normal:{uniforms:In([_t.common,_t.bumpmap,_t.normalmap,_t.displacementmap,{opacity:{value:1}}]),vertexShader:oe.meshnormal_vert,fragmentShader:oe.meshnormal_frag},sprite:{uniforms:In([_t.sprite,_t.fog]),vertexShader:oe.sprite_vert,fragmentShader:oe.sprite_frag},background:{uniforms:{uvTransform:{value:new ae},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:oe.background_vert,fragmentShader:oe.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new ae}},vertexShader:oe.backgroundCube_vert,fragmentShader:oe.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:oe.cube_vert,fragmentShader:oe.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:oe.equirect_vert,fragmentShader:oe.equirect_frag},distanceRGBA:{uniforms:In([_t.common,_t.displacementmap,{referencePosition:{value:new I},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:oe.distanceRGBA_vert,fragmentShader:oe.distanceRGBA_frag},shadow:{uniforms:In([_t.lights,_t.fog,{color:{value:new $t(0)},opacity:{value:1}}]),vertexShader:oe.shadow_vert,fragmentShader:oe.shadow_frag}};Wi.physical={uniforms:In([Wi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ae},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ae},clearcoatNormalScale:{value:new Zt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ae},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ae},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ae},sheen:{value:0},sheenColor:{value:new $t(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ae},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ae},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ae},transmissionSamplerSize:{value:new Zt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ae},attenuationDistance:{value:0},attenuationColor:{value:new $t(0)},specularColor:{value:new $t(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ae},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ae},anisotropyVector:{value:new Zt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ae}}]),vertexShader:oe.meshphysical_vert,fragmentShader:oe.meshphysical_frag};var nh={r:0,b:0,g:0},ws=new Ps,kS=new Kt;function OS(r,t,e,n,i,s,o){let a=new $t(0),c=s===!0?0:1,l,h,u=null,d=0,x=null;function m(v){let E=v.isScene===!0?v.background:null;return E&&E.isTexture&&(E=(v.backgroundBlurriness>0?e:t).get(E)),E}function g(v){let E=!1,C=m(v);C===null?p(a,c):C&&C.isColor&&(p(C,1),E=!0);let b=r.xr.getEnvironmentBlendMode();b==="additive"?n.buffers.color.setClear(0,0,0,1,o):b==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(r.autoClear||E)&&r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil)}function f(v,E){let C=m(E);C&&(C.isCubeTexture||C.mapping===Lh)?(h===void 0&&(h=new Wn(new Sc(1,1,1),new $i({name:"BackgroundCubeMaterial",uniforms:Ho(Wi.backgroundCube.uniforms),vertexShader:Wi.backgroundCube.vertexShader,fragmentShader:Wi.backgroundCube.fragmentShader,side:jn,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(b,A,w){this.matrixWorld.copyPosition(w.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(h)),ws.copy(E.backgroundRotation),ws.x*=-1,ws.y*=-1,ws.z*=-1,C.isCubeTexture&&C.isRenderTargetTexture===!1&&(ws.y*=-1,ws.z*=-1),h.material.uniforms.envMap.value=C,h.material.uniforms.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=E.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(kS.makeRotationFromEuler(ws)),h.material.toneMapped=Oe.getTransfer(C.colorSpace)!==He,(u!==C||d!==C.version||x!==r.toneMapping)&&(h.material.needsUpdate=!0,u=C,d=C.version,x=r.toneMapping),h.layers.enableAll(),v.unshift(h,h.geometry,h.material,0,0,null)):C&&C.isTexture&&(l===void 0&&(l=new Wn(new Ah(2,2),new $i({name:"BackgroundMaterial",uniforms:Ho(Wi.background.uniforms),vertexShader:Wi.background.vertexShader,fragmentShader:Wi.background.fragmentShader,side:Yi,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=C,l.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,l.material.toneMapped=Oe.getTransfer(C.colorSpace)!==He,C.matrixAutoUpdate===!0&&C.updateMatrix(),l.material.uniforms.uvTransform.value.copy(C.matrix),(u!==C||d!==C.version||x!==r.toneMapping)&&(l.material.needsUpdate=!0,u=C,d=C.version,x=r.toneMapping),l.layers.enableAll(),v.unshift(l,l.geometry,l.material,0,0,null))}function p(v,E){v.getRGB(nh,$v(r)),n.buffers.color.setClear(nh.r,nh.g,nh.b,E,o)}return{getClearColor:function(){return a},setClearColor:function(v,E=1){a.set(v),c=E,p(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(v){c=v,p(a,c)},render:g,addToRenderList:f}}function IS(r,t){let e=r.getParameter(r.MAX_VERTEX_ATTRIBS),n={},i=d(null),s=i,o=!1;function a(y,D,F,T,L){let N=!1,J=u(T,F,D);s!==J&&(s=J,l(s.object)),N=x(y,T,F,L),N&&m(y,T,F,L),L!==null&&t.update(L,r.ELEMENT_ARRAY_BUFFER),(N||o)&&(o=!1,C(y,D,F,T),L!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.get(L).buffer))}function c(){return r.createVertexArray()}function l(y){return r.bindVertexArray(y)}function h(y){return r.deleteVertexArray(y)}function u(y,D,F){let T=F.wireframe===!0,L=n[y.id];L===void 0&&(L={},n[y.id]=L);let N=L[D.id];N===void 0&&(N={},L[D.id]=N);let J=N[T];return J===void 0&&(J=d(c()),N[T]=J),J}function d(y){let D=[],F=[],T=[];for(let L=0;L<e;L++)D[L]=0,F[L]=0,T[L]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:D,enabledAttributes:F,attributeDivisors:T,object:y,attributes:{},index:null}}function x(y,D,F,T){let L=s.attributes,N=D.attributes,J=0,tt=F.getAttributes();for(let G in tt)if(tt[G].location>=0){let st=L[G],ft=N[G];if(ft===void 0&&(G==="instanceMatrix"&&y.instanceMatrix&&(ft=y.instanceMatrix),G==="instanceColor"&&y.instanceColor&&(ft=y.instanceColor)),st===void 0||st.attribute!==ft||ft&&st.data!==ft.data)return!0;J++}return s.attributesNum!==J||s.index!==T}function m(y,D,F,T){let L={},N=D.attributes,J=0,tt=F.getAttributes();for(let G in tt)if(tt[G].location>=0){let st=N[G];st===void 0&&(G==="instanceMatrix"&&y.instanceMatrix&&(st=y.instanceMatrix),G==="instanceColor"&&y.instanceColor&&(st=y.instanceColor));let ft={};ft.attribute=st,st&&st.data&&(ft.data=st.data),L[G]=ft,J++}s.attributes=L,s.attributesNum=J,s.index=T}function g(){let y=s.newAttributes;for(let D=0,F=y.length;D<F;D++)y[D]=0}function f(y){p(y,0)}function p(y,D){let F=s.newAttributes,T=s.enabledAttributes,L=s.attributeDivisors;F[y]=1,T[y]===0&&(r.enableVertexAttribArray(y),T[y]=1),L[y]!==D&&(r.vertexAttribDivisor(y,D),L[y]=D)}function v(){let y=s.newAttributes,D=s.enabledAttributes;for(let F=0,T=D.length;F<T;F++)D[F]!==y[F]&&(r.disableVertexAttribArray(F),D[F]=0)}function E(y,D,F,T,L,N,J){J===!0?r.vertexAttribIPointer(y,D,F,L,N):r.vertexAttribPointer(y,D,F,T,L,N)}function C(y,D,F,T){g();let L=T.attributes,N=F.getAttributes(),J=D.defaultAttributeValues;for(let tt in N){let G=N[tt];if(G.location>=0){let X=L[tt];if(X===void 0&&(tt==="instanceMatrix"&&y.instanceMatrix&&(X=y.instanceMatrix),tt==="instanceColor"&&y.instanceColor&&(X=y.instanceColor)),X!==void 0){let st=X.normalized,ft=X.itemSize,mt=t.get(X);if(mt===void 0)continue;let Jt=mt.buffer,q=mt.type,O=mt.bytesPerElement,V=q===r.INT||q===r.UNSIGNED_INT||X.gpuType===Uv;if(X.isInterleavedBufferAttribute){let k=X.data,K=k.stride,Y=X.offset;if(k.isInstancedInterleavedBuffer){for(let R=0;R<G.locationSize;R++)p(G.location+R,k.meshPerAttribute);y.isInstancedMesh!==!0&&T._maxInstanceCount===void 0&&(T._maxInstanceCount=k.meshPerAttribute*k.count)}else for(let R=0;R<G.locationSize;R++)f(G.location+R);r.bindBuffer(r.ARRAY_BUFFER,Jt);for(let R=0;R<G.locationSize;R++)E(G.location+R,ft/G.locationSize,q,st,K*O,(Y+ft/G.locationSize*R)*O,V)}else{if(X.isInstancedBufferAttribute){for(let k=0;k<G.locationSize;k++)p(G.location+k,X.meshPerAttribute);y.isInstancedMesh!==!0&&T._maxInstanceCount===void 0&&(T._maxInstanceCount=X.meshPerAttribute*X.count)}else for(let k=0;k<G.locationSize;k++)f(G.location+k);r.bindBuffer(r.ARRAY_BUFFER,Jt);for(let k=0;k<G.locationSize;k++)E(G.location+k,ft/G.locationSize,q,st,ft*O,ft/G.locationSize*k*O,V)}}else if(J!==void 0){let st=J[tt];if(st!==void 0)switch(st.length){case 2:r.vertexAttrib2fv(G.location,st);break;case 3:r.vertexAttrib3fv(G.location,st);break;case 4:r.vertexAttrib4fv(G.location,st);break;default:r.vertexAttrib1fv(G.location,st)}}}}v()}function b(){S();for(let y in n){let D=n[y];for(let F in D){let T=D[F];for(let L in T)h(T[L].object),delete T[L];delete D[F]}delete n[y]}}function A(y){if(n[y.id]===void 0)return;let D=n[y.id];for(let F in D){let T=D[F];for(let L in T)h(T[L].object),delete T[L];delete D[F]}delete n[y.id]}function w(y){for(let D in n){let F=n[D];if(F[y.id]===void 0)continue;let T=F[y.id];for(let L in T)h(T[L].object),delete T[L];delete F[y.id]}}function S(){_(),o=!0,s!==i&&(s=i,l(s.object))}function _(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:a,reset:S,resetDefaultState:_,dispose:b,releaseStatesOfGeometry:A,releaseStatesOfProgram:w,initAttributes:g,enableAttribute:f,disableUnusedAttributes:v}}function LS(r,t,e){let n;function i(l){n=l}function s(l,h){r.drawArrays(n,l,h),e.update(h,n,1)}function o(l,h,u){u!==0&&(r.drawArraysInstanced(n,l,h,u),e.update(h,n,u))}function a(l,h,u){if(u===0)return;let d=t.get("WEBGL_multi_draw");if(d===null)for(let x=0;x<u;x++)this.render(l[x],h[x]);else{d.multiDrawArraysWEBGL(n,l,0,h,0,u);let x=0;for(let m=0;m<u;m++)x+=h[m];e.update(x,n,1)}}function c(l,h,u,d){if(u===0)return;let x=t.get("WEBGL_multi_draw");if(x===null)for(let m=0;m<l.length;m++)o(l[m],h[m],d[m]);else{x.multiDrawArraysInstancedWEBGL(n,l,0,h,0,d,0,u);let m=0;for(let g=0;g<u;g++)m+=h[g];for(let g=0;g<d.length;g++)e.update(m,n,d[g])}}this.setMode=i,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=c}function NS(r,t,e,n){let i;function s(){if(i!==void 0)return i;if(t.has("EXT_texture_filter_anisotropic")===!0){let A=t.get("EXT_texture_filter_anisotropic");i=r.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(A){return!(A!==ji&&n.convert(A)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(A){let w=A===Nh&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(A!==Hr&&n.convert(A)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_TYPE)&&A!==Ur&&!w)}function c(A){if(A==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";A="mediump"}return A==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=e.precision!==void 0?e.precision:"highp",h=c(l);h!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",h,"instead."),l=h);let u=e.logarithmicDepthBuffer===!0,d=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),x=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=r.getParameter(r.MAX_TEXTURE_SIZE),g=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),f=r.getParameter(r.MAX_VERTEX_ATTRIBS),p=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),v=r.getParameter(r.MAX_VARYING_VECTORS),E=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),C=x>0,b=r.getParameter(r.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:a,precision:l,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:x,maxTextureSize:m,maxCubemapSize:g,maxAttributes:f,maxVertexUniforms:p,maxVaryings:v,maxFragmentUniforms:E,vertexTextures:C,maxSamples:b}}function US(r){let t=this,e=null,n=0,i=!1,s=!1,o=new dr,a=new ae,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d){let x=u.length!==0||d||n!==0||i;return i=d,n=u.length,x},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(u,d){e=h(u,d,0)},this.setState=function(u,d,x){let m=u.clippingPlanes,g=u.clipIntersection,f=u.clipShadows,p=r.get(u);if(!i||m===null||m.length===0||s&&!f)s?h(null):l();else{let v=s?0:n,E=v*4,C=p.clippingState||null;c.value=C,C=h(m,d,E,x);for(let b=0;b!==E;++b)C[b]=e[b];p.clippingState=C,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=v}};function l(){c.value!==e&&(c.value=e,c.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function h(u,d,x,m){let g=u!==null?u.length:0,f=null;if(g!==0){if(f=c.value,m!==!0||f===null){let p=x+g*4,v=d.matrixWorldInverse;a.getNormalMatrix(v),(f===null||f.length<p)&&(f=new Float32Array(p));for(let E=0,C=x;E!==g;++E,C+=4)o.copy(u[E]).applyMatrix4(v,a),o.normal.toArray(f,C),f[C+3]=o.constant}c.value=f,c.needsUpdate=!0}return t.numPlanes=g,t.numIntersection=0,f}}function zS(r){let t=new WeakMap;function e(o,a){return a===Yd?o.mapping=No:a===qd&&(o.mapping=Uo),o}function n(o){if(o&&o.isTexture){let a=o.mapping;if(a===Yd||a===qd)if(t.has(o)){let c=t.get(o).texture;return e(c,o.mapping)}else{let c=o.image;if(c&&c.height>0){let l=new tx(c.height);return l.fromEquirectangularTexture(r,o),t.set(o,l),o.addEventListener("dispose",i),e(l.texture,o.mapping)}else return null}}return o}function i(o){let a=o.target;a.removeEventListener("dispose",i);let c=t.get(a);c!==void 0&&(t.delete(a),c.dispose())}function s(){t=new WeakMap}return{get:n,dispose:s}}var ex=class extends Ch{constructor(t=-1,e=1,n=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,s=n-t,o=n+t,a=i+e,c=i-e;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=h*this.view.offsetY,c=a-h*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}},Ro=4,rv=[.125,.215,.35,.446,.526,.582],Bs=20,Id=new ex,sv=new $t,Ld=null,Nd=0,Ud=0,zd=!1,Ms=(1+Math.sqrt(5))/2,To=1/Ms,ov=[new I(-Ms,To,0),new I(Ms,To,0),new I(-To,0,Ms),new I(To,0,Ms),new I(0,Ms,-To),new I(0,Ms,To),new I(-1,1,-1),new I(1,1,-1),new I(-1,1,1),new I(1,1,1)],bh=class{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Ld=this._renderer.getRenderTarget(),Nd=this._renderer.getActiveCubeFace(),Ud=this._renderer.getActiveMipmapLevel(),zd=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);let s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,n,i,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=lv(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=cv(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Ld,Nd,Ud),this._renderer.xr.enabled=zd,t.scissorTest=!1,ih(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===No||t.mapping===Uo?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Ld=this._renderer.getRenderTarget(),Nd=this._renderer.getActiveCubeFace(),Ud=this._renderer.getActiveMipmapLevel(),zd=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;let n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){let t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:Mi,minFilter:Mi,generateMipmaps:!1,type:Nh,format:ji,colorSpace:Wr,depthBuffer:!1},i=av(t,e,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=av(t,e,n);let{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=VS(s)),this._blurMaterial=HS(s,t,e)}return i}_compileMaterial(t){let e=new Wn(this._lodPlanes[0],t);this._renderer.compile(e,Id)}_sceneToCubeUV(t,e,n,i){let a=new Tn(90,1,e,n),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],h=this._renderer,u=h.autoClear,d=h.toneMapping;h.getClearColor(sv),h.toneMapping=Vr,h.autoClear=!1;let x=new vh({name:"PMREM.Background",side:jn,depthWrite:!1,depthTest:!1}),m=new Wn(new Sc,x),g=!1,f=t.background;f?f.isColor&&(x.color.copy(f),t.background=null,g=!0):(x.color.copy(sv),g=!0);for(let p=0;p<6;p++){let v=p%3;v===0?(a.up.set(0,c[p],0),a.lookAt(l[p],0,0)):v===1?(a.up.set(0,0,c[p]),a.lookAt(0,l[p],0)):(a.up.set(0,c[p],0),a.lookAt(0,0,l[p]));let E=this._cubeSize;ih(i,v*E,p>2?E:0,E,E),h.setRenderTarget(i),g&&h.render(m,a),h.render(t,a)}m.geometry.dispose(),m.material.dispose(),h.toneMapping=d,h.autoClear=u,t.background=f}_textureToCubeUV(t,e){let n=this._renderer,i=t.mapping===No||t.mapping===Uo;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=lv()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=cv());let s=i?this._cubemapMaterial:this._equirectMaterial,o=new Wn(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=t;let c=this._cubeSize;ih(e,0,0,3*c,2*c),n.setRenderTarget(e),n.render(o,Id)}_applyPMREM(t){let e=this._renderer,n=e.autoClear;e.autoClear=!1;let i=this._lodPlanes.length;for(let s=1;s<i;s++){let o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=ov[(i-s-1)%ov.length];this._blur(t,s-1,s,o,a)}e.autoClear=n}_blur(t,e,n,i,s){let o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,i,"latitudinal",s),this._halfBlur(o,t,n,n,i,"longitudinal",s)}_halfBlur(t,e,n,i,s,o,a){let c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let h=3,u=new Wn(this._lodPlanes[i],l),d=l.uniforms,x=this._sizeLods[n]-1,m=isFinite(s)?Math.PI/(2*x):2*Math.PI/(2*Bs-1),g=s/m,f=isFinite(s)?1+Math.floor(h*g):Bs;f>Bs&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${Bs}`);let p=[],v=0;for(let w=0;w<Bs;++w){let S=w/g,_=Math.exp(-S*S/2);p.push(_),w===0?v+=_:w<f&&(v+=2*_)}for(let w=0;w<p.length;w++)p[w]=p[w]/v;d.envMap.value=t.texture,d.samples.value=f,d.weights.value=p,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);let{_lodMax:E}=this;d.dTheta.value=m,d.mipInt.value=E-n;let C=this._sizeLods[i],b=3*C*(i>E-Ro?i-E+Ro:0),A=4*(this._cubeSize-C);ih(e,b,A,3*C,2*C),c.setRenderTarget(e),c.render(u,Id)}};function VS(r){let t=[],e=[],n=[],i=r,s=r-Ro+1+rv.length;for(let o=0;o<s;o++){let a=Math.pow(2,i);e.push(a);let c=1/a;o>r-Ro?c=rv[o-r+Ro-1]:o===0&&(c=0),n.push(c);let l=1/(a-2),h=-l,u=1+l,d=[h,h,u,h,u,u,h,h,u,u,h,u],x=6,m=6,g=3,f=2,p=1,v=new Float32Array(g*m*x),E=new Float32Array(f*m*x),C=new Float32Array(p*m*x);for(let A=0;A<x;A++){let w=A%3*2/3-1,S=A>2?0:-1,_=[w,S,0,w+2/3,S,0,w+2/3,S+1,0,w,S,0,w+2/3,S+1,0,w,S+1,0];v.set(_,g*m*A),E.set(d,f*m*A);let y=[A,A,A,A,A,A];C.set(y,p*m*A)}let b=new gn;b.setAttribute("position",new ui(v,g)),b.setAttribute("uv",new ui(E,f)),b.setAttribute("faceIndex",new ui(C,p)),t.push(b),i>Ro&&i--}return{lodPlanes:t,sizeLods:e,sigmas:n}}function av(r,t,e){let n=new pr(r,t,e);return n.texture.mapping=Lh,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function ih(r,t,e,n,i){r.viewport.set(t,e,n,i),r.scissor.set(t,e,n,i)}function HS(r,t,e){let n=new Float32Array(Bs),i=new I(0,1,0);return new $i({name:"SphericalGaussianBlur",defines:{n:Bs,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:kx(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:zr,depthTest:!1,depthWrite:!1})}function cv(){return new $i({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:kx(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:zr,depthTest:!1,depthWrite:!1})}function lv(){return new $i({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:kx(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:zr,depthTest:!1,depthWrite:!1})}function kx(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function GS(r){let t=new WeakMap,e=null;function n(a){if(a&&a.isTexture){let c=a.mapping,l=c===Yd||c===qd,h=c===No||c===Uo;if(l||h){let u=t.get(a),d=u!==void 0?u.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==d)return e===null&&(e=new bh(r)),u=l?e.fromEquirectangular(a,u):e.fromCubemap(a,u),u.texture.pmremVersion=a.pmremVersion,t.set(a,u),u.texture;if(u!==void 0)return u.texture;{let x=a.image;return l&&x&&x.height>0||h&&x&&i(x)?(e===null&&(e=new bh(r)),u=l?e.fromEquirectangular(a):e.fromCubemap(a),u.texture.pmremVersion=a.pmremVersion,t.set(a,u),a.addEventListener("dispose",s),u.texture):null}}}return a}function i(a){let c=0,l=6;for(let h=0;h<l;h++)a[h]!==void 0&&c++;return c===l}function s(a){let c=a.target;c.removeEventListener("dispose",s);let l=t.get(c);l!==void 0&&(t.delete(c),l.dispose())}function o(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:n,dispose:o}}function WS(r){let t={};function e(n){if(t[n]!==void 0)return t[n];let i;switch(n){case"WEBGL_depth_texture":i=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=r.getExtension(n)}return t[n]=i,i}return{has:function(n){return e(n)!==null},init:function(){e("EXT_color_buffer_float"),e("WEBGL_clip_cull_distance"),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture"),e("WEBGL_render_shared_exponent")},get:function(n){let i=e(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function jS(r,t,e,n){let i={},s=new WeakMap;function o(u){let d=u.target;d.index!==null&&t.remove(d.index);for(let m in d.attributes)t.remove(d.attributes[m]);for(let m in d.morphAttributes){let g=d.morphAttributes[m];for(let f=0,p=g.length;f<p;f++)t.remove(g[f])}d.removeEventListener("dispose",o),delete i[d.id];let x=s.get(d);x&&(t.remove(x),s.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,e.memory.geometries--}function a(u,d){return i[d.id]===!0||(d.addEventListener("dispose",o),i[d.id]=!0,e.memory.geometries++),d}function c(u){let d=u.attributes;for(let m in d)t.update(d[m],r.ARRAY_BUFFER);let x=u.morphAttributes;for(let m in x){let g=x[m];for(let f=0,p=g.length;f<p;f++)t.update(g[f],r.ARRAY_BUFFER)}}function l(u){let d=[],x=u.index,m=u.attributes.position,g=0;if(x!==null){let v=x.array;g=x.version;for(let E=0,C=v.length;E<C;E+=3){let b=v[E+0],A=v[E+1],w=v[E+2];d.push(b,A,A,w,w,b)}}else if(m!==void 0){let v=m.array;g=m.version;for(let E=0,C=v.length/3-1;E<C;E+=3){let b=E+0,A=E+1,w=E+2;d.push(b,A,A,w,w,b)}}else return;let f=new(Yv(d)?_h:Eh)(d,1);f.version=g;let p=s.get(u);p&&t.remove(p),s.set(u,f)}function h(u){let d=s.get(u);if(d){let x=u.index;x!==null&&d.version<x.version&&l(u)}else l(u);return s.get(u)}return{get:a,update:c,getWireframeAttribute:h}}function XS(r,t,e){let n;function i(d){n=d}let s,o;function a(d){s=d.type,o=d.bytesPerElement}function c(d,x){r.drawElements(n,x,s,d*o),e.update(x,n,1)}function l(d,x,m){m!==0&&(r.drawElementsInstanced(n,x,s,d*o,m),e.update(x,n,m))}function h(d,x,m){if(m===0)return;let g=t.get("WEBGL_multi_draw");if(g===null)for(let f=0;f<m;f++)this.render(d[f]/o,x[f]);else{g.multiDrawElementsWEBGL(n,x,0,s,d,0,m);let f=0;for(let p=0;p<m;p++)f+=x[p];e.update(f,n,1)}}function u(d,x,m,g){if(m===0)return;let f=t.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<d.length;p++)l(d[p]/o,x[p],g[p]);else{f.multiDrawElementsInstancedWEBGL(n,x,0,s,d,0,g,0,m);let p=0;for(let v=0;v<m;v++)p+=x[v];for(let v=0;v<g.length;v++)e.update(p,n,g[v])}}this.setMode=i,this.setIndex=a,this.render=c,this.renderInstances=l,this.renderMultiDraw=h,this.renderMultiDrawInstances=u}function YS(r){let t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(e.calls++,o){case r.TRIANGLES:e.triangles+=a*(s/3);break;case r.LINES:e.lines+=a*(s/2);break;case r.LINE_STRIP:e.lines+=a*(s-1);break;case r.LINE_LOOP:e.lines+=a*s;break;case r.POINTS:e.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:i,update:n}}function qS(r,t,e){let n=new WeakMap,i=new je;function s(o,a,c){let l=o.morphTargetInfluences,h=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,u=h!==void 0?h.length:0,d=n.get(a);if(d===void 0||d.count!==u){let y=function(){S.dispose(),n.delete(a),a.removeEventListener("dispose",y)};var x=y;d!==void 0&&d.texture.dispose();let m=a.morphAttributes.position!==void 0,g=a.morphAttributes.normal!==void 0,f=a.morphAttributes.color!==void 0,p=a.morphAttributes.position||[],v=a.morphAttributes.normal||[],E=a.morphAttributes.color||[],C=0;m===!0&&(C=1),g===!0&&(C=2),f===!0&&(C=3);let b=a.attributes.position.count*C,A=1;b>t.maxTextureSize&&(A=Math.ceil(b/t.maxTextureSize),b=t.maxTextureSize);let w=new Float32Array(b*A*4*u),S=new gh(w,b,A,u);S.type=Ur,S.needsUpdate=!0;let _=C*4;for(let D=0;D<u;D++){let F=p[D],T=v[D],L=E[D],N=b*A*4*D;for(let J=0;J<F.count;J++){let tt=J*_;m===!0&&(i.fromBufferAttribute(F,J),w[N+tt+0]=i.x,w[N+tt+1]=i.y,w[N+tt+2]=i.z,w[N+tt+3]=0),g===!0&&(i.fromBufferAttribute(T,J),w[N+tt+4]=i.x,w[N+tt+5]=i.y,w[N+tt+6]=i.z,w[N+tt+7]=0),f===!0&&(i.fromBufferAttribute(L,J),w[N+tt+8]=i.x,w[N+tt+9]=i.y,w[N+tt+10]=i.z,w[N+tt+11]=L.itemSize===4?i.w:1)}}d={count:u,texture:S,size:new Zt(b,A)},n.set(a,d),a.addEventListener("dispose",y)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(r,"morphTexture",o.morphTexture,e);else{let m=0;for(let f=0;f<l.length;f++)m+=l[f];let g=a.morphTargetsRelative?1:1-m;c.getUniforms().setValue(r,"morphTargetBaseInfluence",g),c.getUniforms().setValue(r,"morphTargetInfluences",l)}c.getUniforms().setValue(r,"morphTargetsTexture",d.texture,e),c.getUniforms().setValue(r,"morphTargetsTextureSize",d.size)}return{update:s}}function $S(r,t,e,n){let i=new WeakMap;function s(c){let l=n.render.frame,h=c.geometry,u=t.get(c,h);if(i.get(u)!==l&&(t.update(u),i.set(u,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),i.get(c)!==l&&(e.update(c.instanceMatrix,r.ARRAY_BUFFER),c.instanceColor!==null&&e.update(c.instanceColor,r.ARRAY_BUFFER),i.set(c,l))),c.isSkinnedMesh){let d=c.skeleton;i.get(d)!==l&&(d.update(),i.set(d,l))}return u}function o(){i=new WeakMap}function a(c){let l=c.target;l.removeEventListener("dispose",a),e.remove(l.instanceMatrix),l.instanceColor!==null&&e.remove(l.instanceColor)}return{update:s,dispose:o}}var wh=class extends jr{constructor(t,e,n,i,s,o,a,c,l,h){if(h=h!==void 0?h:Oo,h!==Oo&&h!==yc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&h===Oo&&(n=zo),n===void 0&&h===yc&&(n=Bc),super(null,i,s,o,a,c,h,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:hi,this.minFilter=c!==void 0?c:hi,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){let e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}},Jv=new jr,Kv=new wh(1,1);Kv.compareFunction=Xv;var Qv=new gh,tE=new Kd,eE=new yh,hv=[],uv=[],dv=new Float32Array(16),xv=new Float32Array(9),fv=new Float32Array(4);function $o(r,t,e){let n=r[0];if(n<=0||n>0)return r;let i=t*e,s=hv[i];if(s===void 0&&(s=new Float32Array(i),hv[i]=s),t!==0){n.toArray(s,0);for(let o=1,a=0;o!==t;++o)a+=e,r[o].toArray(s,a)}return s}function hn(r,t){if(r.length!==t.length)return!1;for(let e=0,n=r.length;e<n;e++)if(r[e]!==t[e])return!1;return!0}function un(r,t){for(let e=0,n=t.length;e<n;e++)r[e]=t[e]}function zh(r,t){let e=uv[t];e===void 0&&(e=new Int32Array(t),uv[t]=e);for(let n=0;n!==t;++n)e[n]=r.allocateTextureUnit();return e}function ZS(r,t){let e=this.cache;e[0]!==t&&(r.uniform1f(this.addr,t),e[0]=t)}function JS(r,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(r.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(hn(e,t))return;r.uniform2fv(this.addr,t),un(e,t)}}function KS(r,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(r.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(r.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(hn(e,t))return;r.uniform3fv(this.addr,t),un(e,t)}}function QS(r,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(r.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(hn(e,t))return;r.uniform4fv(this.addr,t),un(e,t)}}function t8(r,t){let e=this.cache,n=t.elements;if(n===void 0){if(hn(e,t))return;r.uniformMatrix2fv(this.addr,!1,t),un(e,t)}else{if(hn(e,n))return;fv.set(n),r.uniformMatrix2fv(this.addr,!1,fv),un(e,n)}}function e8(r,t){let e=this.cache,n=t.elements;if(n===void 0){if(hn(e,t))return;r.uniformMatrix3fv(this.addr,!1,t),un(e,t)}else{if(hn(e,n))return;xv.set(n),r.uniformMatrix3fv(this.addr,!1,xv),un(e,n)}}function n8(r,t){let e=this.cache,n=t.elements;if(n===void 0){if(hn(e,t))return;r.uniformMatrix4fv(this.addr,!1,t),un(e,t)}else{if(hn(e,n))return;dv.set(n),r.uniformMatrix4fv(this.addr,!1,dv),un(e,n)}}function i8(r,t){let e=this.cache;e[0]!==t&&(r.uniform1i(this.addr,t),e[0]=t)}function r8(r,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(r.uniform2i(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(hn(e,t))return;r.uniform2iv(this.addr,t),un(e,t)}}function s8(r,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(r.uniform3i(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(hn(e,t))return;r.uniform3iv(this.addr,t),un(e,t)}}function o8(r,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(r.uniform4i(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(hn(e,t))return;r.uniform4iv(this.addr,t),un(e,t)}}function a8(r,t){let e=this.cache;e[0]!==t&&(r.uniform1ui(this.addr,t),e[0]=t)}function c8(r,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(r.uniform2ui(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(hn(e,t))return;r.uniform2uiv(this.addr,t),un(e,t)}}function l8(r,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(r.uniform3ui(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(hn(e,t))return;r.uniform3uiv(this.addr,t),un(e,t)}}function h8(r,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(r.uniform4ui(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(hn(e,t))return;r.uniform4uiv(this.addr,t),un(e,t)}}function u8(r,t,e){let n=this.cache,i=e.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i);let s=this.type===r.SAMPLER_2D_SHADOW?Kv:Jv;e.setTexture2D(t||s,i)}function d8(r,t,e){let n=this.cache,i=e.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),e.setTexture3D(t||tE,i)}function x8(r,t,e){let n=this.cache,i=e.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),e.setTextureCube(t||eE,i)}function f8(r,t,e){let n=this.cache,i=e.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),e.setTexture2DArray(t||Qv,i)}function p8(r){switch(r){case 5126:return ZS;case 35664:return JS;case 35665:return KS;case 35666:return QS;case 35674:return t8;case 35675:return e8;case 35676:return n8;case 5124:case 35670:return i8;case 35667:case 35671:return r8;case 35668:case 35672:return s8;case 35669:case 35673:return o8;case 5125:return a8;case 36294:return c8;case 36295:return l8;case 36296:return h8;case 35678:case 36198:case 36298:case 36306:case 35682:return u8;case 35679:case 36299:case 36307:return d8;case 35680:case 36300:case 36308:case 36293:return x8;case 36289:case 36303:case 36311:case 36292:return f8}}function m8(r,t){r.uniform1fv(this.addr,t)}function g8(r,t){let e=$o(t,this.size,2);r.uniform2fv(this.addr,e)}function v8(r,t){let e=$o(t,this.size,3);r.uniform3fv(this.addr,e)}function E8(r,t){let e=$o(t,this.size,4);r.uniform4fv(this.addr,e)}function _8(r,t){let e=$o(t,this.size,4);r.uniformMatrix2fv(this.addr,!1,e)}function C8(r,t){let e=$o(t,this.size,9);r.uniformMatrix3fv(this.addr,!1,e)}function y8(r,t){let e=$o(t,this.size,16);r.uniformMatrix4fv(this.addr,!1,e)}function A8(r,t){r.uniform1iv(this.addr,t)}function b8(r,t){r.uniform2iv(this.addr,t)}function w8(r,t){r.uniform3iv(this.addr,t)}function S8(r,t){r.uniform4iv(this.addr,t)}function M8(r,t){r.uniform1uiv(this.addr,t)}function D8(r,t){r.uniform2uiv(this.addr,t)}function B8(r,t){r.uniform3uiv(this.addr,t)}function T8(r,t){r.uniform4uiv(this.addr,t)}function F8(r,t,e){let n=this.cache,i=t.length,s=zh(e,i);hn(n,s)||(r.uniform1iv(this.addr,s),un(n,s));for(let o=0;o!==i;++o)e.setTexture2D(t[o]||Jv,s[o])}function P8(r,t,e){let n=this.cache,i=t.length,s=zh(e,i);hn(n,s)||(r.uniform1iv(this.addr,s),un(n,s));for(let o=0;o!==i;++o)e.setTexture3D(t[o]||tE,s[o])}function R8(r,t,e){let n=this.cache,i=t.length,s=zh(e,i);hn(n,s)||(r.uniform1iv(this.addr,s),un(n,s));for(let o=0;o!==i;++o)e.setTextureCube(t[o]||eE,s[o])}function k8(r,t,e){let n=this.cache,i=t.length,s=zh(e,i);hn(n,s)||(r.uniform1iv(this.addr,s),un(n,s));for(let o=0;o!==i;++o)e.setTexture2DArray(t[o]||Qv,s[o])}function O8(r){switch(r){case 5126:return m8;case 35664:return g8;case 35665:return v8;case 35666:return E8;case 35674:return _8;case 35675:return C8;case 35676:return y8;case 5124:case 35670:return A8;case 35667:case 35671:return b8;case 35668:case 35672:return w8;case 35669:case 35673:return S8;case 5125:return M8;case 36294:return D8;case 36295:return B8;case 36296:return T8;case 35678:case 36198:case 36298:case 36306:case 35682:return F8;case 35679:case 36299:case 36307:return P8;case 35680:case 36300:case 36308:case 36293:return R8;case 36289:case 36303:case 36311:case 36292:return k8}}var nx=class{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=p8(e.type)}},ix=class{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=O8(e.type)}},rx=class{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){let i=this.seq;for(let s=0,o=i.length;s!==o;++s){let a=i[s];a.setValue(t,e[a.id],n)}}},Vd=/(\w+)(\])?(\[|\.)?/g;function pv(r,t){r.seq.push(t),r.map[t.id]=t}function I8(r,t,e){let n=r.name,i=n.length;for(Vd.lastIndex=0;;){let s=Vd.exec(n),o=Vd.lastIndex,a=s[1],c=s[2]==="]",l=s[3];if(c&&(a=a|0),l===void 0||l==="["&&o+2===i){pv(e,l===void 0?new nx(a,r,t):new ix(a,r,t));break}else{let u=e.map[a];u===void 0&&(u=new rx(a),pv(e,u)),e=u}}}var Lo=class{constructor(t,e){this.seq=[],this.map={};let n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){let s=t.getActiveUniform(e,i),o=t.getUniformLocation(e,s.name);I8(s,o,this)}}setValue(t,e,n,i){let s=this.map[e];s!==void 0&&s.setValue(t,n,i)}setOptional(t,e,n){let i=e[n];i!==void 0&&this.setValue(t,n,i)}static upload(t,e,n,i){for(let s=0,o=e.length;s!==o;++s){let a=e[s],c=n[a.id];c.needsUpdate!==!1&&a.setValue(t,c.value,i)}}static seqWithValue(t,e){let n=[];for(let i=0,s=t.length;i!==s;++i){let o=t[i];o.id in e&&n.push(o)}return n}};function mv(r,t,e){let n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),n}var L8=37297,N8=0;function U8(r,t){let e=r.split(`
`),n=[],i=Math.max(t-6,0),s=Math.min(t+6,e.length);for(let o=i;o<s;o++){let a=o+1;n.push(`${a===t?">":" "} ${a}: ${e[o]}`)}return n.join(`
`)}function z8(r){let t=Oe.getPrimaries(Oe.workingColorSpace),e=Oe.getPrimaries(r),n;switch(t===e?n="":t===fh&&e===xh?n="LinearDisplayP3ToLinearSRGB":t===xh&&e===fh&&(n="LinearSRGBToLinearDisplayP3"),r){case Wr:case Uh:return[n,"LinearTransferOETF"];case li:case Px:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",r),[n,"LinearTransferOETF"]}}function gv(r,t,e){let n=r.getShaderParameter(t,r.COMPILE_STATUS),i=r.getShaderInfoLog(t).trim();if(n&&i==="")return"";let s=/ERROR: 0:(\d+)/.exec(i);if(s){let o=parseInt(s[1]);return e.toUpperCase()+`

`+i+`

`+U8(r.getShaderSource(t),o)}else return i}function V8(r,t){let e=z8(t);return`vec4 ${r}( vec4 value ) { return ${e[0]}( ${e[1]}( value ) ); }`}function H8(r,t){let e;switch(t){case G9:e="Linear";break;case W9:e="Reinhard";break;case j9:e="OptimizedCineon";break;case X9:e="ACESFilmic";break;case q9:e="AgX";break;case $9:e="Neutral";break;case Y9:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+r+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function G8(r){return[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",r.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(gc).join(`
`)}function W8(r){let t=[];for(let e in r){let n=r[e];n!==!1&&t.push("#define "+e+" "+n)}return t.join(`
`)}function j8(r,t){let e={},n=r.getProgramParameter(t,r.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){let s=r.getActiveAttrib(t,i),o=s.name,a=1;s.type===r.FLOAT_MAT2&&(a=2),s.type===r.FLOAT_MAT3&&(a=3),s.type===r.FLOAT_MAT4&&(a=4),e[o]={type:s.type,location:r.getAttribLocation(t,o),locationSize:a}}return e}function gc(r){return r!==""}function vv(r,t){let e=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,e).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ev(r,t){return r.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var X8=/^[ \t]*#include +<([\w\d./]+)>/gm;function sx(r){return r.replace(X8,q8)}var Y8=new Map;function q8(r,t){let e=oe[t];if(e===void 0){let n=Y8.get(t);if(n!==void 0)e=oe[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,n);else throw new Error("Can not resolve #include <"+t+">")}return sx(e)}var $8=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function _v(r){return r.replace($8,Z8)}function Z8(r,t,e,n){let i="";for(let s=parseInt(t);s<parseInt(e);s++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function Cv(r){let t=`precision ${r.precision} float;
	precision ${r.precision} int;
	precision ${r.precision} sampler2D;
	precision ${r.precision} samplerCube;
	precision ${r.precision} sampler3D;
	precision ${r.precision} sampler2DArray;
	precision ${r.precision} sampler2DShadow;
	precision ${r.precision} samplerCubeShadow;
	precision ${r.precision} sampler2DArrayShadow;
	precision ${r.precision} isampler2D;
	precision ${r.precision} isampler3D;
	precision ${r.precision} isamplerCube;
	precision ${r.precision} isampler2DArray;
	precision ${r.precision} usampler2D;
	precision ${r.precision} usampler3D;
	precision ${r.precision} usamplerCube;
	precision ${r.precision} usampler2DArray;
	`;return r.precision==="highp"?t+=`
#define HIGH_PRECISION`:r.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function J8(r){let t="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===Lv?t="SHADOWMAP_TYPE_PCF":r.shadowMapType===p9?t="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===ur&&(t="SHADOWMAP_TYPE_VSM"),t}function K8(r){let t="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case No:case Uo:t="ENVMAP_TYPE_CUBE";break;case Lh:t="ENVMAP_TYPE_CUBE_UV";break}return t}function Q8(r){let t="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case Uo:t="ENVMAP_MODE_REFRACTION";break}return t}function tM(r){let t="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case Fx:t="ENVMAP_BLENDING_MULTIPLY";break;case V9:t="ENVMAP_BLENDING_MIX";break;case H9:t="ENVMAP_BLENDING_ADD";break}return t}function eM(r){let t=r.envMapCubeUVHeight;if(t===null)return null;let e=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:n,maxMip:e}}function nM(r,t,e,n){let i=r.getContext(),s=e.defines,o=e.vertexShader,a=e.fragmentShader,c=J8(e),l=K8(e),h=Q8(e),u=tM(e),d=eM(e),x=G8(e),m=W8(s),g=i.createProgram(),f,p,v=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(f=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,m].filter(gc).join(`
`),f.length>0&&(f+=`
`),p=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,m].filter(gc).join(`
`),p.length>0&&(p+=`
`)):(f=[Cv(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,m,e.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",e.batching?"#define USE_BATCHING":"",e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.instancingMorph?"#define USE_INSTANCING_MORPH":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+h:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.displacementMap?"#define USE_DISPLACEMENTMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.mapUv?"#define MAP_UV "+e.mapUv:"",e.alphaMapUv?"#define ALPHAMAP_UV "+e.alphaMapUv:"",e.lightMapUv?"#define LIGHTMAP_UV "+e.lightMapUv:"",e.aoMapUv?"#define AOMAP_UV "+e.aoMapUv:"",e.emissiveMapUv?"#define EMISSIVEMAP_UV "+e.emissiveMapUv:"",e.bumpMapUv?"#define BUMPMAP_UV "+e.bumpMapUv:"",e.normalMapUv?"#define NORMALMAP_UV "+e.normalMapUv:"",e.displacementMapUv?"#define DISPLACEMENTMAP_UV "+e.displacementMapUv:"",e.metalnessMapUv?"#define METALNESSMAP_UV "+e.metalnessMapUv:"",e.roughnessMapUv?"#define ROUGHNESSMAP_UV "+e.roughnessMapUv:"",e.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+e.anisotropyMapUv:"",e.clearcoatMapUv?"#define CLEARCOATMAP_UV "+e.clearcoatMapUv:"",e.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+e.clearcoatNormalMapUv:"",e.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+e.clearcoatRoughnessMapUv:"",e.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+e.iridescenceMapUv:"",e.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+e.iridescenceThicknessMapUv:"",e.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+e.sheenColorMapUv:"",e.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+e.sheenRoughnessMapUv:"",e.specularMapUv?"#define SPECULARMAP_UV "+e.specularMapUv:"",e.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+e.specularColorMapUv:"",e.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+e.specularIntensityMapUv:"",e.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+e.transmissionMapUv:"",e.thicknessMapUv?"#define THICKNESSMAP_UV "+e.thicknessMapUv:"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",e.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+c:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.numLightProbes>0?"#define USE_LIGHT_PROBES":"",e.useLegacyLights?"#define LEGACY_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(gc).join(`
`),p=[Cv(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,m,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+l:"",e.envMap?"#define "+h:"",e.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.dispersion?"#define USE_DISPERSION":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+c:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.numLightProbes>0?"#define USE_LIGHT_PROBES":"",e.useLegacyLights?"#define LEGACY_LIGHTS":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==Vr?"#define TONE_MAPPING":"",e.toneMapping!==Vr?oe.tonemapping_pars_fragment:"",e.toneMapping!==Vr?H8("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",oe.colorspace_pars_fragment,V8("linearToOutputTexel",e.outputColorSpace),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(gc).join(`
`)),o=sx(o),o=vv(o,e),o=Ev(o,e),a=sx(a),a=vv(a,e),a=Ev(a,e),o=_v(o),a=_v(a),e.isRawShaderMaterial!==!0&&(v=`#version 300 es
`,f=[x,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+f,p=["#define varying in",e.glslVersion===Lg?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===Lg?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+p);let E=v+f+o,C=v+p+a,b=mv(i,i.VERTEX_SHADER,E),A=mv(i,i.FRAGMENT_SHADER,C);i.attachShader(g,b),i.attachShader(g,A),e.index0AttributeName!==void 0?i.bindAttribLocation(g,0,e.index0AttributeName):e.morphTargets===!0&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g);function w(D){if(r.debug.checkShaderErrors){let F=i.getProgramInfoLog(g).trim(),T=i.getShaderInfoLog(b).trim(),L=i.getShaderInfoLog(A).trim(),N=!0,J=!0;if(i.getProgramParameter(g,i.LINK_STATUS)===!1)if(N=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(i,g,b,A);else{let tt=gv(i,b,"vertex"),G=gv(i,A,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(g,i.VALIDATE_STATUS)+`

Material Name: `+D.name+`
Material Type: `+D.type+`

Program Info Log: `+F+`
`+tt+`
`+G)}else F!==""?console.warn("THREE.WebGLProgram: Program Info Log:",F):(T===""||L==="")&&(J=!1);J&&(D.diagnostics={runnable:N,programLog:F,vertexShader:{log:T,prefix:f},fragmentShader:{log:L,prefix:p}})}i.deleteShader(b),i.deleteShader(A),S=new Lo(i,g),_=j8(i,g)}let S;this.getUniforms=function(){return S===void 0&&w(this),S};let _;this.getAttributes=function(){return _===void 0&&w(this),_};let y=e.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return y===!1&&(y=i.getProgramParameter(g,L8)),y},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.type=e.shaderType,this.name=e.shaderName,this.id=N8++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=b,this.fragmentShader=A,this}var iM=0,ox=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){let e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(t);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(t){let e=this.materialCache.get(t);for(let n of e)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){let e=this.materialCache,n=e.get(t);return n===void 0&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){let e=this.shaderCache,n=e.get(t);return n===void 0&&(n=new ax(t),e.set(t,n)),n}},ax=class{constructor(t){this.id=iM++,this.code=t,this.usedTimes=0}};function rM(r,t,e,n,i,s,o){let a=new wc,c=new ox,l=new Set,h=[],u=i.logarithmicDepthBuffer,d=i.vertexTextures,x=i.precision,m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(_){return l.add(_),_===0?"uv":`uv${_}`}function f(_,y,D,F,T){let L=F.fog,N=T.geometry,J=_.isMeshStandardMaterial?F.environment:null,tt=(_.isMeshStandardMaterial?e:t).get(_.envMap||J),G=tt&&tt.mapping===Lh?tt.image.height:null,X=m[_.type];_.precision!==null&&(x=i.getMaxPrecision(_.precision),x!==_.precision&&console.warn("THREE.WebGLProgram.getParameters:",_.precision,"not supported, using",x,"instead."));let st=N.morphAttributes.position||N.morphAttributes.normal||N.morphAttributes.color,ft=st!==void 0?st.length:0,mt=0;N.morphAttributes.position!==void 0&&(mt=1),N.morphAttributes.normal!==void 0&&(mt=2),N.morphAttributes.color!==void 0&&(mt=3);let Jt,q,O,V;if(X){let Pe=Wi[X];Jt=Pe.vertexShader,q=Pe.fragmentShader}else Jt=_.vertexShader,q=_.fragmentShader,c.update(_),O=c.getVertexShaderID(_),V=c.getFragmentShaderID(_);let k=r.getRenderTarget(),K=T.isInstancedMesh===!0,Y=T.isBatchedMesh===!0,R=!!_.map,vt=!!_.matcap,ht=!!tt,Tt=!!_.aoMap,Ct=!!_.lightMap,pt=!!_.bumpMap,Rt=!!_.normalMap,Ft=!!_.displacementMap,Ue=!!_.emissiveMap,P=!!_.metalnessMap,M=!!_.roughnessMap,nt=_.anisotropy>0,lt=_.clearcoat>0,dt=_.dispersion>0,xt=_.iridescence>0,Ht=_.sheen>0,wt=_.transmission>0,bt=nt&&!!_.anisotropyMap,ce=lt&&!!_.clearcoatMap,Et=lt&&!!_.clearcoatNormalMap,Nt=lt&&!!_.clearcoatRoughnessMap,_e=xt&&!!_.iridescenceMap,jt=xt&&!!_.iridescenceThicknessMap,Bt=Ht&&!!_.sheenColorMap,le=Ht&&!!_.sheenRoughnessMap,pe=!!_.specularMap,$e=!!_.specularColorMap,he=!!_.specularIntensityMap,H=wt&&!!_.transmissionMap,ut=wt&&!!_.thicknessMap,ct=!!_.gradientMap,yt=!!_.alphaMap,Mt=_.alphaTest>0,ye=!!_.alphaHash,ze=!!_.extensions,Ye=Vr;_.toneMapped&&(k===null||k.isXRRenderTarget===!0)&&(Ye=r.toneMapping);let bn={shaderID:X,shaderType:_.type,shaderName:_.name,vertexShader:Jt,fragmentShader:q,defines:_.defines,customVertexShaderID:O,customFragmentShaderID:V,isRawShaderMaterial:_.isRawShaderMaterial===!0,glslVersion:_.glslVersion,precision:x,batching:Y,instancing:K,instancingColor:K&&T.instanceColor!==null,instancingMorph:K&&T.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:k===null?r.outputColorSpace:k.isXRRenderTarget===!0?k.texture.colorSpace:Wr,alphaToCoverage:!!_.alphaToCoverage,map:R,matcap:vt,envMap:ht,envMapMode:ht&&tt.mapping,envMapCubeUVHeight:G,aoMap:Tt,lightMap:Ct,bumpMap:pt,normalMap:Rt,displacementMap:d&&Ft,emissiveMap:Ue,normalMapObjectSpace:Rt&&_.normalMapType===lb,normalMapTangentSpace:Rt&&_.normalMapType===jv,metalnessMap:P,roughnessMap:M,anisotropy:nt,anisotropyMap:bt,clearcoat:lt,clearcoatMap:ce,clearcoatNormalMap:Et,clearcoatRoughnessMap:Nt,dispersion:dt,iridescence:xt,iridescenceMap:_e,iridescenceThicknessMap:jt,sheen:Ht,sheenColorMap:Bt,sheenRoughnessMap:le,specularMap:pe,specularColorMap:$e,specularIntensityMap:he,transmission:wt,transmissionMap:H,thicknessMap:ut,gradientMap:ct,opaque:_.transparent===!1&&_.blending===ko&&_.alphaToCoverage===!1,alphaMap:yt,alphaTest:Mt,alphaHash:ye,combine:_.combine,mapUv:R&&g(_.map.channel),aoMapUv:Tt&&g(_.aoMap.channel),lightMapUv:Ct&&g(_.lightMap.channel),bumpMapUv:pt&&g(_.bumpMap.channel),normalMapUv:Rt&&g(_.normalMap.channel),displacementMapUv:Ft&&g(_.displacementMap.channel),emissiveMapUv:Ue&&g(_.emissiveMap.channel),metalnessMapUv:P&&g(_.metalnessMap.channel),roughnessMapUv:M&&g(_.roughnessMap.channel),anisotropyMapUv:bt&&g(_.anisotropyMap.channel),clearcoatMapUv:ce&&g(_.clearcoatMap.channel),clearcoatNormalMapUv:Et&&g(_.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Nt&&g(_.clearcoatRoughnessMap.channel),iridescenceMapUv:_e&&g(_.iridescenceMap.channel),iridescenceThicknessMapUv:jt&&g(_.iridescenceThicknessMap.channel),sheenColorMapUv:Bt&&g(_.sheenColorMap.channel),sheenRoughnessMapUv:le&&g(_.sheenRoughnessMap.channel),specularMapUv:pe&&g(_.specularMap.channel),specularColorMapUv:$e&&g(_.specularColorMap.channel),specularIntensityMapUv:he&&g(_.specularIntensityMap.channel),transmissionMapUv:H&&g(_.transmissionMap.channel),thicknessMapUv:ut&&g(_.thicknessMap.channel),alphaMapUv:yt&&g(_.alphaMap.channel),vertexTangents:!!N.attributes.tangent&&(Rt||nt),vertexColors:_.vertexColors,vertexAlphas:_.vertexColors===!0&&!!N.attributes.color&&N.attributes.color.itemSize===4,pointsUvs:T.isPoints===!0&&!!N.attributes.uv&&(R||yt),fog:!!L,useFog:_.fog===!0,fogExp2:!!L&&L.isFogExp2,flatShading:_.flatShading===!0,sizeAttenuation:_.sizeAttenuation===!0,logarithmicDepthBuffer:u,skinning:T.isSkinnedMesh===!0,morphTargets:N.morphAttributes.position!==void 0,morphNormals:N.morphAttributes.normal!==void 0,morphColors:N.morphAttributes.color!==void 0,morphTargetsCount:ft,morphTextureStride:mt,numDirLights:y.directional.length,numPointLights:y.point.length,numSpotLights:y.spot.length,numSpotLightMaps:y.spotLightMap.length,numRectAreaLights:y.rectArea.length,numHemiLights:y.hemi.length,numDirLightShadows:y.directionalShadowMap.length,numPointLightShadows:y.pointShadowMap.length,numSpotLightShadows:y.spotShadowMap.length,numSpotLightShadowsWithMaps:y.numSpotLightShadowsWithMaps,numLightProbes:y.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:_.dithering,shadowMapEnabled:r.shadowMap.enabled&&D.length>0,shadowMapType:r.shadowMap.type,toneMapping:Ye,useLegacyLights:r._useLegacyLights,decodeVideoTexture:R&&_.map.isVideoTexture===!0&&Oe.getTransfer(_.map.colorSpace)===He,premultipliedAlpha:_.premultipliedAlpha,doubleSided:_.side===xr,flipSided:_.side===jn,useDepthPacking:_.depthPacking>=0,depthPacking:_.depthPacking||0,index0AttributeName:_.index0AttributeName,extensionClipCullDistance:ze&&_.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:ze&&_.extensions.multiDraw===!0&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:_.customProgramCacheKey()};return bn.vertexUv1s=l.has(1),bn.vertexUv2s=l.has(2),bn.vertexUv3s=l.has(3),l.clear(),bn}function p(_){let y=[];if(_.shaderID?y.push(_.shaderID):(y.push(_.customVertexShaderID),y.push(_.customFragmentShaderID)),_.defines!==void 0)for(let D in _.defines)y.push(D),y.push(_.defines[D]);return _.isRawShaderMaterial===!1&&(v(y,_),E(y,_),y.push(r.outputColorSpace)),y.push(_.customProgramCacheKey),y.join()}function v(_,y){_.push(y.precision),_.push(y.outputColorSpace),_.push(y.envMapMode),_.push(y.envMapCubeUVHeight),_.push(y.mapUv),_.push(y.alphaMapUv),_.push(y.lightMapUv),_.push(y.aoMapUv),_.push(y.bumpMapUv),_.push(y.normalMapUv),_.push(y.displacementMapUv),_.push(y.emissiveMapUv),_.push(y.metalnessMapUv),_.push(y.roughnessMapUv),_.push(y.anisotropyMapUv),_.push(y.clearcoatMapUv),_.push(y.clearcoatNormalMapUv),_.push(y.clearcoatRoughnessMapUv),_.push(y.iridescenceMapUv),_.push(y.iridescenceThicknessMapUv),_.push(y.sheenColorMapUv),_.push(y.sheenRoughnessMapUv),_.push(y.specularMapUv),_.push(y.specularColorMapUv),_.push(y.specularIntensityMapUv),_.push(y.transmissionMapUv),_.push(y.thicknessMapUv),_.push(y.combine),_.push(y.fogExp2),_.push(y.sizeAttenuation),_.push(y.morphTargetsCount),_.push(y.morphAttributeCount),_.push(y.numDirLights),_.push(y.numPointLights),_.push(y.numSpotLights),_.push(y.numSpotLightMaps),_.push(y.numHemiLights),_.push(y.numRectAreaLights),_.push(y.numDirLightShadows),_.push(y.numPointLightShadows),_.push(y.numSpotLightShadows),_.push(y.numSpotLightShadowsWithMaps),_.push(y.numLightProbes),_.push(y.shadowMapType),_.push(y.toneMapping),_.push(y.numClippingPlanes),_.push(y.numClipIntersection),_.push(y.depthPacking)}function E(_,y){a.disableAll(),y.supportsVertexTextures&&a.enable(0),y.instancing&&a.enable(1),y.instancingColor&&a.enable(2),y.instancingMorph&&a.enable(3),y.matcap&&a.enable(4),y.envMap&&a.enable(5),y.normalMapObjectSpace&&a.enable(6),y.normalMapTangentSpace&&a.enable(7),y.clearcoat&&a.enable(8),y.iridescence&&a.enable(9),y.alphaTest&&a.enable(10),y.vertexColors&&a.enable(11),y.vertexAlphas&&a.enable(12),y.vertexUv1s&&a.enable(13),y.vertexUv2s&&a.enable(14),y.vertexUv3s&&a.enable(15),y.vertexTangents&&a.enable(16),y.anisotropy&&a.enable(17),y.alphaHash&&a.enable(18),y.batching&&a.enable(19),y.dispersion&&a.enable(20),_.push(a.mask),a.disableAll(),y.fog&&a.enable(0),y.useFog&&a.enable(1),y.flatShading&&a.enable(2),y.logarithmicDepthBuffer&&a.enable(3),y.skinning&&a.enable(4),y.morphTargets&&a.enable(5),y.morphNormals&&a.enable(6),y.morphColors&&a.enable(7),y.premultipliedAlpha&&a.enable(8),y.shadowMapEnabled&&a.enable(9),y.useLegacyLights&&a.enable(10),y.doubleSided&&a.enable(11),y.flipSided&&a.enable(12),y.useDepthPacking&&a.enable(13),y.dithering&&a.enable(14),y.transmission&&a.enable(15),y.sheen&&a.enable(16),y.opaque&&a.enable(17),y.pointsUvs&&a.enable(18),y.decodeVideoTexture&&a.enable(19),y.alphaToCoverage&&a.enable(20),_.push(a.mask)}function C(_){let y=m[_.type],D;if(y){let F=Wi[y];D=$b.clone(F.uniforms)}else D=_.uniforms;return D}function b(_,y){let D;for(let F=0,T=h.length;F<T;F++){let L=h[F];if(L.cacheKey===y){D=L,++D.usedTimes;break}}return D===void 0&&(D=new nM(r,y,_,s),h.push(D)),D}function A(_){if(--_.usedTimes===0){let y=h.indexOf(_);h[y]=h[h.length-1],h.pop(),_.destroy()}}function w(_){c.remove(_)}function S(){c.dispose()}return{getParameters:f,getProgramCacheKey:p,getUniforms:C,acquireProgram:b,releaseProgram:A,releaseShaderCache:w,programs:h,dispose:S}}function sM(){let r=new WeakMap;function t(s){let o=r.get(s);return o===void 0&&(o={},r.set(s,o)),o}function e(s){r.delete(s)}function n(s,o,a){r.get(s)[o]=a}function i(){r=new WeakMap}return{get:t,remove:e,update:n,dispose:i}}function oM(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.material.id!==t.material.id?r.material.id-t.material.id:r.z!==t.z?r.z-t.z:r.id-t.id}function yv(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.z!==t.z?t.z-r.z:r.id-t.id}function Av(){let r=[],t=0,e=[],n=[],i=[];function s(){t=0,e.length=0,n.length=0,i.length=0}function o(u,d,x,m,g,f){let p=r[t];return p===void 0?(p={id:u.id,object:u,geometry:d,material:x,groupOrder:m,renderOrder:u.renderOrder,z:g,group:f},r[t]=p):(p.id=u.id,p.object=u,p.geometry=d,p.material=x,p.groupOrder=m,p.renderOrder=u.renderOrder,p.z=g,p.group=f),t++,p}function a(u,d,x,m,g,f){let p=o(u,d,x,m,g,f);x.transmission>0?n.push(p):x.transparent===!0?i.push(p):e.push(p)}function c(u,d,x,m,g,f){let p=o(u,d,x,m,g,f);x.transmission>0?n.unshift(p):x.transparent===!0?i.unshift(p):e.unshift(p)}function l(u,d){e.length>1&&e.sort(u||oM),n.length>1&&n.sort(d||yv),i.length>1&&i.sort(d||yv)}function h(){for(let u=t,d=r.length;u<d;u++){let x=r[u];if(x.id===null)break;x.id=null,x.object=null,x.geometry=null,x.material=null,x.group=null}}return{opaque:e,transmissive:n,transparent:i,init:s,push:a,unshift:c,finish:h,sort:l}}function aM(){let r=new WeakMap;function t(n,i){let s=r.get(n),o;return s===void 0?(o=new Av,r.set(n,[o])):i>=s.length?(o=new Av,s.push(o)):o=s[i],o}function e(){r=new WeakMap}return{get:t,dispose:e}}function cM(){let r={};return{get:function(t){if(r[t.id]!==void 0)return r[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new I,color:new $t};break;case"SpotLight":e={position:new I,direction:new I,color:new $t,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new I,color:new $t,distance:0,decay:0};break;case"HemisphereLight":e={direction:new I,skyColor:new $t,groundColor:new $t};break;case"RectAreaLight":e={color:new $t,position:new I,halfWidth:new I,halfHeight:new I};break}return r[t.id]=e,e}}}function lM(){let r={};return{get:function(t){if(r[t.id]!==void 0)return r[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zt};break;case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zt};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Zt,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[t.id]=e,e}}}var hM=0;function uM(r,t){return(t.castShadow?2:0)-(r.castShadow?2:0)+(t.map?1:0)-(r.map?1:0)}function dM(r){let t=new cM,e=lM(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)n.probe.push(new I);let i=new I,s=new Kt,o=new Kt;function a(l,h){let u=0,d=0,x=0;for(let D=0;D<9;D++)n.probe[D].set(0,0,0);let m=0,g=0,f=0,p=0,v=0,E=0,C=0,b=0,A=0,w=0,S=0;l.sort(uM);let _=h===!0?Math.PI:1;for(let D=0,F=l.length;D<F;D++){let T=l[D],L=T.color,N=T.intensity,J=T.distance,tt=T.shadow&&T.shadow.map?T.shadow.map.texture:null;if(T.isAmbientLight)u+=L.r*N*_,d+=L.g*N*_,x+=L.b*N*_;else if(T.isLightProbe){for(let G=0;G<9;G++)n.probe[G].addScaledVector(T.sh.coefficients[G],N);S++}else if(T.isDirectionalLight){let G=t.get(T);if(G.color.copy(T.color).multiplyScalar(T.intensity*_),T.castShadow){let X=T.shadow,st=e.get(T);st.shadowBias=X.bias,st.shadowNormalBias=X.normalBias,st.shadowRadius=X.radius,st.shadowMapSize=X.mapSize,n.directionalShadow[m]=st,n.directionalShadowMap[m]=tt,n.directionalShadowMatrix[m]=T.shadow.matrix,E++}n.directional[m]=G,m++}else if(T.isSpotLight){let G=t.get(T);G.position.setFromMatrixPosition(T.matrixWorld),G.color.copy(L).multiplyScalar(N*_),G.distance=J,G.coneCos=Math.cos(T.angle),G.penumbraCos=Math.cos(T.angle*(1-T.penumbra)),G.decay=T.decay,n.spot[f]=G;let X=T.shadow;if(T.map&&(n.spotLightMap[A]=T.map,A++,X.updateMatrices(T),T.castShadow&&w++),n.spotLightMatrix[f]=X.matrix,T.castShadow){let st=e.get(T);st.shadowBias=X.bias,st.shadowNormalBias=X.normalBias,st.shadowRadius=X.radius,st.shadowMapSize=X.mapSize,n.spotShadow[f]=st,n.spotShadowMap[f]=tt,b++}f++}else if(T.isRectAreaLight){let G=t.get(T);G.color.copy(L).multiplyScalar(N),G.halfWidth.set(T.width*.5,0,0),G.halfHeight.set(0,T.height*.5,0),n.rectArea[p]=G,p++}else if(T.isPointLight){let G=t.get(T);if(G.color.copy(T.color).multiplyScalar(T.intensity*_),G.distance=T.distance,G.decay=T.decay,T.castShadow){let X=T.shadow,st=e.get(T);st.shadowBias=X.bias,st.shadowNormalBias=X.normalBias,st.shadowRadius=X.radius,st.shadowMapSize=X.mapSize,st.shadowCameraNear=X.camera.near,st.shadowCameraFar=X.camera.far,n.pointShadow[g]=st,n.pointShadowMap[g]=tt,n.pointShadowMatrix[g]=T.shadow.matrix,C++}n.point[g]=G,g++}else if(T.isHemisphereLight){let G=t.get(T);G.skyColor.copy(T.color).multiplyScalar(N*_),G.groundColor.copy(T.groundColor).multiplyScalar(N*_),n.hemi[v]=G,v++}}p>0&&(r.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=_t.LTC_FLOAT_1,n.rectAreaLTC2=_t.LTC_FLOAT_2):(n.rectAreaLTC1=_t.LTC_HALF_1,n.rectAreaLTC2=_t.LTC_HALF_2)),n.ambient[0]=u,n.ambient[1]=d,n.ambient[2]=x;let y=n.hash;(y.directionalLength!==m||y.pointLength!==g||y.spotLength!==f||y.rectAreaLength!==p||y.hemiLength!==v||y.numDirectionalShadows!==E||y.numPointShadows!==C||y.numSpotShadows!==b||y.numSpotMaps!==A||y.numLightProbes!==S)&&(n.directional.length=m,n.spot.length=f,n.rectArea.length=p,n.point.length=g,n.hemi.length=v,n.directionalShadow.length=E,n.directionalShadowMap.length=E,n.pointShadow.length=C,n.pointShadowMap.length=C,n.spotShadow.length=b,n.spotShadowMap.length=b,n.directionalShadowMatrix.length=E,n.pointShadowMatrix.length=C,n.spotLightMatrix.length=b+A-w,n.spotLightMap.length=A,n.numSpotLightShadowsWithMaps=w,n.numLightProbes=S,y.directionalLength=m,y.pointLength=g,y.spotLength=f,y.rectAreaLength=p,y.hemiLength=v,y.numDirectionalShadows=E,y.numPointShadows=C,y.numSpotShadows=b,y.numSpotMaps=A,y.numLightProbes=S,n.version=hM++)}function c(l,h){let u=0,d=0,x=0,m=0,g=0,f=h.matrixWorldInverse;for(let p=0,v=l.length;p<v;p++){let E=l[p];if(E.isDirectionalLight){let C=n.directional[u];C.direction.setFromMatrixPosition(E.matrixWorld),i.setFromMatrixPosition(E.target.matrixWorld),C.direction.sub(i),C.direction.transformDirection(f),u++}else if(E.isSpotLight){let C=n.spot[x];C.position.setFromMatrixPosition(E.matrixWorld),C.position.applyMatrix4(f),C.direction.setFromMatrixPosition(E.matrixWorld),i.setFromMatrixPosition(E.target.matrixWorld),C.direction.sub(i),C.direction.transformDirection(f),x++}else if(E.isRectAreaLight){let C=n.rectArea[m];C.position.setFromMatrixPosition(E.matrixWorld),C.position.applyMatrix4(f),o.identity(),s.copy(E.matrixWorld),s.premultiply(f),o.extractRotation(s),C.halfWidth.set(E.width*.5,0,0),C.halfHeight.set(0,E.height*.5,0),C.halfWidth.applyMatrix4(o),C.halfHeight.applyMatrix4(o),m++}else if(E.isPointLight){let C=n.point[d];C.position.setFromMatrixPosition(E.matrixWorld),C.position.applyMatrix4(f),d++}else if(E.isHemisphereLight){let C=n.hemi[g];C.direction.setFromMatrixPosition(E.matrixWorld),C.direction.transformDirection(f),g++}}}return{setup:a,setupView:c,state:n}}function bv(r){let t=new dM(r),e=[],n=[];function i(h){l.camera=h,e.length=0,n.length=0}function s(h){e.push(h)}function o(h){n.push(h)}function a(h){t.setup(e,h)}function c(h){t.setupView(e,h)}let l={lightsArray:e,shadowsArray:n,camera:null,lights:t,transmissionRenderTarget:{}};return{init:i,state:l,setupLights:a,setupLightsView:c,pushLight:s,pushShadow:o}}function xM(r){let t=new WeakMap;function e(i,s=0){let o=t.get(i),a;return o===void 0?(a=new bv(r),t.set(i,[a])):s>=o.length?(a=new bv(r),o.push(a)):a=o[s],a}function n(){t=new WeakMap}return{get:e,dispose:n}}var cx=class extends xi{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=ab,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}},lx=class extends xi{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}},fM=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,pM=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function mM(r,t,e){let n=new Mc,i=new Zt,s=new Zt,o=new je,a=new cx({depthPacking:cb}),c=new lx,l={},h=e.maxTextureSize,u={[Yi]:jn,[jn]:Yi,[xr]:xr},d=new $i({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Zt},radius:{value:4}},vertexShader:fM,fragmentShader:pM}),x=d.clone();x.defines.HORIZONTAL_PASS=1;let m=new gn;m.setAttribute("position",new ui(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let g=new Wn(m,d),f=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Lv;let p=this.type;this.render=function(A,w,S){if(f.enabled===!1||f.autoUpdate===!1&&f.needsUpdate===!1||A.length===0)return;let _=r.getRenderTarget(),y=r.getActiveCubeFace(),D=r.getActiveMipmapLevel(),F=r.state;F.setBlending(zr),F.buffers.color.setClear(1,1,1,1),F.buffers.depth.setTest(!0),F.setScissorTest(!1);let T=p!==ur&&this.type===ur,L=p===ur&&this.type!==ur;for(let N=0,J=A.length;N<J;N++){let tt=A[N],G=tt.shadow;if(G===void 0){console.warn("THREE.WebGLShadowMap:",tt,"has no shadow.");continue}if(G.autoUpdate===!1&&G.needsUpdate===!1)continue;i.copy(G.mapSize);let X=G.getFrameExtents();if(i.multiply(X),s.copy(G.mapSize),(i.x>h||i.y>h)&&(i.x>h&&(s.x=Math.floor(h/X.x),i.x=s.x*X.x,G.mapSize.x=s.x),i.y>h&&(s.y=Math.floor(h/X.y),i.y=s.y*X.y,G.mapSize.y=s.y)),G.map===null||T===!0||L===!0){let ft=this.type!==ur?{minFilter:hi,magFilter:hi}:{};G.map!==null&&G.map.dispose(),G.map=new pr(i.x,i.y,ft),G.map.texture.name=tt.name+".shadowMap",G.camera.updateProjectionMatrix()}r.setRenderTarget(G.map),r.clear();let st=G.getViewportCount();for(let ft=0;ft<st;ft++){let mt=G.getViewport(ft);o.set(s.x*mt.x,s.y*mt.y,s.x*mt.z,s.y*mt.w),F.viewport(o),G.updateMatrices(tt,ft),n=G.getFrustum(),C(w,S,G.camera,tt,this.type)}G.isPointLightShadow!==!0&&this.type===ur&&v(G,S),G.needsUpdate=!1}p=this.type,f.needsUpdate=!1,r.setRenderTarget(_,y,D)};function v(A,w){let S=t.update(g);d.defines.VSM_SAMPLES!==A.blurSamples&&(d.defines.VSM_SAMPLES=A.blurSamples,x.defines.VSM_SAMPLES=A.blurSamples,d.needsUpdate=!0,x.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new pr(i.x,i.y)),d.uniforms.shadow_pass.value=A.map.texture,d.uniforms.resolution.value=A.mapSize,d.uniforms.radius.value=A.radius,r.setRenderTarget(A.mapPass),r.clear(),r.renderBufferDirect(w,null,S,d,g,null),x.uniforms.shadow_pass.value=A.mapPass.texture,x.uniforms.resolution.value=A.mapSize,x.uniforms.radius.value=A.radius,r.setRenderTarget(A.map),r.clear(),r.renderBufferDirect(w,null,S,x,g,null)}function E(A,w,S,_){let y=null,D=S.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(D!==void 0)y=D;else if(y=S.isPointLight===!0?c:a,r.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){let F=y.uuid,T=w.uuid,L=l[F];L===void 0&&(L={},l[F]=L);let N=L[T];N===void 0&&(N=y.clone(),L[T]=N,w.addEventListener("dispose",b)),y=N}if(y.visible=w.visible,y.wireframe=w.wireframe,_===ur?y.side=w.shadowSide!==null?w.shadowSide:w.side:y.side=w.shadowSide!==null?w.shadowSide:u[w.side],y.alphaMap=w.alphaMap,y.alphaTest=w.alphaTest,y.map=w.map,y.clipShadows=w.clipShadows,y.clippingPlanes=w.clippingPlanes,y.clipIntersection=w.clipIntersection,y.displacementMap=w.displacementMap,y.displacementScale=w.displacementScale,y.displacementBias=w.displacementBias,y.wireframeLinewidth=w.wireframeLinewidth,y.linewidth=w.linewidth,S.isPointLight===!0&&y.isMeshDistanceMaterial===!0){let F=r.properties.get(y);F.light=S}return y}function C(A,w,S,_,y){if(A.visible===!1)return;if(A.layers.test(w.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&y===ur)&&(!A.frustumCulled||n.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,A.matrixWorld);let T=t.update(A),L=A.material;if(Array.isArray(L)){let N=T.groups;for(let J=0,tt=N.length;J<tt;J++){let G=N[J],X=L[G.materialIndex];if(X&&X.visible){let st=E(A,X,_,y);A.onBeforeShadow(r,A,w,S,T,st,G),r.renderBufferDirect(S,null,T,st,A,G),A.onAfterShadow(r,A,w,S,T,st,G)}}}else if(L.visible){let N=E(A,L,_,y);A.onBeforeShadow(r,A,w,S,T,N,null),r.renderBufferDirect(S,null,T,N,A,null),A.onAfterShadow(r,A,w,S,T,N,null)}}let F=A.children;for(let T=0,L=F.length;T<L;T++)C(F[T],w,S,_,y)}function b(A){A.target.removeEventListener("dispose",b);for(let S in l){let _=l[S],y=A.target.uuid;y in _&&(_[y].dispose(),delete _[y])}}}function gM(r){function t(){let H=!1,ut=new je,ct=null,yt=new je(0,0,0,0);return{setMask:function(Mt){ct!==Mt&&!H&&(r.colorMask(Mt,Mt,Mt,Mt),ct=Mt)},setLocked:function(Mt){H=Mt},setClear:function(Mt,ye,ze,Ye,bn){bn===!0&&(Mt*=Ye,ye*=Ye,ze*=Ye),ut.set(Mt,ye,ze,Ye),yt.equals(ut)===!1&&(r.clearColor(Mt,ye,ze,Ye),yt.copy(ut))},reset:function(){H=!1,ct=null,yt.set(-1,0,0,0)}}}function e(){let H=!1,ut=null,ct=null,yt=null;return{setTest:function(Mt){Mt?V(r.DEPTH_TEST):k(r.DEPTH_TEST)},setMask:function(Mt){ut!==Mt&&!H&&(r.depthMask(Mt),ut=Mt)},setFunc:function(Mt){if(ct!==Mt){switch(Mt){case k9:r.depthFunc(r.NEVER);break;case O9:r.depthFunc(r.ALWAYS);break;case I9:r.depthFunc(r.LESS);break;case lh:r.depthFunc(r.LEQUAL);break;case L9:r.depthFunc(r.EQUAL);break;case N9:r.depthFunc(r.GEQUAL);break;case U9:r.depthFunc(r.GREATER);break;case z9:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}ct=Mt}},setLocked:function(Mt){H=Mt},setClear:function(Mt){yt!==Mt&&(r.clearDepth(Mt),yt=Mt)},reset:function(){H=!1,ut=null,ct=null,yt=null}}}function n(){let H=!1,ut=null,ct=null,yt=null,Mt=null,ye=null,ze=null,Ye=null,bn=null;return{setTest:function(Pe){H||(Pe?V(r.STENCIL_TEST):k(r.STENCIL_TEST))},setMask:function(Pe){ut!==Pe&&!H&&(r.stencilMask(Pe),ut=Pe)},setFunc:function(Pe,Ui,kn){(ct!==Pe||yt!==Ui||Mt!==kn)&&(r.stencilFunc(Pe,Ui,kn),ct=Pe,yt=Ui,Mt=kn)},setOp:function(Pe,Ui,kn){(ye!==Pe||ze!==Ui||Ye!==kn)&&(r.stencilOp(Pe,Ui,kn),ye=Pe,ze=Ui,Ye=kn)},setLocked:function(Pe){H=Pe},setClear:function(Pe){bn!==Pe&&(r.clearStencil(Pe),bn=Pe)},reset:function(){H=!1,ut=null,ct=null,yt=null,Mt=null,ye=null,ze=null,Ye=null,bn=null}}}let i=new t,s=new e,o=new n,a=new WeakMap,c=new WeakMap,l={},h={},u=new WeakMap,d=[],x=null,m=!1,g=null,f=null,p=null,v=null,E=null,C=null,b=null,A=new $t(0,0,0),w=0,S=!1,_=null,y=null,D=null,F=null,T=null,L=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS),N=!1,J=0,tt=r.getParameter(r.VERSION);tt.indexOf("WebGL")!==-1?(J=parseFloat(/^WebGL (\d)/.exec(tt)[1]),N=J>=1):tt.indexOf("OpenGL ES")!==-1&&(J=parseFloat(/^OpenGL ES (\d)/.exec(tt)[1]),N=J>=2);let G=null,X={},st=r.getParameter(r.SCISSOR_BOX),ft=r.getParameter(r.VIEWPORT),mt=new je().fromArray(st),Jt=new je().fromArray(ft);function q(H,ut,ct,yt){let Mt=new Uint8Array(4),ye=r.createTexture();r.bindTexture(H,ye),r.texParameteri(H,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(H,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let ze=0;ze<ct;ze++)H===r.TEXTURE_3D||H===r.TEXTURE_2D_ARRAY?r.texImage3D(ut,0,r.RGBA,1,1,yt,0,r.RGBA,r.UNSIGNED_BYTE,Mt):r.texImage2D(ut+ze,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,Mt);return ye}let O={};O[r.TEXTURE_2D]=q(r.TEXTURE_2D,r.TEXTURE_2D,1),O[r.TEXTURE_CUBE_MAP]=q(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),O[r.TEXTURE_2D_ARRAY]=q(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),O[r.TEXTURE_3D]=q(r.TEXTURE_3D,r.TEXTURE_3D,1,1),i.setClear(0,0,0,1),s.setClear(1),o.setClear(0),V(r.DEPTH_TEST),s.setFunc(lh),pt(!1),Rt(eg),V(r.CULL_FACE),Tt(zr);function V(H){l[H]!==!0&&(r.enable(H),l[H]=!0)}function k(H){l[H]!==!1&&(r.disable(H),l[H]=!1)}function K(H,ut){return h[H]!==ut?(r.bindFramebuffer(H,ut),h[H]=ut,H===r.DRAW_FRAMEBUFFER&&(h[r.FRAMEBUFFER]=ut),H===r.FRAMEBUFFER&&(h[r.DRAW_FRAMEBUFFER]=ut),!0):!1}function Y(H,ut){let ct=d,yt=!1;if(H){ct=u.get(ut),ct===void 0&&(ct=[],u.set(ut,ct));let Mt=H.textures;if(ct.length!==Mt.length||ct[0]!==r.COLOR_ATTACHMENT0){for(let ye=0,ze=Mt.length;ye<ze;ye++)ct[ye]=r.COLOR_ATTACHMENT0+ye;ct.length=Mt.length,yt=!0}}else ct[0]!==r.BACK&&(ct[0]=r.BACK,yt=!0);yt&&r.drawBuffers(ct)}function R(H){return x!==H?(r.useProgram(H),x=H,!0):!1}let vt={[Ds]:r.FUNC_ADD,[g9]:r.FUNC_SUBTRACT,[v9]:r.FUNC_REVERSE_SUBTRACT};vt[E9]=r.MIN,vt[_9]=r.MAX;let ht={[C9]:r.ZERO,[y9]:r.ONE,[A9]:r.SRC_COLOR,[jd]:r.SRC_ALPHA,[B9]:r.SRC_ALPHA_SATURATE,[M9]:r.DST_COLOR,[w9]:r.DST_ALPHA,[b9]:r.ONE_MINUS_SRC_COLOR,[Xd]:r.ONE_MINUS_SRC_ALPHA,[D9]:r.ONE_MINUS_DST_COLOR,[S9]:r.ONE_MINUS_DST_ALPHA,[T9]:r.CONSTANT_COLOR,[F9]:r.ONE_MINUS_CONSTANT_COLOR,[P9]:r.CONSTANT_ALPHA,[R9]:r.ONE_MINUS_CONSTANT_ALPHA};function Tt(H,ut,ct,yt,Mt,ye,ze,Ye,bn,Pe){if(H===zr){m===!0&&(k(r.BLEND),m=!1);return}if(m===!1&&(V(r.BLEND),m=!0),H!==m9){if(H!==g||Pe!==S){if((f!==Ds||E!==Ds)&&(r.blendEquation(r.FUNC_ADD),f=Ds,E=Ds),Pe)switch(H){case ko:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case ng:r.blendFunc(r.ONE,r.ONE);break;case ig:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case rg:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",H);break}else switch(H){case ko:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case ng:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case ig:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case rg:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",H);break}p=null,v=null,C=null,b=null,A.set(0,0,0),w=0,g=H,S=Pe}return}Mt=Mt||ut,ye=ye||ct,ze=ze||yt,(ut!==f||Mt!==E)&&(r.blendEquationSeparate(vt[ut],vt[Mt]),f=ut,E=Mt),(ct!==p||yt!==v||ye!==C||ze!==b)&&(r.blendFuncSeparate(ht[ct],ht[yt],ht[ye],ht[ze]),p=ct,v=yt,C=ye,b=ze),(Ye.equals(A)===!1||bn!==w)&&(r.blendColor(Ye.r,Ye.g,Ye.b,bn),A.copy(Ye),w=bn),g=H,S=!1}function Ct(H,ut){H.side===xr?k(r.CULL_FACE):V(r.CULL_FACE);let ct=H.side===jn;ut&&(ct=!ct),pt(ct),H.blending===ko&&H.transparent===!1?Tt(zr):Tt(H.blending,H.blendEquation,H.blendSrc,H.blendDst,H.blendEquationAlpha,H.blendSrcAlpha,H.blendDstAlpha,H.blendColor,H.blendAlpha,H.premultipliedAlpha),s.setFunc(H.depthFunc),s.setTest(H.depthTest),s.setMask(H.depthWrite),i.setMask(H.colorWrite);let yt=H.stencilWrite;o.setTest(yt),yt&&(o.setMask(H.stencilWriteMask),o.setFunc(H.stencilFunc,H.stencilRef,H.stencilFuncMask),o.setOp(H.stencilFail,H.stencilZFail,H.stencilZPass)),Ue(H.polygonOffset,H.polygonOffsetFactor,H.polygonOffsetUnits),H.alphaToCoverage===!0?V(r.SAMPLE_ALPHA_TO_COVERAGE):k(r.SAMPLE_ALPHA_TO_COVERAGE)}function pt(H){_!==H&&(H?r.frontFace(r.CW):r.frontFace(r.CCW),_=H)}function Rt(H){H!==x9?(V(r.CULL_FACE),H!==y&&(H===eg?r.cullFace(r.BACK):H===f9?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):k(r.CULL_FACE),y=H}function Ft(H){H!==D&&(N&&r.lineWidth(H),D=H)}function Ue(H,ut,ct){H?(V(r.POLYGON_OFFSET_FILL),(F!==ut||T!==ct)&&(r.polygonOffset(ut,ct),F=ut,T=ct)):k(r.POLYGON_OFFSET_FILL)}function P(H){H?V(r.SCISSOR_TEST):k(r.SCISSOR_TEST)}function M(H){H===void 0&&(H=r.TEXTURE0+L-1),G!==H&&(r.activeTexture(H),G=H)}function nt(H,ut,ct){ct===void 0&&(G===null?ct=r.TEXTURE0+L-1:ct=G);let yt=X[ct];yt===void 0&&(yt={type:void 0,texture:void 0},X[ct]=yt),(yt.type!==H||yt.texture!==ut)&&(G!==ct&&(r.activeTexture(ct),G=ct),r.bindTexture(H,ut||O[H]),yt.type=H,yt.texture=ut)}function lt(){let H=X[G];H!==void 0&&H.type!==void 0&&(r.bindTexture(H.type,null),H.type=void 0,H.texture=void 0)}function dt(){try{r.compressedTexImage2D.apply(r,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function xt(){try{r.compressedTexImage3D.apply(r,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function Ht(){try{r.texSubImage2D.apply(r,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function wt(){try{r.texSubImage3D.apply(r,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function bt(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function ce(){try{r.compressedTexSubImage3D.apply(r,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function Et(){try{r.texStorage2D.apply(r,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function Nt(){try{r.texStorage3D.apply(r,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function _e(){try{r.texImage2D.apply(r,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function jt(){try{r.texImage3D.apply(r,arguments)}catch(H){console.error("THREE.WebGLState:",H)}}function Bt(H){mt.equals(H)===!1&&(r.scissor(H.x,H.y,H.z,H.w),mt.copy(H))}function le(H){Jt.equals(H)===!1&&(r.viewport(H.x,H.y,H.z,H.w),Jt.copy(H))}function pe(H,ut){let ct=c.get(ut);ct===void 0&&(ct=new WeakMap,c.set(ut,ct));let yt=ct.get(H);yt===void 0&&(yt=r.getUniformBlockIndex(ut,H.name),ct.set(H,yt))}function $e(H,ut){let yt=c.get(ut).get(H);a.get(ut)!==yt&&(r.uniformBlockBinding(ut,yt,H.__bindingPointIndex),a.set(ut,yt))}function he(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),l={},G=null,X={},h={},u=new WeakMap,d=[],x=null,m=!1,g=null,f=null,p=null,v=null,E=null,C=null,b=null,A=new $t(0,0,0),w=0,S=!1,_=null,y=null,D=null,F=null,T=null,mt.set(0,0,r.canvas.width,r.canvas.height),Jt.set(0,0,r.canvas.width,r.canvas.height),i.reset(),s.reset(),o.reset()}return{buffers:{color:i,depth:s,stencil:o},enable:V,disable:k,bindFramebuffer:K,drawBuffers:Y,useProgram:R,setBlending:Tt,setMaterial:Ct,setFlipSided:pt,setCullFace:Rt,setLineWidth:Ft,setPolygonOffset:Ue,setScissorTest:P,activeTexture:M,bindTexture:nt,unbindTexture:lt,compressedTexImage2D:dt,compressedTexImage3D:xt,texImage2D:_e,texImage3D:jt,updateUBOMapping:pe,uniformBlockBinding:$e,texStorage2D:Et,texStorage3D:Nt,texSubImage2D:Ht,texSubImage3D:wt,compressedTexSubImage2D:bt,compressedTexSubImage3D:ce,scissor:Bt,viewport:le,reset:he}}function vM(r,t,e,n,i,s,o){let a=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new Zt,h=new WeakMap,u,d=new WeakMap,x=!1;try{x=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(P,M){return x?new OffscreenCanvas(P,M):bc("canvas")}function g(P,M,nt){let lt=1,dt=Ue(P);if((dt.width>nt||dt.height>nt)&&(lt=nt/Math.max(dt.width,dt.height)),lt<1)if(typeof HTMLImageElement<"u"&&P instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&P instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&P instanceof ImageBitmap||typeof VideoFrame<"u"&&P instanceof VideoFrame){let xt=Math.floor(lt*dt.width),Ht=Math.floor(lt*dt.height);u===void 0&&(u=m(xt,Ht));let wt=M?m(xt,Ht):u;return wt.width=xt,wt.height=Ht,wt.getContext("2d").drawImage(P,0,0,xt,Ht),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+dt.width+"x"+dt.height+") to ("+xt+"x"+Ht+")."),wt}else return"data"in P&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+dt.width+"x"+dt.height+")."),P;return P}function f(P){return P.generateMipmaps&&P.minFilter!==hi&&P.minFilter!==Mi}function p(P){r.generateMipmap(P)}function v(P,M,nt,lt,dt=!1){if(P!==null){if(r[P]!==void 0)return r[P];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+P+"'")}let xt=M;if(M===r.RED&&(nt===r.FLOAT&&(xt=r.R32F),nt===r.HALF_FLOAT&&(xt=r.R16F),nt===r.UNSIGNED_BYTE&&(xt=r.R8)),M===r.RED_INTEGER&&(nt===r.UNSIGNED_BYTE&&(xt=r.R8UI),nt===r.UNSIGNED_SHORT&&(xt=r.R16UI),nt===r.UNSIGNED_INT&&(xt=r.R32UI),nt===r.BYTE&&(xt=r.R8I),nt===r.SHORT&&(xt=r.R16I),nt===r.INT&&(xt=r.R32I)),M===r.RG&&(nt===r.FLOAT&&(xt=r.RG32F),nt===r.HALF_FLOAT&&(xt=r.RG16F),nt===r.UNSIGNED_BYTE&&(xt=r.RG8)),M===r.RG_INTEGER&&(nt===r.UNSIGNED_BYTE&&(xt=r.RG8UI),nt===r.UNSIGNED_SHORT&&(xt=r.RG16UI),nt===r.UNSIGNED_INT&&(xt=r.RG32UI),nt===r.BYTE&&(xt=r.RG8I),nt===r.SHORT&&(xt=r.RG16I),nt===r.INT&&(xt=r.RG32I)),M===r.RGB&&nt===r.UNSIGNED_INT_5_9_9_9_REV&&(xt=r.RGB9_E5),M===r.RGBA){let Ht=dt?dh:Oe.getTransfer(lt);nt===r.FLOAT&&(xt=r.RGBA32F),nt===r.HALF_FLOAT&&(xt=r.RGBA16F),nt===r.UNSIGNED_BYTE&&(xt=Ht===He?r.SRGB8_ALPHA8:r.RGBA8),nt===r.UNSIGNED_SHORT_4_4_4_4&&(xt=r.RGBA4),nt===r.UNSIGNED_SHORT_5_5_5_1&&(xt=r.RGB5_A1)}return(xt===r.R16F||xt===r.R32F||xt===r.RG16F||xt===r.RG32F||xt===r.RGBA16F||xt===r.RGBA32F)&&t.get("EXT_color_buffer_float"),xt}function E(P,M){return f(P)===!0||P.isFramebufferTexture&&P.minFilter!==hi&&P.minFilter!==Mi?Math.log2(Math.max(M.width,M.height))+1:P.mipmaps!==void 0&&P.mipmaps.length>0?P.mipmaps.length:P.isCompressedTexture&&Array.isArray(P.image)?M.mipmaps.length:1}function C(P){let M=P.target;M.removeEventListener("dispose",C),A(M),M.isVideoTexture&&h.delete(M)}function b(P){let M=P.target;M.removeEventListener("dispose",b),S(M)}function A(P){let M=n.get(P);if(M.__webglInit===void 0)return;let nt=P.source,lt=d.get(nt);if(lt){let dt=lt[M.__cacheKey];dt.usedTimes--,dt.usedTimes===0&&w(P),Object.keys(lt).length===0&&d.delete(nt)}n.remove(P)}function w(P){let M=n.get(P);r.deleteTexture(M.__webglTexture);let nt=P.source,lt=d.get(nt);delete lt[M.__cacheKey],o.memory.textures--}function S(P){let M=n.get(P);if(P.depthTexture&&P.depthTexture.dispose(),P.isWebGLCubeRenderTarget)for(let lt=0;lt<6;lt++){if(Array.isArray(M.__webglFramebuffer[lt]))for(let dt=0;dt<M.__webglFramebuffer[lt].length;dt++)r.deleteFramebuffer(M.__webglFramebuffer[lt][dt]);else r.deleteFramebuffer(M.__webglFramebuffer[lt]);M.__webglDepthbuffer&&r.deleteRenderbuffer(M.__webglDepthbuffer[lt])}else{if(Array.isArray(M.__webglFramebuffer))for(let lt=0;lt<M.__webglFramebuffer.length;lt++)r.deleteFramebuffer(M.__webglFramebuffer[lt]);else r.deleteFramebuffer(M.__webglFramebuffer);if(M.__webglDepthbuffer&&r.deleteRenderbuffer(M.__webglDepthbuffer),M.__webglMultisampledFramebuffer&&r.deleteFramebuffer(M.__webglMultisampledFramebuffer),M.__webglColorRenderbuffer)for(let lt=0;lt<M.__webglColorRenderbuffer.length;lt++)M.__webglColorRenderbuffer[lt]&&r.deleteRenderbuffer(M.__webglColorRenderbuffer[lt]);M.__webglDepthRenderbuffer&&r.deleteRenderbuffer(M.__webglDepthRenderbuffer)}let nt=P.textures;for(let lt=0,dt=nt.length;lt<dt;lt++){let xt=n.get(nt[lt]);xt.__webglTexture&&(r.deleteTexture(xt.__webglTexture),o.memory.textures--),n.remove(nt[lt])}n.remove(P)}let _=0;function y(){_=0}function D(){let P=_;return P>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+P+" texture units while this GPU supports only "+i.maxTextures),_+=1,P}function F(P){let M=[];return M.push(P.wrapS),M.push(P.wrapT),M.push(P.wrapR||0),M.push(P.magFilter),M.push(P.minFilter),M.push(P.anisotropy),M.push(P.internalFormat),M.push(P.format),M.push(P.type),M.push(P.generateMipmaps),M.push(P.premultiplyAlpha),M.push(P.flipY),M.push(P.unpackAlignment),M.push(P.colorSpace),M.join()}function T(P,M){let nt=n.get(P);if(P.isVideoTexture&&Rt(P),P.isRenderTargetTexture===!1&&P.version>0&&nt.__version!==P.version){let lt=P.image;if(lt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(lt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{mt(nt,P,M);return}}e.bindTexture(r.TEXTURE_2D,nt.__webglTexture,r.TEXTURE0+M)}function L(P,M){let nt=n.get(P);if(P.version>0&&nt.__version!==P.version){mt(nt,P,M);return}e.bindTexture(r.TEXTURE_2D_ARRAY,nt.__webglTexture,r.TEXTURE0+M)}function N(P,M){let nt=n.get(P);if(P.version>0&&nt.__version!==P.version){mt(nt,P,M);return}e.bindTexture(r.TEXTURE_3D,nt.__webglTexture,r.TEXTURE0+M)}function J(P,M){let nt=n.get(P);if(P.version>0&&nt.__version!==P.version){Jt(nt,P,M);return}e.bindTexture(r.TEXTURE_CUBE_MAP,nt.__webglTexture,r.TEXTURE0+M)}let tt={[Cc]:r.REPEAT,[Ts]:r.CLAMP_TO_EDGE,[$d]:r.MIRRORED_REPEAT},G={[hi]:r.NEAREST,[Z9]:r.NEAREST_MIPMAP_NEAREST,[Il]:r.NEAREST_MIPMAP_LINEAR,[Mi]:r.LINEAR,[ud]:r.LINEAR_MIPMAP_NEAREST,[Fs]:r.LINEAR_MIPMAP_LINEAR},X={[hb]:r.NEVER,[mb]:r.ALWAYS,[ub]:r.LESS,[Xv]:r.LEQUAL,[db]:r.EQUAL,[pb]:r.GEQUAL,[xb]:r.GREATER,[fb]:r.NOTEQUAL};function st(P,M){if(M.type===Ur&&t.has("OES_texture_float_linear")===!1&&(M.magFilter===Mi||M.magFilter===ud||M.magFilter===Il||M.magFilter===Fs||M.minFilter===Mi||M.minFilter===ud||M.minFilter===Il||M.minFilter===Fs)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),r.texParameteri(P,r.TEXTURE_WRAP_S,tt[M.wrapS]),r.texParameteri(P,r.TEXTURE_WRAP_T,tt[M.wrapT]),(P===r.TEXTURE_3D||P===r.TEXTURE_2D_ARRAY)&&r.texParameteri(P,r.TEXTURE_WRAP_R,tt[M.wrapR]),r.texParameteri(P,r.TEXTURE_MAG_FILTER,G[M.magFilter]),r.texParameteri(P,r.TEXTURE_MIN_FILTER,G[M.minFilter]),M.compareFunction&&(r.texParameteri(P,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(P,r.TEXTURE_COMPARE_FUNC,X[M.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){if(M.magFilter===hi||M.minFilter!==Il&&M.minFilter!==Fs||M.type===Ur&&t.has("OES_texture_float_linear")===!1)return;if(M.anisotropy>1||n.get(M).__currentAnisotropy){let nt=t.get("EXT_texture_filter_anisotropic");r.texParameterf(P,nt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(M.anisotropy,i.getMaxAnisotropy())),n.get(M).__currentAnisotropy=M.anisotropy}}}function ft(P,M){let nt=!1;P.__webglInit===void 0&&(P.__webglInit=!0,M.addEventListener("dispose",C));let lt=M.source,dt=d.get(lt);dt===void 0&&(dt={},d.set(lt,dt));let xt=F(M);if(xt!==P.__cacheKey){dt[xt]===void 0&&(dt[xt]={texture:r.createTexture(),usedTimes:0},o.memory.textures++,nt=!0),dt[xt].usedTimes++;let Ht=dt[P.__cacheKey];Ht!==void 0&&(dt[P.__cacheKey].usedTimes--,Ht.usedTimes===0&&w(M)),P.__cacheKey=xt,P.__webglTexture=dt[xt].texture}return nt}function mt(P,M,nt){let lt=r.TEXTURE_2D;(M.isDataArrayTexture||M.isCompressedArrayTexture)&&(lt=r.TEXTURE_2D_ARRAY),M.isData3DTexture&&(lt=r.TEXTURE_3D);let dt=ft(P,M),xt=M.source;e.bindTexture(lt,P.__webglTexture,r.TEXTURE0+nt);let Ht=n.get(xt);if(xt.version!==Ht.__version||dt===!0){e.activeTexture(r.TEXTURE0+nt);let wt=Oe.getPrimaries(Oe.workingColorSpace),bt=M.colorSpace===Nr?null:Oe.getPrimaries(M.colorSpace),ce=M.colorSpace===Nr||wt===bt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,M.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,M.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,M.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,ce);let Et=g(M.image,!1,i.maxTextureSize);Et=Ft(M,Et);let Nt=s.convert(M.format,M.colorSpace),_e=s.convert(M.type),jt=v(M.internalFormat,Nt,_e,M.colorSpace,M.isVideoTexture);st(lt,M);let Bt,le=M.mipmaps,pe=M.isVideoTexture!==!0,$e=Ht.__version===void 0||dt===!0,he=xt.dataReady,H=E(M,Et);if(M.isDepthTexture)jt=r.DEPTH_COMPONENT16,M.type===Ur?jt=r.DEPTH_COMPONENT32F:M.type===zo?jt=r.DEPTH_COMPONENT24:M.type===Bc&&(jt=r.DEPTH24_STENCIL8),$e&&(pe?e.texStorage2D(r.TEXTURE_2D,1,jt,Et.width,Et.height):e.texImage2D(r.TEXTURE_2D,0,jt,Et.width,Et.height,0,Nt,_e,null));else if(M.isDataTexture)if(le.length>0){pe&&$e&&e.texStorage2D(r.TEXTURE_2D,H,jt,le[0].width,le[0].height);for(let ut=0,ct=le.length;ut<ct;ut++)Bt=le[ut],pe?he&&e.texSubImage2D(r.TEXTURE_2D,ut,0,0,Bt.width,Bt.height,Nt,_e,Bt.data):e.texImage2D(r.TEXTURE_2D,ut,jt,Bt.width,Bt.height,0,Nt,_e,Bt.data);M.generateMipmaps=!1}else pe?($e&&e.texStorage2D(r.TEXTURE_2D,H,jt,Et.width,Et.height),he&&e.texSubImage2D(r.TEXTURE_2D,0,0,0,Et.width,Et.height,Nt,_e,Et.data)):e.texImage2D(r.TEXTURE_2D,0,jt,Et.width,Et.height,0,Nt,_e,Et.data);else if(M.isCompressedTexture)if(M.isCompressedArrayTexture){pe&&$e&&e.texStorage3D(r.TEXTURE_2D_ARRAY,H,jt,le[0].width,le[0].height,Et.depth);for(let ut=0,ct=le.length;ut<ct;ut++)Bt=le[ut],M.format!==ji?Nt!==null?pe?he&&e.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,ut,0,0,0,Bt.width,Bt.height,Et.depth,Nt,Bt.data,0,0):e.compressedTexImage3D(r.TEXTURE_2D_ARRAY,ut,jt,Bt.width,Bt.height,Et.depth,0,Bt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):pe?he&&e.texSubImage3D(r.TEXTURE_2D_ARRAY,ut,0,0,0,Bt.width,Bt.height,Et.depth,Nt,_e,Bt.data):e.texImage3D(r.TEXTURE_2D_ARRAY,ut,jt,Bt.width,Bt.height,Et.depth,0,Nt,_e,Bt.data)}else{pe&&$e&&e.texStorage2D(r.TEXTURE_2D,H,jt,le[0].width,le[0].height);for(let ut=0,ct=le.length;ut<ct;ut++)Bt=le[ut],M.format!==ji?Nt!==null?pe?he&&e.compressedTexSubImage2D(r.TEXTURE_2D,ut,0,0,Bt.width,Bt.height,Nt,Bt.data):e.compressedTexImage2D(r.TEXTURE_2D,ut,jt,Bt.width,Bt.height,0,Bt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):pe?he&&e.texSubImage2D(r.TEXTURE_2D,ut,0,0,Bt.width,Bt.height,Nt,_e,Bt.data):e.texImage2D(r.TEXTURE_2D,ut,jt,Bt.width,Bt.height,0,Nt,_e,Bt.data)}else if(M.isDataArrayTexture)pe?($e&&e.texStorage3D(r.TEXTURE_2D_ARRAY,H,jt,Et.width,Et.height,Et.depth),he&&e.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,Et.width,Et.height,Et.depth,Nt,_e,Et.data)):e.texImage3D(r.TEXTURE_2D_ARRAY,0,jt,Et.width,Et.height,Et.depth,0,Nt,_e,Et.data);else if(M.isData3DTexture)pe?($e&&e.texStorage3D(r.TEXTURE_3D,H,jt,Et.width,Et.height,Et.depth),he&&e.texSubImage3D(r.TEXTURE_3D,0,0,0,0,Et.width,Et.height,Et.depth,Nt,_e,Et.data)):e.texImage3D(r.TEXTURE_3D,0,jt,Et.width,Et.height,Et.depth,0,Nt,_e,Et.data);else if(M.isFramebufferTexture){if($e)if(pe)e.texStorage2D(r.TEXTURE_2D,H,jt,Et.width,Et.height);else{let ut=Et.width,ct=Et.height;for(let yt=0;yt<H;yt++)e.texImage2D(r.TEXTURE_2D,yt,jt,ut,ct,0,Nt,_e,null),ut>>=1,ct>>=1}}else if(le.length>0){if(pe&&$e){let ut=Ue(le[0]);e.texStorage2D(r.TEXTURE_2D,H,jt,ut.width,ut.height)}for(let ut=0,ct=le.length;ut<ct;ut++)Bt=le[ut],pe?he&&e.texSubImage2D(r.TEXTURE_2D,ut,0,0,Nt,_e,Bt):e.texImage2D(r.TEXTURE_2D,ut,jt,Nt,_e,Bt);M.generateMipmaps=!1}else if(pe){if($e){let ut=Ue(Et);e.texStorage2D(r.TEXTURE_2D,H,jt,ut.width,ut.height)}he&&e.texSubImage2D(r.TEXTURE_2D,0,0,0,Nt,_e,Et)}else e.texImage2D(r.TEXTURE_2D,0,jt,Nt,_e,Et);f(M)&&p(lt),Ht.__version=xt.version,M.onUpdate&&M.onUpdate(M)}P.__version=M.version}function Jt(P,M,nt){if(M.image.length!==6)return;let lt=ft(P,M),dt=M.source;e.bindTexture(r.TEXTURE_CUBE_MAP,P.__webglTexture,r.TEXTURE0+nt);let xt=n.get(dt);if(dt.version!==xt.__version||lt===!0){e.activeTexture(r.TEXTURE0+nt);let Ht=Oe.getPrimaries(Oe.workingColorSpace),wt=M.colorSpace===Nr?null:Oe.getPrimaries(M.colorSpace),bt=M.colorSpace===Nr||Ht===wt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,M.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,M.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,M.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,bt);let ce=M.isCompressedTexture||M.image[0].isCompressedTexture,Et=M.image[0]&&M.image[0].isDataTexture,Nt=[];for(let ct=0;ct<6;ct++)!ce&&!Et?Nt[ct]=g(M.image[ct],!0,i.maxCubemapSize):Nt[ct]=Et?M.image[ct].image:M.image[ct],Nt[ct]=Ft(M,Nt[ct]);let _e=Nt[0],jt=s.convert(M.format,M.colorSpace),Bt=s.convert(M.type),le=v(M.internalFormat,jt,Bt,M.colorSpace),pe=M.isVideoTexture!==!0,$e=xt.__version===void 0||lt===!0,he=dt.dataReady,H=E(M,_e);st(r.TEXTURE_CUBE_MAP,M);let ut;if(ce){pe&&$e&&e.texStorage2D(r.TEXTURE_CUBE_MAP,H,le,_e.width,_e.height);for(let ct=0;ct<6;ct++){ut=Nt[ct].mipmaps;for(let yt=0;yt<ut.length;yt++){let Mt=ut[yt];M.format!==ji?jt!==null?pe?he&&e.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ct,yt,0,0,Mt.width,Mt.height,jt,Mt.data):e.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ct,yt,le,Mt.width,Mt.height,0,Mt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):pe?he&&e.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ct,yt,0,0,Mt.width,Mt.height,jt,Bt,Mt.data):e.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ct,yt,le,Mt.width,Mt.height,0,jt,Bt,Mt.data)}}}else{if(ut=M.mipmaps,pe&&$e){ut.length>0&&H++;let ct=Ue(Nt[0]);e.texStorage2D(r.TEXTURE_CUBE_MAP,H,le,ct.width,ct.height)}for(let ct=0;ct<6;ct++)if(Et){pe?he&&e.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ct,0,0,0,Nt[ct].width,Nt[ct].height,jt,Bt,Nt[ct].data):e.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ct,0,le,Nt[ct].width,Nt[ct].height,0,jt,Bt,Nt[ct].data);for(let yt=0;yt<ut.length;yt++){let ye=ut[yt].image[ct].image;pe?he&&e.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ct,yt+1,0,0,ye.width,ye.height,jt,Bt,ye.data):e.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ct,yt+1,le,ye.width,ye.height,0,jt,Bt,ye.data)}}else{pe?he&&e.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ct,0,0,0,jt,Bt,Nt[ct]):e.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ct,0,le,jt,Bt,Nt[ct]);for(let yt=0;yt<ut.length;yt++){let Mt=ut[yt];pe?he&&e.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ct,yt+1,0,0,jt,Bt,Mt.image[ct]):e.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+ct,yt+1,le,jt,Bt,Mt.image[ct])}}}f(M)&&p(r.TEXTURE_CUBE_MAP),xt.__version=dt.version,M.onUpdate&&M.onUpdate(M)}P.__version=M.version}function q(P,M,nt,lt,dt,xt){let Ht=s.convert(nt.format,nt.colorSpace),wt=s.convert(nt.type),bt=v(nt.internalFormat,Ht,wt,nt.colorSpace);if(!n.get(M).__hasExternalTextures){let Et=Math.max(1,M.width>>xt),Nt=Math.max(1,M.height>>xt);dt===r.TEXTURE_3D||dt===r.TEXTURE_2D_ARRAY?e.texImage3D(dt,xt,bt,Et,Nt,M.depth,0,Ht,wt,null):e.texImage2D(dt,xt,bt,Et,Nt,0,Ht,wt,null)}e.bindFramebuffer(r.FRAMEBUFFER,P),pt(M)?a.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,lt,dt,n.get(nt).__webglTexture,0,Ct(M)):(dt===r.TEXTURE_2D||dt>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&dt<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,lt,dt,n.get(nt).__webglTexture,xt),e.bindFramebuffer(r.FRAMEBUFFER,null)}function O(P,M,nt){if(r.bindRenderbuffer(r.RENDERBUFFER,P),M.depthBuffer&&!M.stencilBuffer){let lt=r.DEPTH_COMPONENT24;if(nt||pt(M)){let dt=M.depthTexture;dt&&dt.isDepthTexture&&(dt.type===Ur?lt=r.DEPTH_COMPONENT32F:dt.type===zo&&(lt=r.DEPTH_COMPONENT24));let xt=Ct(M);pt(M)?a.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,xt,lt,M.width,M.height):r.renderbufferStorageMultisample(r.RENDERBUFFER,xt,lt,M.width,M.height)}else r.renderbufferStorage(r.RENDERBUFFER,lt,M.width,M.height);r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,P)}else if(M.depthBuffer&&M.stencilBuffer){let lt=Ct(M);nt&&pt(M)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,lt,r.DEPTH24_STENCIL8,M.width,M.height):pt(M)?a.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,lt,r.DEPTH24_STENCIL8,M.width,M.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,M.width,M.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,P)}else{let lt=M.textures;for(let dt=0;dt<lt.length;dt++){let xt=lt[dt],Ht=s.convert(xt.format,xt.colorSpace),wt=s.convert(xt.type),bt=v(xt.internalFormat,Ht,wt,xt.colorSpace),ce=Ct(M);nt&&pt(M)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,ce,bt,M.width,M.height):pt(M)?a.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,ce,bt,M.width,M.height):r.renderbufferStorage(r.RENDERBUFFER,bt,M.width,M.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function V(P,M){if(M&&M.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(r.FRAMEBUFFER,P),!(M.depthTexture&&M.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(M.depthTexture).__webglTexture||M.depthTexture.image.width!==M.width||M.depthTexture.image.height!==M.height)&&(M.depthTexture.image.width=M.width,M.depthTexture.image.height=M.height,M.depthTexture.needsUpdate=!0),T(M.depthTexture,0);let lt=n.get(M.depthTexture).__webglTexture,dt=Ct(M);if(M.depthTexture.format===Oo)pt(M)?a.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,lt,0,dt):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,lt,0);else if(M.depthTexture.format===yc)pt(M)?a.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,lt,0,dt):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,lt,0);else throw new Error("Unknown depthTexture format")}function k(P){let M=n.get(P),nt=P.isWebGLCubeRenderTarget===!0;if(P.depthTexture&&!M.__autoAllocateDepthBuffer){if(nt)throw new Error("target.depthTexture not supported in Cube render targets");V(M.__webglFramebuffer,P)}else if(nt){M.__webglDepthbuffer=[];for(let lt=0;lt<6;lt++)e.bindFramebuffer(r.FRAMEBUFFER,M.__webglFramebuffer[lt]),M.__webglDepthbuffer[lt]=r.createRenderbuffer(),O(M.__webglDepthbuffer[lt],P,!1)}else e.bindFramebuffer(r.FRAMEBUFFER,M.__webglFramebuffer),M.__webglDepthbuffer=r.createRenderbuffer(),O(M.__webglDepthbuffer,P,!1);e.bindFramebuffer(r.FRAMEBUFFER,null)}function K(P,M,nt){let lt=n.get(P);M!==void 0&&q(lt.__webglFramebuffer,P,P.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),nt!==void 0&&k(P)}function Y(P){let M=P.texture,nt=n.get(P),lt=n.get(M);P.addEventListener("dispose",b);let dt=P.textures,xt=P.isWebGLCubeRenderTarget===!0,Ht=dt.length>1;if(Ht||(lt.__webglTexture===void 0&&(lt.__webglTexture=r.createTexture()),lt.__version=M.version,o.memory.textures++),xt){nt.__webglFramebuffer=[];for(let wt=0;wt<6;wt++)if(M.mipmaps&&M.mipmaps.length>0){nt.__webglFramebuffer[wt]=[];for(let bt=0;bt<M.mipmaps.length;bt++)nt.__webglFramebuffer[wt][bt]=r.createFramebuffer()}else nt.__webglFramebuffer[wt]=r.createFramebuffer()}else{if(M.mipmaps&&M.mipmaps.length>0){nt.__webglFramebuffer=[];for(let wt=0;wt<M.mipmaps.length;wt++)nt.__webglFramebuffer[wt]=r.createFramebuffer()}else nt.__webglFramebuffer=r.createFramebuffer();if(Ht)for(let wt=0,bt=dt.length;wt<bt;wt++){let ce=n.get(dt[wt]);ce.__webglTexture===void 0&&(ce.__webglTexture=r.createTexture(),o.memory.textures++)}if(P.samples>0&&pt(P)===!1){nt.__webglMultisampledFramebuffer=r.createFramebuffer(),nt.__webglColorRenderbuffer=[],e.bindFramebuffer(r.FRAMEBUFFER,nt.__webglMultisampledFramebuffer);for(let wt=0;wt<dt.length;wt++){let bt=dt[wt];nt.__webglColorRenderbuffer[wt]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,nt.__webglColorRenderbuffer[wt]);let ce=s.convert(bt.format,bt.colorSpace),Et=s.convert(bt.type),Nt=v(bt.internalFormat,ce,Et,bt.colorSpace,P.isXRRenderTarget===!0),_e=Ct(P);r.renderbufferStorageMultisample(r.RENDERBUFFER,_e,Nt,P.width,P.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+wt,r.RENDERBUFFER,nt.__webglColorRenderbuffer[wt])}r.bindRenderbuffer(r.RENDERBUFFER,null),P.depthBuffer&&(nt.__webglDepthRenderbuffer=r.createRenderbuffer(),O(nt.__webglDepthRenderbuffer,P,!0)),e.bindFramebuffer(r.FRAMEBUFFER,null)}}if(xt){e.bindTexture(r.TEXTURE_CUBE_MAP,lt.__webglTexture),st(r.TEXTURE_CUBE_MAP,M);for(let wt=0;wt<6;wt++)if(M.mipmaps&&M.mipmaps.length>0)for(let bt=0;bt<M.mipmaps.length;bt++)q(nt.__webglFramebuffer[wt][bt],P,M,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+wt,bt);else q(nt.__webglFramebuffer[wt],P,M,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+wt,0);f(M)&&p(r.TEXTURE_CUBE_MAP),e.unbindTexture()}else if(Ht){for(let wt=0,bt=dt.length;wt<bt;wt++){let ce=dt[wt],Et=n.get(ce);e.bindTexture(r.TEXTURE_2D,Et.__webglTexture),st(r.TEXTURE_2D,ce),q(nt.__webglFramebuffer,P,ce,r.COLOR_ATTACHMENT0+wt,r.TEXTURE_2D,0),f(ce)&&p(r.TEXTURE_2D)}e.unbindTexture()}else{let wt=r.TEXTURE_2D;if((P.isWebGL3DRenderTarget||P.isWebGLArrayRenderTarget)&&(wt=P.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),e.bindTexture(wt,lt.__webglTexture),st(wt,M),M.mipmaps&&M.mipmaps.length>0)for(let bt=0;bt<M.mipmaps.length;bt++)q(nt.__webglFramebuffer[bt],P,M,r.COLOR_ATTACHMENT0,wt,bt);else q(nt.__webglFramebuffer,P,M,r.COLOR_ATTACHMENT0,wt,0);f(M)&&p(wt),e.unbindTexture()}P.depthBuffer&&k(P)}function R(P){let M=P.textures;for(let nt=0,lt=M.length;nt<lt;nt++){let dt=M[nt];if(f(dt)){let xt=P.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D,Ht=n.get(dt).__webglTexture;e.bindTexture(xt,Ht),p(xt),e.unbindTexture()}}}let vt=[],ht=[];function Tt(P){if(P.samples>0){if(pt(P)===!1){let M=P.textures,nt=P.width,lt=P.height,dt=r.COLOR_BUFFER_BIT,xt=P.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Ht=n.get(P),wt=M.length>1;if(wt)for(let bt=0;bt<M.length;bt++)e.bindFramebuffer(r.FRAMEBUFFER,Ht.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+bt,r.RENDERBUFFER,null),e.bindFramebuffer(r.FRAMEBUFFER,Ht.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+bt,r.TEXTURE_2D,null,0);e.bindFramebuffer(r.READ_FRAMEBUFFER,Ht.__webglMultisampledFramebuffer),e.bindFramebuffer(r.DRAW_FRAMEBUFFER,Ht.__webglFramebuffer);for(let bt=0;bt<M.length;bt++){if(P.resolveDepthBuffer&&(P.depthBuffer&&(dt|=r.DEPTH_BUFFER_BIT),P.stencilBuffer&&P.resolveStencilBuffer&&(dt|=r.STENCIL_BUFFER_BIT)),wt){r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,Ht.__webglColorRenderbuffer[bt]);let ce=n.get(M[bt]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,ce,0)}r.blitFramebuffer(0,0,nt,lt,0,0,nt,lt,dt,r.NEAREST),c===!0&&(vt.length=0,ht.length=0,vt.push(r.COLOR_ATTACHMENT0+bt),P.depthBuffer&&P.resolveDepthBuffer===!1&&(vt.push(xt),ht.push(xt),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,ht)),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,vt))}if(e.bindFramebuffer(r.READ_FRAMEBUFFER,null),e.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),wt)for(let bt=0;bt<M.length;bt++){e.bindFramebuffer(r.FRAMEBUFFER,Ht.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+bt,r.RENDERBUFFER,Ht.__webglColorRenderbuffer[bt]);let ce=n.get(M[bt]).__webglTexture;e.bindFramebuffer(r.FRAMEBUFFER,Ht.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+bt,r.TEXTURE_2D,ce,0)}e.bindFramebuffer(r.DRAW_FRAMEBUFFER,Ht.__webglMultisampledFramebuffer)}else if(P.depthBuffer&&P.resolveDepthBuffer===!1&&c){let M=P.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[M])}}}function Ct(P){return Math.min(i.maxSamples,P.samples)}function pt(P){let M=n.get(P);return P.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&M.__useRenderToTexture!==!1}function Rt(P){let M=o.render.frame;h.get(P)!==M&&(h.set(P,M),P.update())}function Ft(P,M){let nt=P.colorSpace,lt=P.format,dt=P.type;return P.isCompressedTexture===!0||P.isVideoTexture===!0||nt!==Wr&&nt!==Nr&&(Oe.getTransfer(nt)===He?(lt!==ji||dt!==Hr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",nt)),M}function Ue(P){return typeof HTMLImageElement<"u"&&P instanceof HTMLImageElement?(l.width=P.naturalWidth||P.width,l.height=P.naturalHeight||P.height):typeof VideoFrame<"u"&&P instanceof VideoFrame?(l.width=P.displayWidth,l.height=P.displayHeight):(l.width=P.width,l.height=P.height),l}this.allocateTextureUnit=D,this.resetTextureUnits=y,this.setTexture2D=T,this.setTexture2DArray=L,this.setTexture3D=N,this.setTextureCube=J,this.rebindTextures=K,this.setupRenderTarget=Y,this.updateRenderTargetMipmap=R,this.updateMultisampleRenderTarget=Tt,this.setupDepthRenderbuffer=k,this.setupFrameBufferTexture=q,this.useMultisampledRTT=pt}function EM(r,t){function e(n,i=Nr){let s,o=Oe.getTransfer(i);if(n===Hr)return r.UNSIGNED_BYTE;if(n===zv)return r.UNSIGNED_SHORT_4_4_4_4;if(n===Vv)return r.UNSIGNED_SHORT_5_5_5_1;if(n===Q9)return r.UNSIGNED_INT_5_9_9_9_REV;if(n===J9)return r.BYTE;if(n===K9)return r.SHORT;if(n===Nv)return r.UNSIGNED_SHORT;if(n===Uv)return r.INT;if(n===zo)return r.UNSIGNED_INT;if(n===Ur)return r.FLOAT;if(n===Nh)return r.HALF_FLOAT;if(n===tb)return r.ALPHA;if(n===eb)return r.RGB;if(n===ji)return r.RGBA;if(n===nb)return r.LUMINANCE;if(n===ib)return r.LUMINANCE_ALPHA;if(n===Oo)return r.DEPTH_COMPONENT;if(n===yc)return r.DEPTH_STENCIL;if(n===rb)return r.RED;if(n===Hv)return r.RED_INTEGER;if(n===sb)return r.RG;if(n===Gv)return r.RG_INTEGER;if(n===Wv)return r.RGBA_INTEGER;if(n===dd||n===xd||n===fd||n===pd)if(o===He)if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===dd)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===xd)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===fd)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===pd)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=t.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===dd)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===xd)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===fd)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===pd)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===og||n===ag||n===cg||n===lg)if(s=t.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===og)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===ag)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===cg)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===lg)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===hg||n===ug||n===dg)if(s=t.get("WEBGL_compressed_texture_etc"),s!==null){if(n===hg||n===ug)return o===He?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===dg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===xg||n===fg||n===pg||n===mg||n===gg||n===vg||n===Eg||n===_g||n===Cg||n===yg||n===Ag||n===bg||n===wg||n===Sg)if(s=t.get("WEBGL_compressed_texture_astc"),s!==null){if(n===xg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===fg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===pg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===mg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===gg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===vg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Eg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===_g)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Cg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===yg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Ag)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===bg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===wg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Sg)return o===He?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===md||n===Mg||n===Dg)if(s=t.get("EXT_texture_compression_bptc"),s!==null){if(n===md)return o===He?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Mg)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Dg)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===ob||n===Bg||n===Tg||n===Fg)if(s=t.get("EXT_texture_compression_rgtc"),s!==null){if(n===md)return s.COMPRESSED_RED_RGTC1_EXT;if(n===Bg)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Tg)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Fg)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===Bc?r.UNSIGNED_INT_24_8:r[n]!==void 0?r[n]:null}return{convert:e}}var hx=class extends Tn{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}},Xi=class extends Bi{constructor(){super(),this.isGroup=!0,this.type="Group"}},_M={type:"move"},_c=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Xi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Xi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new I,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new I),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Xi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new I,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new I),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){let e=this._hand;if(e)for(let n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,n){let i=null,s=null,o=null,a=this._targetRay,c=this._grip,l=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(l&&t.hand){o=!0;for(let g of t.hand.values()){let f=e.getJointPose(g,n),p=this._getHandJoint(l,g);f!==null&&(p.matrix.fromArray(f.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,p.jointRadius=f.radius),p.visible=f!==null}let h=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],d=h.position.distanceTo(u.position),x=.02,m=.005;l.inputState.pinching&&d>x+m?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&d<=x-m&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else c!==null&&t.gripSpace&&(s=e.getPose(t.gripSpace,n),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(i=e.getPose(t.targetRaySpace,n),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(_M)))}return a!==null&&(a.visible=i!==null),c!==null&&(c.visible=s!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){let n=new Xi;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}},CM=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,yM=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`,ux=class{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,n){if(this.texture===null){let i=new jr,s=t.properties.get(i);s.__webglTexture=e.texture,(e.depthNear!=n.depthNear||e.depthFar!=n.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=i}}render(t,e){if(this.texture!==null){if(this.mesh===null){let n=e.cameras[0].viewport,i=new $i({vertexShader:CM,fragmentShader:yM,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new Wn(new Ah(20,20),i)}t.render(this.mesh,e)}}reset(){this.texture=null,this.mesh=null}},dx=class extends qi{constructor(t,e){super();let n=this,i=null,s=1,o=null,a="local-floor",c=1,l=null,h=null,u=null,d=null,x=null,m=null,g=new ux,f=e.getContextAttributes(),p=null,v=null,E=[],C=[],b=new Zt,A=null,w=new Tn;w.layers.enable(1),w.viewport=new je;let S=new Tn;S.layers.enable(2),S.viewport=new je;let _=[w,S],y=new hx;y.layers.enable(1),y.layers.enable(2);let D=null,F=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(q){let O=E[q];return O===void 0&&(O=new _c,E[q]=O),O.getTargetRaySpace()},this.getControllerGrip=function(q){let O=E[q];return O===void 0&&(O=new _c,E[q]=O),O.getGripSpace()},this.getHand=function(q){let O=E[q];return O===void 0&&(O=new _c,E[q]=O),O.getHandSpace()};function T(q){let O=C.indexOf(q.inputSource);if(O===-1)return;let V=E[O];V!==void 0&&(V.update(q.inputSource,q.frame,l||o),V.dispatchEvent({type:q.type,data:q.inputSource}))}function L(){i.removeEventListener("select",T),i.removeEventListener("selectstart",T),i.removeEventListener("selectend",T),i.removeEventListener("squeeze",T),i.removeEventListener("squeezestart",T),i.removeEventListener("squeezeend",T),i.removeEventListener("end",L),i.removeEventListener("inputsourceschange",N);for(let q=0;q<E.length;q++){let O=C[q];O!==null&&(C[q]=null,E[q].disconnect(O))}D=null,F=null,g.reset(),t.setRenderTarget(p),x=null,d=null,u=null,i=null,v=null,Jt.stop(),n.isPresenting=!1,t.setPixelRatio(A),t.setSize(b.width,b.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(q){s=q,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(q){a=q,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(q){l=q},this.getBaseLayer=function(){return d!==null?d:x},this.getBinding=function(){return u},this.getFrame=function(){return m},this.getSession=function(){return i},this.setSession=function(q){return Ut(this,null,function*(){if(i=q,i!==null){if(p=t.getRenderTarget(),i.addEventListener("select",T),i.addEventListener("selectstart",T),i.addEventListener("selectend",T),i.addEventListener("squeeze",T),i.addEventListener("squeezestart",T),i.addEventListener("squeezeend",T),i.addEventListener("end",L),i.addEventListener("inputsourceschange",N),f.xrCompatible!==!0&&(yield e.makeXRCompatible()),A=t.getPixelRatio(),t.getSize(b),i.renderState.layers===void 0){let O={antialias:f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:s};x=new XRWebGLLayer(i,e,O),i.updateRenderState({baseLayer:x}),t.setPixelRatio(1),t.setSize(x.framebufferWidth,x.framebufferHeight,!1),v=new pr(x.framebufferWidth,x.framebufferHeight,{format:ji,type:Hr,colorSpace:t.outputColorSpace,stencilBuffer:f.stencil})}else{let O=null,V=null,k=null;f.depth&&(k=f.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,O=f.stencil?yc:Oo,V=f.stencil?Bc:zo);let K={colorFormat:e.RGBA8,depthFormat:k,scaleFactor:s};u=new XRWebGLBinding(i,e),d=u.createProjectionLayer(K),i.updateRenderState({layers:[d]}),t.setPixelRatio(1),t.setSize(d.textureWidth,d.textureHeight,!1),v=new pr(d.textureWidth,d.textureHeight,{format:ji,type:Hr,depthTexture:new wh(d.textureWidth,d.textureHeight,V,void 0,void 0,void 0,void 0,void 0,void 0,O),stencilBuffer:f.stencil,colorSpace:t.outputColorSpace,samples:f.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}v.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=yield i.requestReferenceSpace(a),Jt.setContext(i),Jt.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}})},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode};function N(q){for(let O=0;O<q.removed.length;O++){let V=q.removed[O],k=C.indexOf(V);k>=0&&(C[k]=null,E[k].disconnect(V))}for(let O=0;O<q.added.length;O++){let V=q.added[O],k=C.indexOf(V);if(k===-1){for(let Y=0;Y<E.length;Y++)if(Y>=C.length){C.push(V),k=Y;break}else if(C[Y]===null){C[Y]=V,k=Y;break}if(k===-1)break}let K=E[k];K&&K.connect(V)}}let J=new I,tt=new I;function G(q,O,V){J.setFromMatrixPosition(O.matrixWorld),tt.setFromMatrixPosition(V.matrixWorld);let k=J.distanceTo(tt),K=O.projectionMatrix.elements,Y=V.projectionMatrix.elements,R=K[14]/(K[10]-1),vt=K[14]/(K[10]+1),ht=(K[9]+1)/K[5],Tt=(K[9]-1)/K[5],Ct=(K[8]-1)/K[0],pt=(Y[8]+1)/Y[0],Rt=R*Ct,Ft=R*pt,Ue=k/(-Ct+pt),P=Ue*-Ct;O.matrixWorld.decompose(q.position,q.quaternion,q.scale),q.translateX(P),q.translateZ(Ue),q.matrixWorld.compose(q.position,q.quaternion,q.scale),q.matrixWorldInverse.copy(q.matrixWorld).invert();let M=R+Ue,nt=vt+Ue,lt=Rt-P,dt=Ft+(k-P),xt=ht*vt/nt*M,Ht=Tt*vt/nt*M;q.projectionMatrix.makePerspective(lt,dt,xt,Ht,M,nt),q.projectionMatrixInverse.copy(q.projectionMatrix).invert()}function X(q,O){O===null?q.matrixWorld.copy(q.matrix):q.matrixWorld.multiplyMatrices(O.matrixWorld,q.matrix),q.matrixWorldInverse.copy(q.matrixWorld).invert()}this.updateCamera=function(q){if(i===null)return;g.texture!==null&&(q.near=g.depthNear,q.far=g.depthFar),y.near=S.near=w.near=q.near,y.far=S.far=w.far=q.far,(D!==y.near||F!==y.far)&&(i.updateRenderState({depthNear:y.near,depthFar:y.far}),D=y.near,F=y.far,w.near=D,w.far=F,S.near=D,S.far=F,w.updateProjectionMatrix(),S.updateProjectionMatrix(),q.updateProjectionMatrix());let O=q.parent,V=y.cameras;X(y,O);for(let k=0;k<V.length;k++)X(V[k],O);V.length===2?G(y,w,S):y.projectionMatrix.copy(w.projectionMatrix),st(q,y,O)};function st(q,O,V){V===null?q.matrix.copy(O.matrixWorld):(q.matrix.copy(V.matrixWorld),q.matrix.invert(),q.matrix.multiply(O.matrixWorld)),q.matrix.decompose(q.position,q.quaternion,q.scale),q.updateMatrixWorld(!0),q.projectionMatrix.copy(O.projectionMatrix),q.projectionMatrixInverse.copy(O.projectionMatrixInverse),q.isPerspectiveCamera&&(q.fov=Ac*2*Math.atan(1/q.projectionMatrix.elements[5]),q.zoom=1)}this.getCamera=function(){return y},this.getFoveation=function(){if(!(d===null&&x===null))return c},this.setFoveation=function(q){c=q,d!==null&&(d.fixedFoveation=q),x!==null&&x.fixedFoveation!==void 0&&(x.fixedFoveation=q)},this.hasDepthSensing=function(){return g.texture!==null};let ft=null;function mt(q,O){if(h=O.getViewerPose(l||o),m=O,h!==null){let V=h.views;x!==null&&(t.setRenderTargetFramebuffer(v,x.framebuffer),t.setRenderTarget(v));let k=!1;V.length!==y.cameras.length&&(y.cameras.length=0,k=!0);for(let Y=0;Y<V.length;Y++){let R=V[Y],vt=null;if(x!==null)vt=x.getViewport(R);else{let Tt=u.getViewSubImage(d,R);vt=Tt.viewport,Y===0&&(t.setRenderTargetTextures(v,Tt.colorTexture,d.ignoreDepthValues?void 0:Tt.depthStencilTexture),t.setRenderTarget(v))}let ht=_[Y];ht===void 0&&(ht=new Tn,ht.layers.enable(Y),ht.viewport=new je,_[Y]=ht),ht.matrix.fromArray(R.transform.matrix),ht.matrix.decompose(ht.position,ht.quaternion,ht.scale),ht.projectionMatrix.fromArray(R.projectionMatrix),ht.projectionMatrixInverse.copy(ht.projectionMatrix).invert(),ht.viewport.set(vt.x,vt.y,vt.width,vt.height),Y===0&&(y.matrix.copy(ht.matrix),y.matrix.decompose(y.position,y.quaternion,y.scale)),k===!0&&y.cameras.push(ht)}let K=i.enabledFeatures;if(K&&K.includes("depth-sensing")){let Y=u.getDepthInformation(V[0]);Y&&Y.isValid&&Y.texture&&g.init(t,Y,i.renderState)}}for(let V=0;V<E.length;V++){let k=C[V],K=E[V];k!==null&&K!==void 0&&K.update(k,O,l||o)}g.render(t,y),ft&&ft(q,O),O.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:O}),m=null}let Jt=new Zv;Jt.setAnimationLoop(mt),this.setAnimationLoop=function(q){ft=q},this.dispose=function(){}}},Ss=new Ps,AM=new Kt;function bM(r,t){function e(f,p){f.matrixAutoUpdate===!0&&f.updateMatrix(),p.value.copy(f.matrix)}function n(f,p){p.color.getRGB(f.fogColor.value,$v(r)),p.isFog?(f.fogNear.value=p.near,f.fogFar.value=p.far):p.isFogExp2&&(f.fogDensity.value=p.density)}function i(f,p,v,E,C){p.isMeshBasicMaterial||p.isMeshLambertMaterial?s(f,p):p.isMeshToonMaterial?(s(f,p),u(f,p)):p.isMeshPhongMaterial?(s(f,p),h(f,p)):p.isMeshStandardMaterial?(s(f,p),d(f,p),p.isMeshPhysicalMaterial&&x(f,p,C)):p.isMeshMatcapMaterial?(s(f,p),m(f,p)):p.isMeshDepthMaterial?s(f,p):p.isMeshDistanceMaterial?(s(f,p),g(f,p)):p.isMeshNormalMaterial?s(f,p):p.isLineBasicMaterial?(o(f,p),p.isLineDashedMaterial&&a(f,p)):p.isPointsMaterial?c(f,p,v,E):p.isSpriteMaterial?l(f,p):p.isShadowMaterial?(f.color.value.copy(p.color),f.opacity.value=p.opacity):p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)}function s(f,p){f.opacity.value=p.opacity,p.color&&f.diffuse.value.copy(p.color),p.emissive&&f.emissive.value.copy(p.emissive).multiplyScalar(p.emissiveIntensity),p.map&&(f.map.value=p.map,e(p.map,f.mapTransform)),p.alphaMap&&(f.alphaMap.value=p.alphaMap,e(p.alphaMap,f.alphaMapTransform)),p.bumpMap&&(f.bumpMap.value=p.bumpMap,e(p.bumpMap,f.bumpMapTransform),f.bumpScale.value=p.bumpScale,p.side===jn&&(f.bumpScale.value*=-1)),p.normalMap&&(f.normalMap.value=p.normalMap,e(p.normalMap,f.normalMapTransform),f.normalScale.value.copy(p.normalScale),p.side===jn&&f.normalScale.value.negate()),p.displacementMap&&(f.displacementMap.value=p.displacementMap,e(p.displacementMap,f.displacementMapTransform),f.displacementScale.value=p.displacementScale,f.displacementBias.value=p.displacementBias),p.emissiveMap&&(f.emissiveMap.value=p.emissiveMap,e(p.emissiveMap,f.emissiveMapTransform)),p.specularMap&&(f.specularMap.value=p.specularMap,e(p.specularMap,f.specularMapTransform)),p.alphaTest>0&&(f.alphaTest.value=p.alphaTest);let v=t.get(p),E=v.envMap,C=v.envMapRotation;if(E&&(f.envMap.value=E,Ss.copy(C),Ss.x*=-1,Ss.y*=-1,Ss.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(Ss.y*=-1,Ss.z*=-1),f.envMapRotation.value.setFromMatrix4(AM.makeRotationFromEuler(Ss)),f.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,f.reflectivity.value=p.reflectivity,f.ior.value=p.ior,f.refractionRatio.value=p.refractionRatio),p.lightMap){f.lightMap.value=p.lightMap;let b=r._useLegacyLights===!0?Math.PI:1;f.lightMapIntensity.value=p.lightMapIntensity*b,e(p.lightMap,f.lightMapTransform)}p.aoMap&&(f.aoMap.value=p.aoMap,f.aoMapIntensity.value=p.aoMapIntensity,e(p.aoMap,f.aoMapTransform))}function o(f,p){f.diffuse.value.copy(p.color),f.opacity.value=p.opacity,p.map&&(f.map.value=p.map,e(p.map,f.mapTransform))}function a(f,p){f.dashSize.value=p.dashSize,f.totalSize.value=p.dashSize+p.gapSize,f.scale.value=p.scale}function c(f,p,v,E){f.diffuse.value.copy(p.color),f.opacity.value=p.opacity,f.size.value=p.size*v,f.scale.value=E*.5,p.map&&(f.map.value=p.map,e(p.map,f.uvTransform)),p.alphaMap&&(f.alphaMap.value=p.alphaMap,e(p.alphaMap,f.alphaMapTransform)),p.alphaTest>0&&(f.alphaTest.value=p.alphaTest)}function l(f,p){f.diffuse.value.copy(p.color),f.opacity.value=p.opacity,f.rotation.value=p.rotation,p.map&&(f.map.value=p.map,e(p.map,f.mapTransform)),p.alphaMap&&(f.alphaMap.value=p.alphaMap,e(p.alphaMap,f.alphaMapTransform)),p.alphaTest>0&&(f.alphaTest.value=p.alphaTest)}function h(f,p){f.specular.value.copy(p.specular),f.shininess.value=Math.max(p.shininess,1e-4)}function u(f,p){p.gradientMap&&(f.gradientMap.value=p.gradientMap)}function d(f,p){f.metalness.value=p.metalness,p.metalnessMap&&(f.metalnessMap.value=p.metalnessMap,e(p.metalnessMap,f.metalnessMapTransform)),f.roughness.value=p.roughness,p.roughnessMap&&(f.roughnessMap.value=p.roughnessMap,e(p.roughnessMap,f.roughnessMapTransform)),p.envMap&&(f.envMapIntensity.value=p.envMapIntensity)}function x(f,p,v){f.ior.value=p.ior,p.sheen>0&&(f.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),f.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(f.sheenColorMap.value=p.sheenColorMap,e(p.sheenColorMap,f.sheenColorMapTransform)),p.sheenRoughnessMap&&(f.sheenRoughnessMap.value=p.sheenRoughnessMap,e(p.sheenRoughnessMap,f.sheenRoughnessMapTransform))),p.clearcoat>0&&(f.clearcoat.value=p.clearcoat,f.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(f.clearcoatMap.value=p.clearcoatMap,e(p.clearcoatMap,f.clearcoatMapTransform)),p.clearcoatRoughnessMap&&(f.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap,e(p.clearcoatRoughnessMap,f.clearcoatRoughnessMapTransform)),p.clearcoatNormalMap&&(f.clearcoatNormalMap.value=p.clearcoatNormalMap,e(p.clearcoatNormalMap,f.clearcoatNormalMapTransform),f.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),p.side===jn&&f.clearcoatNormalScale.value.negate())),p.dispersion>0&&(f.dispersion.value=p.dispersion),p.iridescence>0&&(f.iridescence.value=p.iridescence,f.iridescenceIOR.value=p.iridescenceIOR,f.iridescenceThicknessMinimum.value=p.iridescenceThicknessRange[0],f.iridescenceThicknessMaximum.value=p.iridescenceThicknessRange[1],p.iridescenceMap&&(f.iridescenceMap.value=p.iridescenceMap,e(p.iridescenceMap,f.iridescenceMapTransform)),p.iridescenceThicknessMap&&(f.iridescenceThicknessMap.value=p.iridescenceThicknessMap,e(p.iridescenceThicknessMap,f.iridescenceThicknessMapTransform))),p.transmission>0&&(f.transmission.value=p.transmission,f.transmissionSamplerMap.value=v.texture,f.transmissionSamplerSize.value.set(v.width,v.height),p.transmissionMap&&(f.transmissionMap.value=p.transmissionMap,e(p.transmissionMap,f.transmissionMapTransform)),f.thickness.value=p.thickness,p.thicknessMap&&(f.thicknessMap.value=p.thicknessMap,e(p.thicknessMap,f.thicknessMapTransform)),f.attenuationDistance.value=p.attenuationDistance,f.attenuationColor.value.copy(p.attenuationColor)),p.anisotropy>0&&(f.anisotropyVector.value.set(p.anisotropy*Math.cos(p.anisotropyRotation),p.anisotropy*Math.sin(p.anisotropyRotation)),p.anisotropyMap&&(f.anisotropyMap.value=p.anisotropyMap,e(p.anisotropyMap,f.anisotropyMapTransform))),f.specularIntensity.value=p.specularIntensity,f.specularColor.value.copy(p.specularColor),p.specularColorMap&&(f.specularColorMap.value=p.specularColorMap,e(p.specularColorMap,f.specularColorMapTransform)),p.specularIntensityMap&&(f.specularIntensityMap.value=p.specularIntensityMap,e(p.specularIntensityMap,f.specularIntensityMapTransform))}function m(f,p){p.matcap&&(f.matcap.value=p.matcap)}function g(f,p){let v=t.get(p).light;f.referencePosition.value.setFromMatrixPosition(v.matrixWorld),f.nearDistance.value=v.shadow.camera.near,f.farDistance.value=v.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function wM(r,t,e,n){let i={},s={},o=[],a=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS);function c(v,E){let C=E.program;n.uniformBlockBinding(v,C)}function l(v,E){let C=i[v.id];C===void 0&&(m(v),C=h(v),i[v.id]=C,v.addEventListener("dispose",f));let b=E.program;n.updateUBOMapping(v,b);let A=t.render.frame;s[v.id]!==A&&(d(v),s[v.id]=A)}function h(v){let E=u();v.__bindingPointIndex=E;let C=r.createBuffer(),b=v.__size,A=v.usage;return r.bindBuffer(r.UNIFORM_BUFFER,C),r.bufferData(r.UNIFORM_BUFFER,b,A),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,E,C),C}function u(){for(let v=0;v<a;v++)if(o.indexOf(v)===-1)return o.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(v){let E=i[v.id],C=v.uniforms,b=v.__cache;r.bindBuffer(r.UNIFORM_BUFFER,E);for(let A=0,w=C.length;A<w;A++){let S=Array.isArray(C[A])?C[A]:[C[A]];for(let _=0,y=S.length;_<y;_++){let D=S[_];if(x(D,A,_,b)===!0){let F=D.__offset,T=Array.isArray(D.value)?D.value:[D.value],L=0;for(let N=0;N<T.length;N++){let J=T[N],tt=g(J);typeof J=="number"||typeof J=="boolean"?(D.__data[0]=J,r.bufferSubData(r.UNIFORM_BUFFER,F+L,D.__data)):J.isMatrix3?(D.__data[0]=J.elements[0],D.__data[1]=J.elements[1],D.__data[2]=J.elements[2],D.__data[3]=0,D.__data[4]=J.elements[3],D.__data[5]=J.elements[4],D.__data[6]=J.elements[5],D.__data[7]=0,D.__data[8]=J.elements[6],D.__data[9]=J.elements[7],D.__data[10]=J.elements[8],D.__data[11]=0):(J.toArray(D.__data,L),L+=tt.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,F,D.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function x(v,E,C,b){let A=v.value,w=E+"_"+C;if(b[w]===void 0)return typeof A=="number"||typeof A=="boolean"?b[w]=A:b[w]=A.clone(),!0;{let S=b[w];if(typeof A=="number"||typeof A=="boolean"){if(S!==A)return b[w]=A,!0}else if(S.equals(A)===!1)return S.copy(A),!0}return!1}function m(v){let E=v.uniforms,C=0,b=16;for(let w=0,S=E.length;w<S;w++){let _=Array.isArray(E[w])?E[w]:[E[w]];for(let y=0,D=_.length;y<D;y++){let F=_[y],T=Array.isArray(F.value)?F.value:[F.value];for(let L=0,N=T.length;L<N;L++){let J=T[L],tt=g(J),G=C%b;G!==0&&b-G<tt.boundary&&(C+=b-G),F.__data=new Float32Array(tt.storage/Float32Array.BYTES_PER_ELEMENT),F.__offset=C,C+=tt.storage}}}let A=C%b;return A>0&&(C+=b-A),v.__size=C,v.__cache={},this}function g(v){let E={boundary:0,storage:0};return typeof v=="number"||typeof v=="boolean"?(E.boundary=4,E.storage=4):v.isVector2?(E.boundary=8,E.storage=8):v.isVector3||v.isColor?(E.boundary=16,E.storage=12):v.isVector4?(E.boundary=16,E.storage=16):v.isMatrix3?(E.boundary=48,E.storage=48):v.isMatrix4?(E.boundary=64,E.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),E}function f(v){let E=v.target;E.removeEventListener("dispose",f);let C=o.indexOf(E.__bindingPointIndex);o.splice(C,1),r.deleteBuffer(i[E.id]),delete i[E.id],delete s[E.id]}function p(){for(let v in i)r.deleteBuffer(i[v]);o=[],i={},s={}}return{bind:c,update:l,dispose:p}}var Sh=class{constructor(t={}){let{canvas:e=Rb(),context:n=null,depth:i=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:u=!1}=t;this.isWebGLRenderer=!0;let d;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=n.getContextAttributes().alpha}else d=o;let x=new Uint32Array(4),m=new Int32Array(4),g=null,f=null,p=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=li,this._useLegacyLights=!1,this.toneMapping=Vr,this.toneMappingExposure=1;let E=this,C=!1,b=0,A=0,w=null,S=-1,_=null,y=new je,D=new je,F=null,T=new $t(0),L=0,N=e.width,J=e.height,tt=1,G=null,X=null,st=new je(0,0,N,J),ft=new je(0,0,N,J),mt=!1,Jt=new Mc,q=!1,O=!1,V=new Kt,k=new I,K={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Y(){return w===null?tt:1}let R=n;function vt(B,W){return e.getContext(B,W)}try{let B={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Tx}`),e.addEventListener("webglcontextlost",H,!1),e.addEventListener("webglcontextrestored",ut,!1),e.addEventListener("webglcontextcreationerror",ct,!1),R===null){let W="webgl2";if(R=vt(W,B),R===null)throw vt(W)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(B){throw console.error("THREE.WebGLRenderer: "+B.message),B}let ht,Tt,Ct,pt,Rt,Ft,Ue,P,M,nt,lt,dt,xt,Ht,wt,bt,ce,Et,Nt,_e,jt,Bt,le,pe;function $e(){ht=new WS(R),ht.init(),Bt=new EM(R,ht),Tt=new NS(R,ht,t,Bt),Ct=new gM(R),pt=new YS(R),Rt=new sM,Ft=new vM(R,ht,Ct,Rt,Tt,Bt,pt),Ue=new zS(E),P=new GS(E),M=new t2(R),le=new IS(R,M),nt=new jS(R,M,pt,le),lt=new $S(R,nt,M,pt),Nt=new qS(R,Tt,Ft),bt=new US(Rt),dt=new rM(E,Ue,P,ht,Tt,le,bt),xt=new bM(E,Rt),Ht=new aM,wt=new xM(ht),Et=new OS(E,Ue,P,Ct,lt,d,c),ce=new mM(E,lt,Tt),pe=new wM(R,pt,Tt,Ct),_e=new LS(R,ht,pt),jt=new XS(R,ht,pt),pt.programs=dt.programs,E.capabilities=Tt,E.extensions=ht,E.properties=Rt,E.renderLists=Ht,E.shadowMap=ce,E.state=Ct,E.info=pt}$e();let he=new dx(E,R);this.xr=he,this.getContext=function(){return R},this.getContextAttributes=function(){return R.getContextAttributes()},this.forceContextLoss=function(){let B=ht.get("WEBGL_lose_context");B&&B.loseContext()},this.forceContextRestore=function(){let B=ht.get("WEBGL_lose_context");B&&B.restoreContext()},this.getPixelRatio=function(){return tt},this.setPixelRatio=function(B){B!==void 0&&(tt=B,this.setSize(N,J,!1))},this.getSize=function(B){return B.set(N,J)},this.setSize=function(B,W,et=!0){if(he.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}N=B,J=W,e.width=Math.floor(B*tt),e.height=Math.floor(W*tt),et===!0&&(e.style.width=B+"px",e.style.height=W+"px"),this.setViewport(0,0,B,W)},this.getDrawingBufferSize=function(B){return B.set(N*tt,J*tt).floor()},this.setDrawingBufferSize=function(B,W,et){N=B,J=W,tt=et,e.width=Math.floor(B*et),e.height=Math.floor(W*et),this.setViewport(0,0,B,W)},this.getCurrentViewport=function(B){return B.copy(y)},this.getViewport=function(B){return B.copy(st)},this.setViewport=function(B,W,et,$){B.isVector4?st.set(B.x,B.y,B.z,B.w):st.set(B,W,et,$),Ct.viewport(y.copy(st).multiplyScalar(tt).round())},this.getScissor=function(B){return B.copy(ft)},this.setScissor=function(B,W,et,$){B.isVector4?ft.set(B.x,B.y,B.z,B.w):ft.set(B,W,et,$),Ct.scissor(D.copy(ft).multiplyScalar(tt).round())},this.getScissorTest=function(){return mt},this.setScissorTest=function(B){Ct.setScissorTest(mt=B)},this.setOpaqueSort=function(B){G=B},this.setTransparentSort=function(B){X=B},this.getClearColor=function(B){return B.copy(Et.getClearColor())},this.setClearColor=function(){Et.setClearColor.apply(Et,arguments)},this.getClearAlpha=function(){return Et.getClearAlpha()},this.setClearAlpha=function(){Et.setClearAlpha.apply(Et,arguments)},this.clear=function(B=!0,W=!0,et=!0){let $=0;if(B){let Z=!1;if(w!==null){let At=w.texture.format;Z=At===Wv||At===Gv||At===Hv}if(Z){let At=w.texture.type,Pt=At===Hr||At===zo||At===Nv||At===Bc||At===zv||At===Vv,kt=Et.getClearColor(),Xt=Et.getClearAlpha(),Qt=kt.r,se=kt.g,de=kt.b;Pt?(x[0]=Qt,x[1]=se,x[2]=de,x[3]=Xt,R.clearBufferuiv(R.COLOR,0,x)):(m[0]=Qt,m[1]=se,m[2]=de,m[3]=Xt,R.clearBufferiv(R.COLOR,0,m))}else $|=R.COLOR_BUFFER_BIT}W&&($|=R.DEPTH_BUFFER_BIT),et&&($|=R.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),R.clear($)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",H,!1),e.removeEventListener("webglcontextrestored",ut,!1),e.removeEventListener("webglcontextcreationerror",ct,!1),Ht.dispose(),wt.dispose(),Rt.dispose(),Ue.dispose(),P.dispose(),lt.dispose(),le.dispose(),pe.dispose(),dt.dispose(),he.dispose(),he.removeEventListener("sessionstart",Pe),he.removeEventListener("sessionend",Ui),kn.stop()};function H(B){B.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),C=!0}function ut(){console.log("THREE.WebGLRenderer: Context Restored."),C=!1;let B=pt.autoReset,W=ce.enabled,et=ce.autoUpdate,$=ce.needsUpdate,Z=ce.type;$e(),pt.autoReset=B,ce.enabled=W,ce.autoUpdate=et,ce.needsUpdate=$,ce.type=Z}function ct(B){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",B.statusMessage)}function yt(B){let W=B.target;W.removeEventListener("dispose",yt),Mt(W)}function Mt(B){ye(B),Rt.remove(B)}function ye(B){let W=Rt.get(B).programs;W!==void 0&&(W.forEach(function(et){dt.releaseProgram(et)}),B.isShaderMaterial&&dt.releaseShaderCache(B))}this.renderBufferDirect=function(B,W,et,$,Z,At){W===null&&(W=K);let Pt=Z.isMesh&&Z.matrixWorld.determinant()<0,kt=CC(B,W,et,$,Z);Ct.setMaterial($,Pt);let Xt=et.index,Qt=1;if($.wireframe===!0){if(Xt=nt.getWireframeAttribute(et),Xt===void 0)return;Qt=2}let se=et.drawRange,de=et.attributes.position,en=se.start*Qt,wn=(se.start+se.count)*Qt;At!==null&&(en=Math.max(en,At.start*Qt),wn=Math.min(wn,(At.start+At.count)*Qt)),Xt!==null?(en=Math.max(en,0),wn=Math.min(wn,Xt.count)):de!=null&&(en=Math.max(en,0),wn=Math.min(wn,de.count));let qn=wn-en;if(qn<0||qn===1/0)return;le.setup(Z,$,kt,et,Xt);let rr,Te=_e;if(Xt!==null&&(rr=M.get(Xt),Te=jt,Te.setIndex(rr)),Z.isMesh)$.wireframe===!0?(Ct.setLineWidth($.wireframeLinewidth*Y()),Te.setMode(R.LINES)):Te.setMode(R.TRIANGLES);else if(Z.isLine){let te=$.linewidth;te===void 0&&(te=1),Ct.setLineWidth(te*Y()),Z.isLineSegments?Te.setMode(R.LINES):Z.isLineLoop?Te.setMode(R.LINE_LOOP):Te.setMode(R.LINE_STRIP)}else Z.isPoints?Te.setMode(R.POINTS):Z.isSprite&&Te.setMode(R.TRIANGLES);if(Z.isBatchedMesh)Z._multiDrawInstances!==null?Te.renderMultiDrawInstances(Z._multiDrawStarts,Z._multiDrawCounts,Z._multiDrawCount,Z._multiDrawInstances):Te.renderMultiDraw(Z._multiDrawStarts,Z._multiDrawCounts,Z._multiDrawCount);else if(Z.isInstancedMesh)Te.renderInstances(en,qn,Z.count);else if(et.isInstancedBufferGeometry){let te=et._maxInstanceCount!==void 0?et._maxInstanceCount:1/0,Ia=Math.min(et.instanceCount,te);Te.renderInstances(en,qn,Ia)}else Te.render(en,qn)};function ze(B,W,et){B.transparent===!0&&B.side===xr&&B.forceSinglePass===!1?(B.side=jn,B.needsUpdate=!0,ll(B,W,et),B.side=Yi,B.needsUpdate=!0,ll(B,W,et),B.side=xr):ll(B,W,et)}this.compile=function(B,W,et=null){et===null&&(et=B),f=wt.get(et),f.init(W),v.push(f),et.traverseVisible(function(Z){Z.isLight&&Z.layers.test(W.layers)&&(f.pushLight(Z),Z.castShadow&&f.pushShadow(Z))}),B!==et&&B.traverseVisible(function(Z){Z.isLight&&Z.layers.test(W.layers)&&(f.pushLight(Z),Z.castShadow&&f.pushShadow(Z))}),f.setupLights(E._useLegacyLights);let $=new Set;return B.traverse(function(Z){let At=Z.material;if(At)if(Array.isArray(At))for(let Pt=0;Pt<At.length;Pt++){let kt=At[Pt];ze(kt,et,Z),$.add(kt)}else ze(At,et,Z),$.add(At)}),v.pop(),f=null,$},this.compileAsync=function(B,W,et=null){let $=this.compile(B,W,et);return new Promise(Z=>{function At(){if($.forEach(function(Pt){Rt.get(Pt).currentProgram.isReady()&&$.delete(Pt)}),$.size===0){Z(B);return}setTimeout(At,10)}ht.get("KHR_parallel_shader_compile")!==null?At():setTimeout(At,10)})};let Ye=null;function bn(B){Ye&&Ye(B)}function Pe(){kn.stop()}function Ui(){kn.start()}let kn=new Zv;kn.setAnimationLoop(bn),typeof self<"u"&&kn.setContext(self),this.setAnimationLoop=function(B){Ye=B,he.setAnimationLoop(B),B===null?kn.stop():kn.start()},he.addEventListener("sessionstart",Pe),he.addEventListener("sessionend",Ui),this.render=function(B,W){if(W!==void 0&&W.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(C===!0)return;B.matrixWorldAutoUpdate===!0&&B.updateMatrixWorld(),W.parent===null&&W.matrixWorldAutoUpdate===!0&&W.updateMatrixWorld(),he.enabled===!0&&he.isPresenting===!0&&(he.cameraAutoUpdate===!0&&he.updateCamera(W),W=he.getCamera()),B.isScene===!0&&B.onBeforeRender(E,B,W,w),f=wt.get(B,v.length),f.init(W),v.push(f),V.multiplyMatrices(W.projectionMatrix,W.matrixWorldInverse),Jt.setFromProjectionMatrix(V),O=this.localClippingEnabled,q=bt.init(this.clippingPlanes,O),g=Ht.get(B,p.length),g.init(),p.push(g),vp(B,W,0,E.sortObjects),g.finish(),E.sortObjects===!0&&g.sort(G,X);let et=he.enabled===!1||he.isPresenting===!1||he.hasDepthSensing()===!1;et&&Et.addToRenderList(g,B),this.info.render.frame++,q===!0&&bt.beginShadows();let $=f.state.shadowsArray;ce.render($,B,W),q===!0&&bt.endShadows(),this.info.autoReset===!0&&this.info.reset();let Z=g.opaque,At=g.transmissive;if(f.setupLights(E._useLegacyLights),W.isArrayCamera){let Pt=W.cameras;if(At.length>0)for(let kt=0,Xt=Pt.length;kt<Xt;kt++){let Qt=Pt[kt];_p(Z,At,B,Qt)}et&&Et.render(B);for(let kt=0,Xt=Pt.length;kt<Xt;kt++){let Qt=Pt[kt];Ep(g,B,Qt,Qt.viewport)}}else At.length>0&&_p(Z,At,B,W),et&&Et.render(B),Ep(g,B,W);w!==null&&(Ft.updateMultisampleRenderTarget(w),Ft.updateRenderTargetMipmap(w)),B.isScene===!0&&B.onAfterRender(E,B,W),le.resetDefaultState(),S=-1,_=null,v.pop(),v.length>0?(f=v[v.length-1],q===!0&&bt.setGlobalState(E.clippingPlanes,f.state.camera)):f=null,p.pop(),p.length>0?g=p[p.length-1]:g=null};function vp(B,W,et,$){if(B.visible===!1)return;if(B.layers.test(W.layers)){if(B.isGroup)et=B.renderOrder;else if(B.isLOD)B.autoUpdate===!0&&B.update(W);else if(B.isLight)f.pushLight(B),B.castShadow&&f.pushShadow(B);else if(B.isSprite){if(!B.frustumCulled||Jt.intersectsSprite(B)){$&&k.setFromMatrixPosition(B.matrixWorld).applyMatrix4(V);let Pt=lt.update(B),kt=B.material;kt.visible&&g.push(B,Pt,kt,et,k.z,null)}}else if((B.isMesh||B.isLine||B.isPoints)&&(!B.frustumCulled||Jt.intersectsObject(B))){let Pt=lt.update(B),kt=B.material;if($&&(B.boundingSphere!==void 0?(B.boundingSphere===null&&B.computeBoundingSphere(),k.copy(B.boundingSphere.center)):(Pt.boundingSphere===null&&Pt.computeBoundingSphere(),k.copy(Pt.boundingSphere.center)),k.applyMatrix4(B.matrixWorld).applyMatrix4(V)),Array.isArray(kt)){let Xt=Pt.groups;for(let Qt=0,se=Xt.length;Qt<se;Qt++){let de=Xt[Qt],en=kt[de.materialIndex];en&&en.visible&&g.push(B,Pt,en,et,k.z,de)}}else kt.visible&&g.push(B,Pt,kt,et,k.z,null)}}let At=B.children;for(let Pt=0,kt=At.length;Pt<kt;Pt++)vp(At[Pt],W,et,$)}function Ep(B,W,et,$){let Z=B.opaque,At=B.transmissive,Pt=B.transparent;f.setupLightsView(et),q===!0&&bt.setGlobalState(E.clippingPlanes,et),$&&Ct.viewport(y.copy($)),Z.length>0&&cl(Z,W,et),At.length>0&&cl(At,W,et),Pt.length>0&&cl(Pt,W,et),Ct.buffers.depth.setTest(!0),Ct.buffers.depth.setMask(!0),Ct.buffers.color.setMask(!0),Ct.setPolygonOffset(!1)}function _p(B,W,et,$){if((et.isScene===!0?et.overrideMaterial:null)!==null)return;f.state.transmissionRenderTarget[$.id]===void 0&&(f.state.transmissionRenderTarget[$.id]=new pr(1,1,{generateMipmaps:!0,type:ht.has("EXT_color_buffer_half_float")||ht.has("EXT_color_buffer_float")?Nh:Hr,minFilter:Fs,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1}));let At=f.state.transmissionRenderTarget[$.id],Pt=$.viewport||y;At.setSize(Pt.z,Pt.w);let kt=E.getRenderTarget();E.setRenderTarget(At),E.getClearColor(T),L=E.getClearAlpha(),L<1&&E.setClearColor(16777215,.5),E.clear();let Xt=E.toneMapping;E.toneMapping=Vr;let Qt=$.viewport;if($.viewport!==void 0&&($.viewport=void 0),f.setupLightsView($),q===!0&&bt.setGlobalState(E.clippingPlanes,$),cl(B,et,$),Ft.updateMultisampleRenderTarget(At),Ft.updateRenderTargetMipmap(At),ht.has("WEBGL_multisampled_render_to_texture")===!1){let se=!1;for(let de=0,en=W.length;de<en;de++){let wn=W[de],qn=wn.object,rr=wn.geometry,Te=wn.material,te=wn.group;if(Te.side===xr&&qn.layers.test($.layers)){let Ia=Te.side;Te.side=jn,Te.needsUpdate=!0,Cp(qn,et,$,rr,Te,te),Te.side=Ia,Te.needsUpdate=!0,se=!0}}se===!0&&(Ft.updateMultisampleRenderTarget(At),Ft.updateRenderTargetMipmap(At))}E.setRenderTarget(kt),E.setClearColor(T,L),Qt!==void 0&&($.viewport=Qt),E.toneMapping=Xt}function cl(B,W,et){let $=W.isScene===!0?W.overrideMaterial:null;for(let Z=0,At=B.length;Z<At;Z++){let Pt=B[Z],kt=Pt.object,Xt=Pt.geometry,Qt=$===null?Pt.material:$,se=Pt.group;kt.layers.test(et.layers)&&Cp(kt,W,et,Xt,Qt,se)}}function Cp(B,W,et,$,Z,At){B.onBeforeRender(E,W,et,$,Z,At),B.modelViewMatrix.multiplyMatrices(et.matrixWorldInverse,B.matrixWorld),B.normalMatrix.getNormalMatrix(B.modelViewMatrix),Z.onBeforeRender(E,W,et,$,B,At),Z.transparent===!0&&Z.side===xr&&Z.forceSinglePass===!1?(Z.side=jn,Z.needsUpdate=!0,E.renderBufferDirect(et,W,$,Z,B,At),Z.side=Yi,Z.needsUpdate=!0,E.renderBufferDirect(et,W,$,Z,B,At),Z.side=xr):E.renderBufferDirect(et,W,$,Z,B,At),B.onAfterRender(E,W,et,$,Z,At)}function ll(B,W,et){W.isScene!==!0&&(W=K);let $=Rt.get(B),Z=f.state.lights,At=f.state.shadowsArray,Pt=Z.state.version,kt=dt.getParameters(B,Z.state,At,W,et),Xt=dt.getProgramCacheKey(kt),Qt=$.programs;$.environment=B.isMeshStandardMaterial?W.environment:null,$.fog=W.fog,$.envMap=(B.isMeshStandardMaterial?P:Ue).get(B.envMap||$.environment),$.envMapRotation=$.environment!==null&&B.envMap===null?W.environmentRotation:B.envMapRotation,Qt===void 0&&(B.addEventListener("dispose",yt),Qt=new Map,$.programs=Qt);let se=Qt.get(Xt);if(se!==void 0){if($.currentProgram===se&&$.lightsStateVersion===Pt)return Ap(B,kt),se}else kt.uniforms=dt.getUniforms(B),B.onBuild(et,kt,E),B.onBeforeCompile(kt,E),se=dt.acquireProgram(kt,Xt),Qt.set(Xt,se),$.uniforms=kt.uniforms;let de=$.uniforms;return(!B.isShaderMaterial&&!B.isRawShaderMaterial||B.clipping===!0)&&(de.clippingPlanes=bt.uniform),Ap(B,kt),$.needsLights=AC(B),$.lightsStateVersion=Pt,$.needsLights&&(de.ambientLightColor.value=Z.state.ambient,de.lightProbe.value=Z.state.probe,de.directionalLights.value=Z.state.directional,de.directionalLightShadows.value=Z.state.directionalShadow,de.spotLights.value=Z.state.spot,de.spotLightShadows.value=Z.state.spotShadow,de.rectAreaLights.value=Z.state.rectArea,de.ltc_1.value=Z.state.rectAreaLTC1,de.ltc_2.value=Z.state.rectAreaLTC2,de.pointLights.value=Z.state.point,de.pointLightShadows.value=Z.state.pointShadow,de.hemisphereLights.value=Z.state.hemi,de.directionalShadowMap.value=Z.state.directionalShadowMap,de.directionalShadowMatrix.value=Z.state.directionalShadowMatrix,de.spotShadowMap.value=Z.state.spotShadowMap,de.spotLightMatrix.value=Z.state.spotLightMatrix,de.spotLightMap.value=Z.state.spotLightMap,de.pointShadowMap.value=Z.state.pointShadowMap,de.pointShadowMatrix.value=Z.state.pointShadowMatrix),$.currentProgram=se,$.uniformsList=null,se}function yp(B){if(B.uniformsList===null){let W=B.currentProgram.getUniforms();B.uniformsList=Lo.seqWithValue(W.seq,B.uniforms)}return B.uniformsList}function Ap(B,W){let et=Rt.get(B);et.outputColorSpace=W.outputColorSpace,et.batching=W.batching,et.instancing=W.instancing,et.instancingColor=W.instancingColor,et.instancingMorph=W.instancingMorph,et.skinning=W.skinning,et.morphTargets=W.morphTargets,et.morphNormals=W.morphNormals,et.morphColors=W.morphColors,et.morphTargetsCount=W.morphTargetsCount,et.numClippingPlanes=W.numClippingPlanes,et.numIntersection=W.numClipIntersection,et.vertexAlphas=W.vertexAlphas,et.vertexTangents=W.vertexTangents,et.toneMapping=W.toneMapping}function CC(B,W,et,$,Z){W.isScene!==!0&&(W=K),Ft.resetTextureUnits();let At=W.fog,Pt=$.isMeshStandardMaterial?W.environment:null,kt=w===null?E.outputColorSpace:w.isXRRenderTarget===!0?w.texture.colorSpace:Wr,Xt=($.isMeshStandardMaterial?P:Ue).get($.envMap||Pt),Qt=$.vertexColors===!0&&!!et.attributes.color&&et.attributes.color.itemSize===4,se=!!et.attributes.tangent&&(!!$.normalMap||$.anisotropy>0),de=!!et.morphAttributes.position,en=!!et.morphAttributes.normal,wn=!!et.morphAttributes.color,qn=Vr;$.toneMapped&&(w===null||w.isXRRenderTarget===!0)&&(qn=E.toneMapping);let rr=et.morphAttributes.position||et.morphAttributes.normal||et.morphAttributes.color,Te=rr!==void 0?rr.length:0,te=Rt.get($),Ia=f.state.lights;if(q===!0&&(O===!0||B!==_)){let ni=B===_&&$.id===S;bt.setState($,B,ni)}let Ge=!1;$.version===te.__version?(te.needsLights&&te.lightsStateVersion!==Ia.state.version||te.outputColorSpace!==kt||Z.isBatchedMesh&&te.batching===!1||!Z.isBatchedMesh&&te.batching===!0||Z.isInstancedMesh&&te.instancing===!1||!Z.isInstancedMesh&&te.instancing===!0||Z.isSkinnedMesh&&te.skinning===!1||!Z.isSkinnedMesh&&te.skinning===!0||Z.isInstancedMesh&&te.instancingColor===!0&&Z.instanceColor===null||Z.isInstancedMesh&&te.instancingColor===!1&&Z.instanceColor!==null||Z.isInstancedMesh&&te.instancingMorph===!0&&Z.morphTexture===null||Z.isInstancedMesh&&te.instancingMorph===!1&&Z.morphTexture!==null||te.envMap!==Xt||$.fog===!0&&te.fog!==At||te.numClippingPlanes!==void 0&&(te.numClippingPlanes!==bt.numPlanes||te.numIntersection!==bt.numIntersection)||te.vertexAlphas!==Qt||te.vertexTangents!==se||te.morphTargets!==de||te.morphNormals!==en||te.morphColors!==wn||te.toneMapping!==qn||te.morphTargetsCount!==Te)&&(Ge=!0):(Ge=!0,te.__version=$.version);let us=te.currentProgram;Ge===!0&&(us=ll($,W,Z));let bp=!1,La=!1,J0=!1,Sn=us.getUniforms(),wr=te.uniforms;if(Ct.useProgram(us.program)&&(bp=!0,La=!0,J0=!0),$.id!==S&&(S=$.id,La=!0),bp||_!==B){Sn.setValue(R,"projectionMatrix",B.projectionMatrix),Sn.setValue(R,"viewMatrix",B.matrixWorldInverse);let ni=Sn.map.cameraPosition;ni!==void 0&&ni.setValue(R,k.setFromMatrixPosition(B.matrixWorld)),Tt.logarithmicDepthBuffer&&Sn.setValue(R,"logDepthBufFC",2/(Math.log(B.far+1)/Math.LN2)),($.isMeshPhongMaterial||$.isMeshToonMaterial||$.isMeshLambertMaterial||$.isMeshBasicMaterial||$.isMeshStandardMaterial||$.isShaderMaterial)&&Sn.setValue(R,"isOrthographic",B.isOrthographicCamera===!0),_!==B&&(_=B,La=!0,J0=!0)}if(Z.isSkinnedMesh){Sn.setOptional(R,Z,"bindMatrix"),Sn.setOptional(R,Z,"bindMatrixInverse");let ni=Z.skeleton;ni&&(ni.boneTexture===null&&ni.computeBoneTexture(),Sn.setValue(R,"boneTexture",ni.boneTexture,Ft))}Z.isBatchedMesh&&(Sn.setOptional(R,Z,"batchingTexture"),Sn.setValue(R,"batchingTexture",Z._matricesTexture,Ft));let K0=et.morphAttributes;if((K0.position!==void 0||K0.normal!==void 0||K0.color!==void 0)&&Nt.update(Z,et,us),(La||te.receiveShadow!==Z.receiveShadow)&&(te.receiveShadow=Z.receiveShadow,Sn.setValue(R,"receiveShadow",Z.receiveShadow)),$.isMeshGouraudMaterial&&$.envMap!==null&&(wr.envMap.value=Xt,wr.flipEnvMap.value=Xt.isCubeTexture&&Xt.isRenderTargetTexture===!1?-1:1),$.isMeshStandardMaterial&&$.envMap===null&&W.environment!==null&&(wr.envMapIntensity.value=W.environmentIntensity),La&&(Sn.setValue(R,"toneMappingExposure",E.toneMappingExposure),te.needsLights&&yC(wr,J0),At&&$.fog===!0&&xt.refreshFogUniforms(wr,At),xt.refreshMaterialUniforms(wr,$,tt,J,f.state.transmissionRenderTarget[B.id]),Lo.upload(R,yp(te),wr,Ft)),$.isShaderMaterial&&$.uniformsNeedUpdate===!0&&(Lo.upload(R,yp(te),wr,Ft),$.uniformsNeedUpdate=!1),$.isSpriteMaterial&&Sn.setValue(R,"center",Z.center),Sn.setValue(R,"modelViewMatrix",Z.modelViewMatrix),Sn.setValue(R,"normalMatrix",Z.normalMatrix),Sn.setValue(R,"modelMatrix",Z.matrixWorld),$.isShaderMaterial||$.isRawShaderMaterial){let ni=$.uniformsGroups;for(let Q0=0,bC=ni.length;Q0<bC;Q0++){let wp=ni[Q0];pe.update(wp,us),pe.bind(wp,us)}}return us}function yC(B,W){B.ambientLightColor.needsUpdate=W,B.lightProbe.needsUpdate=W,B.directionalLights.needsUpdate=W,B.directionalLightShadows.needsUpdate=W,B.pointLights.needsUpdate=W,B.pointLightShadows.needsUpdate=W,B.spotLights.needsUpdate=W,B.spotLightShadows.needsUpdate=W,B.rectAreaLights.needsUpdate=W,B.hemisphereLights.needsUpdate=W}function AC(B){return B.isMeshLambertMaterial||B.isMeshToonMaterial||B.isMeshPhongMaterial||B.isMeshStandardMaterial||B.isShadowMaterial||B.isShaderMaterial&&B.lights===!0}this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return A},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(B,W,et){Rt.get(B.texture).__webglTexture=W,Rt.get(B.depthTexture).__webglTexture=et;let $=Rt.get(B);$.__hasExternalTextures=!0,$.__autoAllocateDepthBuffer=et===void 0,$.__autoAllocateDepthBuffer||ht.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),$.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(B,W){let et=Rt.get(B);et.__webglFramebuffer=W,et.__useDefaultFramebuffer=W===void 0},this.setRenderTarget=function(B,W=0,et=0){w=B,b=W,A=et;let $=!0,Z=null,At=!1,Pt=!1;if(B){let Xt=Rt.get(B);Xt.__useDefaultFramebuffer!==void 0?(Ct.bindFramebuffer(R.FRAMEBUFFER,null),$=!1):Xt.__webglFramebuffer===void 0?Ft.setupRenderTarget(B):Xt.__hasExternalTextures&&Ft.rebindTextures(B,Rt.get(B.texture).__webglTexture,Rt.get(B.depthTexture).__webglTexture);let Qt=B.texture;(Qt.isData3DTexture||Qt.isDataArrayTexture||Qt.isCompressedArrayTexture)&&(Pt=!0);let se=Rt.get(B).__webglFramebuffer;B.isWebGLCubeRenderTarget?(Array.isArray(se[W])?Z=se[W][et]:Z=se[W],At=!0):B.samples>0&&Ft.useMultisampledRTT(B)===!1?Z=Rt.get(B).__webglMultisampledFramebuffer:Array.isArray(se)?Z=se[et]:Z=se,y.copy(B.viewport),D.copy(B.scissor),F=B.scissorTest}else y.copy(st).multiplyScalar(tt).floor(),D.copy(ft).multiplyScalar(tt).floor(),F=mt;if(Ct.bindFramebuffer(R.FRAMEBUFFER,Z)&&$&&Ct.drawBuffers(B,Z),Ct.viewport(y),Ct.scissor(D),Ct.setScissorTest(F),At){let Xt=Rt.get(B.texture);R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+W,Xt.__webglTexture,et)}else if(Pt){let Xt=Rt.get(B.texture),Qt=W||0;R.framebufferTextureLayer(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,Xt.__webglTexture,et||0,Qt)}S=-1},this.readRenderTargetPixels=function(B,W,et,$,Z,At,Pt){if(!(B&&B.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let kt=Rt.get(B).__webglFramebuffer;if(B.isWebGLCubeRenderTarget&&Pt!==void 0&&(kt=kt[Pt]),kt){Ct.bindFramebuffer(R.FRAMEBUFFER,kt);try{let Xt=B.texture,Qt=Xt.format,se=Xt.type;if(!Tt.textureFormatReadable(Qt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Tt.textureTypeReadable(se)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}W>=0&&W<=B.width-$&&et>=0&&et<=B.height-Z&&R.readPixels(W,et,$,Z,Bt.convert(Qt),Bt.convert(se),At)}finally{let Xt=w!==null?Rt.get(w).__webglFramebuffer:null;Ct.bindFramebuffer(R.FRAMEBUFFER,Xt)}}},this.copyFramebufferToTexture=function(B,W,et=0){let $=Math.pow(2,-et),Z=Math.floor(W.image.width*$),At=Math.floor(W.image.height*$);Ft.setTexture2D(W,0),R.copyTexSubImage2D(R.TEXTURE_2D,et,0,0,B.x,B.y,Z,At),Ct.unbindTexture()},this.copyTextureToTexture=function(B,W,et,$=0){let Z=W.image.width,At=W.image.height,Pt=Bt.convert(et.format),kt=Bt.convert(et.type);Ft.setTexture2D(et,0),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,et.flipY),R.pixelStorei(R.UNPACK_PREMULTIPLY_ALPHA_WEBGL,et.premultiplyAlpha),R.pixelStorei(R.UNPACK_ALIGNMENT,et.unpackAlignment),W.isDataTexture?R.texSubImage2D(R.TEXTURE_2D,$,B.x,B.y,Z,At,Pt,kt,W.image.data):W.isCompressedTexture?R.compressedTexSubImage2D(R.TEXTURE_2D,$,B.x,B.y,W.mipmaps[0].width,W.mipmaps[0].height,Pt,W.mipmaps[0].data):R.texSubImage2D(R.TEXTURE_2D,$,B.x,B.y,Pt,kt,W.image),$===0&&et.generateMipmaps&&R.generateMipmap(R.TEXTURE_2D),Ct.unbindTexture()},this.copyTextureToTexture3D=function(B,W,et,$,Z=0){let At=B.max.x-B.min.x,Pt=B.max.y-B.min.y,kt=B.max.z-B.min.z,Xt=Bt.convert($.format),Qt=Bt.convert($.type),se;if($.isData3DTexture)Ft.setTexture3D($,0),se=R.TEXTURE_3D;else if($.isDataArrayTexture||$.isCompressedArrayTexture)Ft.setTexture2DArray($,0),se=R.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,$.flipY),R.pixelStorei(R.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$.premultiplyAlpha),R.pixelStorei(R.UNPACK_ALIGNMENT,$.unpackAlignment);let de=R.getParameter(R.UNPACK_ROW_LENGTH),en=R.getParameter(R.UNPACK_IMAGE_HEIGHT),wn=R.getParameter(R.UNPACK_SKIP_PIXELS),qn=R.getParameter(R.UNPACK_SKIP_ROWS),rr=R.getParameter(R.UNPACK_SKIP_IMAGES),Te=et.isCompressedTexture?et.mipmaps[Z]:et.image;R.pixelStorei(R.UNPACK_ROW_LENGTH,Te.width),R.pixelStorei(R.UNPACK_IMAGE_HEIGHT,Te.height),R.pixelStorei(R.UNPACK_SKIP_PIXELS,B.min.x),R.pixelStorei(R.UNPACK_SKIP_ROWS,B.min.y),R.pixelStorei(R.UNPACK_SKIP_IMAGES,B.min.z),et.isDataTexture||et.isData3DTexture?R.texSubImage3D(se,Z,W.x,W.y,W.z,At,Pt,kt,Xt,Qt,Te.data):$.isCompressedArrayTexture?R.compressedTexSubImage3D(se,Z,W.x,W.y,W.z,At,Pt,kt,Xt,Te.data):R.texSubImage3D(se,Z,W.x,W.y,W.z,At,Pt,kt,Xt,Qt,Te),R.pixelStorei(R.UNPACK_ROW_LENGTH,de),R.pixelStorei(R.UNPACK_IMAGE_HEIGHT,en),R.pixelStorei(R.UNPACK_SKIP_PIXELS,wn),R.pixelStorei(R.UNPACK_SKIP_ROWS,qn),R.pixelStorei(R.UNPACK_SKIP_IMAGES,rr),Z===0&&$.generateMipmaps&&R.generateMipmap(se),Ct.unbindTexture()},this.initTexture=function(B){B.isCubeTexture?Ft.setTextureCube(B,0):B.isData3DTexture?Ft.setTexture3D(B,0):B.isDataArrayTexture||B.isCompressedArrayTexture?Ft.setTexture2DArray(B,0):Ft.setTexture2D(B,0),Ct.unbindTexture()},this.resetState=function(){b=0,A=0,w=null,Ct.reset(),le.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return fr}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;let e=this.getContext();e.drawingBufferColorSpace=t===Px?"display-p3":"srgb",e.unpackColorSpace=Oe.workingColorSpace===Uh?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t}};var Mh=class extends Bi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ps,this.environmentIntensity=1,this.environmentRotation=new Ps,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){let e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}};var fi=class extends xi{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new $t(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}},Dh=new I,Bh=new I,wv=new Kt,pc=new Vo,rh=new gr,Hd=new I,Sv=new I,Rs=class extends Bi{constructor(t=new gn,e=new fi){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){let t=this.geometry;if(t.index===null){let e=t.attributes.position,n=[0];for(let i=1,s=e.count;i<s;i++)Dh.fromBufferAttribute(e,i-1),Bh.fromBufferAttribute(e,i),n[i]=n[i-1],n[i]+=Dh.distanceTo(Bh);t.setAttribute("lineDistance",new on(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){let n=this.geometry,i=this.matrixWorld,s=t.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),rh.copy(n.boundingSphere),rh.applyMatrix4(i),rh.radius+=s,t.ray.intersectsSphere(rh)===!1)return;wv.copy(i).invert(),pc.copy(t.ray).applyMatrix4(wv);let a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=this.isLineSegments?2:1,h=n.index,d=n.attributes.position;if(h!==null){let x=Math.max(0,o.start),m=Math.min(h.count,o.start+o.count);for(let g=x,f=m-1;g<f;g+=l){let p=h.getX(g),v=h.getX(g+1),E=sh(this,t,pc,c,p,v);E&&e.push(E)}if(this.isLineLoop){let g=h.getX(m-1),f=h.getX(x),p=sh(this,t,pc,c,g,f);p&&e.push(p)}}else{let x=Math.max(0,o.start),m=Math.min(d.count,o.start+o.count);for(let g=x,f=m-1;g<f;g+=l){let p=sh(this,t,pc,c,g,g+1);p&&e.push(p)}if(this.isLineLoop){let g=sh(this,t,pc,c,m-1,x);g&&e.push(g)}}}updateMorphTargets(){let e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){let i=e[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){let a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}};function sh(r,t,e,n,i,s){let o=r.geometry.attributes.position;if(Dh.fromBufferAttribute(o,i),Bh.fromBufferAttribute(o,s),e.distanceSqToSegment(Dh,Bh,Hd,Sv)>n)return;Hd.applyMatrix4(r.matrixWorld);let c=t.ray.origin.distanceTo(Hd);if(!(c<t.near||c>t.far))return{distance:c,point:Sv.clone().applyMatrix4(r.matrixWorld),index:i,face:null,faceIndex:null,object:r}}var Mv=new I,Dv=new I,Go=class extends Rs{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let t=this.geometry;if(t.index===null){let e=t.attributes.position,n=[];for(let i=0,s=e.count;i<s;i+=2)Mv.fromBufferAttribute(e,i),Dv.fromBufferAttribute(e,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+Mv.distanceTo(Dv);t.setAttribute("lineDistance",new on(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}};var Gr=class extends xi{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new $t(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}},Bv=new Kt,xx=new Vo,oh=new gr,ah=new I,Wo=class extends Bi{constructor(t=new gn,e=new Gr){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){let n=this.geometry,i=this.matrixWorld,s=t.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),oh.copy(n.boundingSphere),oh.applyMatrix4(i),oh.radius+=s,t.ray.intersectsSphere(oh)===!1)return;Bv.copy(i).invert(),xx.copy(t.ray).applyMatrix4(Bv);let a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=n.index,u=n.attributes.position;if(l!==null){let d=Math.max(0,o.start),x=Math.min(l.count,o.start+o.count);for(let m=d,g=x;m<g;m++){let f=l.getX(m);ah.fromBufferAttribute(u,f),Tv(ah,f,c,i,t,e,this)}}else{let d=Math.max(0,o.start),x=Math.min(u.count,o.start+o.count);for(let m=d,g=x;m<g;m++)ah.fromBufferAttribute(u,m),Tv(ah,m,c,i,t,e,this)}}updateMorphTargets(){let e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){let i=e[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){let a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}};function Tv(r,t,e,n,i,s,o){let a=xx.distanceSqToPoint(r);if(a<e){let c=new I;xx.closestPointToPoint(r,c),c.applyMatrix4(n);let l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:t,face:null,object:o})}}var fx=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){let n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){let e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){let e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){let t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let e=[],n,i=this.getPoint(0),s=0;e.push(0);for(let o=1;o<=t;o++)n=this.getPoint(o/t),s+=n.distanceTo(i),e.push(s),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){let n=this.getLengths(),i=0,s=n.length,o;e?o=e:o=t*n[s-1];let a=0,c=s-1,l;for(;a<=c;)if(i=Math.floor(a+(c-a)/2),l=n[i]-o,l<0)a=i+1;else if(l>0)c=i-1;else{c=i;break}if(i=c,n[i]===o)return i/(s-1);let h=n[i],d=n[i+1]-h,x=(o-h)/d;return(i+x)/(s-1)}getTangent(t,e){let i=t-1e-4,s=t+1e-4;i<0&&(i=0),s>1&&(s=1);let o=this.getPoint(i),a=this.getPoint(s),c=e||(o.isVector2?new Zt:new I);return c.copy(a).sub(o).normalize(),c}getTangentAt(t,e){let n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){let n=new I,i=[],s=[],o=[],a=new I,c=new Kt;for(let x=0;x<=t;x++){let m=x/t;i[x]=this.getTangentAt(m,new I)}s[0]=new I,o[0]=new I;let l=Number.MAX_VALUE,h=Math.abs(i[0].x),u=Math.abs(i[0].y),d=Math.abs(i[0].z);h<=l&&(l=h,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),d<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),s[0].crossVectors(i[0],a),o[0].crossVectors(i[0],s[0]);for(let x=1;x<=t;x++){if(s[x]=s[x-1].clone(),o[x]=o[x-1].clone(),a.crossVectors(i[x-1],i[x]),a.length()>Number.EPSILON){a.normalize();let m=Math.acos(_n(i[x-1].dot(i[x]),-1,1));s[x].applyMatrix4(c.makeRotationAxis(a,m))}o[x].crossVectors(i[x],s[x])}if(e===!0){let x=Math.acos(_n(s[0].dot(s[t]),-1,1));x/=t,i[0].dot(a.crossVectors(s[0],s[t]))>0&&(x=-x);for(let m=1;m<=t;m++)s[m].applyMatrix4(c.makeRotationAxis(i[m],x*m)),o[m].crossVectors(i[m],s[m])}return{tangents:i,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){let t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},ks=class extends fx{constructor(t=0,e=0,n=1,i=1,s=0,o=Math.PI*2,a=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=c}getPoint(t,e=new Zt){let n=e,i=Math.PI*2,s=this.aEndAngle-this.aStartAngle,o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(o?s=0:s=i),this.aClockwise===!0&&!o&&(s===i?s=-i:s=s-i);let a=this.aStartAngle+t*s,c=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=c-this.aX,x=l-this.aY;c=d*h-x*u+this.aX,l=d*u+x*h+this.aY}return n.set(c,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){let t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}};var jo=class extends xi{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new $t(16777215),this.specular=new $t(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $t(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=jv,this.normalScale=new Zt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ps,this.combine=Fx,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}};function ch(r,t,e){return!r||!e&&r.constructor===t?r:typeof t.BYTES_PER_ELEMENT=="number"?new t(r):Array.prototype.slice.call(r)}function SM(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}var Xo=class{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){let e=this.parameterPositions,n=this._cachedIndex,i=e[n],s=e[n-1];n:{t:{let o;e:{i:if(!(t<i)){for(let a=n+2;;){if(i===void 0){if(t<s)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=i,i=e[++n],t<i)break t}o=e.length;break e}if(!(t>=s)){let a=e[1];t<a&&(n=2,s=a);for(let c=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(i=s,s=e[--n-1],t>=s)break t}o=n,n=0;break e}break n}for(;n<o;){let a=n+o>>>1;t<e[a]?o=a:n=a+1}if(i=e[n],s=e[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,i)}return this.interpolate_(n,s,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){let e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=t*i;for(let o=0;o!==i;++o)e[o]=n[s+o];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},px=class extends Xo{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Pg,endingEnd:Pg}}intervalChanged_(t,e,n){let i=this.parameterPositions,s=t-2,o=t+1,a=i[s],c=i[o];if(a===void 0)switch(this.getSettings_().endingStart){case Rg:s=t,a=2*e-n;break;case kg:s=i.length-2,a=e+i[s]-i[s+1];break;default:s=t,a=n}if(c===void 0)switch(this.getSettings_().endingEnd){case Rg:o=t,c=2*n-e;break;case kg:o=1,c=n+i[1]-i[0];break;default:o=t-1,c=e}let l=(n-e)*.5,h=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(c-n),this._offsetPrev=s*h,this._offsetNext=o*h}interpolate_(t,e,n,i){let s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=t*a,l=c-a,h=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,x=this._weightNext,m=(n-e)/(i-e),g=m*m,f=g*m,p=-d*f+2*d*g-d*m,v=(1+d)*f+(-1.5-2*d)*g+(-.5+d)*m+1,E=(-1-x)*f+(1.5+x)*g+.5*m,C=x*f-x*g;for(let b=0;b!==a;++b)s[b]=p*o[h+b]+v*o[l+b]+E*o[c+b]+C*o[u+b];return s}},mx=class extends Xo{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){let s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=t*a,l=c-a,h=(n-e)/(i-e),u=1-h;for(let d=0;d!==a;++d)s[d]=o[l+d]*u+o[c+d]*h;return s}},gx=class extends Xo{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}},Di=class{constructor(t,e,n,i){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=ch(e,this.TimeBufferType),this.values=ch(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){let e=t.constructor,n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:ch(t.times,Array),values:ch(t.values,Array)};let i=t.getInterpolation();i!==t.DefaultInterpolation&&(n.interpolation=i)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new gx(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new mx(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new px(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case hh:e=this.InterpolantFactoryMethodDiscrete;break;case uh:e=this.InterpolantFactoryMethodLinear;break;case gd:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){let n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return hh;case this.InterpolantFactoryMethodLinear:return uh;case this.InterpolantFactoryMethodSmooth:return gd}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){let e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(t!==1){let e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){let n=this.times,i=n.length,s=0,o=i-1;for(;s!==i&&n[s]<t;)++s;for(;o!==-1&&n[o]>e;)--o;if(++o,s!==0||o!==i){s>=o&&(o=Math.max(o,1),s=o-1);let a=this.getValueSize();this.times=n.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);let n=this.times,i=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let a=0;a!==s;a++){let c=n[a];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),t=!1;break}if(o!==null&&o>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,o),t=!1;break}o=c}if(i!==void 0&&SM(i))for(let a=0,c=i.length;a!==c;++a){let l=i[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),t=!1;break}}return t}optimize(){let t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===gd,s=t.length-1,o=1;for(let a=1;a<s;++a){let c=!1,l=t[a],h=t[a+1];if(l!==h&&(a!==1||l!==t[0]))if(i)c=!0;else{let u=a*n,d=u-n,x=u+n;for(let m=0;m!==n;++m){let g=e[u+m];if(g!==e[d+m]||g!==e[x+m]){c=!0;break}}}if(c){if(a!==o){t[o]=t[a];let u=a*n,d=o*n;for(let x=0;x!==n;++x)e[d+x]=e[u+x]}++o}}if(s>0){t[o]=t[s];for(let a=s*n,c=o*n,l=0;l!==n;++l)e[c+l]=e[a+l];++o}return o!==t.length?(this.times=t.slice(0,o),this.values=e.slice(0,o*n)):(this.times=t,this.values=e),this}clone(){let t=this.times.slice(),e=this.values.slice(),n=this.constructor,i=new n(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}};Di.prototype.TimeBufferType=Float32Array;Di.prototype.ValueBufferType=Float32Array;Di.prototype.DefaultInterpolation=uh;var Os=class extends Di{};Os.prototype.ValueTypeName="bool";Os.prototype.ValueBufferType=Array;Os.prototype.DefaultInterpolation=hh;Os.prototype.InterpolantFactoryMethodLinear=void 0;Os.prototype.InterpolantFactoryMethodSmooth=void 0;var vx=class extends Di{};vx.prototype.ValueTypeName="color";var Ex=class extends Di{};Ex.prototype.ValueTypeName="number";var _x=class extends Xo{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){let s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=(n-e)/(i-e),l=t*a;for(let h=l+a;l!==h;l+=4)di.slerpFlat(s,0,o,l-a,o,l,c);return s}},Dc=class extends Di{InterpolantFactoryMethodLinear(t){return new _x(this.times,this.values,this.getValueSize(),t)}};Dc.prototype.ValueTypeName="quaternion";Dc.prototype.DefaultInterpolation=uh;Dc.prototype.InterpolantFactoryMethodSmooth=void 0;var Is=class extends Di{};Is.prototype.ValueTypeName="string";Is.prototype.ValueBufferType=Array;Is.prototype.DefaultInterpolation=hh;Is.prototype.InterpolantFactoryMethodLinear=void 0;Is.prototype.InterpolantFactoryMethodSmooth=void 0;var Cx=class extends Di{};Cx.prototype.ValueTypeName="vector";var Th={enabled:!1,files:{},add:function(r,t){this.enabled!==!1&&(this.files[r]=t)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}},yx=class{constructor(t,e,n){let i=this,s=!1,o=0,a=0,c,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(h){a++,s===!1&&i.onStart!==void 0&&i.onStart(h,o,a),s=!0},this.itemEnd=function(h){o++,i.onProgress!==void 0&&i.onProgress(h,o,a),o===a&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(h){i.onError!==void 0&&i.onError(h)},this.resolveURL=function(h){return c?c(h):h},this.setURLModifier=function(h){return c=h,this},this.addHandler=function(h,u){return l.push(h,u),this},this.removeHandler=function(h){let u=l.indexOf(h);return u!==-1&&l.splice(u,2),this},this.getHandler=function(h){for(let u=0,d=l.length;u<d;u+=2){let x=l[u],m=l[u+1];if(x.global&&(x.lastIndex=0),x.test(h))return m}return null}}},Ox=new yx,Ls=(()=>{class r{constructor(e){this.manager=e!==void 0?e:Ox,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){let i=this;return new Promise(function(s,o){i.load(e,s,n,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}return r.DEFAULT_MATERIAL_NAME="__DEFAULT",r})(),hr={},Ax=class extends Error{constructor(t,e){super(t),this.response=e}},Yo=class extends Ls{constructor(t){super(t)}load(t,e,n,i){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);let s=Th.get(t);if(s!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(s),this.manager.itemEnd(t)},0),s;if(hr[t]!==void 0){hr[t].push({onLoad:e,onProgress:n,onError:i});return}hr[t]=[],hr[t].push({onLoad:e,onProgress:n,onError:i});let o=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(o).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let h=hr[t],u=l.body.getReader(),d=l.headers.get("X-File-Size")||l.headers.get("Content-Length"),x=d?parseInt(d):0,m=x!==0,g=0,f=new ReadableStream({start(p){v();function v(){u.read().then(({done:E,value:C})=>{if(E)p.close();else{g+=C.byteLength;let b=new ProgressEvent("progress",{lengthComputable:m,loaded:g,total:x});for(let A=0,w=h.length;A<w;A++){let S=h[A];S.onProgress&&S.onProgress(b)}p.enqueue(C),v()}})}}});return new Response(f)}else throw new Ax(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(c){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return l.json();default:if(a===void 0)return l.text();{let u=/charset="?([^;"\s]*)"?/i.exec(a),d=u&&u[1]?u[1].toLowerCase():void 0,x=new TextDecoder(d);return l.arrayBuffer().then(m=>x.decode(m))}}}).then(l=>{Th.add(t,l);let h=hr[t];delete hr[t];for(let u=0,d=h.length;u<d;u++){let x=h[u];x.onLoad&&x.onLoad(l)}}).catch(l=>{let h=hr[t];if(h===void 0)throw this.manager.itemError(t),l;delete hr[t];for(let u=0,d=h.length;u<d;u++){let x=h[u];x.onError&&x.onError(l)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}};var bx=class extends Ls{constructor(t){super(t)}load(t,e,n,i){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);let s=this,o=Th.get(t);if(o!==void 0)return s.manager.itemStart(t),setTimeout(function(){e&&e(o),s.manager.itemEnd(t)},0),o;let a=bc("img");function c(){h(),Th.add(t,this),e&&e(this),s.manager.itemEnd(t)}function l(u){h(),i&&i(u),s.manager.itemError(t),s.manager.itemEnd(t)}function h(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(t),a.src=t,a}};var Fh=class extends Ls{constructor(t){super(t)}load(t,e,n,i){let s=new jr,o=new bx(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(a){s.image=a,s.needsUpdate=!0,e!==void 0&&e(s)},n,i),s}},wx=class extends Bi{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new $t(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){let e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}};var Gd=new Kt,Fv=new I,Pv=new I,Sx=class{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Zt(512,512),this.map=null,this.mapPass=null,this.matrix=new Kt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Mc,this._frameExtents=new Zt(1,1),this._viewportCount=1,this._viewports=[new je(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){let e=this.camera,n=this.matrix;Fv.setFromMatrixPosition(t.matrixWorld),e.position.copy(Fv),Pv.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Pv),e.updateMatrixWorld(),Gd.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Gd),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Gd)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}};var Rv=new Kt,mc=new I,Wd=new I,Mx=class extends Sx{constructor(){super(new Tn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Zt(4,2),this._viewportCount=6,this._viewports=[new je(2,1,1,1),new je(0,1,1,1),new je(3,1,1,1),new je(1,1,1,1),new je(3,0,1,1),new je(1,0,1,1)],this._cubeDirections=[new I(1,0,0),new I(-1,0,0),new I(0,0,1),new I(0,0,-1),new I(0,1,0),new I(0,-1,0)],this._cubeUps=[new I(0,1,0),new I(0,1,0),new I(0,1,0),new I(0,1,0),new I(0,0,1),new I(0,0,-1)]}updateMatrices(t,e=0){let n=this.camera,i=this.matrix,s=t.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),mc.setFromMatrixPosition(t.matrixWorld),n.position.copy(mc),Wd.copy(n.position),Wd.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Wd),n.updateMatrixWorld(),i.makeTranslation(-mc.x,-mc.y,-mc.z),Rv.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Rv)}},Ph=class extends wx{constructor(t,e,n=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Mx}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}};var Rh=class{static decodeText(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){let e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}};var kh=class{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=kv(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let e=kv();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}};function kv(){return(typeof performance>"u"?Date:performance).now()}var Ix="\\[\\]\\.:\\/",MM=new RegExp("["+Ix+"]","g"),Lx="[^"+Ix+"]",DM="[^"+Ix.replace("\\.","")+"]",BM=/((?:WC+[\/:])*)/.source.replace("WC",Lx),TM=/(WCOD+)?/.source.replace("WCOD",DM),FM=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Lx),PM=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Lx),RM=new RegExp("^"+BM+TM+FM+PM+"$"),kM=["material","materials","bones","map"],Dx=class{constructor(t,e,n){let i=n||Ze.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();let n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(t,e)}setValue(t,e){let n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=n.length;i!==s;++i)n[i].setValue(t,e)}bind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},Ze=(()=>{class r{constructor(e,n,i){this.path=n,this.parsedPath=i||r.parseTrackName(n),this.node=r.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,i){return e&&e.isAnimationObjectGroup?new r.Composite(e,n,i):new r(e,n,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(MM,"")}static parseTrackName(e){let n=RM.exec(e);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){let o=i.nodeName.substring(s+1);kM.indexOf(o)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=o)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,n){if(n===void 0||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(n);if(i!==void 0)return i}if(e.children){let i=function(o){for(let a=0;a<o.length;a++){let c=o[a];if(c.name===n||c.uuid===n)return c;let l=i(c.children);if(l)return l}return null},s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){let i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)e[n++]=i[s]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){let i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=e[n++]}_setValue_array_setNeedsUpdate(e,n){let i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){let i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node,n=this.parsedPath,i=n.objectName,s=n.propertyName,o=n.propertyIndex;if(e||(e=r.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let h=n.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===h){h=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}let a=e[s];if(a===void 0){let h=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+s+" but it wasn't found.",e);return}let c=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?c=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(c=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(o!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return r.Composite=Dx,r})();Ze.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ze.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ze.prototype.GetterByBindingType=[Ze.prototype._getValue_direct,Ze.prototype._getValue_array,Ze.prototype._getValue_arrayElement,Ze.prototype._getValue_toArray];Ze.prototype.SetterByBindingTypeAndVersioning=[[Ze.prototype._setValue_direct,Ze.prototype._setValue_direct_setNeedsUpdate,Ze.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ze.prototype._setValue_array,Ze.prototype._setValue_array_setNeedsUpdate,Ze.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ze.prototype._setValue_arrayElement,Ze.prototype._setValue_arrayElement_setNeedsUpdate,Ze.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ze.prototype._setValue_fromArray,Ze.prototype._setValue_fromArray_setNeedsUpdate,Ze.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var JF=new Float32Array(1);var Ov=new Kt,Oh=class{constructor(t,e,n=0,i=1/0){this.ray=new Vo(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new wc,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return Ov.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Ov),this}intersectObject(t,e=!0,n=[]){return Bx(t,this,n,e),n.sort(Iv),n}intersectObjects(t,e=!0,n=[]){for(let i=0,s=t.length;i<s;i++)Bx(t[i],this,n,e);return n.sort(Iv),n}};function Iv(r,t){return r.distance-t.distance}function Bx(r,t,e,n){if(r.layers.test(t.layers)&&r.raycast(t,e),n===!0){let i=r.children;for(let s=0,o=i.length;s<o;s++)Bx(i[s],t,e,!0)}}var Ih=class extends Go{constructor(t=10,e=10,n=4473924,i=8947848){n=new $t(n),i=new $t(i);let s=e/2,o=t/e,a=t/2,c=[],l=[];for(let d=0,x=0,m=-a;d<=e;d++,m+=o){c.push(-a,0,m,a,0,m),c.push(m,0,-a,m,0,a);let g=d===s?n:i;g.toArray(l,x),x+=3,g.toArray(l,x),x+=3,g.toArray(l,x),x+=3,g.toArray(l,x),x+=3}let h=new gn;h.setAttribute("position",new on(c,3)),h.setAttribute("color",new on(l,3));let u=new fi({vertexColors:!0,toneMapped:!1});super(h,u),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Tx}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Tx);var nE=new I,IM=new di,iE=new I,Vh=class extends Bi{constructor(t=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&e.element.parentNode!==null&&e.element.parentNode.removeChild(e.element)})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this}};var Zi=new Kt,LM=new Kt,Hh=class{constructor(t={}){let e=this,n,i,s,o,a={camera:{style:""},objects:new WeakMap},c=t.element!==void 0?t.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c;let l=document.createElement("div");l.style.transformOrigin="0 0",l.style.pointerEvents="none",c.appendChild(l);let h=document.createElement("div");h.style.transformStyle="preserve-3d",l.appendChild(h),this.getSize=function(){return{width:n,height:i}},this.render=function(g,f){let p=f.projectionMatrix.elements[5]*o;f.view&&f.view.enabled?(l.style.transform=`translate( ${-f.view.offsetX*(n/f.view.width)}px, ${-f.view.offsetY*(i/f.view.height)}px )`,l.style.transform+=`scale( ${f.view.fullWidth/f.view.width}, ${f.view.fullHeight/f.view.height} )`):l.style.transform="",g.matrixWorldAutoUpdate===!0&&g.updateMatrixWorld(),f.parent===null&&f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld();let v,E;f.isOrthographicCamera&&(v=-(f.right+f.left)/2,E=(f.top+f.bottom)/2);let C=f.view&&f.view.enabled?f.view.height/f.view.fullHeight:1,b=f.isOrthographicCamera?`scale( ${C} )scale(`+p+")translate("+u(v)+"px,"+u(E)+"px)"+d(f.matrixWorldInverse):`scale( ${C} )translateZ(`+p+"px)"+d(f.matrixWorldInverse),w=(f.isPerspectiveCamera?"perspective("+p+"px) ":"")+b+"translate("+s+"px,"+o+"px)";a.camera.style!==w&&(h.style.transform=w,a.camera.style=w),m(g,g,f,b)},this.setSize=function(g,f){n=g,i=f,s=n/2,o=i/2,c.style.width=g+"px",c.style.height=f+"px",l.style.width=g+"px",l.style.height=f+"px",h.style.width=g+"px",h.style.height=f+"px"};function u(g){return Math.abs(g)<1e-10?0:g}function d(g){let f=g.elements;return"matrix3d("+u(f[0])+","+u(-f[1])+","+u(f[2])+","+u(f[3])+","+u(f[4])+","+u(-f[5])+","+u(f[6])+","+u(f[7])+","+u(f[8])+","+u(-f[9])+","+u(f[10])+","+u(f[11])+","+u(f[12])+","+u(-f[13])+","+u(f[14])+","+u(f[15])+")"}function x(g){let f=g.elements;return"translate(-50%,-50%)"+("matrix3d("+u(f[0])+","+u(f[1])+","+u(f[2])+","+u(f[3])+","+u(-f[4])+","+u(-f[5])+","+u(-f[6])+","+u(-f[7])+","+u(f[8])+","+u(f[9])+","+u(f[10])+","+u(f[11])+","+u(f[12])+","+u(f[13])+","+u(f[14])+","+u(f[15])+")")}function m(g,f,p,v){if(g.isCSS3DObject){let E=g.visible===!0&&g.layers.test(p.layers)===!0;if(g.element.style.display=E===!0?"":"none",E===!0){g.onBeforeRender(e,f,p);let C;g.isCSS3DSprite?(Zi.copy(p.matrixWorldInverse),Zi.transpose(),g.rotation2D!==0&&Zi.multiply(LM.makeRotationZ(g.rotation2D)),g.matrixWorld.decompose(nE,IM,iE),Zi.setPosition(nE),Zi.scale(iE),Zi.elements[3]=0,Zi.elements[7]=0,Zi.elements[11]=0,Zi.elements[15]=1,C=x(Zi)):C=x(g.matrixWorld);let b=g.element,A=a.objects.get(g);if(A===void 0||A.style!==C){b.style.transform=C;let w={style:C};a.objects.set(g,w)}b.parentNode!==h&&h.appendChild(b),g.onAfterRender(e,f,p)}}for(let E=0,C=g.children.length;E<C;E++)m(g.children[E],f,p,v)}}};var It={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},Re={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},ee={x:0,y:0},Qn={camera:new Kt,gizmos:new Kt},Ne={type:"change"},Fi={type:"start"},pi={type:"end"},NM=new Oh,an=new I,rE=new Kt,sE=new Kt,Ti=new I,Gh=class extends qi{constructor(t,e,n=null){super(),this.camera=null,this.domElement=e,this.scene=n,this.target=new I,this._currentTarget=new I,this.radiusFactor=.67,this.mouseActions=[],this._mouseOp=null,this._v2_1=new Zt,this._v3_1=new I,this._v3_2=new I,this._m4_1=new Kt,this._m4_2=new Kt,this._quat=new di,this._translationMatrix=new Kt,this._rotationMatrix=new Kt,this._scaleMatrix=new Kt,this._rotationAxis=new I,this._cameraMatrixState=new Kt,this._cameraProjectionState=new Kt,this._fovState=1,this._upState=new I,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new Kt,this._up0=new I,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new Kt,this._gizmoMatrixState0=new Kt,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=Re.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._downStart=0,this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new I,this._startCursorPosition=new I,this._grid=null,this._gridPosition=new I,this._gizmos=new Xi,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new I,this._cursorPosCurr=new I,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.rotateSpeed=1,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.enableGizmos=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this._tbRadius=1,this._state=It.IDLE,this.setCamera(t),this.scene!=null&&this.scene.add(this._gizmos),this.domElement.style.touchAction="none",this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this._onContextMenu=zM.bind(this),this._onWheel=jM.bind(this),this._onPointerUp=WM.bind(this),this._onPointerMove=GM.bind(this),this._onPointerDown=HM.bind(this),this._onPointerCancel=VM.bind(this),this._onWindowResize=UM.bind(this),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onWheel),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),window.addEventListener("resize",this._onWindowResize)}onSinglePanStart(t,e){if(this.enabled)switch(this.dispatchEvent(Fi),this.setCenter(t.clientX,t.clientY),e){case"PAN":if(!this.enablePan)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Ne)),this.updateTbState(It.PAN,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ee.x,ee.y,this.domElement)),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(Ne));break;case"ROTATE":if(!this.enableRotate)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.updateTbState(It.ROTATE,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.camera,ee.x,ee.y,this.domElement,this._tbRadius)),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr),this.dispatchEvent(Ne);break;case"FOV":if(!this.camera.isPerspectiveCamera||!this.enableZoom)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Ne)),this.updateTbState(It.FOV,!0),this._startCursorPosition.setY(this.getCursorNDC(ee.x,ee.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition);break;case"ZOOM":if(!this.enableZoom)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(Ne)),this.updateTbState(It.SCALE,!0),this._startCursorPosition.setY(this.getCursorNDC(ee.x,ee.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition);break}}onSinglePanMove(t,e){if(this.enabled){let n=e!=this._state;switch(this.setCenter(t.clientX,t.clientY),e){case It.PAN:this.enablePan&&(n?(this.dispatchEvent(pi),this.dispatchEvent(Fi),this.updateTbState(e,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ee.x,ee.y,this.domElement)),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)):(this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ee.x,ee.y,this.domElement)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))));break;case It.ROTATE:if(this.enableRotate)if(n)this.dispatchEvent(pi),this.dispatchEvent(Fi),this.updateTbState(e,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.camera,ee.x,ee.y,this.domElement,this._tbRadius)),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0);else{this._currentCursorPosition.copy(this.unprojectOnTbSurface(this.camera,ee.x,ee.y,this.domElement,this._tbRadius));let i=this._startCursorPosition.distanceTo(this._currentCursorPosition),s=this._startCursorPosition.angleTo(this._currentCursorPosition),o=Math.max(i/this._tbRadius,s)*this.rotateSpeed;this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),o)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=o,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case It.SCALE:if(this.enableZoom)if(n)this.dispatchEvent(pi),this.dispatchEvent(Fi),this.updateTbState(e,!0),this._startCursorPosition.setY(this.getCursorNDC(ee.x,ee.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(ee.x,ee.y,this.domElement).y*.5);let s=this._currentCursorPosition.y-this._startCursorPosition.y,o=1;s<0?o=1/Math.pow(this.scaleFactor,-s*8):s>0&&(o=Math.pow(this.scaleFactor,s*8)),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this.applyTransformMatrix(this.scale(o,this._v3_1))}break;case It.FOV:if(this.enableZoom&&this.camera.isPerspectiveCamera)if(n)this.dispatchEvent(pi),this.dispatchEvent(Fi),this.updateTbState(e,!0),this._startCursorPosition.setY(this.getCursorNDC(ee.x,ee.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(ee.x,ee.y,this.domElement).y*.5);let s=this._currentCursorPosition.y-this._startCursorPosition.y,o=1;s<0?o=1/Math.pow(this.scaleFactor,-s*8):s>0&&(o=Math.pow(this.scaleFactor,s*8)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let a=this._v3_1.distanceTo(this._gizmos.position),c=a/o;c=Xe.clamp(c,this.minDistance,this.maxDistance);let l=a*Math.tan(Xe.DEG2RAD*this._fovState*.5),h=Xe.RAD2DEG*(Math.atan(l/c)*2);h=Xe.clamp(h,this.minFov,this.maxFov);let u=l/Math.tan(Xe.DEG2RAD*(h/2));o=a/u,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(h),this.applyTransformMatrix(this.scale(o,this._v3_2,!1)),an.copy(this._gizmos.position).sub(this.camera.position).normalize().multiplyScalar(u/a),this._m4_1.makeTranslation(an.x,an.y,an.z)}break}this.dispatchEvent(Ne)}}onSinglePanEnd(){if(this._state==It.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations)if(performance.now()-this._timeCurrent<120){let e=Math.abs((this._wPrev+this._wCurr)/2),n=this;this._animationId=window.requestAnimationFrame(function(i){n.updateTbState(It.ANIMATION_ROTATE,!0);let s=n.calculateRotationAxis(n._cursorPosPrev,n._cursorPosCurr);n.onRotationAnim(i,s,Math.min(e,n.wMax))})}else this.updateTbState(It.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Ne);else this.updateTbState(It.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Ne)}else(this._state==It.PAN||this._state==It.IDLE)&&(this.updateTbState(It.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(Ne));this.dispatchEvent(pi)}onDoubleTap(t){if(this.enabled&&this.enablePan&&this.scene!=null){this.dispatchEvent(Fi),this.setCenter(t.clientX,t.clientY);let e=this.unprojectOnObj(this.getCursorNDC(ee.x,ee.y,this.domElement),this.camera);if(e!=null&&this.enableAnimations){let n=this;this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(i){n.updateTbState(It.ANIMATION_FOCUS,!0),n.onFocusAnim(i,e,n._cameraMatrixState,n._gizmoMatrixState)})}else e!=null&&!this.enableAnimations&&(this.updateTbState(It.FOCUS,!0),this.focus(e,this.scaleFactor),this.updateTbState(It.IDLE,!1),this.dispatchEvent(Ne))}this.dispatchEvent(pi)}onDoublePanStart(){this.enabled&&this.enablePan&&(this.dispatchEvent(Fi),this.updateTbState(It.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ee.x,ee.y,this.domElement,!0)),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1))}onDoublePanMove(){this.enabled&&this.enablePan&&(this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=It.PAN&&(this.updateTbState(It.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition)),this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ee.x,ee.y,this.domElement,!0)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(Ne))}onDoublePanEnd(){this.updateTbState(It.IDLE,!1),this.dispatchEvent(pi)}onRotateStart(){this.enabled&&this.enableRotate&&(this.dispatchEvent(Fi),this.updateTbState(It.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,this.camera.getWorldDirection(this._rotationAxis),!this.enablePan&&!this.enableZoom&&this.activateGizmos(!0))}onRotateMove(){if(this.enabled&&this.enableRotate){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);let t;this._state!=It.ZROTATE&&(this.updateTbState(It.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),t=this.unprojectOnTbPlane(this.camera,ee.x,ee.y,this.domElement).applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):t=new I().setFromMatrixPosition(this._gizmoMatrixState);let e=Xe.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);this.applyTransformMatrix(this.zRotate(t,e)),this.dispatchEvent(Ne)}}onRotateEnd(){this.updateTbState(It.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(pi)}onPinchStart(){this.enabled&&this.enableZoom&&(this.dispatchEvent(Fi),this.updateTbState(It.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}onPinchMove(){if(this.enabled&&this.enableZoom){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);let t=12;this._state!=It.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(It.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),t*this._devPxRatio);let e=this._currentFingerDistance/this._startFingerDistance,n;this.enablePan?this.camera.isOrthographicCamera?n=this.unprojectOnTbPlane(this.camera,ee.x,ee.y,this.domElement).applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera.isPerspectiveCamera&&(n=this.unprojectOnTbPlane(this.camera,ee.x,ee.y,this.domElement).applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):n=this._gizmos.position,this.applyTransformMatrix(this.scale(e,n)),this.dispatchEvent(Ne)}}onPinchEnd(){this.updateTbState(It.IDLE,!1),this.dispatchEvent(pi)}onTriplePanStart(){if(this.enabled&&this.enableZoom){this.dispatchEvent(Fi),this.updateTbState(It.SCALE,!0);let t=0,e=0,n=this._touchCurrent.length;for(let i=0;i<n;i++)t+=this._touchCurrent[i].clientX,e+=this._touchCurrent[i].clientY;this.setCenter(t/n,e/n),this._startCursorPosition.setY(this.getCursorNDC(ee.x,ee.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition)}}onTriplePanMove(){if(this.enabled&&this.enableZoom){let t=0,e=0,n=this._touchCurrent.length;for(let d=0;d<n;d++)t+=this._touchCurrent[d].clientX,e+=this._touchCurrent[d].clientY;this.setCenter(t/n,e/n);let i=8;this._currentCursorPosition.setY(this.getCursorNDC(ee.x,ee.y,this.domElement).y*.5);let s=this._currentCursorPosition.y-this._startCursorPosition.y,o=1;s<0?o=1/Math.pow(this.scaleFactor,-s*i):s>0&&(o=Math.pow(this.scaleFactor,s*i)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let a=this._v3_1.distanceTo(this._gizmos.position),c=a/o;c=Xe.clamp(c,this.minDistance,this.maxDistance);let l=a*Math.tan(Xe.DEG2RAD*this._fovState*.5),h=Xe.RAD2DEG*(Math.atan(l/c)*2);h=Xe.clamp(h,this.minFov,this.maxFov);let u=l/Math.tan(Xe.DEG2RAD*(h/2));o=a/u,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(h),this.applyTransformMatrix(this.scale(o,this._v3_2,!1)),an.copy(this._gizmos.position).sub(this.camera.position).normalize().multiplyScalar(u/a),this._m4_1.makeTranslation(an.x,an.y,an.z),this.dispatchEvent(Ne)}}onTriplePanEnd(){this.updateTbState(It.IDLE,!1),this.dispatchEvent(pi)}setCenter(t,e){ee.x=t,ee.y=e}initializeMouseActions(){this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}compareMouseAction(t,e){return t.operation==e.operation?t.mouse==e.mouse&&t.key==e.key:!1}setMouseAction(t,e,n=null){let i=["PAN","ROTATE","ZOOM","FOV"],s=[0,1,2,"WHEEL"],o=["CTRL","SHIFT",null],a;if(!i.includes(t)||!s.includes(e)||!o.includes(n)||e=="WHEEL"&&t!="ZOOM"&&t!="FOV")return!1;switch(t){case"PAN":a=It.PAN;break;case"ROTATE":a=It.ROTATE;break;case"ZOOM":a=It.SCALE;break;case"FOV":a=It.FOV;break}let c={operation:t,mouse:e,key:n,state:a};for(let l=0;l<this.mouseActions.length;l++)if(this.mouseActions[l].mouse==c.mouse&&this.mouseActions[l].key==c.key)return this.mouseActions.splice(l,1,c),!0;return this.mouseActions.push(c),!0}unsetMouseAction(t,e=null){for(let n=0;n<this.mouseActions.length;n++)if(this.mouseActions[n].mouse==t&&this.mouseActions[n].key==e)return this.mouseActions.splice(n,1),!0;return!1}getOpFromAction(t,e){let n;for(let i=0;i<this.mouseActions.length;i++)if(n=this.mouseActions[i],n.mouse==t&&n.key==e)return n.operation;if(e!=null){for(let i=0;i<this.mouseActions.length;i++)if(n=this.mouseActions[i],n.mouse==t&&n.key==null)return n.operation}return null}getOpStateFromAction(t,e){let n;for(let i=0;i<this.mouseActions.length;i++)if(n=this.mouseActions[i],n.mouse==t&&n.key==e)return n.state;if(e!=null){for(let i=0;i<this.mouseActions.length;i++)if(n=this.mouseActions[i],n.mouse==t&&n.key==null)return n.state}return null}getAngle(t,e){return Math.atan2(e.clientY-t.clientY,e.clientX-t.clientX)*180/Math.PI}updateTouchEvent(t){for(let e=0;e<this._touchCurrent.length;e++)if(this._touchCurrent[e].pointerId==t.pointerId){this._touchCurrent.splice(e,1,t);break}}applyTransformMatrix(t){if(t.camera!=null&&(this._m4_1.copy(this._cameraMatrixState).premultiply(t.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),(this._state==It.ROTATE||this._state==It.ZROTATE||this._state==It.ANIMATION_ROTATE)&&this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),t.gizmos!=null&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(t.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),this._state==It.SCALE||this._state==It.FOCUS||this._state==It.ANIMATION_FOCUS)if(this._tbRadius=this.calculateTbRadius(this.camera),this.adjustNearFar){let e=this.camera.position.distanceTo(this._gizmos.position),n=new mr;n.setFromObject(this._gizmos);let i=new gr;n.getBoundingSphere(i);let s=Math.max(this._nearPos0,i.radius+i.center.length()),o=e-this._initialNear,a=Math.min(s,o);this.camera.near=e-a;let c=Math.min(this._farPos0,-i.radius+i.center.length()),l=e-this._initialFar,h=Math.min(c,l);this.camera.far=e-h,this.camera.updateProjectionMatrix()}else{let e=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,e=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,e=!0),e&&this.camera.updateProjectionMatrix()}}calculateAngularSpeed(t,e,n,i){let s=e-t,o=(i-n)/1e3;return o==0?0:s/o}calculatePointersDistance(t,e){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))}calculateRotationAxis(t,e){return this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(t,e).applyQuaternion(this._quat),this._rotationAxis.normalize().clone()}calculateTbRadius(t){let e=t.position.distanceTo(this._gizmos.position);if(t.type=="PerspectiveCamera"){let n=Xe.DEG2RAD*t.fov*.5,i=Math.atan(t.aspect*Math.tan(n));return Math.tan(Math.min(n,i))*e*this.radiusFactor}else if(t.type=="OrthographicCamera")return Math.min(t.top,t.right)*this.radiusFactor}focus(t,e,n=1){an.copy(t).sub(this._gizmos.position).multiplyScalar(n),this._translationMatrix.makeTranslation(an.x,an.y,an.z),rE.copy(this._gizmoMatrixState),this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),sE.copy(this._cameraMatrixState),this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.scale(e,this._gizmos.position)),this._gizmoMatrixState.copy(rE),this._cameraMatrixState.copy(sE)}drawGrid(){if(this.scene!=null){let n,i,s,o;if(this.camera.isOrthographicCamera){let a=this.camera.right-this.camera.left,c=this.camera.bottom-this.camera.top;s=Math.max(a,c),o=s/20,n=s/this.camera.zoom*3,i=n/o*this.camera.zoom}else if(this.camera.isPerspectiveCamera){let a=this.camera.position.distanceTo(this._gizmos.position),c=Xe.DEG2RAD*this.camera.fov*.5,l=Math.atan(this.camera.aspect*Math.tan(c));s=Math.tan(Math.max(c,l))*a*2,o=s/20,n=s*3,i=n/o}this._grid==null&&(this._grid=new Ih(n,i,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(Math.PI*.5),this.scene.add(this._grid))}}dispose(){this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),window.removeEventListener("resize",this._onWindowResize),this.scene!==null&&this.scene.remove(this._gizmos),this.disposeGrid()}disposeGrid(){this._grid!=null&&this.scene!=null&&(this.scene.remove(this._grid),this._grid=null)}easeOutCubic(t){return 1-Math.pow(1-t,3)}activateGizmos(t){let e=this._gizmos.children[0],n=this._gizmos.children[1],i=this._gizmos.children[2];t?(e.material.setValues({opacity:1}),n.material.setValues({opacity:1}),i.material.setValues({opacity:1})):(e.material.setValues({opacity:.6}),n.material.setValues({opacity:.6}),i.material.setValues({opacity:.6}))}getCursorNDC(t,e,n){let i=n.getBoundingClientRect();return this._v2_1.setX((t-i.left)/i.width*2-1),this._v2_1.setY((i.bottom-e)/i.height*2-1),this._v2_1.clone()}getCursorPosition(t,e,n){return this._v2_1.copy(this.getCursorNDC(t,e,n)),this._v2_1.x*=(this.camera.right-this.camera.left)*.5,this._v2_1.y*=(this.camera.top-this.camera.bottom)*.5,this._v2_1.clone()}setCamera(t){t.lookAt(this.target),t.updateMatrix(),t.type=="PerspectiveCamera"&&(this._fov0=t.fov,this._fovState=t.fov),this._cameraMatrixState0.copy(t.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(t.projectionMatrix),this._zoom0=t.zoom,this._zoomState=this._zoom0,this._initialNear=t.near,this._nearPos0=t.position.distanceTo(this.target)-t.near,this._nearPos=this._initialNear,this._initialFar=t.far,this._farPos0=t.position.distanceTo(this.target)-t.far,this._farPos=this._initialFar,this._up0.copy(t.up),this._upState.copy(t.up),this.camera=t,this.camera.updateProjectionMatrix(),this._tbRadius=this.calculateTbRadius(t),this.makeGizmos(this.target,this._tbRadius)}setGizmosVisible(t){this._gizmos.visible=t,this.dispatchEvent(Ne)}setTbRadius(t){this.radiusFactor=t,this._tbRadius=this.calculateTbRadius(this.camera);let n=new ks(0,0,this._tbRadius,this._tbRadius).getPoints(this._curvePts),i=new gn().setFromPoints(n);for(let s in this._gizmos.children)this._gizmos.children[s].geometry=i;this.dispatchEvent(Ne)}makeGizmos(t,e){let i=new ks(0,0,e,e).getPoints(this._curvePts),s=new gn().setFromPoints(i),o=new fi({color:16744576,fog:!1,transparent:!0,opacity:.6}),a=new fi({color:8454016,fog:!1,transparent:!0,opacity:.6}),c=new fi({color:8421631,fog:!1,transparent:!0,opacity:.6}),l=new Rs(s,o),h=new Rs(s,a),u=new Rs(s,c),d=Math.PI*.5;if(l.rotation.x=d,h.rotation.y=d,this._gizmoMatrixState0.identity().setPosition(t),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.camera.zoom!==1){let x=1/this.camera.zoom;this._scaleMatrix.makeScale(x,x,x),this._translationMatrix.makeTranslation(-t.x,-t.y,-t.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(t.x,t.y,t.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.traverse(function(x){x.isLine&&(x.geometry.dispose(),x.material.dispose())}),this._gizmos.clear(),this._gizmos.add(l),this._gizmos.add(h),this._gizmos.add(u)}onFocusAnim(t,e,n,i){if(this._timeStart==-1&&(this._timeStart=t),this._state==It.ANIMATION_FOCUS){let o=(t-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(i),o>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(e,this.scaleFactor),this._timeStart=-1,this.updateTbState(It.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Ne);else{let a=this.easeOutCubic(o),c=1-a+this.scaleFactor*a;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(e,c,a),this.dispatchEvent(Ne);let l=this;this._animationId=window.requestAnimationFrame(function(h){l.onFocusAnim(h,e,n,i.clone())})}}else this._animationId=-1,this._timeStart=-1}onRotationAnim(t,e,n){if(this._timeStart==-1&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=t),this._state==It.ANIMATION_ROTATE){let i=(t-this._timeStart)/1e3;if(n+-this.dampingFactor*i>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(i,2)+n*i+0,this.applyTransformMatrix(this.rotate(e,this._angleCurrent)),this.dispatchEvent(Ne);let o=this;this._animationId=window.requestAnimationFrame(function(a){o.onRotationAnim(a,e,n)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(It.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(Ne)}else this._animationId=-1,this._timeStart=-1,this._state!=It.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(Ne))}pan(t,e,n=!1){let i=t.clone().sub(e);if(this.camera.isOrthographicCamera)i.multiplyScalar(1/this.camera.zoom);else if(this.camera.isPerspectiveCamera&&n){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);let s=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);i.multiplyScalar(1/s)}return this._v3_1.set(i.x,i.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1),Qn}reset(){this.camera.zoom=this._zoom0,this.camera.isPerspectiveCamera&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.camera),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(It.IDLE,!1),this.dispatchEvent(Ne)}rotate(t,e){let n=this._gizmos.position;return this._translationMatrix.makeTranslation(-n.x,-n.y,-n.z),this._rotationMatrix.makeRotationAxis(t,-e),this._m4_1.makeTranslation(n.x,n.y,n.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),Qn}copyState(){let t;this.camera.isOrthographicCamera?t=JSON.stringify({arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}):this.camera.isPerspectiveCamera&&(t=JSON.stringify({arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}})),navigator.clipboard.writeText(t)}pasteState(){let t=this;navigator.clipboard.readText().then(function(n){t.setStateFromJSON(n)})}saveState(){this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera.isPerspectiveCamera&&(this._fov0=this.camera.fov)}scale(t,e,n=!0){Ti.copy(e);let i=1/t;if(this.camera.isOrthographicCamera){this.camera.zoom=this._zoomState,this.camera.zoom*=t,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,i=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,i=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(i,i,i),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),Ti.sub(this._v3_1);let s=Ti.clone().multiplyScalar(i);return Ti.sub(s),this._m4_1.makeTranslation(Ti.x,Ti.y,Ti.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),Qn}else if(this.camera.isPerspectiveCamera){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let s=this._v3_1.distanceTo(Ti),o=s-s*i,a=s-o;if(a<this.minDistance?(i=this.minDistance/s,o=s-s*i):a>this.maxDistance&&(i=this.maxDistance/s,o=s-s*i),an.copy(Ti).sub(this._v3_1).normalize().multiplyScalar(o),this._m4_1.makeTranslation(an.x,an.y,an.z),n){let c=this._v3_2;s=c.distanceTo(Ti),o=s-s*i,an.copy(Ti).sub(this._v3_2).normalize().multiplyScalar(o),this._translationMatrix.makeTranslation(c.x,c.y,c.z),this._scaleMatrix.makeScale(i,i,i),this._m4_2.makeTranslation(an.x,an.y,an.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-c.x,-c.y,-c.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return Qn}}setFov(t){this.camera.isPerspectiveCamera&&(this.camera.fov=Xe.clamp(t,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())}setTransformationMatrices(t=null,e=null){t!=null?Qn.camera!=null?Qn.camera.copy(t):Qn.camera=t.clone():Qn.camera=null,e!=null?Qn.gizmos!=null?Qn.gizmos.copy(e):Qn.gizmos=e.clone():Qn.gizmos=null}zRotate(t,e){return this._rotationMatrix.makeRotationAxis(this._rotationAxis,e),this._translationMatrix.makeTranslation(-t.x,-t.y,-t.z),this._m4_1.makeTranslation(t.x,t.y,t.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(t),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,e),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),Qn}getRaycaster(){return NM}unprojectOnObj(t,e){let n=this.getRaycaster();n.near=e.near,n.far=e.far,n.setFromCamera(t,e);let i=n.intersectObjects(this.scene.children,!0);for(let s=0;s<i.length;s++)if(i[s].object.uuid!=this._gizmos.uuid&&i[s].face!=null)return i[s].point.clone();return null}unprojectOnTbSurface(t,e,n,i,s){if(t.type=="OrthographicCamera"){this._v2_1.copy(this.getCursorPosition(e,n,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);let o=Math.pow(this._v2_1.x,2),a=Math.pow(this._v2_1.y,2),c=Math.pow(this._tbRadius,2);return o+a<=c*.5?this._v3_1.setZ(Math.sqrt(c-(o+a))):this._v3_1.setZ(c*.5/Math.sqrt(o+a)),this._v3_1}else if(t.type=="PerspectiveCamera"){this._v2_1.copy(this.getCursorNDC(e,n,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(t.projectionMatrixInverse);let o=this._v3_1.clone().normalize(),a=t.position.distanceTo(this._gizmos.position),c=Math.pow(s,2),l=this._v3_1.z,h=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(h==0)return o.set(this._v3_1.x,this._v3_1.y,s),o;let u=l/h,d=a,x=Math.pow(u,2)+1,m=2*u*d,g=Math.pow(d,2)-c,f=Math.pow(m,2)-4*x*g;if(f>=0&&(this._v2_1.setX((-m-Math.sqrt(f))/(2*x)),this._v2_1.setY(u*this._v2_1.x+d),Xe.RAD2DEG*this._v2_1.angle()>=45)){let E=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(a-this._v2_1.y,2));return o.multiplyScalar(E),o.z+=a,o}x=u,m=d,g=-c*.5,f=Math.pow(m,2)-4*x*g,this._v2_1.setX((-m-Math.sqrt(f))/(2*x)),this._v2_1.setY(u*this._v2_1.x+d);let p=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(a-this._v2_1.y,2));return o.multiplyScalar(p),o.z+=a,o}}unprojectOnTbPlane(t,e,n,i,s=!1){if(t.type=="OrthographicCamera")return this._v2_1.copy(this.getCursorPosition(e,n,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(t.type=="PerspectiveCamera"){this._v2_1.copy(this.getCursorNDC(e,n,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(t.projectionMatrixInverse);let o=this._v3_1.clone().normalize(),a=this._v3_1.z,c=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2)),l;if(s?l=this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):l=t.position.distanceTo(this._gizmos.position),c==0)return o.set(0,0,0),o;let h=a/c,u=l,d=-u/h,x=Math.sqrt(Math.pow(u,2)+Math.pow(d,2));return o.multiplyScalar(x),o.z=0,o}}updateMatrixState(){this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera.isOrthographicCamera?(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom):this.camera.isPerspectiveCamera&&(this._fovState=this.camera.fov)}updateTbState(t,e){this._state=t,e&&this.updateMatrixState()}update(){if(this.target.equals(this._currentTarget)===!1&&(this._gizmos.position.copy(this.target),this._tbRadius=this.calculateTbRadius(this.camera),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)),this.camera.isOrthographicCamera){if(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom){let e=Xe.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.scale(e/this.camera.zoom,this._gizmos.position,!0))}}else if(this.camera.isPerspectiveCamera){let e=this.camera.position.distanceTo(this._gizmos.position);if(e>this.maxDistance+1e-6||e<this.minDistance-1e-6){let i=Xe.clamp(e,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.scale(i/e,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=Xe.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());let n=this._tbRadius;if(this._tbRadius=this.calculateTbRadius(this.camera),n<this._tbRadius-1e-6||n>this._tbRadius+1e-6){let i=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,s=this._tbRadius/i,a=new ks(0,0,s,s).getPoints(this._curvePts),c=new gn().setFromPoints(a);for(let l in this._gizmos.children)this._gizmos.children[l].geometry=c}}this.camera.lookAt(this._gizmos.position)}setStateFromJSON(t){let e=JSON.parse(t);if(e.arcballState!=null){this._cameraMatrixState.fromArray(e.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(e.arcballState.cameraUp),this.camera.near=e.arcballState.cameraNear,this.camera.far=e.arcballState.cameraFar,this.camera.zoom=e.arcballState.cameraZoom,this.camera.isPerspectiveCamera&&(this.camera.fov=e.arcballState.cameraFov),this._gizmoMatrixState.fromArray(e.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.camera);let n=new Kt().copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(n),this.camera.lookAt(this._gizmos.position),this.updateTbState(It.IDLE,!1),this.dispatchEvent(Ne)}}};function UM(){let r=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;this._tbRadius=this.calculateTbRadius(this.camera);let t=this._tbRadius/r,n=new ks(0,0,t,t).getPoints(this._curvePts),i=new gn().setFromPoints(n);for(let s in this._gizmos.children)this._gizmos.children[s].geometry=i;this.dispatchEvent(Ne)}function zM(r){if(this.enabled){for(let t=0;t<this.mouseActions.length;t++)if(this.mouseActions[t].mouse==2){r.preventDefault();break}}}function VM(){this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=Re.NONE}function HM(r){if(r.button==0&&r.isPrimary?(this._downValid=!0,this._downEvents.push(r),this._downStart=performance.now()):this._downValid=!1,r.pointerType=="touch"&&this._input!=Re.CURSOR)switch(this._touchStart.push(r),this._touchCurrent.push(r),this._input){case Re.NONE:this._input=Re.ONE_FINGER,this.onSinglePanStart(r,"ROTATE"),window.addEventListener("pointermove",this._onPointerMove),window.addEventListener("pointerup",this._onPointerUp);break;case Re.ONE_FINGER:case Re.ONE_FINGER_SWITCHED:this._input=Re.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case Re.TWO_FINGER:this._input=Re.MULT_FINGER,this.onTriplePanStart(r);break}else if(r.pointerType!="touch"&&this._input==Re.NONE){let t=null;r.ctrlKey||r.metaKey?t="CTRL":r.shiftKey&&(t="SHIFT"),this._mouseOp=this.getOpFromAction(r.button,t),this._mouseOp!=null&&(window.addEventListener("pointermove",this._onPointerMove),window.addEventListener("pointerup",this._onPointerUp),this._input=Re.CURSOR,this._button=r.button,this.onSinglePanStart(r,this._mouseOp))}}function GM(r){if(r.pointerType=="touch"&&this._input!=Re.CURSOR)switch(this._input){case Re.ONE_FINGER:this.updateTouchEvent(r),this.onSinglePanMove(r,It.ROTATE);break;case Re.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],r)*this._devPxRatio>=this._switchSensibility){this._input=Re.ONE_FINGER,this.updateTouchEvent(r),this.onSinglePanStart(r,"ROTATE");break}break;case Re.TWO_FINGER:this.updateTouchEvent(r),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case Re.MULT_FINGER:this.updateTouchEvent(r),this.onTriplePanMove(r);break}else if(r.pointerType!="touch"&&this._input==Re.CURSOR){let t=null;r.ctrlKey||r.metaKey?t="CTRL":r.shiftKey&&(t="SHIFT");let e=this.getOpStateFromAction(this._button,t);e!=null&&this.onSinglePanMove(r,e)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],r)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}function WM(r){if(r.pointerType=="touch"&&this._input!=Re.CURSOR){let t=this._touchCurrent.length;for(let e=0;e<t;e++)if(this._touchCurrent[e].pointerId==r.pointerId){this._touchCurrent.splice(e,1),this._touchStart.splice(e,1);break}switch(this._input){case Re.ONE_FINGER:case Re.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this._input=Re.NONE,this.onSinglePanEnd();break;case Re.TWO_FINGER:this.onDoublePanEnd(r),this.onPinchEnd(r),this.onRotateEnd(r),this._input=Re.ONE_FINGER_SWITCHED;break;case Re.MULT_FINGER:this._touchCurrent.length==0&&(window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this._input=Re.NONE,this.onTriplePanEnd());break}}else r.pointerType!="touch"&&this._input==Re.CURSOR&&(window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this._input=Re.NONE,this.onSinglePanEnd(),this._button=-1);if(r.isPrimary)if(this._downValid)if(r.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(this._nclicks==0)this._nclicks=1,this._clickStart=performance.now();else{let e=r.timeStamp-this._clickStart,n=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;e<=this._maxInterval&&n<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(r)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length);else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}function jM(r){if(this.enabled&&this.enableZoom){let t=null;r.ctrlKey||r.metaKey?t="CTRL":r.shiftKey&&(t="SHIFT");let e=this.getOpFromAction("WHEEL",t);if(e!=null){r.preventDefault(),this.dispatchEvent(Fi);let n=125,i=r.deltaY/n,s=1;switch(i>0?s=1/this.scaleFactor:i<0&&(s=this.scaleFactor),e){case"ZOOM":if(this.updateTbState(It.SCALE,!0),i>0?s=1/Math.pow(this.scaleFactor,i):i<0&&(s=Math.pow(this.scaleFactor,-i)),this.cursorZoom&&this.enablePan){let o;this.camera.isOrthographicCamera?o=this.unprojectOnTbPlane(this.camera,r.clientX,r.clientY,this.domElement).applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera.isPerspectiveCamera&&(o=this.unprojectOnTbPlane(this.camera,r.clientX,r.clientY,this.domElement).applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),this.applyTransformMatrix(this.scale(s,o))}else this.applyTransformMatrix(this.scale(s,this._gizmos.position));this._grid!=null&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(It.IDLE,!1),this.dispatchEvent(Ne),this.dispatchEvent(pi);break;case"FOV":if(this.camera.isPerspectiveCamera){this.updateTbState(It.FOV,!0),r.deltaX!=0&&(i=r.deltaX/n,s=1,i>0?s=1/Math.pow(this.scaleFactor,i):i<0&&(s=Math.pow(this.scaleFactor,-i))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let o=this._v3_1.distanceTo(this._gizmos.position),a=o/s;a=Xe.clamp(a,this.minDistance,this.maxDistance);let c=o*Math.tan(Xe.DEG2RAD*this.camera.fov*.5),l=Xe.RAD2DEG*(Math.atan(c/a)*2);l>this.maxFov?l=this.maxFov:l<this.minFov&&(l=this.minFov);let h=c/Math.tan(Xe.DEG2RAD*(l/2));s=o/h,this.setFov(l),this.applyTransformMatrix(this.scale(s,this._gizmos.position,!1))}this._grid!=null&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(It.IDLE,!1),this.dispatchEvent(Ne),this.dispatchEvent(pi);break}}}}var Wh=class extends Ls{constructor(t){super(t)}load(t,e,n,i){let s=this,o=this.path===""?Rh.extractUrlBase(t):this.path,a=new Yo(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(c){try{e(s.parse(c,o))}catch(l){i?i(l):console.error(l),s.manager.itemError(t)}},n,i)}setMaterialOptions(t){return this.materialOptions=t,this}parse(t,e){let n=t.split(`
`),i={},s=/\s+/,o={};for(let c=0;c<n.length;c++){let l=n[c];if(l=l.trim(),l.length===0||l.charAt(0)==="#")continue;let h=l.indexOf(" "),u=h>=0?l.substring(0,h):l;u=u.toLowerCase();let d=h>=0?l.substring(h+1):"";if(d=d.trim(),u==="newmtl")i={name:d},o[d]=i;else if(u==="ka"||u==="kd"||u==="ks"||u==="ke"){let x=d.split(s,3);i[u]=[parseFloat(x[0]),parseFloat(x[1]),parseFloat(x[2])]}else i[u]=d}let a=new Nx(this.resourcePath||e,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(o),a}},Nx=class{constructor(t="",e={}){this.baseUrl=t,this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:Yi,this.wrap=this.options.wrap!==void 0?this.options.wrap:Cc}setCrossOrigin(t){return this.crossOrigin=t,this}setManager(t){this.manager=t}setMaterials(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(t){if(!this.options)return t;let e={};for(let n in t){let i=t[n],s={};e[n]=s;for(let o in i){let a=!0,c=i[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(c=[c[0]/255,c[1]/255,c[2]/255]),this.options&&this.options.ignoreZeroRGBs&&c[0]===0&&c[1]===0&&c[2]===0&&(a=!1);break;default:break}a&&(s[l]=c)}}return e}preload(){for(let t in this.materialsInfo)this.create(t)}getIndex(t){return this.nameLookup[t]}getAsArray(){let t=0;for(let e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray}create(t){return this.materials[t]===void 0&&this.createMaterial_(t),this.materials[t]}createMaterial_(t){let e=this,n=this.materialsInfo[t],i={name:t,side:this.side};function s(a,c){return typeof c!="string"||c===""?"":/^https?:\/\//i.test(c)?c:a+c}function o(a,c){if(i[a])return;let l=e.getTextureParams(c,i),h=e.loadTexture(s(e.baseUrl,l.url));h.repeat.copy(l.scale),h.offset.copy(l.offset),h.wrapS=e.wrap,h.wrapT=e.wrap,(a==="map"||a==="emissiveMap")&&(h.colorSpace=li),i[a]=h}for(let a in n){let c=n[a],l;if(c!=="")switch(a.toLowerCase()){case"kd":i.color=new $t().fromArray(c).convertSRGBToLinear();break;case"ks":i.specular=new $t().fromArray(c).convertSRGBToLinear();break;case"ke":i.emissive=new $t().fromArray(c).convertSRGBToLinear();break;case"map_kd":o("map",c);break;case"map_ks":o("specularMap",c);break;case"map_ke":o("emissiveMap",c);break;case"norm":o("normalMap",c);break;case"map_bump":case"bump":o("bumpMap",c);break;case"map_d":o("alphaMap",c),i.transparent=!0;break;case"ns":i.shininess=parseFloat(c);break;case"d":l=parseFloat(c),l<1&&(i.opacity=l,i.transparent=!0);break;case"tr":l=parseFloat(c),this.options&&this.options.invertTrProperty&&(l=1-l),l>0&&(i.opacity=1-l,i.transparent=!0);break;default:break}}return this.materials[t]=new jo(i),this.materials[t]}getTextureParams(t,e){let n={scale:new Zt(1,1),offset:new Zt(0,0)},i=t.split(/\s+/),s;return s=i.indexOf("-bm"),s>=0&&(e.bumpScale=parseFloat(i[s+1]),i.splice(s,2)),s=i.indexOf("-s"),s>=0&&(n.scale.set(parseFloat(i[s+1]),parseFloat(i[s+2])),i.splice(s,4)),s=i.indexOf("-o"),s>=0&&(n.offset.set(parseFloat(i[s+1]),parseFloat(i[s+2])),i.splice(s,4)),n.url=i.join(" ").trim(),n}loadTexture(t,e,n,i,s){let o=this.manager!==void 0?this.manager:Ox,a=o.getHandler(t);a===null&&(a=new Fh(o)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);let c=a.load(t,n,i,s);return e!==void 0&&(c.mapping=e),c}};var XM=/^[og]\s*(.+)?/,YM=/^mtllib /,qM=/^usemtl /,$M=/^usemap /,oE=/\s+/,aE=new I,Ux=new I,cE=new I,lE=new I,mi=new I,jh=new $t;function ZM(){let r={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&this.object.fromDeclaration===!1){this.object.name=t,this.object.fromDeclaration=e!==!1;return}let n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:e!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(i,s){let o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);let a={index:this.materials.length,name:i||"",mtllib:Array.isArray(s)&&s.length>0?s[s.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(c){let l={index:typeof c=="number"?c:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return l.clone=this.clone.bind(l),l}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(i){let s=this.currentMaterial();if(s&&s.groupEnd===-1&&(s.groupEnd=this.geometry.vertices.length/3,s.groupCount=s.groupEnd-s.groupStart,s.inherited=!1),i&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return i&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),s}},n&&n.name&&typeof n.clone=="function"){let i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(t,e){let n=parseInt(t,10);return(n>=0?n-1:n+e/3)*3},parseNormalIndex:function(t,e){let n=parseInt(t,10);return(n>=0?n-1:n+e/3)*3},parseUVIndex:function(t,e){let n=parseInt(t,10);return(n>=0?n-1:n+e/2)*2},addVertex:function(t,e,n){let i=this.vertices,s=this.object.geometry.vertices;s.push(i[t+0],i[t+1],i[t+2]),s.push(i[e+0],i[e+1],i[e+2]),s.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(t){let e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){let e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,n){let i=this.normals,s=this.object.geometry.normals;s.push(i[t+0],i[t+1],i[t+2]),s.push(i[e+0],i[e+1],i[e+2]),s.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(t,e,n){let i=this.vertices,s=this.object.geometry.normals;aE.fromArray(i,t),Ux.fromArray(i,e),cE.fromArray(i,n),mi.subVectors(cE,Ux),lE.subVectors(aE,Ux),mi.cross(lE),mi.normalize(),s.push(mi.x,mi.y,mi.z),s.push(mi.x,mi.y,mi.z),s.push(mi.x,mi.y,mi.z)},addColor:function(t,e,n){let i=this.colors,s=this.object.geometry.colors;i[t]!==void 0&&s.push(i[t+0],i[t+1],i[t+2]),i[e]!==void 0&&s.push(i[e+0],i[e+1],i[e+2]),i[n]!==void 0&&s.push(i[n+0],i[n+1],i[n+2])},addUV:function(t,e,n){let i=this.uvs,s=this.object.geometry.uvs;s.push(i[t+0],i[t+1]),s.push(i[e+0],i[e+1]),s.push(i[n+0],i[n+1])},addDefaultUV:function(){let t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){let e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,n,i,s,o,a,c,l){let h=this.vertices.length,u=this.parseVertexIndex(t,h),d=this.parseVertexIndex(e,h),x=this.parseVertexIndex(n,h);if(this.addVertex(u,d,x),this.addColor(u,d,x),a!==void 0&&a!==""){let m=this.normals.length;u=this.parseNormalIndex(a,m),d=this.parseNormalIndex(c,m),x=this.parseNormalIndex(l,m),this.addNormal(u,d,x)}else this.addFaceNormal(u,d,x);if(i!==void 0&&i!==""){let m=this.uvs.length;u=this.parseUVIndex(i,m),d=this.parseUVIndex(s,m),x=this.parseUVIndex(o,m),this.addUV(u,d,x),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";let e=this.vertices.length;for(let n=0,i=t.length;n<i;n++){let s=this.parseVertexIndex(t[n],e);this.addVertexPoint(s),this.addColor(s)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";let n=this.vertices.length,i=this.uvs.length;for(let s=0,o=t.length;s<o;s++)this.addVertexLine(this.parseVertexIndex(t[s],n));for(let s=0,o=e.length;s<o;s++)this.addUVLine(this.parseUVIndex(e[s],i))}};return r.startObject("",!1),r}var Xh=class extends Ls{constructor(t){super(t),this.materials=null}load(t,e,n,i){let s=this,o=new Yo(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(a){try{e(s.parse(a))}catch(c){i?i(c):console.error(c),s.manager.itemError(t)}},n,i)}setMaterials(t){return this.materials=t,this}parse(t){let e=new ZM;t.indexOf(`\r
`)!==-1&&(t=t.replace(/\r\n/g,`
`)),t.indexOf(`\\
`)!==-1&&(t=t.replace(/\\\n/g,""));let n=t.split(`
`),i=[];for(let a=0,c=n.length;a<c;a++){let l=n[a].trimStart();if(l.length===0)continue;let h=l.charAt(0);if(h!=="#")if(h==="v"){let u=l.split(oE);switch(u[0]){case"v":e.vertices.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])),u.length>=7?(jh.setRGB(parseFloat(u[4]),parseFloat(u[5]),parseFloat(u[6])).convertSRGBToLinear(),e.colors.push(jh.r,jh.g,jh.b)):e.colors.push(void 0,void 0,void 0);break;case"vn":e.normals.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]));break;case"vt":e.uvs.push(parseFloat(u[1]),parseFloat(u[2]));break}}else if(h==="f"){let d=l.slice(1).trim().split(oE),x=[];for(let g=0,f=d.length;g<f;g++){let p=d[g];if(p.length>0){let v=p.split("/");x.push(v)}}let m=x[0];for(let g=1,f=x.length-1;g<f;g++){let p=x[g],v=x[g+1];e.addFace(m[0],p[0],v[0],m[1],p[1],v[1],m[2],p[2],v[2])}}else if(h==="l"){let u=l.substring(1).trim().split(" "),d=[],x=[];if(l.indexOf("/")===-1)d=u;else for(let m=0,g=u.length;m<g;m++){let f=u[m].split("/");f[0]!==""&&d.push(f[0]),f[1]!==""&&x.push(f[1])}e.addLineGeometry(d,x)}else if(h==="p"){let d=l.slice(1).trim().split(" ");e.addPointGeometry(d)}else if((i=XM.exec(l))!==null){let u=(" "+i[0].slice(1).trim()).slice(1);e.startObject(u)}else if(qM.test(l))e.object.startMaterial(l.substring(7).trim(),e.materialLibraries);else if(YM.test(l))e.materialLibraries.push(l.substring(7).trim());else if($M.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(i=l.split(" "),i.length>1){let d=i[1].trim().toLowerCase();e.object.smooth=d!=="0"&&d!=="off"}else e.object.smooth=!0;let u=e.object.currentMaterial();u&&(u.smooth=e.object.smooth)}else{if(l==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}}e.finalize();let s=new Xi;if(s.materialLibraries=[].concat(e.materialLibraries),!(e.objects.length===1&&e.objects[0].geometry.vertices.length===0)===!0)for(let a=0,c=e.objects.length;a<c;a++){let l=e.objects[a],h=l.geometry,u=l.materials,d=h.type==="Line",x=h.type==="Points",m=!1;if(h.vertices.length===0)continue;let g=new gn;g.setAttribute("position",new on(h.vertices,3)),h.normals.length>0&&g.setAttribute("normal",new on(h.normals,3)),h.colors.length>0&&(m=!0,g.setAttribute("color",new on(h.colors,3))),h.hasUVIndices===!0&&g.setAttribute("uv",new on(h.uvs,2));let f=[];for(let v=0,E=u.length;v<E;v++){let C=u[v],b=C.name+"_"+C.smooth+"_"+m,A=e.materials[b];if(this.materials!==null){if(A=this.materials.create(C.name),d&&A&&!(A instanceof fi)){let w=new fi;xi.prototype.copy.call(w,A),w.color.copy(A.color),A=w}else if(x&&A&&!(A instanceof Gr)){let w=new Gr({size:10,sizeAttenuation:!1});xi.prototype.copy.call(w,A),w.color.copy(A.color),w.map=A.map,A=w}}A===void 0&&(d?A=new fi:x?A=new Gr({size:1,sizeAttenuation:!1}):A=new jo,A.name=C.name,A.flatShading=!C.smooth,A.vertexColors=m,e.materials[b]=A),f.push(A)}let p;if(f.length>1){for(let v=0,E=u.length;v<E;v++){let C=u[v];g.addGroup(C.groupStart,C.groupCount,v)}d?p=new Go(g,f):x?p=new Wo(g,f):p=new Wn(g,f)}else d?p=new Go(g,f[0]):x?p=new Wo(g,f[0]):p=new Wn(g,f[0]);p.name=l.name,s.add(p)}else if(e.vertices.length>0){let a=new Gr({size:1,sizeAttenuation:!1}),c=new gn;c.setAttribute("position",new on(e.vertices,3)),e.colors.length>0&&e.colors[0]!==void 0&&(c.setAttribute("color",new on(e.colors,3)),a.vertexColors=!0);let l=new Wo(c,a);s.add(l)}return s}};function hE(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function U(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?hE(Object(e),!0).forEach(function(n){z(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):hE(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}function z(r,t,e){return(t=VE(t))in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function ke(r,t){if(r==null)return{};var e,n,i=function(o,a){if(o==null)return{};var c,l,h={},u=Object.keys(o);for(l=0;l<u.length;l++)c=u[l],a.indexOf(c)>=0||(h[c]=o[c]);return h}(r,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);for(n=0;n<s.length;n++)e=s[n],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(r,e)&&(i[e]=r[e])}return i}function nr(r,t){return t||(t=r.slice(0)),Object.freeze(Object.defineProperties(r,{raw:{value:Object.freeze(t)}}))}function VE(r){var t=function(e,n){if(typeof e!="object"||e===null)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var s=i.call(e,n||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}(r,"string");return typeof t=="symbol"?t:String(t)}var t0=class{constructor(){z(this,"browserShadowBlurConstant",1),z(this,"DPI",96),z(this,"devicePixelRatio",typeof window<"u"?window.devicePixelRatio:1),z(this,"perfLimitSizeTotal",2097152),z(this,"maxCacheSideLimit",4096),z(this,"minCacheSideLimit",256),z(this,"disableStyleCopyPaste",!1),z(this,"enableGLFiltering",!0),z(this,"textureSize",4096),z(this,"forceGLPutImageData",!1),z(this,"cachesBoundsOfCurve",!0),z(this,"fontPaths",{}),z(this,"NUM_FRACTION_DIGITS",4)}},ve=new class extends t0{constructor(r){super(),this.configure(r)}configure(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,r)}addFonts(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=U(U({},this.fontPaths),r)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(r=>{delete this.fontPaths[r]})}clearFonts(){this.fontPaths={}}restoreDefaults(r){let t=new t0,e=r?.reduce((n,i)=>(n[i]=t[i],n),{})||t;this.configure(e)}},es=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return console[r]("fabric",...e)},_i=class extends Error{constructor(t,e){super("fabric: ".concat(t),e)}},e0=class extends _i{constructor(t){super("".concat(t," 'options.signal' is in 'aborted' state"))}},Kx=class{},Qx=class extends Kx{testPrecision(t,e){let n="precision ".concat(e,` float;
void main(){}`),i=t.createShader(t.FRAGMENT_SHADER);return!!i&&(t.shaderSource(i,n),t.compileShader(i),!!t.getShaderParameter(i,t.COMPILE_STATUS))}queryWebGL(t){let e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(n=>this.testPrecision(e,n)),e.getExtension("WEBGL_lose_context").loseContext(),es("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t}},JM={},uE;var tr=()=>uE||(uE={document,window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new Qx,dispose(){},copyPasteData:JM}),Sa=()=>tr().document,w0=()=>tr().window,HE=()=>{var r;return Math.max((r=ve.devicePixelRatio)!==null&&r!==void 0?r:w0().devicePixelRatio,1)},Rc=new class{constructor(){z(this,"charWidthsCache",{}),z(this,"boundsOfCurveCache",{})}getFontCache(r){let{fontFamily:t,fontStyle:e,fontWeight:n}=r;t=t.toLowerCase(),this.charWidthsCache[t]||(this.charWidthsCache[t]={});let i=this.charWidthsCache[t],s="".concat(e.toLowerCase(),"_").concat((n+"").toLowerCase());return i[s]||(i[s]={}),i[s]}clearFontCache(r){(r=(r||"").toLowerCase())?this.charWidthsCache[r]&&delete this.charWidthsCache[r]:this.charWidthsCache={}}limitDimsByArea(r){let{perfLimitSizeTotal:t}=ve,e=Math.sqrt(t*r);return[Math.floor(e),Math.floor(t/e)]}},tf="6.0.0-rc1";function Hs(){}var ns=Math.PI/2,Cr=2*Math.PI,Ff=Math.PI/180,Nn=Object.freeze([1,0,0,1,0,0]),Pf=16,Xr=.4477152502,ue="center",Se="left",Rn="top",ef="bottom",Je="right",Xn="none",Rf=/\r?\n/,Tc="json",zx="svg",St=new class{constructor(){this[Tc]=new Map,this[zx]=new Map}getClass(r){let t=this[Tc].get(r);if(!t)throw new _i("No class registered for ".concat(r));return t}setClass(r,t){t?this[Tc].set(t,r):(this[Tc].set(r.type,r),this[Tc].set(r.type.toLowerCase(),r))}getSVGClass(r){return this[zx].get(r)}setSVGClass(r,t){this[zx].set(t??r.type.toLowerCase(),r)}},n0=new class extends Array{remove(r){let t=this.indexOf(r);t>-1&&this.splice(t,1)}cancelAll(){let r=this.splice(0);return r.forEach(t=>t.abort()),r}cancelByCanvas(r){if(!r)return[];let t=this.filter(e=>{var n;return e.target===r||typeof e.target=="object"&&((n=e.target)===null||n===void 0?void 0:n.canvas)===r});return t.forEach(e=>e.abort()),t}cancelByTarget(r){if(!r)return[];let t=this.filter(e=>e.target===r);return t.forEach(e=>e.abort()),t}},nf=class{constructor(){z(this,"__eventListeners",{})}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),typeof t=="object")return Object.entries(t).forEach(n=>{let[i,s]=n;this.on(i,s)}),()=>this.off(t);if(e){let n=t;return this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(e),()=>this.off(n,e)}return()=>!1}once(t,e){if(typeof t=="object"){let n=[];return Object.entries(t).forEach(i=>{let[s,o]=i;n.push(this.once(s,o))}),()=>n.forEach(i=>i())}if(e){let n=this.on(t,function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];e.call(this,...s),n()});return n}return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){let n=this.__eventListeners[t],i=n.indexOf(e);i>-1&&n.splice(i,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(t===void 0)for(let n in this.__eventListeners)this._removeEventListener(n);else typeof t=="object"?Object.entries(t).forEach(n=>{let[i,s]=n;this._removeEventListener(i,s)}):this._removeEventListener(t,e)}fire(t,e){var n;if(!this.__eventListeners)return;let i=(n=this.__eventListeners[t])===null||n===void 0?void 0:n.concat();if(i)for(let s=0;s<i.length;s++)i[s].call(this,e||{})}},KM=(r,t)=>Math.floor(Math.random()*(t-r+1))+r,Jo=(r,t)=>isNaN(r)&&typeof t=="number"?t:r,Us=(r,t)=>{let e=r.indexOf(t);return e!==-1&&r.splice(e,1),r},Ii=r=>{if(r===0)return 1;switch(Math.abs(r)/ns){case 1:case 3:return 0;case 2:return-1}return Math.cos(r)},Li=r=>{if(r===0)return 0;let t=r/ns,e=Math.sign(r);switch(t){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(r)},Q=class r{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new r(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new r(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new r(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new r(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new r(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new r(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new r(this.x/t.x,this.y/t.y)}scalarDivide(t){return new r(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new r(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){let e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}midPointFrom(t){return this.lerp(t)}min(t){return new r(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new r(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){let e=this.x,n=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=n}clone(){return new r(this.x,this.y)}rotate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:kf,n=Li(t),i=Ii(t),s=this.subtract(e);return new r(s.x*i-s.y*n,s.x*n+s.y*i).add(e)}transform(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new r(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}},kf=new Q(0,0),Qh=r=>!!r&&Array.isArray(r._objects);function GE(r){class t extends r{constructor(){super(...arguments),z(this,"_objects",[])}_onObjectAdded(n){}_onObjectRemoved(n){}_onStackOrderChanged(n){}add(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];let o=this._objects.push(...i);return i.forEach(a=>this._onObjectAdded(a)),o}insertAt(n){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return this._objects.splice(n,0,...s),s.forEach(a=>this._onObjectAdded(a)),this._objects.length}remove(){let n=this._objects,i=[];for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return o.forEach(c=>{let l=n.indexOf(c);l!==-1&&(n.splice(l,1),i.push(c),this._onObjectRemoved(c))}),i}forEachObject(n){this.getObjects().forEach((i,s,o)=>n(i,s,o))}getObjects(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return i.length===0?[...this._objects]:this._objects.filter(o=>o.isType(...i))}item(n){return this._objects[n]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(n,i){return!!this._objects.includes(n)||!!i&&this._objects.some(s=>s instanceof t&&s.contains(n,!0))}complexity(){return this._objects.reduce((n,i)=>n+=i.complexity?i.complexity():0,0)}sendObjectToBack(n){return!(!n||n===this._objects[0])&&(Us(this._objects,n),this._objects.unshift(n),this._onStackOrderChanged(n),!0)}bringObjectToFront(n){return!(!n||n===this._objects[this._objects.length-1])&&(Us(this._objects,n),this._objects.push(n),this._onStackOrderChanged(n),!0)}sendObjectBackwards(n,i){if(!n)return!1;let s=this._objects.indexOf(n);if(s!==0){let o=this.findNewLowerIndex(n,s,i);return Us(this._objects,n),this._objects.splice(o,0,n),this._onStackOrderChanged(n),!0}return!1}bringObjectForward(n,i){if(!n)return!1;let s=this._objects.indexOf(n);if(s!==this._objects.length-1){let o=this.findNewUpperIndex(n,s,i);return Us(this._objects,n),this._objects.splice(o,0,n),this._onStackOrderChanged(n),!0}return!1}moveObjectTo(n,i){return n!==this._objects[i]&&(Us(this._objects,n),this._objects.splice(i,0,n),this._onStackOrderChanged(n),!0)}findNewLowerIndex(n,i,s){let o;if(s){o=i;for(let a=i-1;a>=0;--a)if(n.isOverlapping(this._objects[a])){o=a;break}}else o=i-1;return o}findNewUpperIndex(n,i,s){let o;if(s){o=i;for(let a=i+1;a<this._objects.length;++a)if(n.isOverlapping(this._objects[a])){o=a;break}}else o=i+1;return o}collectObjects(n){let{left:i,top:s,width:o,height:a}=n,{includeIntersecting:c=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=[],h=new Q(i,s),u=h.add(new Q(o,a));for(let d=this._objects.length-1;d>=0;d--){let x=this._objects[d];x.selectable&&x.visible&&(c&&x.intersectsWithRect(h,u)||x.isContainedWithinRect(h,u)||c&&x.containsPoint(h)||c&&x.containsPoint(u))&&l.push(x)}return l}}return t}var i0=class extends nf{_setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(let e in t)this.set(e,t[e])}_setObject(t){for(let e in t)this._set(e,t[e])}set(t,e){return typeof t=="object"?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){let e=this.get(t);return typeof e=="boolean"&&this.set(t,!e),this}get(t){return this[t]}};function kc(r){return w0().requestAnimationFrame(r)}function WE(r){return w0().cancelAnimationFrame(r)}var QM=0,is=()=>QM++,Ke=()=>{let r=Sa().createElement("canvas");if(!r||r.getContext===void 0)throw new _i("Failed to create `canvas` element");return r},jE=()=>Sa().createElement("img"),Of=(r,t,e)=>r.toDataURL("image/".concat(t),e),qe=r=>r*Ff,Xs=r=>r/Ff,t5=["translateX","translateY","angle"],Pn=(r,t,e)=>new Q(r).transform(t,e),ei=r=>{let t=1/(r[0]*r[3]-r[1]*r[2]),e=[t*r[3],-t*r[1],-t*r[2],t*r[0],0,0],{x:n,y:i}=new Q(r[4],r[5]).transform(e,!0);return e[4]=-n,e[5]=-i,e},yn=(r,t,e)=>[r[0]*t[0]+r[2]*t[1],r[1]*t[0]+r[3]*t[1],r[0]*t[2]+r[2]*t[3],r[1]*t[2]+r[3]*t[3],e?0:r[0]*t[4]+r[2]*t[5]+r[4],e?0:r[1]*t[4]+r[3]*t[5]+r[5]],Ma=(r,t)=>r.reduceRight((e,n)=>n?yn(n,e,t):e,Nn),XE=r=>{let[t,e]=r;return Math.atan2(e,t)},ya=r=>{let t=XE(r),e=Math.pow(r[0],2)+Math.pow(r[1],2),n=Math.sqrt(e),i=(r[0]*r[3]-r[2]*r[1])/n,s=Math.atan2(r[0]*r[2]+r[1]*r[3],e);return{angle:Xs(t),scaleX:n,scaleY:i,skewX:Xs(s),skewY:0,translateX:r[4]||0,translateY:r[5]||0}},Da=function(r){return[1,0,0,1,r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:0]};function Ba(){let{angle:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:t=0,y:e=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=qe(r),i=Ii(n),s=Li(n);return[i,s,-s,i,t?t-(i*t-s*e):0,e?e-(s*t+i*e):0]}var S0=function(r){return[r,0,0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:r,0,0]},YE=r=>Math.tan(qe(r)),If=r=>[1,0,YE(r),1,0,0],Lf=r=>[1,YE(r),0,1,0,0],Xc=r=>{let{scaleX:t=1,scaleY:e=1,flipX:n=!1,flipY:i=!1,skewX:s=0,skewY:o=0}=r;return Ma([S0(n?-t:t,i?-e:e),s&&If(s),o&&Lf(o)],!0)},qE=r=>{let{translateX:t=0,translateY:e=0,angle:n=0}=r,i=ke(r,t5);return Ma([Da(t,e),n&&Ba({angle:n}),Xc(i)])},Oc=function(r){let{signal:t,crossOrigin:e=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(n,i){if(t&&t.aborted)return i(new e0("loadImage"));let s=jE(),o;t&&(o=function(c){s.src="",i(c)},t.addEventListener("abort",o,{once:!0}));let a=function(){s.onload=s.onerror=null,o&&t?.removeEventListener("abort",o),n(s)};r?(s.onload=a,s.onerror=function(){o&&t?.removeEventListener("abort",o),i(new _i("Error loading ".concat(s.src)))},e&&(s.crossOrigin=e),s.src=r):a()})},Aa=function(r){let{signal:t,reviver:e=Hs}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((n,i)=>{let s=[];t&&t.addEventListener("abort",i,{once:!0}),Promise.all(r.map(o=>St.getClass(o.type).fromObject(o,{signal:t}).then(a=>(e(o,a),s.push(a),a)))).then(n).catch(o=>{s.forEach(a=>{a.dispose&&a.dispose()}),i(o)}).finally(()=>{t&&t.removeEventListener("abort",i)})})},Yc=function(r){let{signal:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((e,n)=>{let i=[];t&&t.addEventListener("abort",n,{once:!0});let s=Object.values(r).map(a=>a&&(a.type?Aa([a],{signal:t}).then(c=>{let[l]=c;return i.push(l),l}):a.source?St.getClass("pattern").fromObject(a,{signal:t}).then(c=>(i.push(c),c)):a)),o=Object.keys(r);Promise.all(s).then(a=>a.reduce((c,l,h)=>(c[o[h]]=l,c),{})).then(e).catch(a=>{i.forEach(c=>{c.dispose&&c.dispose()}),n(a)}).finally(()=>{t&&t.removeEventListener("abort",n)})})},$s=function(r){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce((t,e)=>(e in r&&(t[e]=r[e]),t),{})},Nf=(r,t)=>Object.keys(r).reduce((e,n)=>(t(r[n],n,r)&&(e[n]=r[n]),e),{}),dE={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},Vx=(r,t,e)=>(e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+6*(t-r)*e:e<.5?t:e<2/3?r+(t-r)*(2/3-e)*6:r),xE=(r,t,e,n)=>{r/=255,t/=255,e/=255;let i=Math.max(r,t,e),s=Math.min(r,t,e),o,a,c=(i+s)/2;if(i===s)o=a=0;else{let l=i-s;switch(a=c>.5?l/(2-i-s):l/(i+s),i){case r:o=(t-e)/l+(t<e?6:0);break;case t:o=(e-r)/l+2;break;case e:o=(r-t)/l+4}o/=6}return[Math.round(360*o),Math.round(100*a),Math.round(100*c),n]},fE=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(r)/(r.endsWith("%")?100:1)},Yh=r=>Math.min(Math.round(r),255).toString(16).toUpperCase().padStart(2,"0"),pE=r=>{let[t,e,n,i=1]=r,s=Math.round(.3*t+.59*e+.11*n);return[s,s,s,i]},Un=class r{constructor(t){if(t)if(t instanceof r)this.setSource([...t._source]);else if(Array.isArray(t)){let[e,n,i,s=1]=t;this.setSource([e,n,i,s])}else this.setSource(this._tryParsingColor(t));else this.setSource([0,0,0,1])}_tryParsingColor(t){return t in dE&&(t=dE[t]),t==="transparent"?[255,255,255,0]:r.sourceFromHex(t)||r.sourceFromRgb(t)||r.sourceFromHsl(t)||[0,0,0,1]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){let[t,e,n]=this.getSource();return"rgb(".concat(t,",").concat(e,",").concat(n,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){let[t,e,n]=xE(...this.getSource());return"hsl(".concat(t,",").concat(e,"%,").concat(n,"%)")}toHsla(){let[t,e,n,i]=xE(...this.getSource());return"hsla(".concat(t,",").concat(e,"%,").concat(n,"%,").concat(i,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){let[t,e,n,i]=this.getSource();return"".concat(Yh(t)).concat(Yh(e)).concat(Yh(n)).concat(Yh(Math.round(255*i)))}getAlpha(){return this.getSource()[3]}setAlpha(t){return this._source[3]=t,this}toGrayscale(){return this.setSource(pE(this.getSource())),this}toBlackWhite(t){let[e,,,n]=pE(this.getSource()),i=e<(t||127)?0:255;return this.setSource([i,i,i,n]),this}overlayWith(t){t instanceof r||(t=new r(t));let e=this.getSource(),n=t.getSource(),[i,s,o]=e.map((a,c)=>Math.round(.5*a+.5*n[c]));return this.setSource([i,s,o,e[3]]),this}static fromRgb(t){return r.fromRgba(t)}static fromRgba(t){return new r(r.sourceFromRgb(t))}static sourceFromRgb(t){let e=t.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(e){let[n,i,s]=e.slice(1,4).map(o=>{let a=parseFloat(o);return o.endsWith("%")?Math.round(2.55*a):a});return[n,i,s,fE(e[4])]}}static fromHsl(t){return r.fromHsla(t)}static fromHsla(t){return new r(r.sourceFromHsl(t))}static sourceFromHsl(t){let e=t.match(/^hsla?\(\s*([+-]?\d{1,3})\s*[\s|,]\s*(\d{1,3}%)\s*[\s|,]\s*(\d{1,3}%)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!e)return;let n=(parseFloat(e[1])%360+360)%360/360,i=parseFloat(e[2])/100,s=parseFloat(e[3])/100,o,a,c;if(i===0)o=a=c=s;else{let l=s<=.5?s*(i+1):s+i-s*i,h=2*s-l;o=Vx(h,l,n+1/3),a=Vx(h,l,n),c=Vx(h,l,n-1/3)}return[Math.round(255*o),Math.round(255*a),Math.round(255*c),fE(e[4])]}static fromHex(t){return new r(r.sourceFromHex(t))}static sourceFromHex(t){if(t.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){let e=t.slice(t.indexOf("#")+1),n;n=e.length<=4?e.split("").map(c=>c+c):e.match(/.{2}/g);let[i,s,o,a=255]=n.map(c=>parseInt(c,16));return[i,s,o,a/255]}}},me=(r,t)=>parseFloat(Number(r).toFixed(t)),Gs=function(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pf,e=/\D{0,2}$/.exec(r),n=parseFloat(r),i=ve.DPI;switch(e?.[0]){case"mm":return n*i/25.4;case"cm":return n*i/2.54;case"in":return n*i;case"pt":return n*i/72;case"pc":return n*i/72*12;case"em":return n*t;default:return n}},$E=r=>{let[t,e]=r.trim().split(" "),[n,i]=(s=t)&&s!==Xn?[s.slice(1,4),s.slice(5,8)]:s===Xn?[s,s]:["Mid","Mid"];var s;return{meetOrSlice:e||"meet",alignX:n,alignY:i}},zc=r=>"matrix("+r.map(t=>me(t,ve.NUM_FRACTION_DIGITS)).join(" ")+")",Vc=function(r,t){let e,n,i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(t)if(t.toLive)e="url(#SVGID_".concat(t.id,")");else{let s=new Un(t),o=s.getAlpha();e=s.toRgb(),o!==1&&(n=o.toString())}else e="none";return i?"".concat(r,": ").concat(e,"; ").concat(n?"".concat(r,"-opacity: ").concat(n,"; "):""):"".concat(r,'="').concat(e,'" ').concat(n?"".concat(r,'-opacity="').concat(n,'" '):"")},Ei=r=>!!r&&r.toLive!==void 0,mE=r=>!!r&&typeof r.toObject=="function",gE=r=>!!r&&r.offsetX!==void 0&&Object.hasOwn(r,"source"),ZE=r=>!!r&&typeof r._renderText=="function",Ko=r=>!!r&&Object.hasOwn(r,"multiSelectionStacking");function JE(r){let t=r&&ki(r),e=0,n=0;if(!r||!t)return{left:e,top:n};let i=t.documentElement,s=t.body||{scrollLeft:0,scrollTop:0};for(;r&&(r.parentNode||r.host)&&((r=r.parentNode||r.host)===t?(e=s.scrollLeft||i.scrollLeft||0,n=s.scrollTop||i.scrollTop||0):(e+=r.scrollLeft||0,n+=r.scrollTop||0),r.nodeType!==1||r.style.position!=="fixed"););return{left:e,top:n}}var ki=r=>r.ownerDocument||null,KE=r=>{var t;return((t=r.ownerDocument)===null||t===void 0?void 0:t.defaultView)||null};function Ic(r,t){let e=r.style;e&&(typeof t=="string"?r.style.cssText+=";"+t:Object.entries(t).forEach(n=>{let[i,s]=n;return e.setProperty(i,s)}))}var QE=function(r,t,e){let{width:n,height:i}=e,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;r.width=n,r.height=i,s>1&&(r.setAttribute("width",(n*s).toString()),r.setAttribute("height",(i*s).toString()),t.scale(s,s))},rf=(r,t)=>{let{width:e,height:n}=t;e&&(r.style.width=typeof e=="number"?"".concat(e,"px"):e),n&&(r.style.height=typeof n=="number"?"".concat(n,"px"):n)};function vE(r){return r.onselectstart!==void 0&&(r.onselectstart=()=>!1),r.style.userSelect=Xn,r}var r0=class{constructor(t){z(this,"_originalCanvasStyle",void 0),z(this,"lower",void 0);let e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")}}createLowerCanvas(t){let e=(n=t)&&n.getContext!==void 0?t:t&&Sa().getElementById(t)||Ke();var n;if(e.hasAttribute("data-fabric"))throw new _i("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=e.style.cssText,e.setAttribute("data-fabric","main"),e.classList.add("lower-canvas"),e}cleanupDOM(t){let{width:e,height:n}=t,{el:i}=this.lower;i.classList.remove("lower-canvas"),i.removeAttribute("data-fabric"),i.setAttribute("width","".concat(e)),i.setAttribute("height","".concat(n)),i.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(t,e){let{el:n,ctx:i}=this.lower;QE(n,i,t,e)}setCSSDimensions(t){rf(this.lower.el,t)}calcOffset(){return function(t){var e;let n={left:0,top:0},i=t&&ki(t),s={left:0,top:0},o={borderLeftWidth:Se,borderTopWidth:Rn,paddingLeft:Se,paddingTop:Rn};if(!i)return s;let a=((e=KE(t))===null||e===void 0?void 0:e.getComputedStyle(t,null))||{};for(let h in o)s[o[h]]+=parseInt(a[h],10)||0;let c=i.documentElement;t.getBoundingClientRect!==void 0&&(n=t.getBoundingClientRect());let l=JE(t);return{left:n.left+l.left-(c.clientLeft||0)+s.left,top:n.top+l.top-(c.clientTop||0)+s.top}}(this.lower.el)}dispose(){tr().dispose(this.lower.el),delete this.lower}},e5={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...Nn]},Hc=class r extends GE(i0){get lowerCanvasEl(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.el}get contextContainer(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.ctx}static getDefaults(){return r.ownDefaults}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(t){this.elements=new r0(t)}add(){let t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}insertAt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];let s=super.insertAt(t,...n);return n.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),s}remove(){let t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(es("warn",`Canvas is trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?HE():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}_setDimensionsImpl(t){let{cssOnly:e=!1,backstoreOnly:n=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!e){let i=U({width:this.width,height:this.height},t);this.elements.setDimensions(i,this.getRetinaScaling()),this.hasLostContext=!0,this.width=i.width,this.height=i.height}n||this.elements.setCSSDimensions(t),this.calcOffset()}setDimensions(t,e){this._setDimensionsImpl(t,e),e&&e.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){let e=this.backgroundImage,n=this.overlayImage,i=this._objects.length;this.viewportTransform=t;for(let s=0;s<i;s++){let o=this._objects[s];o.group||o.setCoords()}e&&e.setCoords(),n&&n.setCoords(),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){let n=t,i=[...this.viewportTransform],s=Pn(t,ei(i));i[0]=e,i[3]=e;let o=Pn(s,i);i[4]+=n.x-o.x,i[5]+=n.y-o.y,this.setViewportTransform(i)}setZoom(t){this.zoomToPoint(new Q(0,0),t)}absolutePan(t){let e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new Q(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=kc(()=>this.renderAndReset()))}calcViewportBoundaries(){let t=this.width,e=this.height,n=ei(this.viewportTransform),i=Pn({x:0,y:0},n),s=Pn({x:t,y:e},n),o=i.min(s),a=i.max(s);return this.vptCoords={tl:o,tr:new Q(a.x,o.y),bl:new Q(o.x,a.y),br:a}}cancelRequestedRender(){this.nextRenderHandle&&(WE(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(t){}renderCanvas(t,e){if(this.destroyed)return;let n=this.viewportTransform,i=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.drawControls(t),i&&(i._set("canvas",this),i.shouldCache(),i._transformDone=!0,i.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,i)),this._renderOverlay(t),this.controlsAboveOverlay&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(t,e){let n=this.viewportTransform;t.save(),t.transform(...n),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(let n=0,i=e.length;n<i;++n)e[n]&&e[n].render(t)}_renderBackgroundOrOverlay(t,e){let n=this["".concat(e,"Color")],i=this["".concat(e,"Image")],s=this.viewportTransform,o=this["".concat(e,"Vpt")];if(!n&&!i)return;let a=Ei(n);if(n){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=a?n.toLive(t):n,o&&t.transform(...s),a){t.transform(1,0,0,1,n.offsetX||0,n.offsetY||0);let c=n.gradientTransform||n.patternTransform;c&&t.transform(...c)}t.fill(),t.restore()}if(i){t.save();let{skipOffscreen:c}=this;this.skipOffscreen=o,o&&t.transform(...s),i.render(t),this.skipOffscreen=c,t.restore()}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new Q(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new Q(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new Q(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new Q(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new Q(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return Pn(this.getCenterPoint(),ei(this.viewportTransform))}_centerObject(t,e){t.setXY(e,ue,ue),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){let n=this.clipPath,i=n&&!n.excludeFromExport?this._toObject(n,t,e):null;return U(U(U({version:tf},$s(this,e)),{},{objects:this._objects.filter(s=>!s.excludeFromExport).map(s=>this._toObject(s,t,e))},this.__serializeBgOverlay(t,e)),i?{clipPath:i}:null)}_toObject(t,e,n){let i;this.includeDefaultValues||(i=t.includeDefaultValues,t.includeDefaultValues=!1);let s=t[e](n);return this.includeDefaultValues||(t.includeDefaultValues=!!i),s}__serializeBgOverlay(t,e){let n={},i=this.backgroundImage,s=this.overlayImage,o=this.backgroundColor,a=this.overlayColor;return Ei(o)?o.excludeFromExport||(n.background=o.toObject(e)):o&&(n.background=o),Ei(a)?a.excludeFromExport||(n.overlay=a.toObject(e)):a&&(n.overlay=a),i&&!i.excludeFromExport&&(n.backgroundImage=this._toObject(i,t,e)),s&&!s.excludeFromExport&&(n.overlayImage=this._toObject(s,t,e)),n}toSVG(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;let n=[];return this._setSVGPreamble(n,t),this._setSVGHeader(n,t),this.clipPath&&n.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(n,"background"),this._setSVGBgOverlayImage(n,"backgroundImage",e),this._setSVGObjects(n,e),this.clipPath&&n.push(`</g>
`),this._setSVGBgOverlayColor(n,"overlay"),this._setSVGBgOverlayImage(n,"overlayImage",e),n.push("</svg>"),n.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(t,e){let n=e.width||"".concat(this.width),i=e.height||"".concat(this.height),s=ve.NUM_FRACTION_DIGITS,o=e.viewBox,a;if(o)a='viewBox="'.concat(o.x," ").concat(o.y," ").concat(o.width," ").concat(o.height,'" ');else if(this.svgViewportTransformation){let c=this.viewportTransform;a='viewBox="'.concat(me(-c[4]/c[0],s)," ").concat(me(-c[5]/c[3],s)," ").concat(me(this.width/c[0],s)," ").concat(me(this.height/c[3],s),'" ')}else a='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',n,'" ','height="',i,'" ',a,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",tf,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),`</defs>
`)}createSVGClipPathMarkup(t){let e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(is()),'<clipPath id="'.concat(e.clipPathId,`" >
`).concat(e.toClipPathSVG(t.reviver),`</clipPath>
`)):""}createSVGRefElementsMarkup(){return["background","overlay"].map(t=>{let e=this["".concat(t,"Color")];if(Ei(e)){let n=this["".concat(t,"Vpt")],i=this.viewportTransform,s={isType:()=>!1,width:this.width/(n?i[0]:1),height:this.height/(n?i[3]:1)};return e.toSVG(s,{additionalTransform:n?zc(i):""})}}).join("")}createSVGFontFacesMarkup(){let t=[],e={},n=ve.fontPaths;this._objects.forEach(function s(o){t.push(o),Qh(o)&&o._objects.forEach(s)}),t.forEach(s=>{if(!ZE(s))return;let{styles:o,fontFamily:a}=s;!e[a]&&n[a]&&(e[a]=!0,o&&Object.values(o).forEach(c=>{Object.values(c).forEach(l=>{let{fontFamily:h=""}=l;!e[h]&&n[h]&&(e[h]=!0)})}))});let i=Object.keys(e).map(s=>`		@font-face {
			font-family: '`.concat(s,`';
			src: url('`).concat(n[s],`');
		}
`)).join("");return i?`	<style type="text/css"><![CDATA[
`.concat(i,`]]></style>
`):""}_setSVGObjects(t,e){this.forEachObject(n=>{n.excludeFromExport||this._setSVGObject(t,n,e)})}_setSVGObject(t,e,n){t.push(e.toSVG(n))}_setSVGBgOverlayImage(t,e,n){let i=this[e];i&&!i.excludeFromExport&&i.toSVG&&t.push(i.toSVG(n))}_setSVGBgOverlayColor(t,e){let n=this["".concat(e,"Color")];if(n)if(Ei(n)){let i=n.repeat||"",s=this.width,o=this.height,a=this["".concat(e,"Vpt")]?zc(ei(this.viewportTransform)):"";t.push('<rect transform="'.concat(a," translate(").concat(s/2,",").concat(o/2,')" x="').concat(n.offsetX-s/2,'" y="').concat(n.offsetY-o/2,'" width="').concat(i!=="repeat-y"&&i!=="no-repeat"||!gE(n)?s:n.source.width,'" height="').concat(i!=="repeat-x"&&i!=="no-repeat"||!gE(n)?o:n.source.height,'" fill="url(#SVGID_').concat(n.id,`)"></rect>
`))}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',n,'"',`></rect>
`)}loadFromJSON(t,e){let{signal:n}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!t)return Promise.reject(new _i("`json` is undefined"));let i=typeof t=="string"?JSON.parse(t):t,{objects:s=[],backgroundImage:o,background:a,overlayImage:c,overlay:l,clipPath:h}=i,u=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([Aa(s,{reviver:e,signal:n}),Yc({backgroundImage:o,backgroundColor:a,overlayImage:c,overlayColor:l,clipPath:h},{signal:n})]).then(d=>{let[x,m]=d;return this.clear(),this.add(...x),this.set(i),this.set(m),this.renderOnAddRemove=u,this})}clone(t){let e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){let t=Ke();return t.width=this.width,t.height=this.height,new this.constructor(t)}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{format:e="png",quality:n=1,multiplier:i=1,enableRetinaScaling:s=!1}=t,o=i*(s?this.getRetinaScaling():1);return Of(this.toCanvasElement(o,t),e,n)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:e,height:n,left:i,top:s,filter:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=(e||this.width)*t,c=(n||this.height)*t,l=this.getZoom(),h=this.width,u=this.height,d=l*t,x=this.viewportTransform,m=[d,0,0,d,(x[4]-(i||0))*t,(x[5]-(s||0))*t],g=this.enableRetinaScaling,f=Ke(),p=o?this._objects.filter(v=>o(v)):this._objects;return f.width=a,f.height=c,this.enableRetinaScaling=!1,this.viewportTransform=m,this.width=a,this.height=c,this.calcViewportBoundaries(),this.renderCanvas(f.getContext("2d"),p),this.viewportTransform=x,this.width=h,this.height=u,this.calcViewportBoundaries(),this.enableRetinaScaling=g,f}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),n0.cancelByCanvas(this),this.disposed=!0,new Promise((t,e)=>{let n=()=>{this.destroy(),t(!0)};n.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=n:n()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(t=>t.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}};z(Hc,"ownDefaults",e5);var n5=["touchstart","touchmove","touchend"],t_=r=>{let t=JE(r.target),e=function(n){let i=n.changedTouches;return i&&i[0]?i[0]:n}(r);return new Q(e.clientX+t.left,e.clientY+t.top)},s0=r=>n5.includes(r.type)||r.pointerType==="touch",sf=r=>{r.preventDefault(),r.stopPropagation()},Qi=r=>{if(r.length===0)return{left:0,top:0,width:0,height:0};let{min:t,max:e}=r.reduce((i,s)=>{let{min:o,max:a}=i;return{min:o.min(s),max:a.max(s)}},{min:new Q(r[0]),max:new Q(r[0])}),n=e.subtract(t);return{left:t.x,top:t.y,width:n.x,height:n.y}},i5=["translateX","translateY","scaleX","scaleY"],e_=(r,t)=>ba(r,yn(t,r.calcOwnMatrix())),ba=(r,t)=>{let e=ya(t),{translateX:n,translateY:i,scaleX:s,scaleY:o}=e,a=ke(e,i5),c=new Q(n,i);r.flipX=!1,r.flipY=!1,Object.assign(r,a),r.set({scaleX:s,scaleY:o}),r.setPositionByOrigin(c,ue,ue)},n_=r=>{r.scaleX=1,r.scaleY=1,r.skewX=0,r.skewY=0,r.flipX=!1,r.flipY=!1,r.rotate(0)},Uf=r=>({scaleX:r.scaleX,scaleY:r.scaleY,skewX:r.skewX,skewY:r.skewY,angle:r.angle,left:r.left,flipX:r.flipX,flipY:r.flipY,top:r.top}),M0=(r,t,e)=>{let n=r/2,i=t/2,s=[new Q(-n,-i),new Q(n,-i),new Q(-n,i),new Q(n,i)].map(a=>a.transform(e)),o=Qi(s);return new Q(o.width,o.height)},qc=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Nn;return yn(ei(arguments.length>1&&arguments[1]!==void 0?arguments[1]:Nn),r)},Kr=function(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Nn,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Nn;return r.transform(qc(t,e))},i_=function(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Nn,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Nn;return r.transform(qc(t,e),!0)},of=(r,t,e)=>{let n=qc(t,e);return ba(r,yn(n,r.calcOwnMatrix())),n},r_=(r,t)=>{var e;let{transform:{target:n}}=t;(e=n.canvas)===null||e===void 0||e.fire("object:".concat(r),U(U({},t),{},{target:n})),n.fire(r,t)},r5={left:-.5,top:-.5,center:0,bottom:.5,right:.5},Zr=r=>typeof r=="string"?r5[r]:r-.5,o0="not-allowed";function s_(r){return r.originX===ue&&r.originY===ue}function EE(r){return .5-Zr(r)}var Oi=(r,t)=>r[t],o_=(r,t,e,n)=>({e:r,transform:t,pointer:new Q(e,n)});function a_(r,t){let e=r.getTotalAngle()+Xs(Math.atan2(t.y,t.x))+360;return Math.round(e%360/45)}function D0(r,t,e,n,i){var s;let{target:o,corner:a}=r,c=o.controls[a],l=((s=o.canvas)===null||s===void 0?void 0:s.getZoom())||1,h=o.padding/l,u=function(d,x,m,g){let f=d.getRelativeCenterPoint(),p=m!==void 0&&g!==void 0?d.translateToGivenOrigin(f,ue,ue,m,g):new Q(d.left,d.top);return(d.angle?x.rotate(-qe(d.angle),f):x).subtract(p)}(o,new Q(n,i),t,e);return u.x>=h&&(u.x-=h),u.x<=-h&&(u.x+=h),u.y>=h&&(u.y-=h),u.y<=h&&(u.y+=h),u.x-=c.offsetX,u.y-=c.offsetY,u}var c_=(r,t,e,n)=>{let{target:i,offsetX:s,offsetY:o}=t,a=e-s,c=n-o,l=!Oi(i,"lockMovementX")&&i.left!==a,h=!Oi(i,"lockMovementY")&&i.top!==c;return l&&i.set(Se,a),h&&i.set(Rn,c),(l||h)&&r_("moving",o_(r,t,e,n)),l||h},a0=class{getSvgStyles(t){let e=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):Xn,s=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",a=this.strokeLineJoin?this.strokeLineJoin:"miter",c=this.strokeMiterLimit?this.strokeMiterLimit:"4",l=this.opacity!==void 0?this.opacity:"1",h=this.visible?"":" visibility: hidden;",u=t?"":this.getSvgFilter(),d=Vc("fill",this.fill);return[Vc("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",s,"; ","stroke-linejoin: ",a,"; ","stroke-miterlimit: ",c,"; ",d,"fill-rule: ",e,"; ","opacity: ",l,";",u,h].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=t?this.calcTransformMatrix():this.calcOwnMatrix(),i='transform="'.concat(zc(n));return"".concat(i).concat(e,'" ')}_toSVG(t){return[""]}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t){let{reviver:e,additionalTransform:n=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),s=t.indexOf("COMMON_PARTS");return t[s]=i,e?e(t.join("")):t.join("")}_createBaseSVGMarkup(t){let{noStyle:e,reviver:n,withShadow:i,additionalTransform:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=e?"":'style="'.concat(this.getSvgStyles(),'" '),a=i?'style="'.concat(this.getSvgFilter(),'" '):"",c=this.clipPath,l=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=c&&c.absolutePositioned,u=this.stroke,d=this.fill,x=this.shadow,m=[],g=t.indexOf("COMMON_PARTS"),f;c&&(c.clipPathId="CLIPPATH_".concat(is()),f='<clipPath id="'.concat(c.clipPathId,`" >
`).concat(c.toClipPathSVG(n),`</clipPath>
`)),h&&m.push("<g ",a,this.getSvgCommons(),` >
`),m.push("<g ",this.getSvgTransform(!1),h?"":a+this.getSvgCommons(),` >
`);let p=[o,l,e?"":this.addPaintOrder()," ",s?'transform="'.concat(s,'" '):""].join("");return t[g]=p,Ei(d)&&m.push(d.toSVG(this)),Ei(u)&&m.push(u.toSVG(this)),x&&m.push(x.toSVG(this)),c&&m.push(f),m.push(t.join("")),m.push(`</g>
`),h&&m.push(`</g>
`),n?n(m.join("")):m.join("")}addPaintOrder(){return this.paintFirst!=="fill"?' paint-order="'.concat(this.paintFirst,'" '):""}},Hx=(r,t,e,n)=>(r<Math.abs(t)?(r=t,n=e/4):n=t===0&&r===0?e/Cr*Math.asin(1):e/Cr*Math.asin(t/r),{a:r,c:t,p:e,s:n}),_E=(r,t,e,n,i)=>r*Math.pow(2,10*(n-=1))*Math.sin((n*i-t)*Cr/e),l_=(r,t,e,n)=>-e*Math.cos(r/n*ns)+e+t,af=(r,t,e,n)=>(r/=n)<1/2.75?e*(7.5625*r*r)+t:r<2/2.75?e*(7.5625*(r-=1.5/2.75)*r+.75)+t:r<2.5/2.75?e*(7.5625*(r-=2.25/2.75)*r+.9375)+t:e*(7.5625*(r-=2.625/2.75)*r+.984375)+t,CE=(r,t,e,n)=>e-af(n-r,0,e,n)+t,s5=Object.freeze({__proto__:null,defaultEasing:l_,easeInBack:function(r,t,e,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return e*(r/=n)*r*((i+1)*r-i)+t},easeInBounce:CE,easeInCirc:(r,t,e,n)=>-e*(Math.sqrt(1-(r/=n)*r)-1)+t,easeInCubic:(r,t,e,n)=>e*(r/n)**3+t,easeInElastic:(r,t,e,n)=>{let i=e,s=0;if(r===0)return t;if((r/=n)===1)return t+e;s||(s=.3*n);let{a:o,s:a,p:c}=Hx(i,e,s,1.70158);return-_E(o,a,c,r,n)+t},easeInExpo:(r,t,e,n)=>r===0?t:e*2**(10*(r/n-1))+t,easeInOutBack:function(r,t,e,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return(r/=n/2)<1?e/2*(r*r*((1+(i*=1.525))*r-i))+t:e/2*((r-=2)*r*((1+(i*=1.525))*r+i)+2)+t},easeInOutBounce:(r,t,e,n)=>r<n/2?.5*CE(2*r,0,e,n)+t:.5*af(2*r-n,0,e,n)+.5*e+t,easeInOutCirc:(r,t,e,n)=>(r/=n/2)<1?-e/2*(Math.sqrt(1-r**2)-1)+t:e/2*(Math.sqrt(1-(r-=2)*r)+1)+t,easeInOutCubic:(r,t,e,n)=>(r/=n/2)<1?e/2*r**3+t:e/2*((r-2)**3+2)+t,easeInOutElastic:(r,t,e,n)=>{let i=e,s=0;if(r===0)return t;if((r/=n/2)===2)return t+e;s||(s=n*(.3*1.5));let{a:o,s:a,p:c,c:l}=Hx(i,e,s,1.70158);return r<1?-.5*_E(o,a,c,r,n)+t:o*Math.pow(2,-10*(r-=1))*Math.sin((r*n-a)*Cr/c)*.5+l+t},easeInOutExpo:(r,t,e,n)=>r===0?t:r===n?t+e:(r/=n/2)<1?e/2*2**(10*(r-1))+t:e/2*-(2**(-10*--r)+2)+t,easeInOutQuad:(r,t,e,n)=>(r/=n/2)<1?e/2*r**2+t:-e/2*(--r*(r-2)-1)+t,easeInOutQuart:(r,t,e,n)=>(r/=n/2)<1?e/2*r**4+t:-e/2*((r-=2)*r**3-2)+t,easeInOutQuint:(r,t,e,n)=>(r/=n/2)<1?e/2*r**5+t:e/2*((r-2)**5+2)+t,easeInOutSine:(r,t,e,n)=>-e/2*(Math.cos(Math.PI*r/n)-1)+t,easeInQuad:(r,t,e,n)=>e*(r/=n)*r+t,easeInQuart:(r,t,e,n)=>e*(r/=n)*r**3+t,easeInQuint:(r,t,e,n)=>e*(r/n)**5+t,easeInSine:(r,t,e,n)=>-e*Math.cos(r/n*ns)+e+t,easeOutBack:function(r,t,e,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return e*((r=r/n-1)*r*((i+1)*r+i)+1)+t},easeOutBounce:af,easeOutCirc:(r,t,e,n)=>e*Math.sqrt(1-(r=r/n-1)*r)+t,easeOutCubic:(r,t,e,n)=>e*((r/n-1)**3+1)+t,easeOutElastic:(r,t,e,n)=>{let i=e,s=0;if(r===0)return t;if((r/=n)===1)return t+e;s||(s=.3*n);let{a:o,s:a,p:c,c:l}=Hx(i,e,s,1.70158);return o*2**(-10*r)*Math.sin((r*n-a)*Cr/c)+l+t},easeOutExpo:(r,t,e,n)=>r===n?t+e:e*-(2**(-10*r/n)+1)+t,easeOutQuad:(r,t,e,n)=>-e*(r/=n)*(r-2)+t,easeOutQuart:(r,t,e,n)=>-e*((r=r/n-1)*r**3-1)+t,easeOutQuint:(r,t,e,n)=>e*((r/n-1)**5+1)+t,easeOutSine:(r,t,e,n)=>e*Math.sin(r/n*ns)+t}),o5=()=>!1,Gc=class{constructor(t){let{startValue:e,byValue:n,duration:i=500,delay:s=0,easing:o=l_,onStart:a=Hs,onChange:c=Hs,onComplete:l=Hs,abort:h=o5,target:u}=t;z(this,"_state","pending"),z(this,"durationProgress",0),z(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=i,this.delay=s,this.easing=o,this._onStart=a,this._onChange=c,this._onComplete=l,this._abort=h,this.target=u,this.startValue=e,this.byValue=n,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){let t=e=>{this._state==="pending"&&(this.startTime=e||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>kc(t),this.delay):kc(t)}tick(t){let e=(t||+new Date)-this.startTime,n=Math.min(e,this.duration);this.durationProgress=n/this.duration;let{value:i,valueProgress:s}=this.calculate(n);this.value=Object.freeze(i),this.valueProgress=s,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),kc(this.tick)))}register(){n0.push(this)}unregister(){n0.remove(this)}abort(){this._state="aborted",this.unregister()}},a5=["startValue","endValue"],cf=class extends Gc{constructor(t){let{startValue:e=0,endValue:n=100}=t;super(U(U({},ke(t,a5)),{},{startValue:e,byValue:n-e}))}calculate(t){let e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)}}},c5=["startValue","endValue"],lf=class extends Gc{constructor(t){let{startValue:e=[0],endValue:n=[100]}=t;super(U(U({},ke(t,c5)),{},{startValue:e,byValue:n.map((i,s)=>i-e[s])}))}calculate(t){let e=this.startValue.map((n,i)=>this.easing(t,n,this.byValue[i],this.duration,i));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}},Ys=(r,t,e)=>Math.max(r,Math.min(t,e)),l5=["startValue","endValue","easing","onChange","onComplete","abort"],h5=(r,t,e,n)=>t+e*(1-Math.cos(r/n*ns)),Gx=r=>r&&((t,e,n)=>r(new Un(t).toRgba(),e,n)),hf=class extends Gc{constructor(t){let{startValue:e,endValue:n,easing:i=h5,onChange:s,onComplete:o,abort:a}=t,c=ke(t,l5),l=new Un(e).getSource(),h=new Un(n).getSource();super(U(U({},c),{},{startValue:l,byValue:h.map((u,d)=>u-l[d]),easing:i,onChange:Gx(s),onComplete:Gx(o),abort:Gx(a)}))}calculate(t){let[e,n,i,s]=this.startValue.map((a,c)=>this.easing(t,a,this.byValue[c],this.duration,c)),o=[...[e,n,i].map(Math.round),Ys(0,s,1)];return{value:o,valueProgress:o.map((a,c)=>this.byValue[c]!==0?Math.abs((a-this.startValue[c])/this.byValue[c]):0).find(a=>a!==0)||0}}};function zf(r){let t=(e=>Array.isArray(e.startValue)||Array.isArray(e.endValue))(r)?new lf(r):new cf(r);return t.start(),t}function h_(r){let t=new hf(r);return t.start(),t}var u5=new Q(1,0),u_=new Q,Vf=(r,t)=>r.rotate(t),c0=(r,t)=>new Q(t).subtract(r),l0=r=>r.distanceFrom(u_),h0=(r,t)=>Math.atan2(sa(r,t),x_(r,t)),d_=r=>h0(u5,r),B0=r=>r.eq(u_)?r:r.scalarDivide(l0(r)),Hf=function(r){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return B0(new Q(-r.y,r.x).scalarMultiply(t?1:-1))},sa=(r,t)=>r.x*t.y-r.y*t.x,x_=(r,t)=>r.x*t.x+r.y*t.y,uf=(r,t,e)=>{if(r.eq(t)||r.eq(e))return!0;let n=sa(t,e),i=sa(t,r),s=sa(e,r);return n>=0?i>=0&&s<=0:!(i<=0&&s>=0)},Ws=class r{constructor(t){this.status=t,this.points=[]}includes(t){return this.points.some(e=>e.eq(t))}append(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.points=this.points.concat(e.filter(i=>!this.includes(i))),this}static isPointContained(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(e.eq(n))return t.eq(e);if(e.x===n.x)return t.x===e.x&&(i||t.y>=Math.min(e.y,n.y)&&t.y<=Math.max(e.y,n.y));if(e.y===n.y)return t.y===e.y&&(i||t.x>=Math.min(e.x,n.x)&&t.x<=Math.max(e.x,n.x));{let s=c0(e,n),o=c0(e,t).divide(s);return i?Math.abs(o.x)===Math.abs(o.y):o.x===o.y&&o.x>=0&&o.x<=1}}static isPointInPolygon(t,e){let n=new Q(t).setX(Math.min(t.x-1,...e.map(s=>s.x))),i=0;for(let s=0;s<e.length;s++){let o=this.intersectSegmentSegment(e[s],e[(s+1)%e.length],t,n);if(o.includes(t))return!0;i+=+(o.status==="Intersection")}return i%2==1}static intersectLineLine(t,e,n,i){let s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],a=e.x-t.x,c=e.y-t.y,l=i.x-n.x,h=i.y-n.y,u=t.x-n.x,d=t.y-n.y,x=l*d-h*u,m=a*d-c*u,g=h*a-l*c;if(g!==0){let f=x/g,p=m/g;return(s||0<=f&&f<=1)&&(o||0<=p&&p<=1)?new r("Intersection").append(new Q(t.x+f*a,t.y+f*c)):new r}if(x===0||m===0){let f=s||o||r.isPointContained(t,n,i)||r.isPointContained(e,n,i)||r.isPointContained(n,t,e)||r.isPointContained(i,t,e);return new r(f?"Coincident":void 0)}return new r("Parallel")}static intersectSegmentLine(t,e,n,i){return r.intersectLineLine(t,e,n,i,!1,!0)}static intersectSegmentSegment(t,e,n,i){return r.intersectLineLine(t,e,n,i,!1,!1)}static intersectLinePolygon(t,e,n){let i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3],s=new r,o=n.length;for(let a,c,l,h=0;h<o;h++){if(a=n[h],c=n[(h+1)%o],l=r.intersectLineLine(t,e,a,c,i,!1),l.status==="Coincident")return l;s.append(...l.points)}return s.points.length>0&&(s.status="Intersection"),s}static intersectSegmentPolygon(t,e,n){return r.intersectLinePolygon(t,e,n,!1)}static intersectPolygonPolygon(t,e){let n=new r,i=t.length,s=[];for(let o=0;o<i;o++){let a=t[o],c=t[(o+1)%i],l=r.intersectSegmentPolygon(a,c,e);l.status==="Coincident"?(s.push(l),n.append(a,c)):n.append(...l.points)}return s.length>0&&s.length===t.length?new r("Coincident"):(n.points.length>0&&(n.status="Intersection"),n)}static intersectPolygonRectangle(t,e,n){let i=e.min(n),s=e.max(n),o=new Q(s.x,i.y),a=new Q(i.x,s.y);return r.intersectPolygonPolygon(t,[i,o,s,a])}},df=class extends i0{_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=U({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),n=e.strokeWidth,i=n,s=0;this.strokeUniform&&(i=0,s=n);let o=e.width+i,a=e.height+i,c;return c=e.skewX===0&&e.skewY===0?new Q(o*e.scaleX,a*e.scaleY):M0(o,a,Xc(e)),c.scalarAdd(s)}translateToGivenOrigin(t,e,n,i,s){let o=t.x,a=t.y,c=Zr(i)-Zr(e),l=Zr(s)-Zr(n);if(c||l){let h=this._getTransformedDimensions();o+=c*h.x,a+=l*h.y}return new Q(o,a)}translateToCenterPoint(t,e,n){let i=this.translateToGivenOrigin(t,e,n,ue,ue);return this.angle?i.rotate(qe(this.angle),t):i}translateToOriginPoint(t,e,n){let i=this.translateToGivenOrigin(t,ue,ue,e,n);return this.angle?i.rotate(qe(this.angle),t):i}getCenterPoint(){let t=this.getRelativeCenterPoint();return this.group?Pn(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new Q(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,n){let i=this.translateToCenterPoint(t,e,n),s=this.translateToOriginPoint(i,this.originX,this.originY);this.set({left:s.x,top:s.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),Se,Rn)}},xf=class extends df{getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){let t=this.getRelativeXY();return this.group?Pn(t,this.group.calcTransformMatrix()):t}setXY(t,e,n){this.group&&(t=Pn(t,ei(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,n)}getRelativeXY(){return new Q(this.left,this.top)}setRelativeXY(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.originX,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.originY;this.setPositionByOrigin(t,e,n)}isStrokeAccountedForInDimensions(){return!1}getCoords(){let{tl:t,tr:e,br:n,bl:i}=this.aCoords||(this.aCoords=this.calcACoords()),s=[t,e,n,i];if(this.group){let o=this.group.calcTransformMatrix();return s.map(a=>Pn(a,o))}return s}intersectsWithRect(t,e){return Ws.intersectPolygonRectangle(this.getCoords(),t,e).status==="Intersection"}intersectsWithObject(t){let e=Ws.intersectPolygonPolygon(this.getCoords(),t.getCoords());return e.status==="Intersection"||e.status==="Coincident"||t.isContainedWithinObject(this)||this.isContainedWithinObject(t)}isContainedWithinObject(t){return this.getCoords().every(e=>t.containsPoint(e))}isContainedWithinRect(t,e){let{left:n,top:i,width:s,height:o}=this.getBoundingRect();return n>=t.x&&n+s<=e.x&&i>=t.y&&i+o<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t){return Ws.isPointInPolygon(t,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;let{tl:t,br:e}=this.canvas.vptCoords;return!!this.getCoords().some(n=>n.x<=e.x&&n.x>=t.x&&n.y<=e.y&&n.y>=t.y)||!!this.intersectsWithRect(t,e)||this.containsPoint(t.midPointFrom(e))}isPartiallyOnScreen(){if(!this.canvas)return!1;let{tl:t,br:e}=this.canvas.vptCoords;return this.intersectsWithRect(t,e)?!0:this.getCoords().every(n=>(n.x>=e.x||n.x<=t.x)&&(n.y>=e.y||n.y<=t.y))&&this.containsPoint(t.midPointFrom(e))}getBoundingRect(){return Qi(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set("scaleX",t),this._set("scaleY",t),this.setCoords()}scaleToWidth(t){let e=this.getBoundingRect().width/this.getScaledWidth();return this.scale(t/this.width/e)}scaleToHeight(t){let e=this.getBoundingRect().height/this.getScaledHeight();return this.scale(t/this.height/e)}getCanvasRetinaScaling(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.getRetinaScaling())||1}getTotalAngle(){return this.group?Xs(XE(this.calcTransformMatrix())):this.angle}getViewportTransform(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.viewportTransform)||Nn.concat()}calcACoords(){let t=Ba({angle:this.angle}),{x:e,y:n}=this.getRelativeCenterPoint(),i=Da(e,n),s=yn(i,t),o=this._getTransformedDimensions(),a=o.x/2,c=o.y/2;return{tl:Pn({x:-a,y:-c},s),tr:Pn({x:a,y:-c},s),bl:Pn({x:-a,y:c},s),br:Pn({x:a,y:c},s)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e="_",n="";return!t&&this.group&&(n=this.group.transformMatrixKey(t)+e),n+this.top+e+this.left+e+this.scaleX+e+this.scaleY+e+this.skewX+e+this.skewY+e+this.angle+e+this.originX+e+this.originY+e+this.width+e+this.height+e+this.strokeWidth+this.flipX+this.flipY}calcTransformMatrix(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=this.calcOwnMatrix();if(t||!this.group)return e;let n=this.transformMatrixKey(t),i=this.matrixCache;return i&&i.key===n?i.value:(this.group&&(e=yn(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:n,value:e},e)}calcOwnMatrix(){let t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;let n=this.getRelativeCenterPoint(),i={angle:this.angle,translateX:n.x,translateY:n.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},s=qE(i);return this.ownMatrixCache={key:t,value:s},s}_getNonTransformedDimensions(){return new Q(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}},ff=class r extends xf{isDescendantOf(t){let{parent:e,group:n}=this;return e===t||n===t||this.canvas===t||!!e&&e.isDescendantOf(t)||!!n&&n!==e&&n.isDescendantOf(t)}getAncestors(t){let e=[],n=this;do{var i;n=n instanceof r?(i=n.parent)!==null&&i!==void 0?i:t?void 0:n.canvas:void 0,n&&e.push(n)}while(n);return e}findCommonAncestors(t,e){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors(e)]};let n=this.getAncestors(e),i=t.getAncestors(e);if(n.length===0&&i.length>0&&this===i[i.length-1])return{fork:[],otherFork:[t,...i.slice(0,i.length-1)],common:[this]};for(let s,o=0;o<n.length;o++){if(s=n[o],s===t)return{fork:[this,...n.slice(0,o)],otherFork:[],common:n.slice(o)};for(let a=0;a<i.length;a++){if(this===i[a])return{fork:[],otherFork:[t,...i.slice(0,a)],common:[this,...n]};if(s===i[a])return{fork:[this,...n.slice(0,o)],otherFork:[t,...i.slice(0,a)],common:n.slice(o)}}}return{fork:[this,...n],otherFork:[t,...i],common:[]}}hasCommonAncestors(t,e){let n=this.findCommonAncestors(t,e);return n&&!!n.common.length}isInFrontOf(t){if(this===t)return;let e=this.findCommonAncestors(t);if(!e)return;if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;let n=e.common[0];if(!n)return;let i=e.fork.pop(),s=e.otherFork.pop(),o=n._objects.indexOf(i),a=n._objects.indexOf(s);return o>-1&&o>a}},u0=class extends ff{animate(t,e){return Object.entries(t).reduce((n,i)=>{let[s,o]=i;return n[s]=this._animate(s,o,e),n},{})}_animate(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=t.split("."),s=this.constructor.colorProperties.includes(i[i.length-1]),{easing:o,duration:a,abort:c,startValue:l,onChange:h,onComplete:u}=n,d={target:this,startValue:l??i.reduce((x,m)=>x[m],this),endValue:e,easing:o,duration:a,abort:c?.bind(this),onChange:(x,m,g)=>{i.reduce((f,p,v)=>(v===i.length-1&&(f[p]=x),f[p]),this),h&&h(x,m,g)},onComplete:(x,m,g)=>{this.setCoords(),u&&u(x,m,g)}};return s?h_(d):zf(d)}};function T0(r){return new RegExp("^("+r.join("|")+")\\b","i")}var yE,AE;z(u0,"colorProperties",["fill","stroke","backgroundColor"]);var Ki=String.raw(yE||(yE=nr(["(?:[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?)"],["(?:[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?)"])));String.raw(AE||(AE=nr(["(?:s+,?s*|,s*|$)"],["(?:\\s+,?\\s*|,\\s*|$)"])));var d5=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+Ki+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+Ki+"))?\\s+(.*)"),x5={cx:Se,x:Se,r:"radius",cy:Rn,y:Rn,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},Wx="font-size",jx="clip-path",a6=T0(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),c6=T0(["symbol","image","marker","pattern","view","svg"]),bE=T0(["symbol","g","a","svg","clipPath","defs"]),l6=new RegExp("^\\s*("+Ki+"+)\\s*,?\\s*("+Ki+"+)\\s*,?\\s*("+Ki+"+)\\s*,?\\s*("+Ki+"+)\\s*$"),wE="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",js=class r{constructor(t){let e=typeof t=="string"?r.parseShadow(t):t;Object.assign(this,this.constructor.ownDefaults);for(let n in e)this[n]=e[n];this.id=is()}static parseShadow(t){let e=t.trim(),n=new RegExp("(?:\\s|^)"+wE+wE+"("+Ki+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)"),[,i=0,s=0,o=0]=(n.exec(e)||[]).map(a=>parseFloat(a)||0);return{color:(e.replace(n,"")||"rgb(0,0,0)").trim(),offsetX:i,offsetY:s,blur:o}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){let e=Vf(new Q(this.offsetX,this.offsetY),qe(-t.angle)),n=new Un(this.color),i=40,s=40;return t.width&&t.height&&(i=100*me((Math.abs(e.x)+this.blur)/t.width,ve.NUM_FRACTION_DIGITS)+20,s=100*me((Math.abs(e.y)+this.blur)/t.height,ve.NUM_FRACTION_DIGITS)+20),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(s,'%" height="').concat(100+2*s,'%" x="-').concat(i,'%" width="').concat(100+2*i,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(me(this.blur?this.blur/2:0,ve.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(me(e.x,ve.NUM_FRACTION_DIGITS),'" dy="').concat(me(e.y,ve.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(n.toRgb(),'" flood-opacity="').concat(n.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){let t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},e=r.ownDefaults;return this.includeDefaultValues?t:Nf(t,(n,i)=>n!==e[i])}static fromObject(t){return Ut(this,null,function*(){return new this(t)})}};z(js,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),z(js,"type","shadow"),St.setClass(js,"shadow");var $c=r=>JSON.parse(JSON.stringify(r)),f5=[Rn,Se,"scaleX","scaleY","flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible","skewX","skewY"],yr=["fill","stroke","strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],p5={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:Se,originY:Rn,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:"fill",fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},m5=["type"],g5=["extraParam"],Ns=class f_ extends u0{static getDefaults(){return U({},f_.ownDefaults)}get type(){let t=this.constructor.type;return t==="FabricObject"?"object":t.toLowerCase()}set type(t){es("warn","Setting type has no effect",t)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),z(this,"_cacheContext",null),Object.assign(this,this.constructor.getDefaults()),this.setOptions(t)}_createCacheCanvas(){this._cacheCanvas=Ke(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){let e=t.width,n=t.height,i=ve.maxCacheSideLimit,s=ve.minCacheSideLimit;if(e<=i&&n<=i&&e*n<=ve.perfLimitSizeTotal)return e<s&&(t.width=s),n<s&&(t.height=s),t;let o=e/n,[a,c]=Rc.limitDimsByArea(o),l=Ys(s,a,i),h=Ys(s,c,i);return e>l&&(t.zoomX/=e/l,t.width=l,t.capped=!0),n>h&&(t.zoomY/=n/h,t.height=h,t.capped=!0),t}_getCacheCanvasDimensions(){let t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),n=e.x*t.x/this.scaleX,i=e.y*t.y/this.scaleY;return{width:n+2,height:i+2,zoomX:t.x,zoomY:t.y,x:n,y:i}}_updateCacheCanvas(){let t=this._cacheCanvas,e=this._cacheContext,n=this._limitCacheSize(this._getCacheCanvasDimensions()),i=ve.minCacheSideLimit,s=n.width,o=n.height,a=n.zoomX,c=n.zoomY,l=s!==this.cacheWidth||o!==this.cacheHeight,h=this.zoomX!==a||this.zoomY!==c;if(!t||!e)return!1;let u,d,x=l||h,m=0,g=0,f=!1;if(l){let p=this._cacheCanvas.width,v=this._cacheCanvas.height,E=s>p||o>v;f=E||(s<.9*p||o<.9*v)&&p>i&&v>i,E&&!n.capped&&(s>i||o>i)&&(m=.1*s,g=.1*o)}return ZE(this)&&this.path&&(x=!0,f=!0,m+=this.getHeightOfLine(0)*this.zoomX,g+=this.getHeightOfLine(0)*this.zoomY),!!x&&(f?(t.width=Math.ceil(s+m),t.height=Math.ceil(o+g)):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height)),u=n.x/2,d=n.y/2,this.cacheTranslationX=Math.round(t.width/2-u)+u,this.cacheTranslationY=Math.round(t.height/2-d)+d,this.cacheWidth=s,this.cacheHeight=o,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(a,c),this.zoomX=a,this.zoomY=c,!0)}setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(t)}transform(t){let e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,n=this.calcTransformMatrix(!e);t.transform(n[0],n[1],n[2],n[3],n[4],n[5])}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=ve.NUM_FRACTION_DIGITS,n=this.clipPath&&!this.clipPath.excludeFromExport?U(U({},this.clipPath.toObject(t)),{},{inverted:this.clipPath.inverted,absolutePositioned:this.clipPath.absolutePositioned}):null,i=U(U({},$s(this,t)),{},{type:this.constructor.type,version:tf,originX:this.originX,originY:this.originY,left:me(this.left,e),top:me(this.top,e),width:me(this.width,e),height:me(this.height,e),fill:mE(this.fill)?this.fill.toObject():this.fill,stroke:mE(this.stroke)?this.stroke.toObject():this.stroke,strokeWidth:me(this.strokeWidth,e),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:me(this.strokeMiterLimit,e),scaleX:me(this.scaleX,e),scaleY:me(this.scaleY,e),angle:me(this.angle,e),flipX:this.flipX,flipY:this.flipY,opacity:me(this.opacity,e),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:me(this.skewX,e),skewY:me(this.skewY,e)},n?{clipPath:n}:null);return this.includeDefaultValues?i:this._removeDefaultValues(i)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){let e=this.constructor.getDefaults(),n=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return Nf(t,(i,s)=>{if(s===Se||s===Rn||s==="type")return!0;let o=n[s];return i!==o&&!(Array.isArray(i)&&Array.isArray(o)&&i.length===0&&o.length===0)})}toString(){return"#<".concat(this.constructor.type,">")}getObjectScaling(){if(!this.group)return new Q(Math.abs(this.scaleX),Math.abs(this.scaleY));let t=ya(this.calcTransformMatrix());return new Q(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){let t=this.getObjectScaling();if(this.canvas){let e=this.canvas.getZoom(),n=this.getCanvasRetinaScaling();return t.scalarMultiply(e*n)}return t}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t===0?1e-4:t}_set(t,e){t!=="scaleX"&&t!=="scaleY"||(e=this._constrainScale(e)),t==="scaleX"&&e<0?(this.flipX=!this.flipX,e*=-1):t==="scaleY"&&e<0?(this.flipY=!this.flipY,e*=-1):t!=="shadow"||!e||e instanceof js||(e=new js(e));let n=this[t]!==e;return this[t]=e,n&&this.constructor.cacheProperties.includes(t)&&(this.dirty=!0),this.parent&&(this.dirty||n&&this.constructor.stateProperties.includes(t))&&this.parent._set("dirty",!0),this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t),this.dirty=!1),t.restore())}drawSelectionBackground(t){}renderCache(t){t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext&&(this.drawObject(this._cacheContext,t.forClipping),this.dirty=!1)}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.parent||!this.parent.isOnACache()),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(t,e){if(t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",e.absolutePositioned){let n=ei(this.calcTransformMatrix());t.transform(n[0],n[1],n[2],n[3],n[4],n[5])}e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}drawObject(t,e){let n=this.fill,i=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath),this.fill=n,this.stroke=i}_drawClipPath(t,e){e&&(e._set("canvas",this.canvas),e.shouldCache(),e._transformDone=!0,e.renderCache({forClipping:!0}),this.drawClipPathOnCache(t,e))}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!t&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned){if(this._cacheCanvas&&this._cacheContext&&!t){let e=this.cacheWidth/this.zoomX,n=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-n/2,e,n)}return!0}return!1}_renderBackground(t){if(!this.backgroundColor)return;let e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){let n=e.stroke;n&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,Ei(n)?n.gradientUnits==="percentage"||n.gradientTransform||n.patternTransform?this._applyPatternForTransformedGradient(t,n):(t.strokeStyle=n.toLive(t),this._applyPatternGradientTransform(t,n)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){let{fill:n}=e;n&&(Ei(n)?(t.fillStyle=n.toLive(t),this._applyPatternGradientTransform(t,n)):t.fillStyle=n)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){e&&e.length!==0&&(1&e.length&&e.push(...e),t.setLineDash(e))}_setShadow(t){if(!this.shadow)return;let e=this.shadow,n=this.canvas,i=this.getCanvasRetinaScaling(),[s,,,o]=n?.viewportTransform||Nn,a=s*i,c=o*i,l=e.nonScaling?new Q(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*ve.browserShadowBlurConstant*(a+c)*(l.x+l.y)/4,t.shadowOffsetX=e.offsetX*a*l.x,t.shadowOffsetY=e.offsetY*c*l.y}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!Ei(e))return{offsetX:0,offsetY:0};let n=e.gradientTransform||e.patternTransform,i=-this.width/2+e.offsetX||0,s=-this.height/2+e.offsetY||0;return e.gradientUnits==="percentage"?t.transform(this.width,0,0,this.height,i,s):t.transform(1,0,0,1,i,s),n&&t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),{offsetX:i,offsetY:s}}_renderPaintInOrder(t){this.paintFirst==="stroke"?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),this.fillRule==="evenodd"?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){let e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var n;let i=this._limitCacheSize(this._getCacheCanvasDimensions()),s=Ke(),o=this.getCanvasRetinaScaling(),a=i.x/this.scaleX/o,c=i.y/this.scaleY/o;s.width=Math.ceil(a),s.height=Math.ceil(c);let l=s.getContext("2d");l&&(l.beginPath(),l.moveTo(0,0),l.lineTo(a,0),l.lineTo(a,c),l.lineTo(0,c),l.closePath(),l.translate(a/2,c/2),l.scale(i.zoomX/this.scaleX/o,i.zoomY/this.scaleY/o),this._applyPatternGradientTransform(l,e),l.fillStyle=e.toLive(t),l.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(o*this.scaleX/i.zoomX,o*this.scaleY/i.zoomY),t.strokeStyle=(n=l.createPattern(s,"no-repeat"))!==null&&n!==void 0?n:"")}_findCenterFromElement(){return new Q(this.left+this.width/2,this.top+this.height/2)}clone(t){let e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){let e=this.toCanvasElement(t);return new(St.getClass("image"))(e)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Uf(this),n=this.group,i=this.shadow,s=Math.abs,o=t.enableRetinaScaling?HE():1,a=(t.multiplier||1)*o,c=t.canvasProvider||(v=>new Hc(v,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,t.withoutTransform&&n_(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&of(this,this.getViewportTransform()),this.setCoords();let l=Ke(),h=this.getBoundingRect(),u=this.shadow,d=new Q;if(u){let v=u.blur,E=u.nonScaling?new Q(1,1):this.getObjectScaling();d.x=2*Math.round(s(u.offsetX)+v)*s(E.x),d.y=2*Math.round(s(u.offsetY)+v)*s(E.y)}let x=h.width+d.x,m=h.height+d.y;l.width=Math.ceil(x),l.height=Math.ceil(m);let g=c(l);t.format==="jpeg"&&(g.backgroundColor="#fff"),this.setPositionByOrigin(new Q(g.width/2,g.height/2),ue,ue);let f=this.canvas;g._objects=[this],this.set("canvas",g),this.setCoords();let p=g.toCanvasElement(a||1,t);return this.set("canvas",f),this.shadow=i,n&&(this.group=n),this.set(e),this.setCoords(),g._objects=[],g.destroy(),p}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Of(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.includes(this.constructor.type)||e.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){let{centeredRotation:e,originX:n,originY:i}=this;if(e){let{x:s,y:o}=this.getRelativeCenterPoint();this.originX=ue,this.originY=ue,this.left=s,this.top=o}if(this.set("angle",t),e){let{x:s,y:o}=this.translateToOriginPoint(this.getRelativeCenterPoint(),n,i);this.left=s,this.top=o,this.originX=n,this.originY=i}}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){n0.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&tr().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}static _fromObject(t){let e=ke(t,m5),n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:i}=n,s=ke(n,g5);return Yc($c(e),s).then(o=>{let a=U(U({},s),o);if(i){let{[i]:c}=a;return new this(c,ke(a,[i].map(VE)))}return new this(a)})}static fromObject(t,e){return this._fromObject(t,e)}};z(Ns,"stateProperties",f5),z(Ns,"cacheProperties",yr),z(Ns,"ownDefaults",p5),z(Ns,"type","FabricObject"),St.setClass(Ns),St.setClass(Ns,"object");var rs=(r,t)=>(e,n,i,s)=>{let o=t(e,n,i,s);return o&&r_(r,o_(e,n,i,s)),o};function Zs(r){return(t,e,n,i)=>{let{target:s,originX:o,originY:a}=e,c=s.getRelativeCenterPoint(),l=s.translateToOriginPoint(c,o,a),h=r(t,e,n,i);return s.setPositionByOrigin(l,e.originX,e.originY),h}}var pf=rs("resizing",Zs((r,t,e,n)=>{let i=D0(t,t.originX,t.originY,e,n);if(t.originX===ue||t.originX===Je&&i.x<0||t.originX===Se&&i.x>0){let{target:s}=t,o=s.strokeWidth/(s.strokeUniform?s.scaleX:1),a=s_(t)?2:1,c=s.width,l=Math.ceil(Math.abs(i.x*a/s.scaleX)-o);return s.set("width",Math.max(l,0)),c!==s.width}return!1}));function p_(r,t,e,n,i){n=n||{};let s=this.sizeX||n.cornerSize||i.cornerSize,o=this.sizeY||n.cornerSize||i.cornerSize,a=n.transparentCorners!==void 0?n.transparentCorners:i.transparentCorners,c=a?"stroke":"fill",l=!a&&(n.cornerStrokeColor||i.cornerStrokeColor),h,u=t,d=e;r.save(),r.fillStyle=n.cornerColor||i.cornerColor||"",r.strokeStyle=n.cornerStrokeColor||i.cornerStrokeColor||"",s>o?(h=s,r.scale(1,o/s),d=e*s/o):o>s?(h=o,r.scale(s/o,1),u=t*o/s):h=s,r.lineWidth=1,r.beginPath(),r.arc(u,d,h/2,0,Cr,!1),r[c](),l&&r.stroke(),r.restore()}function m_(r,t,e,n,i){n=n||{};let s=this.sizeX||n.cornerSize||i.cornerSize,o=this.sizeY||n.cornerSize||i.cornerSize,a=n.transparentCorners!==void 0?n.transparentCorners:i.transparentCorners,c=a?"stroke":"fill",l=!a&&(n.cornerStrokeColor||i.cornerStrokeColor),h=s/2,u=o/2;r.save(),r.fillStyle=n.cornerColor||i.cornerColor||"",r.strokeStyle=n.cornerStrokeColor||i.cornerStrokeColor||"",r.lineWidth=1,r.translate(t,e);let d=i.getTotalAngle();r.rotate(qe(d)),r["".concat(c,"Rect")](-h,-u,s,o),l&&r.strokeRect(-h,-u,s,o),r.restore()}var Fn=class{constructor(t){z(this,"visible",!0),z(this,"actionName","scale"),z(this,"angle",0),z(this,"x",0),z(this,"y",0),z(this,"offsetX",0),z(this,"offsetY",0),z(this,"sizeX",0),z(this,"sizeY",0),z(this,"touchSizeX",0),z(this,"touchSizeY",0),z(this,"cursorStyle","crosshair"),z(this,"withConnection",!1),Object.assign(this,t)}shouldActivate(t,e,n,i){var s;let{tl:o,tr:a,br:c,bl:l}=i;return((s=e.canvas)===null||s===void 0?void 0:s.getActiveObject())===e&&e.isControlVisible(t)&&Ws.isPointInPolygon(n,[o,a,c,l])}getActionHandler(t,e,n){return this.actionHandler}getMouseDownHandler(t,e,n){return this.mouseDownHandler}getMouseUpHandler(t,e,n){return this.mouseUpHandler}cursorStyleHandler(t,e,n){return e.cursorStyle}getActionName(t,e,n){return e.actionName}getVisibility(t,e){var n,i;return(n=(i=t._controlsVisibility)===null||i===void 0?void 0:i[e])!==null&&n!==void 0?n:this.visible}setVisibility(t,e,n){this.visible=t}positionHandler(t,e,n,i){return new Q(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e)}calcCornerCoords(t,e,n,i,s,o){let a=Ma([Da(n,i),Ba({angle:t}),S0((s?this.touchSizeX:this.sizeX)||e,(s?this.touchSizeY:this.sizeY)||e)]);return{tl:new Q(-.5,-.5).transform(a),tr:new Q(.5,-.5).transform(a),bl:new Q(-.5,.5).transform(a),br:new Q(.5,.5).transform(a)}}render(t,e,n,i,s){((i=i||{}).cornerStyle||s.cornerStyle)==="circle"?p_.call(this,t,e,n,i,s):m_.call(this,t,e,n,i,s)}},g_=(r,t,e)=>e.lockRotation?o0:t.cursorStyle,v_=rs("rotating",Zs((r,t,e,n)=>{let{target:i,ex:s,ey:o,theta:a,originX:c,originY:l}=t,h=i.translateToOriginPoint(i.getRelativeCenterPoint(),c,l);if(Oi(i,"lockRotation"))return!1;let u=Math.atan2(o-h.y,s-h.x),d=Math.atan2(n-h.y,e-h.x),x=Xs(d-u+a);if(i.snapAngle&&i.snapAngle>0){let g=i.snapAngle,f=i.snapThreshold||g,p=Math.ceil(x/g)*g,v=Math.floor(x/g)*g;Math.abs(x-v)<f?x=v:Math.abs(x-p)<f&&(x=p)}x<0&&(x=360+x),x%=360;let m=i.angle!==x;return i.angle=x,m}));function E_(r,t){let e=t.canvas,n=r[e.uniScaleKey];return e.uniformScaling&&!n||!e.uniformScaling&&n}function __(r,t,e){let n=Oi(r,"lockScalingX"),i=Oi(r,"lockScalingY");if(n&&i||!t&&(n||i)&&e||n&&t==="x"||i&&t==="y")return!0;let{width:s,height:o,strokeWidth:a}=r;return s===0&&a===0&&t!=="y"||o===0&&a===0&&t!=="x"}var v5=["e","se","s","sw","w","nw","n","ne","e"],Qo=(r,t,e)=>{let n=E_(r,e);if(__(e,t.x!==0&&t.y===0?"x":t.x===0&&t.y!==0?"y":"",n))return o0;let i=a_(e,t);return"".concat(v5[i],"-resize")};function Gf(r,t,e,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},s=t.target,o=i.by,a=E_(r,s),c,l,h,u,d,x;if(__(s,o,a))return!1;if(t.gestureScale)l=t.scaleX*t.gestureScale,h=t.scaleY*t.gestureScale;else{if(c=D0(t,t.originX,t.originY,e,n),d=o!=="y"?Math.sign(c.x||t.signX||1):1,x=o!=="x"?Math.sign(c.y||t.signY||1):1,t.signX||(t.signX=d),t.signY||(t.signY=x),Oi(s,"lockScalingFlip")&&(t.signX!==d||t.signY!==x))return!1;if(u=s._getTransformedDimensions(),a&&!o){let f=Math.abs(c.x)+Math.abs(c.y),{original:p}=t,v=f/(Math.abs(u.x*p.scaleX/s.scaleX)+Math.abs(u.y*p.scaleY/s.scaleY));l=p.scaleX*v,h=p.scaleY*v}else l=Math.abs(c.x*s.scaleX/u.x),h=Math.abs(c.y*s.scaleY/u.y);s_(t)&&(l*=2,h*=2),t.signX!==d&&o!=="y"&&(t.originX=EE(t.originX),l*=-1,t.signX=d),t.signY!==x&&o!=="x"&&(t.originY=EE(t.originY),h*=-1,t.signY=x)}let m=s.scaleX,g=s.scaleY;return o?(o==="x"&&s.set("scaleX",l),o==="y"&&s.set("scaleY",h)):(!Oi(s,"lockScalingX")&&s.set("scaleX",l),!Oi(s,"lockScalingY")&&s.set("scaleY",h)),m!==s.scaleX||g!==s.scaleY}var Fc=rs("scaling",Zs((r,t,e,n)=>Gf(r,t,e,n))),C_=rs("scaling",Zs((r,t,e,n)=>Gf(r,t,e,n,{by:"x"}))),y_=rs("scaling",Zs((r,t,e,n)=>Gf(r,t,e,n,{by:"y"}))),E5=["target","ex","ey","skewingSide"],Xx={x:{counterAxis:"y",scale:"scaleX",skew:"skewX",lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:"scaleY",skew:"skewY",lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},_5=["ns","nesw","ew","nwse"],A_=(r,t,e)=>{if(t.x!==0&&Oi(e,"lockSkewingY")||t.y!==0&&Oi(e,"lockSkewingX"))return o0;let n=a_(e,t)%4;return"".concat(_5[n],"-resize")};function b_(r,t,e,n,i){let{target:s}=e,{counterAxis:o,origin:a,lockSkewing:c,skew:l,flip:h}=Xx[r];if(Oi(s,c))return!1;let{origin:u,flip:d}=Xx[o],x=Zr(e[u])*(s[d]?-1:1),m=-Math.sign(x)*(s[h]?-1:1),g=.5*-((s[l]===0&&D0(e,ue,ue,n,i)[r]>0||s[l]>0?1:-1)*m)+.5;return rs("skewing",Zs((p,v,E,C)=>function(b,A,w){let{target:S,ex:_,ey:y,skewingSide:D}=A,F=ke(A,E5),{skew:T}=Xx[b],L=w.subtract(new Q(_,y)).divide(new Q(S.scaleX,S.scaleY))[b],N=S[T],J=F[T],tt=Math.tan(qe(J)),G=b==="y"?S._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:S._getTransformedDimensions({scaleX:1,scaleY:1}).y,X=2*L*D/Math.max(G,1)+tt,st=Xs(Math.atan(X));S.set(T,st);let ft=N!==S[T];if(ft&&b==="y"){let{skewX:mt,scaleX:Jt}=S,q=S._getTransformedDimensions({skewY:N}),O=S._getTransformedDimensions(),V=mt!==0?q.x/O.x:1;V!==1&&S.set("scaleX",V*Jt)}return ft}(r,v,new Q(E,C))))(t,U(U({},e),{},{[a]:g,skewingSide:m}),n,i)}var w_=(r,t,e,n)=>b_("x",r,t,e,n),S_=(r,t,e,n)=>b_("y",r,t,e,n);function F0(r,t){return r[t.canvas.altActionKey]}var Pc=(r,t,e)=>{let n=F0(r,e);return t.x===0?n?"skewX":"scaleY":t.y===0?n?"skewY":"scaleX":""},Vs=(r,t,e)=>F0(r,e)?A_(0,t,e):Qo(r,t,e),mf=(r,t,e,n)=>F0(r,t.target)?S_(r,t,e,n):C_(r,t,e,n),gf=(r,t,e,n)=>F0(r,t.target)?w_(r,t,e,n):y_(r,t,e,n),Wf=()=>({ml:new Fn({x:-.5,y:0,cursorStyleHandler:Vs,actionHandler:mf,getActionName:Pc}),mr:new Fn({x:.5,y:0,cursorStyleHandler:Vs,actionHandler:mf,getActionName:Pc}),mb:new Fn({x:0,y:.5,cursorStyleHandler:Vs,actionHandler:gf,getActionName:Pc}),mt:new Fn({x:0,y:-.5,cursorStyleHandler:Vs,actionHandler:gf,getActionName:Pc}),tl:new Fn({x:-.5,y:-.5,cursorStyleHandler:Qo,actionHandler:Fc}),tr:new Fn({x:.5,y:-.5,cursorStyleHandler:Qo,actionHandler:Fc}),bl:new Fn({x:-.5,y:.5,cursorStyleHandler:Qo,actionHandler:Fc}),br:new Fn({x:.5,y:.5,cursorStyleHandler:Qo,actionHandler:Fc}),mtr:new Fn({x:0,y:-.5,actionHandler:v_,cursorStyleHandler:g_,offsetY:-40,withConnection:!0,actionName:"rotate"})}),M_=()=>({mr:new Fn({x:.5,y:0,actionHandler:pf,cursorStyleHandler:Vs,actionName:"resizing"}),ml:new Fn({x:-.5,y:0,actionHandler:pf,cursorStyleHandler:Vs,actionName:"resizing"})}),D_=()=>U(U({},Wf()),M_()),d0=class r extends Ns{static getDefaults(){return U(U({},super.getDefaults()),{},{controls:Wf()},r.ownDefaults)}_updateCacheCanvas(){let t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){let e=t._currentTransform,n=e.target,i=e.action;if(this===n&&i&&i.startsWith("scale"))return!1}return super._updateCacheCanvas()}getActiveControl(){let t=this.__corner;return t?{key:t,control:this.controls[t],coord:this.oCoords[t]}:void 0}findControl(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;let n=Object.entries(this.oCoords);for(let i=n.length-1;i>=0;i--){let[s,o]=n[i],a=this.controls[s];if(a.shouldActivate(s,this,t,e?o.touchCorner:o.corner))return this.__corner=s,{key:s,control:a,coord:this.oCoords[s]}}}calcOCoords(){let t=this.getViewportTransform(),e=this.getCenterPoint(),n=Da(e.x,e.y),i=Ba({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),s=yn(n,i),o=yn(t,s),a=yn(o,[1/t[0],0,0,1/t[3],0,0]),c=this.group?ya(this.calcTransformMatrix()):void 0,l=this._calculateCurrentDimensions(c),h={};return this.forEachControl((u,d)=>{let x=u.positionHandler(l,a,this,u);h[d]=Object.assign(x,this._calcCornerCoords(u,x))}),h}_calcCornerCoords(t,e){let n=this.getTotalAngle();return{corner:t.calcCornerCoords(n,this.cornerSize,e.x,e.y,!1,this),touchCorner:t.calcCornerCoords(n,this.touchCornerSize,e.x,e.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(t){for(let e in this.controls)t(this.controls[e],e,this)}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;t.save();let e=this.getRelativeCenterPoint(),n=this._calculateCurrentDimensions(),i=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/i[0],1/i[3]),t.rotate(qe(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-n.x/2,-n.y/2,n.x,n.y),t.restore()}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=U({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},n);t.save(),t.strokeStyle=i.borderColor,this._setLineDash(t,i.borderDashArray),this.strokeBorders(t,e),i.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{hasBorders:n,hasControls:i}=this,s=U({hasBorders:n,hasControls:i},e),o=this.getViewportTransform(),a=s.hasBorders,c=s.hasControls,l=yn(o,this.calcTransformMatrix()),h=ya(l);t.save(),t.translate(h.translateX,h.translateY),t.lineWidth=1*this.borderScaleFactor,this.group===this.parent&&(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(h.angle-=180),t.rotate(qe(this.group?h.angle:this.angle)),a&&this.drawBorders(t,h,e),c&&this.drawControls(t,e),t.restore()}drawBorders(t,e,n){let i;if(n&&n.forActiveSelection||this.group){let s=M0(this.width,this.height,Xc(e)),o=this.isStrokeAccountedForInDimensions()?kf:(this.strokeUniform?new Q().scalarAdd(this.canvas?this.canvas.getZoom():1):new Q(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);i=s.add(o).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else i=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,i,n)}drawControlsConnectingLines(t,e){let n=!1;t.beginPath(),this.forEachControl((i,s)=>{i.withConnection&&i.getVisibility(this,s)&&(n=!0,t.moveTo(i.x*e.x,i.y*e.y),t.lineTo(i.x*e.x+i.offsetX,i.y*e.y+i.offsetY))}),n&&t.stroke()}drawControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t.save();let n=this.getCanvasRetinaScaling(),{cornerStrokeColor:i,cornerDashArray:s,cornerColor:o}=this,a=U({cornerStrokeColor:i,cornerDashArray:s,cornerColor:o},e);t.setTransform(n,0,0,n,0,0),t.strokeStyle=t.fillStyle=a.cornerColor,this.transparentCorners||(t.strokeStyle=a.cornerStrokeColor),this._setLineDash(t,a.cornerDashArray),this.setCoords(),this.forEachControl((c,l)=>{if(c.getVisibility(this,l)){let h=this.oCoords[l];c.render(t,h.x,h.y,a,this)}}),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(t).forEach(e=>{let[n,i]=e;return this.setControlVisible(n,i)})}clearContextTop(t){if(!this.canvas)return;let e=this.canvas.contextTop;if(!e)return;let n=this.canvas.viewportTransform;e.save(),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this.transform(e);let i=this.width+4,s=this.height+4;return e.clearRect(-i/2,-s/2,i,s),t||e.restore(),e}onDeselect(t){return!1}onSelect(t){return!1}shouldStartDragging(){return!1}onDragStart(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}};function B_(r,t){return t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(n=>{n!=="constructor"&&Object.defineProperty(r.prototype,n,Object.getOwnPropertyDescriptor(e.prototype,n)||Object.create(null))})}),r}z(d0,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});var Qe=class extends d0{};B_(Qe,[a0]),St.setClass(Qe),St.setClass(Qe,"object");var T_=(r,t,e,n)=>{let i=2*(n=Math.round(n))+1,{data:s}=r.getImageData(t-n,e-n,i,i);for(let o=3;o<s.length;o+=4)if(s[o]>0)return!1;return!0},x0=class{constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new Q(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new Q(1/this.options.scaleX,1/this.options.scaleY):new Q(1,1)}createSideVector(t,e){let n=c0(t,e);return this.options.strokeUniform?n.multiply(this.scale):n}projectOrthogonally(t,e,n){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,n)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(t){let e=new Q(t);return e.y+=e.x*Math.tan(qe(this.options.skewY)),e.x+=e.y*Math.tan(qe(this.options.skewX)),e}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e)}},C5=new Q,f0=class r extends x0{static getOrthogonalRotationFactor(t,e){let n=e?h0(t,e):d_(t);return Math.abs(n)<ns?-1:1}constructor(t,e,n,i){super(i),z(this,"AB",void 0),z(this,"AC",void 0),z(this,"alpha",void 0),z(this,"bisector",void 0),this.A=new Q(t),this.B=new Q(e),this.C=new Q(n),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=h0(this.AB,this.AC),this.bisector=B0(Vf(this.AB.eq(C5)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude,i=this.createSideVector(t,e),s=Hf(i),o=r.getOrthogonalRotationFactor(s,this.bisector);return this.scaleUnitVector(s,n*o)}projectBevel(){let t=[];return(this.alpha%Cr==0?[this.B]:[this.B,this.C]).forEach(e=>{t.push(this.projectOrthogonally(this.A,e)),t.push(this.projectOrthogonally(this.A,e,-this.strokeProjectionMagnitude))}),t}projectMiter(){let t=[],e=Math.abs(this.alpha),n=1/Math.sin(e/2),i=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*n),s=this.options.strokeUniform?l0(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return l0(i)/this.strokeProjectionMagnitude<=s&&t.push(this.applySkew(this.A.add(i))),t.push(...this.projectBevel()),t}projectRoundNoSkew(t,e){let n=[],i=new Q(r.getOrthogonalRotationFactor(this.bisector),r.getOrthogonalRotationFactor(new Q(this.bisector.y,this.bisector.x)));return[new Q(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(i),new Q(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(i)].forEach(s=>{uf(s,t,e)&&n.push(this.A.add(s))}),n}projectRoundWithSkew(t,e){let n=[],{skewX:i,skewY:s,scaleX:o,scaleY:a,strokeUniform:c}=this.options,l=new Q(Math.tan(qe(i)),Math.tan(qe(s))),h=this.strokeProjectionMagnitude,u=c?h/a/Math.sqrt(1/a**2+1/o**2*l.y**2):h/Math.sqrt(1+l.y**2),d=new Q(Math.sqrt(Math.max(h**2-u**2,0)),u),x=c?h/Math.sqrt(1+l.x**2*(1/a)**2/(1/o+1/o*l.x*l.y)**2):h/Math.sqrt(1+l.x**2/(1+l.x*l.y)**2),m=new Q(x,Math.sqrt(Math.max(h**2-x**2,0)));return[m,m.scalarMultiply(-1),d,d.scalarMultiply(-1)].map(g=>this.applySkew(c?g.multiply(this.strokeUniformScalar):g)).forEach(g=>{uf(g,t,e)&&n.push(this.applySkew(this.A).add(g))}),n}projectRound(){let t=[];t.push(...this.projectBevel());let e=this.alpha%Cr==0,n=this.applySkew(this.A),i=t[e?0:2].subtract(n),s=t[e?1:0].subtract(n),o=e?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),a=sa(i,o)>0,c=a?i:s,l=a?s:i;return this.isSkewed()?t.push(...this.projectRoundWithSkew(c,l)):t.push(...this.projectRoundNoSkew(c,l)),t}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t,angle:this.alpha,bisector:this.bisector}))}},p0=class extends x0{constructor(t,e,n){super(n),this.A=new Q(t),this.T=new Q(e)}calcOrthogonalProjection(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude,i=this.createSideVector(t,e);return this.scaleUnitVector(Hf(i),n)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){let t=[];if(!this.isSkewed()&&this.A.eq(this.T)){let e=new Q(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.applySkew(this.A.add(e)),this.applySkew(this.A.subtract(e)))}else t.push(...new f0(this.A,this.T,this.T,this.options).projectRound());return t}projectSquare(){let t=[];if(this.A.eq(this.T)){let e=new Q(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.A.add(e),this.A.subtract(e))}else{let e=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),n=this.scaleUnitVector(B0(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),i=this.A.add(n);t.push(i.add(e),i.subtract(e))}return t.map(e=>this.applySkew(e))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t}))}},F_=function(r,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2],n=[];if(r.length===0)return n;let i=r.reduce((s,o)=>(s[s.length-1].eq(o)||s.push(new Q(o)),s),[new Q(r[0])]);if(i.length===1)e=!0;else if(!e){let s=i[0],o=((a,c)=>{for(let l=a.length-1;l>=0;l--)if(c(a[l],l,a))return l;return-1})(i,a=>!a.eq(s));i.splice(o+1)}return i.forEach((s,o,a)=>{let c,l;o===0?(l=a[1],c=e?s:a[a.length-1]):o===a.length-1?(c=a[o-1],l=e?s:a[0]):(c=a[o-1],l=a[o+1]),e&&a.length===1?n.push(...new p0(s,s,t).project()):!e||o!==0&&o!==a.length-1?n.push(...new f0(s,c,l,t).project()):n.push(...new p0(s,o===0?l:c,t).project())}),n},P_=r=>r.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),P0=r=>{let t=[];for(let e,n=0;n<r.length;n++)(e=y5(r,n))!==!1&&t.push(e);return t},y5=(r,t)=>{let e=r.charCodeAt(t);if(isNaN(e))return"";if(e<55296||e>57343)return r.charAt(t);if(55296<=e&&e<=56319){if(r.length<=t+1)throw"High surrogate without following low surrogate";let i=r.charCodeAt(t+1);if(56320>i||i>57343)throw"High surrogate without following low surrogate";return r.charAt(t)+r.charAt(t+1)}if(t===0)throw"Low surrogate without preceding high surrogate";let n=r.charCodeAt(t-1);if(55296>n||n>56319)throw"Low surrogate without preceding high surrogate";return!1},A5=Object.freeze({__proto__:null,capitalize:function(r){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return"".concat(r.charAt(0).toUpperCase()).concat(t?r.slice(1):r.slice(1).toLowerCase())},escapeXml:P_,graphemeSplit:P0}),R0=function(r,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return r.fill!==t.fill||r.stroke!==t.stroke||r.strokeWidth!==t.strokeWidth||r.fontSize!==t.fontSize||r.fontFamily!==t.fontFamily||r.fontWeight!==t.fontWeight||r.fontStyle!==t.fontStyle||r.textBackgroundColor!==t.textBackgroundColor||r.deltaY!==t.deltaY||e&&(r.overline!==t.overline||r.underline!==t.underline||r.linethrough!==t.linethrough)},R_=(r,t)=>{let e=t.split(`
`),n=[],i=-1,s={};r=$c(r);for(let o=0;o<e.length;o++){let a=P0(e[o]);if(r[o])for(let c=0;c<a.length;c++){i++;let l=r[o][c];l&&Object.keys(l).length>0&&(R0(s,l,!0)?n.push({start:i,end:i+1,style:l}):n[n.length-1].end++),s=l||{}}else i+=a.length,s={}}return n},k_=(r,t)=>{if(!Array.isArray(r))return $c(r);let e=t.split(Rf),n={},i=-1,s=0;for(let o=0;o<e.length;o++){let a=P0(e[o]);for(let c=0;c<a.length;c++)i++,r[s]&&r[s].start<=i&&i<r[s].end&&(n[o]=n[o]||{},n[o][c]=U({},r[s].style),i===r[s].end-1&&s++)}return n},ss=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function SE(r,t){let e=r.nodeName,n=r.getAttribute("class"),i=r.getAttribute("id"),s="(?![a-zA-Z\\-]+)",o;if(o=new RegExp("^"+e,"i"),t=t.replace(o,""),i&&t.length&&(o=new RegExp("#"+i+s,"i"),t=t.replace(o,"")),n&&t.length){let a=n.split(" ");for(let c=a.length;c--;)o=new RegExp("\\."+a[c]+s,"i"),t=t.replace(o,"")}return t.length===0}function b5(r,t){let e=!0,n=SE(r,t.pop());return n&&t.length&&(e=function(i,s){let o,a=!0;for(;i.parentElement&&i.parentElement.nodeType===1&&s.length;)a&&(o=s.pop()),a=SE(i=i.parentElement,o);return s.length===0}(r,t)),n&&e&&t.length===0}var w5=r=>{var t;return(t=x5[r])!==null&&t!==void 0?t:r},O_=r=>r.replace(new RegExp("(".concat(Ki,")"),"gi")," $1 ").replace(/,/gi," ").replace(/\s+/gi," "),ME,DE,BE,TE,FE,PE,RE,Ln="(".concat(Ki,")"),S5=String.raw(ME||(ME=nr(["(skewX)(",")"],["(skewX)\\(","\\)"])),Ln),M5=String.raw(DE||(DE=nr(["(skewY)(",")"],["(skewY)\\(","\\)"])),Ln),D5=String.raw(BE||(BE=nr(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),Ln,Ln,Ln),B5=String.raw(TE||(TE=nr(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),Ln,Ln),T5=String.raw(FE||(FE=nr(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),Ln,Ln),F5=String.raw(PE||(PE=nr(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),Ln,Ln,Ln,Ln,Ln,Ln),jf="(?:".concat(F5,"|").concat(T5,"|").concat(D5,"|").concat(B5,"|").concat(S5,"|").concat(M5,")"),P5="(?:".concat(jf,"*)"),R5=String.raw(RE||(RE=nr(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),P5),k5=new RegExp(R5),O5=new RegExp(jf,"g");function vf(r){let t=[];if(!(r=O_(r).replace(/\s*([()])\s*/gi,"$1"))||r&&!k5.test(r))return[...Nn];for(let e of r.matchAll(O5)){let n=new RegExp(jf).exec(e[0]);if(!n)continue;let i=Nn,s=n.filter(m=>!!m),[,o,...a]=s,[c,l,h,u,d,x]=a.map(m=>parseFloat(m));switch(o){case"translate":i=Da(c,l);break;case"rotate":i=Ba({angle:c},{x:l,y:h});break;case"scale":i=S0(c,l);break;case"skewX":i=If(c);break;case"skewY":i=Lf(c);break;case"matrix":i=[c,l,h,u,d,x]}t.push(i)}return Ma(t)}function I5(r,t,e,n){let i=Array.isArray(t),s,o=t;if(r!=="fill"&&r!=="stroke"||t!==Xn){if(r==="strokeUniform")return t==="non-scaling-stroke";if(r==="strokeDashArray")o=t===Xn?null:t.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(r==="transformMatrix")o=e&&e.transformMatrix?yn(e.transformMatrix,vf(t)):vf(t);else if(r==="visible")o=t!==Xn&&t!=="hidden",e&&e.visible===!1&&(o=!1);else if(r==="opacity")o=parseFloat(t),e&&e.opacity!==void 0&&(o*=e.opacity);else if(r==="textAnchor")o=t==="start"?Se:t==="end"?Je:ue;else if(r==="charSpacing")s=Gs(t,n)/n*1e3;else if(r==="paintFirst"){let a=t.indexOf("fill"),c=t.indexOf("stroke");o="fill",(a>-1&&c>-1&&c<a||a===-1&&c>-1)&&(o="stroke")}else{if(r==="href"||r==="xlink:href"||r==="font")return t;if(r==="imageSmoothing")return t==="optimizeQuality";s=i?t.map(Gs):Gs(t,n)}}else o="";return!i&&isNaN(s)?o:s}function L5(r,t){let e=r.match(d5);if(!e)return;let n=e[1],i=e[3],s=e[4],o=e[5],a=e[6];n&&(t.fontStyle=n),i&&(t.fontWeight=isNaN(parseFloat(i))?i:parseFloat(i)),s&&(t.fontSize=Gs(s)),a&&(t.fontFamily=a),o&&(t.lineHeight=o==="normal"?1:o)}function N5(r){let t={},e=r.getAttribute("style");return e&&(typeof e=="string"?function(n,i){n.replace(/;\s*$/,"").split(";").forEach(s=>{let[o,a]=s.split(":");i[o.trim().toLowerCase()]=a.trim()})}(e,t):function(n,i){Object.entries(n).forEach(s=>{let[o,a]=s;a!==void 0&&(i[o.toLowerCase()]=a)})}(e,t)),t}var U5={stroke:"strokeOpacity",fill:"fillOpacity"};function Ar(r,t,e){if(!r)return{};let n,i={},s=Pf;r.parentNode&&bE.test(r.parentNode.nodeName)&&(i=Ar(r.parentElement,t,e),i.fontSize&&(n=s=Gs(i.fontSize)));let o=U(U(U({},t.reduce((l,h)=>{let u=r.getAttribute(h);return u&&(l[h]=u),l},{})),function(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u={};for(let d in h)b5(l,d.split(" "))&&(u=U(U({},u),h[d]));return u}(r,e)),N5(r));o[jx]&&r.setAttribute(jx,o[jx]),o[Wx]&&(n=Gs(o[Wx],s),o[Wx]="".concat(n));let a={};for(let l in o){let h=w5(l),u=I5(h,o[l],i,n);a[h]=u}a&&a.font&&L5(a.font,a);let c=U(U({},i),a);return bE.test(r.nodeName)?c:function(l){let h=Qe.getDefaults();return Object.entries(U5).forEach(u=>{let[d,x]=u;if(l[x]===void 0||l[d]==="")return;if(l[d]===void 0){if(!h[d])return;l[d]=h[d]}if(l[d].indexOf("url(")===0)return;let m=new Un(l[d]);l[d]=m.setAlpha(me(m.getAlpha()*l[x],2)).toRgba()}),l}(c)}var z5=["left","top","width","height","visible"],I_=["rx","ry"],vr=class r extends Qe{static getDefaults(){return U(U({},super.getDefaults()),r.ownDefaults)}constructor(t){super(t),this._initRxRy()}_initRxRy(){let{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){let{width:e,height:n}=this,i=-e/2,s=-n/2,o=this.rx?Math.min(this.rx,e/2):0,a=this.ry?Math.min(this.ry,n/2):0,c=o!==0||a!==0;t.beginPath(),t.moveTo(i+o,s),t.lineTo(i+e-o,s),c&&t.bezierCurveTo(i+e-Xr*o,s,i+e,s+Xr*a,i+e,s+a),t.lineTo(i+e,s+n-a),c&&t.bezierCurveTo(i+e,s+n-Xr*a,i+e-Xr*o,s+n,i+e-o,s+n),t.lineTo(i+o,s+n),c&&t.bezierCurveTo(i+Xr*o,s+n,i,s+n-Xr*a,i,s+n-a),t.lineTo(i,s+a),c&&t.bezierCurveTo(i,s+Xr*a,i+Xr*o,s,i+o,s),t.closePath(),this._renderPaintInOrder(t)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...I_,...t])}_toSVG(){let{width:t,height:e,rx:n,ry:i}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(n,'" ry="').concat(i,'" width="').concat(t,'" height="').concat(e,`" />
`)]}static fromElement(t,e,n){return Ut(this,null,function*(){let i=Ar(t,this.ATTRIBUTE_NAMES,n),{left:s=0,top:o=0,width:a=0,height:c=0,visible:l=!0}=i,h=ke(i,z5);return new this(U(U(U({},e),h),{},{left:s,top:o,width:a,height:c,visible:!!(l&&a&&c)}))})}};z(vr,"type","Rect"),z(vr,"cacheProperties",[...yr,...I_]),z(vr,"ownDefaults",{rx:0,ry:0}),z(vr,"ATTRIBUTE_NAMES",[...ss,"x","y","rx","ry","width","height"]),St.setClass(vr),St.setSVGClass(vr);var _r="initialization",m0="added",Xf="removed",g0="imperative",L_=(r,t)=>{let{strokeUniform:e,strokeWidth:n,width:i,height:s,group:o}=t,a=o&&o!==r?qc(o.calcTransformMatrix(),r.calcTransformMatrix()):null,c=a?t.getRelativeCenterPoint().transform(a):t.getRelativeCenterPoint(),l=!t.isStrokeAccountedForInDimensions(),h=e&&l?i_(new Q(n,n),void 0,r.calcTransformMatrix()):kf,u=!e&&l?n:0,d=M0(i+u,s+u,Ma([a,t.calcOwnMatrix()],!0)).add(h).scalarDivide(2);return[c.subtract(d),c.add(d)]},wa=class{calcLayoutResult(t,e){if(this.shouldPerformLayout(t))return this.calcBoundingBox(e,t)}shouldPerformLayout(t){return t.type===_r||t.type===g0||!!t.prevStrategy&&t.strategy!==t.prevStrategy}shouldLayoutClipPath(t){let{type:e,target:{clipPath:n}}=t;return e!==_r&&n&&!n.absolutePositioned}getInitialSize(t,e){return e.size}calcBoundingBox(t,e){if(e.type===g0&&e.overrides)return e.overrides;if(t.length===0)return;let{target:n}=e,{left:i,top:s,width:o,height:a}=Qi(t.map(h=>L_(n,h)).reduce((h,u)=>h.concat(u),[])),c=new Q(o,a),l=new Q(i,s).add(c.scalarDivide(2));if(e.type===_r){let h=this.getInitialSize(e,{size:c,center:l});return{center:l,relativeCorrection:new Q(0,0),size:h}}return{center:l.transform(n.calcOwnMatrix()),size:c}}};z(wa,"type","strategy");var Wc=class extends wa{shouldPerformLayout(t){return!0}};z(Wc,"type","fit-content"),St.setClass(Wc);var V5=["strategy"],H5=["target","strategy","bubbles","prevStrategy"],N_="layoutManager",qs=class{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Wc;z(this,"strategy",void 0),this.strategy=t,this._subscriptions=new Map}performLayout(t){let e=U(U({bubbles:!0,strategy:this.strategy},t),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(e);let n=this.getLayoutResult(e);n&&this.commitLayout(e,n),this.onAfterLayout(e,n),this._prevLayoutStrategy=e.strategy}attachHandlers(t,e){let{target:n}=e;return["modified","moving","resizing","rotating","scaling","skewing","changed","modifyPoly"].map(i=>t.on(i,s=>this.performLayout(i==="modified"?{type:"object_modified",trigger:i,e:s,target:n}:{type:"object_modifying",trigger:i,e:s,target:n})))}subscribe(t,e){this.unsubscribe(t,e);let n=this.attachHandlers(t,e);this._subscriptions.set(t,n)}unsubscribe(t,e){(this._subscriptions.get(t)||[]).forEach(n=>n()),this._subscriptions.delete(t)}unsubscribeTargets(t){t.targets.forEach(e=>this.unsubscribe(e,t))}subscribeTargets(t){t.targets.forEach(e=>this.subscribe(e,t))}onBeforeLayout(t){let{target:e,type:n}=t,{canvas:i}=e;if(n===_r||n===m0?this.subscribeTargets(t):n===Xf&&this.unsubscribeTargets(t),e.fire("layout:before",{context:t}),i&&i.fire("object:layout:before",{target:e,context:t}),n===g0&&t.deep){let s=ke(t,V5);e.forEachObject(o=>o.layoutManager&&o.layoutManager.performLayout(U(U({},s),{},{bubbles:!1,target:o})))}}getLayoutResult(t){let{target:e}=t,n=t.strategy.calcLayoutResult(t,e.getObjects());if(!n)return;let i=t.type===_r?new Q:e.getRelativeCenterPoint(),{center:s,correction:o=new Q,relativeCorrection:a=new Q}=n,c=i.subtract(s).add(o).transform(t.type===_r?Nn:ei(e.calcOwnMatrix()),!0).add(a);return{result:n,prevCenter:i,nextCenter:s,offset:c}}commitLayout(t,e){let{target:n}=t,{result:{size:i},nextCenter:s}=e;var o,a;n.set({width:i.x,height:i.y}),this.layoutObjects(t,e),t.type===_r?n.set({left:(o=t.x)!==null&&o!==void 0?o:s.x+i.x*Zr(n.originX),top:(a=t.y)!==null&&a!==void 0?a:s.y+i.y*Zr(n.originY)}):(n.setPositionByOrigin(s,ue,ue),n.setCoords(),n.set("dirty",!0))}layoutObjects(t,e){let{target:n}=t;n.forEachObject(i=>{i.group===n&&this.layoutObject(t,e,i)}),t.strategy.shouldLayoutClipPath(t)&&this.layoutObject(t,e,n.clipPath)}layoutObject(t,e,n){let{offset:i}=e;n.set({left:n.left+i.x,top:n.top+i.y})}onAfterLayout(t,e){let{target:n,strategy:i,bubbles:s,prevStrategy:o}=t,a=ke(t,H5),{canvas:c}=n;n.fire("layout:after",{context:t,result:e}),c&&c.fire("object:layout:after",{context:t,result:e,target:n});let l=n.parent;s&&l!=null&&l.layoutManager&&((a.path||(a.path=[])).push(n),l.layoutManager.performLayout(U(U({},a),{},{target:l}))),n.set("dirty",!0)}dispose(){this._subscriptions.forEach(t=>t.forEach(e=>e())),this._subscriptions.clear()}toObject(){return{type:N_,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}};St.setClass(qs,N_);var G5=["type","objects","layoutManager"],Ef=class extends qs{performLayout(){}},Qr=class r extends GE(Qe){static getDefaults(){return U(U({},super.getDefaults()),r.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e),z(this,"_activeObjects",[]),z(this,"__objectSelectionTracker",void 0),z(this,"__objectSelectionDisposer",void 0),this._objects=[...t],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(n=>{this.enterGroup(n,!1)}),this.layoutManager=e.layoutManager||new qs,this.layoutManager.performLayout({type:_r,target:this,targets:[...t],x:e.left,y:e.top})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(es("error","Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(t)===-1||(es("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(t){return t.filter((e,n,i)=>this.canEnterGroup(e)&&i.indexOf(e)===n)}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];let i=this._filterObjectsBeforeEnteringGroup(e),s=super.add(...i);return this._onAfterObjectsChange(m0,i),s}insertAt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];let s=this._filterObjectsBeforeEnteringGroup(n),o=super.insertAt(t,...s);return this._onAfterObjectsChange(m0,s),o}remove(){let t=super.remove(...arguments);return this._onAfterObjectsChange(Xf,t),t}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this.layoutManager.performLayout({type:t,targets:e,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){let n=this[t];return super._set(t,e),t==="canvas"&&n!==e&&(this._objects||[]).forEach(i=>{i._set(t,e)}),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(t,e){let{target:n}=e,i=this._activeObjects;if(t)i.push(n),this._set("dirty",!0);else if(i.length>0){let s=i.indexOf(n);s>-1&&(i.splice(s,1),this._set("dirty",!0))}}_watchObject(t,e){t&&this._watchObject(!1,e),t?(e.on("selected",this.__objectSelectionTracker),e.on("deselected",this.__objectSelectionDisposer)):(e.off("selected",this.__objectSelectionTracker),e.off("deselected",this.__objectSelectionDisposer))}enterGroup(t,e){t.group&&t.group.remove(t),t._set("parent",this),this._enterGroup(t,e)}_enterGroup(t,e){e&&ba(t,yn(ei(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this._watchObject(!0,t);let n=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();n&&(n===t||t.isDescendantOf(n))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("parent",void 0),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(ba(t,yn(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);let n=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;n>-1&&this._activeObjects.splice(n,1)}shouldCache(){let t=Qe.prototype.shouldCache.call(this);if(t){for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1}return t}willDrawShadow(){if(super.willDrawShadow())return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(t){this._renderBackground(t);for(let n=0;n<this._objects.length;n++){var e;(e=this.canvas)!==null&&e!==void 0&&e.preserveObjectStacking&&this._objects[n].group!==this?(t.save(),t.transform(...ei(this.calcTransformMatrix())),this._objects[n].render(t),t.restore()):this._objects[n].group===this&&this._objects[n].render(t)}this._drawClipPath(t,this.clipPath)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(t=>t.setCoords())}triggerLayout(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.layoutManager.performLayout(U({target:this,type:g0},t))}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}__serializeObjects(t,e){let n=this.includeDefaultValues;return this._objects.filter(function(i){return!i.excludeFromExport}).map(function(i){let s=i.includeDefaultValues;i.includeDefaultValues=n;let o=i[t||"toObject"](e);return i.includeDefaultValues=s,o})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=this.layoutManager.toObject();return U(U(U({},super.toObject(["subTargetCheck","interactive",...t])),e.strategy!=="fit-content"||this.includeDefaultValues?{layoutManager:e}:{}),{},{objects:this.__serializeObjects("toObject",t)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(t=>{this._watchObject(!1,t),t.dispose()}),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";let e=vr.prototype._toSVG.call(this),n=e.indexOf("COMMON_PARTS");e[n]='for="group" ';let i=e.join("");return t?t(i):i}_toSVG(t){let e=["<g ","COMMON_PARTS",` >
`],n=this._createSVGBgRect(t);n&&e.push("		",n);for(let i=0;i<this._objects.length;i++)e.push("		",this._objects[i].toSVG(t));return e.push(`</g>
`),e}getSvgStyles(){let t=this.opacity!==void 0&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){let e=[],n=this._createSVGBgRect(t);n&&e.push("	",n);for(let i=0;i<this._objects.length;i++)e.push("	",this._objects[i].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject(t){let{type:e,objects:n=[],layoutManager:i}=t,s=ke(t,G5);return Promise.all([Aa(n),Yc(s)]).then(o=>{let[a,c]=o,l=new this(a,U(U(U({},s),c),{},{layoutManager:new Ef}));if(i){let h=St.getClass(i.type),u=St.getClass(i.strategy);l.layoutManager=new h(new u)}else l.layoutManager=new qs;return l.layoutManager.subscribeTargets({type:_r,target:l,targets:l.getObjects()}),l.setCoords(),l})}};z(Qr,"type","Group"),z(Qr,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),St.setClass(Qr);var U_=(r,t)=>Math.min(t.width/r.width,t.height/r.height),z_=(r,t)=>Math.max(t.width/r.width,t.height/r.height),kE,Ie="(".concat(Ki,")"),W5="(M) (?:".concat(Ie," ").concat(Ie," ?)+"),j5="(L) (?:".concat(Ie," ").concat(Ie," ?)+"),X5="(H) (?:".concat(Ie," ?)+"),Y5="(V) (?:".concat(Ie," ?)+"),q5=String.raw(kE||(kE=nr(["(Z)s*"],["(Z)\\s*"]))),$5="(C) (?:".concat(Ie," ").concat(Ie," ").concat(Ie," ").concat(Ie," ").concat(Ie," ").concat(Ie," ?)+"),Z5="(S) (?:".concat(Ie," ").concat(Ie," ").concat(Ie," ").concat(Ie," ?)+"),J5="(Q) (?:".concat(Ie," ").concat(Ie," ").concat(Ie," ").concat(Ie," ?)+"),K5="(T) (?:".concat(Ie," ").concat(Ie," ?)+"),Q5="(A) (?:".concat(Ie," ").concat(Ie," ").concat(Ie," ([01]) ?([01]) ").concat(Ie," ").concat(Ie," ?)+"),OE="(?:(?:".concat(W5,")")+"|(?:".concat(j5,")")+"|(?:".concat(X5,")")+"|(?:".concat(Y5,")")+"|(?:".concat(q5,")")+"|(?:".concat($5,")")+"|(?:".concat(Z5,")")+"|(?:".concat(J5,")")+"|(?:".concat(K5,")")+"|(?:".concat(Q5,"))"),tD={m:"l",M:"L"},eD=(r,t,e,n,i,s,o,a,c,l,h)=>{let u=Ii(r),d=Li(r),x=Ii(t),m=Li(t),g=e*i*x-n*s*m+o,f=n*i*x+e*s*m+a;return["C",l+c*(-e*i*d-n*s*u),h+c*(-n*i*d+e*s*u),g+c*(e*i*m+n*s*x),f+c*(n*i*m-e*s*x),g,f]},IE=(r,t,e,n)=>{let i=Math.atan2(t,r),s=Math.atan2(n,e);return s>=i?s-i:2*Math.PI-(i-s)};function _f(r,t,e,n,i,s,o,a){let c;if(ve.cachesBoundsOfCurve&&(c=[...arguments].join(),Rc.boundsOfCurveCache[c]))return Rc.boundsOfCurveCache[c];let l=Math.sqrt,h=Math.abs,u=[],d=[[0,0],[0,0]],x=6*r-12*e+6*i,m=-3*r+9*e-9*i+3*o,g=3*e-3*r;for(let C=0;C<2;++C){if(C>0&&(x=6*t-12*n+6*s,m=-3*t+9*n-9*s+3*a,g=3*n-3*t),h(m)<1e-12){if(h(x)<1e-12)continue;let _=-g/x;0<_&&_<1&&u.push(_);continue}let b=x*x-4*g*m;if(b<0)continue;let A=l(b),w=(-x+A)/(2*m);0<w&&w<1&&u.push(w);let S=(-x-A)/(2*m);0<S&&S<1&&u.push(S)}let f=u.length,p=f,v=H_(r,t,e,n,i,s,o,a);for(;f--;){let{x:C,y:b}=v(u[f]);d[0][f]=C,d[1][f]=b}d[0][p]=r,d[1][p]=t,d[0][p+1]=o,d[1][p+1]=a;let E=[new Q(Math.min(...d[0]),Math.min(...d[1])),new Q(Math.max(...d[0]),Math.max(...d[1]))];return ve.cachesBoundsOfCurve&&(Rc.boundsOfCurveCache[c]=E),E}var nD=(r,t,e)=>{let[n,i,s,o,a,c,l,h]=e,u=((d,x,m,g,f,p,v)=>{if(m===0||g===0)return[];let E=0,C=0,b=0,A=Math.PI,w=v*Ff,S=Li(w),_=Ii(w),y=.5*(-_*d-S*x),D=.5*(-_*x+S*d),F=m**2,T=g**2,L=D**2,N=y**2,J=F*T-F*L-T*N,tt=Math.abs(m),G=Math.abs(g);if(J<0){let R=Math.sqrt(1-J/(F*T));tt*=R,G*=R}else b=(f===p?-1:1)*Math.sqrt(J/(F*L+T*N));let X=b*tt*D/G,st=-b*G*y/tt,ft=_*X-S*st+.5*d,mt=S*X+_*st+.5*x,Jt=IE(1,0,(y-X)/tt,(D-st)/G),q=IE((y-X)/tt,(D-st)/G,(-y-X)/tt,(-D-st)/G);p===0&&q>0?q-=2*A:p===1&&q<0&&(q+=2*A);let O=Math.ceil(Math.abs(q/A*2)),V=new Array(O),k=q/O,K=8/3*Math.sin(k/4)*Math.sin(k/4)/Math.sin(k/2),Y=Jt+k;for(let R=0;R<O;R++)V[R]=eD(Jt,Y,_,S,tt,G,ft,mt,K,E,C),E=V[R][5],C=V[R][6],Jt=Y,Y+=k;return V})(l-r,h-t,i,s,a,c,o);for(let d=0,x=u.length;d<x;d++)u[d][1]+=r,u[d][2]+=t,u[d][3]+=r,u[d][4]+=t,u[d][5]+=r,u[d][6]+=t;return u},V_=r=>{let t=0,e=0,n=0,i=0,s=[],o,a=0,c=0;for(let l of r){let h=[...l],u;switch(h[0]){case"l":h[1]+=t,h[2]+=e;case"L":t=h[1],e=h[2],u=["L",t,e];break;case"h":h[1]+=t;case"H":t=h[1],u=["L",t,e];break;case"v":h[1]+=e;case"V":e=h[1],u=["L",t,e];break;case"m":h[1]+=t,h[2]+=e;case"M":t=h[1],e=h[2],n=h[1],i=h[2],u=["M",t,e];break;case"c":h[1]+=t,h[2]+=e,h[3]+=t,h[4]+=e,h[5]+=t,h[6]+=e;case"C":a=h[3],c=h[4],t=h[5],e=h[6],u=["C",h[1],h[2],a,c,t,e];break;case"s":h[1]+=t,h[2]+=e,h[3]+=t,h[4]+=e;case"S":o==="C"?(a=2*t-a,c=2*e-c):(a=t,c=e),t=h[3],e=h[4],u=["C",a,c,h[1],h[2],t,e],a=u[3],c=u[4];break;case"q":h[1]+=t,h[2]+=e,h[3]+=t,h[4]+=e;case"Q":a=h[1],c=h[2],t=h[3],e=h[4],u=["Q",a,c,t,e];break;case"t":h[1]+=t,h[2]+=e;case"T":o==="Q"?(a=2*t-a,c=2*e-c):(a=t,c=e),t=h[1],e=h[2],u=["Q",a,c,t,e];break;case"a":h[6]+=t,h[7]+=e;case"A":nD(t,e,h).forEach(d=>s.push(d)),t=h[6],e=h[7];break;case"z":case"Z":t=n,e=i,u=["Z"]}u?(s.push(u),o=u[0]):o=""}return s},v0=(r,t,e,n)=>Math.sqrt((e-r)**2+(n-t)**2),H_=(r,t,e,n,i,s,o,a)=>c=>{let l=c**3,h=(x=>3*x**2*(1-x))(c),u=(x=>3*x*(1-x)**2)(c),d=(x=>(1-x)**3)(c);return new Q(o*l+i*h+e*u+r*d,a*l+s*h+n*u+t*d)},G_=r=>r**2,W_=r=>2*r*(1-r),j_=r=>(1-r)**2,iD=(r,t,e,n,i,s,o,a)=>c=>{let l=G_(c),h=W_(c),u=j_(c),d=3*(u*(e-r)+h*(i-e)+l*(o-i)),x=3*(u*(n-t)+h*(s-n)+l*(a-s));return Math.atan2(x,d)},rD=(r,t,e,n,i,s)=>o=>{let a=G_(o),c=W_(o),l=j_(o);return new Q(i*a+e*c+r*l,s*a+n*c+t*l)},sD=(r,t,e,n,i,s)=>o=>{let a=1-o,c=2*(a*(e-r)+o*(i-e)),l=2*(a*(n-t)+o*(s-n));return Math.atan2(l,c)},LE=(r,t,e)=>{let n=new Q(t,e),i=0;for(let s=1;s<=100;s+=1){let o=r(s/100);i+=v0(n.x,n.y,o.x,o.y),n=o}return i},oD=(r,t)=>{let e,n=0,i=0,s={x:r.x,y:r.y},o=U({},s),a=.01,c=0,l=r.iterator,h=r.angleFinder;for(;i<t&&a>1e-4;)o=l(n),c=n,e=v0(s.x,s.y,o.x,o.y),e+i>t?(n-=a,a/=2):(s=o,n+=a,i+=e);return U(U({},o),{},{angle:h(c)})},Yf=r=>{let t,e,n=0,i=0,s=0,o=0,a=0,c=[];for(let l of r){let h={x:i,y:s,command:l[0],length:0};switch(l[0]){case"M":e=h,e.x=o=i=l[1],e.y=a=s=l[2];break;case"L":e=h,e.length=v0(i,s,l[1],l[2]),i=l[1],s=l[2];break;case"C":t=H_(i,s,l[1],l[2],l[3],l[4],l[5],l[6]),e=h,e.iterator=t,e.angleFinder=iD(i,s,l[1],l[2],l[3],l[4],l[5],l[6]),e.length=LE(t,i,s),i=l[5],s=l[6];break;case"Q":t=rD(i,s,l[1],l[2],l[3],l[4]),e=h,e.iterator=t,e.angleFinder=sD(i,s,l[1],l[2],l[3],l[4]),e.length=LE(t,i,s),i=l[3],s=l[4];break;case"Z":e=h,e.destX=o,e.destY=a,e.length=v0(i,s,o,a),i=o,s=a}n+=e.length,c.push(e)}return c.push({length:n,x:i,y:s}),c},X_=function(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Yf(r),n=0;for(;t-e[n].length>0&&n<e.length-2;)t-=e[n].length,n++;let i=e[n],s=t/i.length,o=r[n];switch(i.command){case"M":return{x:i.x,y:i.y,angle:0};case"Z":return U(U({},new Q(i.x,i.y).lerp(new Q(i.destX,i.destY),s)),{},{angle:Math.atan2(i.destY-i.y,i.destX-i.x)});case"L":return U(U({},new Q(i.x,i.y).lerp(new Q(o[1],o[2]),s)),{},{angle:Math.atan2(o[2]-i.y,o[1]-i.x)});case"C":case"Q":return oD(i,t)}},Y_=r=>{r=O_(r);let t=[];for(let e of r.matchAll(new RegExp(OE,"gi"))){let n=e[0],i=[],s;do{if(s=new RegExp(OE,"i").exec(n),!s)break;let o=s.filter(c=>c);o.shift();let a=o.map(c=>{let l=Number.parseFloat(c);return Number.isNaN(l)?c:l});if(i.push(a),o.length<=1)break;o.shift(),n=n.replace(new RegExp("".concat(o.join(" ?")," ?$")),"")}while(s);i.reverse().forEach((o,a)=>{let c=tD[o[0]];a>0&&(c=="l"||c=="L")&&(o[0]=c),t.push(o)})}return t},aD=function(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=new Q(r[0]),n=new Q(r[1]),i=1,s=0,o=[],a=r.length,c=a>2,l;for(c&&(i=r[2].x<n.x?-1:r[2].x===n.x?0:1,s=r[2].y<n.y?-1:r[2].y===n.y?0:1),o.push(["M",e.x-i*t,e.y-s*t]),l=1;l<a;l++){if(!e.eq(n)){let h=e.midPointFrom(n);o.push(["Q",e.x,e.y,h.x,h.y])}e=r[l],l+1<r.length&&(n=r[l+1])}return c&&(i=e.x>r[l-2].x?1:e.x===r[l-2].x?0:-1,s=e.y>r[l-2].y?1:e.y===r[l-2].y?0:-1),o.push(["L",e.x+i*t,e.y+s*t]),o},q_=(r,t)=>r.map(e=>e.map((n,i)=>i===0||t===void 0?n:me(n,t)).join(" ")).join(" ");function cD(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=t.onComplete||Hs,n=new(w0()).XMLHttpRequest,i=t.signal,s=function(){n.abort()},o=function(){i&&i.removeEventListener("abort",s),n.onerror=n.ontimeout=Hs};if(i&&i.aborted)throw new e0("request");return i&&i.addEventListener("abort",s,{once:!0}),n.onreadystatechange=function(){n.readyState===4&&(o(),e(n),n.onreadystatechange=Hs)},n.onerror=n.ontimeout=o,n.open("get",r,!0),n.send(),n}var lD=(r,t)=>{let e=r._findCenterFromElement();r.transformMatrix&&((n=>{if(n.transformMatrix){let{scaleX:i,scaleY:s,angle:o,skewX:a}=ya(n.transformMatrix);n.flipX=!1,n.flipY=!1,n.set("scaleX",i),n.set("scaleY",s),n.angle=o,n.skewX=a,n.skewY=0}})(r),e=e.transform(r.transformMatrix)),delete r.transformMatrix,t&&(r.scaleX*=t.scaleX,r.scaleY*=t.scaleY,r.cropX=t.cropX,r.cropY=t.cropY,e.x+=t.offsetLeft,e.y+=t.offsetTop,r.width=t.width,r.height=t.height),r.setPositionByOrigin(e,ue,ue)},h6=Object.freeze({__proto__:null,addTransformToObject:e_,animate:zf,animateColor:h_,applyTransformToObject:ba,calcAngleBetweenVectors:h0,calcDimensionsMatrix:Xc,calcPlaneChangeMatrix:qc,calcVectorRotation:d_,cancelAnimFrame:WE,capValue:Ys,composeMatrix:qE,copyCanvasElement:r=>{var t;let e=Ke();return e.width=r.width,e.height=r.height,(t=e.getContext("2d"))===null||t===void 0||t.drawImage(r,0,0),e},cos:Ii,createCanvasElement:Ke,createImage:jE,createRotateMatrix:Ba,createScaleMatrix:S0,createSkewXMatrix:If,createSkewYMatrix:Lf,createTranslateMatrix:Da,createVector:c0,crossProduct:sa,degreesToRadians:qe,dotProduct:x_,ease:s5,enlivenObjectEnlivables:Yc,enlivenObjects:Aa,findScaleToCover:z_,findScaleToFit:U_,getBoundsOfCurve:_f,getOrthonormalVector:Hf,getPathSegmentsInfo:Yf,getPointOnPath:X_,getPointer:t_,getRandomInt:KM,getRegularPolygonPath:(r,t)=>{let e=2*Math.PI/r,n=-ns;r%2==0&&(n+=e/2);let i=new Array(r+1);for(let s=0;s<r;s++){let o=s*e+n,{x:a,y:c}=new Q(Ii(o),Li(o)).scalarMultiply(t);i[s]=[s===0?"M":"L",a,c]}return i[r]=["Z"],i},getSmoothPathFromPoints:aD,getSvgAttributes:r=>{let t=["instantiated_by_use","style","id","class"];switch(r){case"linearGradient":return t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return t.concat(["offset","stop-color","stop-opacity"])}return t},getUnitVector:B0,groupSVGElements:(r,t)=>r&&r.length===1?r[0]:new Qr(r,t),hasStyleChanged:R0,invertTransform:ei,isBetweenVectors:uf,isIdentityMatrix:r=>r.every((t,e)=>t===Nn[e]),isTouchEvent:s0,isTransparent:T_,joinPath:q_,loadImage:Oc,magnitude:l0,makeBoundingBoxFromPoints:Qi,makePathSimpler:V_,matrixToSVG:zc,mergeClipPaths:(r,t)=>{var e;let n=r,i=t;n.inverted&&!i.inverted&&(n=t,i=r),of(i,(e=i.group)===null||e===void 0?void 0:e.calcTransformMatrix(),n.calcTransformMatrix());let s=n.inverted&&i.inverted;return s&&(n.inverted=i.inverted=!1),new Qr([n],{clipPath:i,inverted:s})},multiplyTransformMatrices:yn,multiplyTransformMatrixArray:Ma,parsePath:Y_,parsePreserveAspectRatioAttribute:$E,parseUnit:Gs,pick:$s,projectStrokeOnPoints:F_,qrDecompose:ya,radiansToDegrees:Xs,removeFromArray:Us,removeTransformFromObject:(r,t)=>{let e=ei(t),n=yn(e,r.calcOwnMatrix());ba(r,n)},removeTransformMatrixForSvgParsing:lD,request:cD,requestAnimFrame:kc,resetObjectTransform:n_,rotatePoint:(r,t,e)=>r.rotate(e,t),rotateVector:Vf,saveObjectTransform:Uf,sendObjectToPlane:of,sendPointToPlane:Kr,sendVectorToPlane:i_,setStyle:Ic,sin:Li,sizeAfterTransform:M0,string:A5,stylesFromArray:k_,stylesToArray:R_,toDataURL:Of,toFixed:me,transformPath:(r,t,e)=>(e&&(t=yn(t,[1,0,0,1,-e.x,-e.y])),r.map(n=>{let i=[...n];for(let s=1;s<n.length-1;s+=2){let{x:o,y:a}=Pn({x:n[s],y:n[s+1]},t);i[s]=o,i[s+1]=a}return i})),transformPoint:Pn}),Cf=class extends r0{constructor(t){let{allowTouchScrolling:e=!1,containerClass:n=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),z(this,"upper",void 0),z(this,"container",void 0);let{el:i}=this.lower,s=this.createUpperCanvas();this.upper={el:s,ctx:s.getContext("2d")},this.applyCanvasStyle(i,{allowTouchScrolling:e}),this.applyCanvasStyle(s,{allowTouchScrolling:e});let o=this.createContainerElement();o.classList.add(n),i.parentNode&&i.parentNode.replaceChild(o,i),o.append(i,s),this.container=o}createUpperCanvas(){let{el:t}=this.lower,e=Ke();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e}createContainerElement(){let t=Sa().createElement("div");return t.setAttribute("data-fabric","wrapper"),Ic(t,{position:"relative"}),vE(t),t}applyCanvasStyle(t,e){let{allowTouchScrolling:n}=e;Ic(t,{position:"absolute",left:"0",top:"0"}),function(i,s){let o=s?"manipulation":Xn;Ic(i,{"touch-action":o,"-ms-touch-action":o})}(t,n),vE(t)}setDimensions(t,e){super.setDimensions(t,e);let{el:n,ctx:i}=this.upper;QE(n,i,t,e)}setCSSDimensions(t){super.setCSSDimensions(t),rf(this.upper.el,t),rf(this.container,t)}cleanupDOM(t){let e=this.container,{el:n}=this.lower,{el:i}=this.upper;super.cleanupDOM(t),e.removeChild(i),e.removeChild(n),e.parentNode&&e.parentNode.replaceChild(n,e)}dispose(){super.dispose(),tr().dispose(this.upper.el),delete this.upper,delete this.container}},E0=class r extends Hc{constructor(){super(...arguments),z(this,"targets",[]),z(this,"_hoveredTargets",[]),z(this,"_objectsToRender",void 0),z(this,"_currentTransform",null),z(this,"_groupSelector",null),z(this,"contextTopDirty",!1)}static getDefaults(){return U(U({},super.getDefaults()),r.ownDefaults)}get upperCanvasEl(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.el}get contextTop(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.ctx}get wrapperEl(){return this.elements.container}initElements(t){this.elements=new Cf(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){let t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter(e=>!e.group&&e!==t).concat(t):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){let t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;let e=this.getRetinaScaling(),n=Math.ceil((2*t+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=n,this.pixelFindContext.scale(e,e)}isTargetTransparent(t,e,n){let i=this.targetFindTolerance,s=this.pixelFindContext;this.clearContext(s),s.save(),s.translate(-e+i,-n+i),s.transform(...this.viewportTransform);let o=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(s),t.selectionBackgroundColor=o,s.restore();let a=Math.round(i*this.getRetinaScaling());return T_(s,a,a,a)}_isSelectionKeyPressed(t){let e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find(n=>!!n&&t[n]===!0):t[e])}_shouldClearSelection(t,e){let n=this.getActiveObjects(),i=this._activeObject;return!!(!e||e&&i&&n.length>1&&n.indexOf(e)===-1&&i!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&i&&i!==e)}_shouldCenterTransform(t,e,n){if(!t)return;let i;return e==="scale"||e==="scaleX"||e==="scaleY"||e==="resizing"?i=this.centeredScaling||t.centeredScaling:e==="rotate"&&(i=this.centeredRotation||t.centeredRotation),i?!n:n}_getOriginFromCorner(t,e){let n={x:t.originX,y:t.originY};return e&&(["ml","tl","bl"].includes(e)?n.x=Je:["mr","tr","br"].includes(e)&&(n.x=Se),["tl","mt","tr"].includes(e)?n.y=ef:["bl","mb","br"].includes(e)&&(n.y=Rn)),n}_setupCurrentTransform(t,e,n){var i;let s=e.group?Kr(this.getScenePoint(t),void 0,e.group.calcTransformMatrix()):this.getScenePoint(t),{key:o="",control:a}=e.getActiveControl()||{},c=n&&a?(i=a.getActionHandler(t,e,a))===null||i===void 0?void 0:i.bind(a):c_,l=((x,m,g,f)=>{if(!m||!x)return"drag";let p=f.controls[m];return p.getActionName(g,p,f)})(n,o,t,e),h=t[this.centeredKey],u=this._shouldCenterTransform(e,l,h)?{x:ue,y:ue}:this._getOriginFromCorner(e,o),d={target:e,action:l,actionHandler:c,actionPerformed:!1,corner:o,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:s.x-e.left,offsetY:s.y-e.top,originX:u.x,originY:u.y,ex:s.x,ey:s.y,lastX:s.x,lastY:s.y,theta:qe(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:h,original:U(U({},Uf(e)),{},{originX:u.x,originY:u.y})};this._currentTransform=d,this.fire("before:transform",{e:t,transform:d})}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){let{x:e,y:n,deltaX:i,deltaY:s}=this._groupSelector,o=new Q(e,n).transform(this.viewportTransform),a=new Q(e+i,n+s).transform(this.viewportTransform),c=this.selectionLineWidth/2,l=Math.min(o.x,a.x),h=Math.min(o.y,a.y),u=Math.max(o.x,a.x),d=Math.max(o.y,a.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(l,h,u-l,d-h)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,l+=c,h+=c,u-=c,d-=c,Qe.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(l,h,u-l,d-h))}findTarget(t){if(this.skipTargetFind)return;let e=this.getViewportPoint(t),n=this._activeObject,i=this.getActiveObjects();if(this.targets=[],n&&i.length>=1){if(n.findControl(e,s0(t))||i.length>1&&this.searchPossibleTargets([n],e))return n;if(n===this.searchPossibleTargets([n],e)){if(this.preserveObjectStacking){let s=this.targets;this.targets=[];let o=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&o&&o!==n?(this.targets=s,n):o}return n}}return this.searchPossibleTargets(this._objects,e)}_pointIsInObjectSelectionArea(t,e){let n=t.getCoords(),i=this.getZoom(),s=t.padding/i;if(s){let[o,a,c,l]=n,h=Math.atan2(a.y-o.y,a.x-o.x),u=Ii(h)*s,d=Li(h)*s,x=u+d,m=u-d;n=[new Q(o.x-m,o.y-x),new Q(a.x+x,a.y-m),new Q(c.x+m,c.y+x),new Q(l.x-x,l.y+m)]}return Ws.isPointInPolygon(e,n)}_checkTarget(t,e){return!!(t&&t.visible&&t.evented&&this._pointIsInObjectSelectionArea(t,Kr(e,void 0,this.viewportTransform))&&(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing||!this.isTargetTransparent(t,e.x,e.y)))}_searchPossibleTargets(t,e){let n=t.length;for(;n--;){let i=t[n];if(this._checkTarget(i,e)){if(Qh(i)&&i.subTargetCheck){let s=this._searchPossibleTargets(i._objects,e);s&&this.targets.push(s)}return i}}}searchPossibleTargets(t,e){let n=this._searchPossibleTargets(t,e);if(n&&Qh(n)&&n.interactive&&this.targets[0]){let i=this.targets;for(let s=i.length-1;s>0;s--){let o=i[s];if(!Qh(o)||!o.interactive)return o}return i[0]}return n}getViewportPoint(t){return this._pointer?this._pointer:this.getPointer(t,!0)}getScenePoint(t){return this._absolutePointer?this._absolutePointer:this.getPointer(t)}getPointer(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=this.upperCanvasEl,i=n.getBoundingClientRect(),s=t_(t),o=i.width||0,a=i.height||0;o&&a||(Rn in i&&ef in i&&(a=Math.abs(i.top-i.bottom)),Je in i&&Se in i&&(o=Math.abs(i.right-i.left))),this.calcOffset(),s.x=s.x-this._offset.left,s.y=s.y-this._offset.top,e||(s=Kr(s,void 0,this.viewportTransform));let c=this.getRetinaScaling();c!==1&&(s.x/=c,s.y/=c);let l=o===0||a===0?new Q(1,1):new Q(n.width/o,n.height/a);return s.multiply(l)}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=Ke(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){let t=this._activeObject;return Ko(t)?t.getObjects():t?[t]:[]}_fireSelectionEvents(t,e){let n=!1,i=!1,s=this.getActiveObjects(),o=[],a=[];t.forEach(c=>{s.includes(c)||(n=!0,c.fire("deselected",{e,target:c}),a.push(c))}),s.forEach(c=>{t.includes(c)||(n=!0,c.fire("selected",{e,target:c}),o.push(c))}),t.length>0&&s.length>0?(i=!0,n&&this.fire("selection:updated",{e,selected:o,deselected:a})):s.length>0?(i=!0,this.fire("selection:created",{e,selected:o})):t.length>0&&(i=!0,this.fire("selection:cleared",{e,deselected:a})),i&&(this._objectsToRender=void 0)}setActiveObject(t,e){let n=this.getActiveObjects(),i=this._setActiveObject(t,e);return this._fireSelectionEvents(n,e),i}_setActiveObject(t,e){let n=this._activeObject;return n!==t&&!(!this._discardActiveObject(e,t)&&this._activeObject)&&!t.onSelect({e})&&(this._activeObject=t,Ko(t)&&n!==t&&(t.set("canvas",this),t.setCoords()),!0)}_discardActiveObject(t,e){let n=this._activeObject;return!!n&&!n.onDeselect({e:t,object:e})&&(this._currentTransform&&this._currentTransform.target===n&&this.endCurrentTransform(t),this._activeObject=void 0,!0)}discardActiveObject(t){let e=this.getActiveObjects(),n=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[n]});let i=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),i}endCurrentTransform(t){let e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){let e=this._currentTransform,n=e.target,i={e:t,target:n,transform:e,action:e.action};n._scaling&&(n._scaling=!1),n.setCoords(),e.actionPerformed&&(this.fire("object:modified",i),n.fire("modified",i))}setViewportTransform(t){super.setViewportTransform(t);let e=this._activeObject;e&&e.setCoords()}destroy(){let t=this._activeObject;Ko(t)&&(t.removeAll(),t.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(t){let e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,n){let i=this._realizeGroupTransformOnObject(t),s=super._toObject(t,e,n);return t.set(i),s}_realizeGroupTransformOnObject(t){let{group:e}=t;if(e&&Ko(e)&&this._activeObject===e){let n=$s(t,["angle","flipX","flipY",Se,"scaleX","scaleY","skewX","skewY",Rn]);return e_(t,e.calcOwnMatrix()),n}return{}}_setSVGObject(t,e,n){let i=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,n),e.set(i)}};z(E0,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});var yf=class{constructor(t){z(this,"targets",[]),z(this,"__disposer",void 0);let e=()=>{let{hiddenTextarea:i}=t.getActiveObject()||{};i&&i.focus()},n=t.upperCanvasEl;n.addEventListener("click",e),this.__disposer=()=>n.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach(t=>{t.isEditing&&t.exitEditing()})}add(t){this.targets.push(t)}remove(t){this.unregister(t),Us(this.targets,t)}register(t){this.target=t}unregister(t){t===this.target&&(this.target=void 0)}onMouseMove(t){var e;!((e=this.target)===null||e===void 0)&&e.isEditing&&this.target.updateSelectionOnMouseMove(t)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}},hD=["target","oldTarget","fireCanvas","e"],ti={passive:!1},Zo=(r,t)=>{let e=r.getViewportPoint(t),n=r.getScenePoint(t);return{viewportPoint:e,scenePoint:n,pointer:e,absolutePointer:n}},Yr=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return r.addEventListener(...e)},gi=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return r.removeEventListener(...e)},uD={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}},er=class extends E0{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),z(this,"_isClick",void 0),z(this,"textEditingManager",new yf(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onDoubleClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(e=>{this[e]=this[e].bind(this)}),this.addOrRemove(Yr,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){let n=this.upperCanvasEl,i=this._getEventPrefix();t(KE(n),"resize",this._onResize),t(n,i+"down",this._onMouseDown),t(n,"".concat(i,"move"),this._onMouseMove,ti),t(n,"".concat(i,"out"),this._onMouseOut),t(n,"".concat(i,"enter"),this._onMouseEnter),t(n,"wheel",this._onMouseWheel),t(n,"contextmenu",this._onContextMenu),t(n,"dblclick",this._onDoubleClick),t(n,"dragstart",this._onDragStart),t(n,"dragend",this._onDragEnd),t(n,"dragover",this._onDragOver),t(n,"dragenter",this._onDragEnter),t(n,"dragleave",this._onDragLeave),t(n,"drop",this._onDrop),this.enablePointerEvents||t(n,"touchstart",this._onTouchStart,ti)}removeListeners(){this.addOrRemove(gi,"remove");let t=this._getEventPrefix(),e=ki(this.upperCanvasEl);gi(e,"".concat(t,"up"),this._onMouseUp),gi(e,"touchend",this._onTouchEnd,ti),gi(e,"".concat(t,"move"),this._onMouseMove,ti),gi(e,"touchmove",this._onMouseMove,ti)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){let e=this._hoveredTarget,n=U({e:t},Zo(this,t));this.fire("mouse:out",U(U({},n),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",U({},n)),this._hoveredTargets.forEach(i=>{this.fire("mouse:out",U(U({},n),{},{target:i})),i&&i.fire("mouseout",U({},n))}),this._hoveredTargets=[]}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",U({e:t},Zo(this,t))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){this._isClick=!1;let e=this.getActiveObject();if(e&&e.onDragStart(t)){this._dragSource=e;let n={e:t,target:e};return this.fire("dragstart",n),e.fire("dragstart",n),void Yr(this.upperCanvasEl,"drag",this._onDragProgress)}sf(t)}_renderDragEffects(t,e,n){let i=!1,s=this._dropTarget;s&&s!==e&&s!==n&&(s.clearContextTop(),i=!0),e?.clearContextTop(),n!==e&&n?.clearContextTop();let o=this.contextTop;o.save(),o.transform(...this.viewportTransform),e&&(o.save(),e.transform(o),e.renderDragSourceEffect(t),o.restore(),i=!0),n&&(o.save(),n.transform(o),n.renderDropTargetEffect(t),o.restore(),i=!0),o.restore(),i&&(this.contextTopDirty=!0)}_onDragEnd(t){let e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==Xn,n=e?this._activeObject:void 0,i={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:n};gi(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",i),this._dragSource&&this._dragSource.fire("dragend",i),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){let e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(t)),targets:[...this.targets]}}_onDragOver(t){let e="dragover",{target:n,targets:i}=this.findDragTargets(t),s=this._dragSource,o={e:t,target:n,subTargets:i,dragSource:s,canDrop:!1,dropTarget:void 0},a;this.fire(e,o),this._fireEnterLeaveEvents(n,o),n&&(n.canDrop(t)&&(a=n),n.fire(e,o));for(let c=0;c<i.length;c++){let l=i[c];l.canDrop(t)&&(a=l),l.fire(e,o)}this._renderDragEffects(t,s,a),this._dropTarget=a}_onDragEnter(t){let{target:e,targets:n}=this.findDragTargets(t),i={e:t,target:e,subTargets:n,dragSource:this._dragSource};this.fire("dragenter",i),this._fireEnterLeaveEvents(e,i)}_onDragLeave(t){let e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(t){let{target:e,targets:n}=this.findDragTargets(t),i=this._basicEventHandler("drop:before",U({e:t,target:e,subTargets:n,dragSource:this._dragSource},Zo(this,t)));i.didDrop=!1,i.dropTarget=void 0,this._basicEventHandler("drop",i),this.fire("drop:after",i)}_onContextMenu(t){let e=this.findTarget(t),n=this.targets||[],i=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:n});return this.stopContextMenu&&sf(t),this._basicEventHandler("contextmenu",i),!1}_onDoubleClick(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData()}getPointerId(t){let e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return t.isPrimary===!0||t.isPrimary!==!1&&(t.type==="touchend"&&t.touches.length===0||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(t){t.preventDefault(),this.mainTouchId===void 0&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();let e=this.upperCanvasEl,n=this._getEventPrefix(),i=ki(e);Yr(i,"touchend",this._onTouchEnd,ti),Yr(i,"touchmove",this._onMouseMove,ti),gi(e,"".concat(n,"down"),this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();let e=this.upperCanvasEl,n=this._getEventPrefix();gi(e,"".concat(n,"move"),this._onMouseMove,ti);let i=ki(e);Yr(i,"".concat(n,"up"),this._onMouseUp),Yr(i,"".concat(n,"move"),this._onMouseMove,ti)}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),delete this.mainTouchId;let e=this._getEventPrefix(),n=ki(this.upperCanvasEl);gi(n,"touchend",this._onTouchEnd,ti),gi(n,"touchmove",this._onMouseMove,ti),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{Yr(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();let e=this.upperCanvasEl,n=this._getEventPrefix();if(this._isMainEvent(t)){let i=ki(this.upperCanvasEl);gi(i,"".concat(n,"up"),this._onMouseUp),gi(i,"".concat(n,"move"),this._onMouseMove,ti),Yr(e,"".concat(n,"move"),this._onMouseMove,ti)}}_onMouseMove(t){let e=this.getActiveObject();!this.allowTouchScrolling&&(!e||!e.shouldStartDragging())&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){let e=this.getActiveObject();return!!e!=!!t||e&&t&&e!==t}__onMouseUp(t){var e;this._cacheTransformEventData(t),this._handleEvent(t,"up:before");let n=this._currentTransform,i=this._isClick,s=this._target,{button:o}=t;if(o)return(this.fireMiddleClick&&o===1||this.fireRightClick&&o===2)&&this._handleEvent(t,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);if(!this._isMainEvent(t))return;let a,c,l=!1;if(n&&(this._finalizeCurrentTransform(t),l=n.actionPerformed),!i){let h=s===this._activeObject;this.handleSelection(t),l||(l=this._shouldRender(s)||!h&&s===this._activeObject)}if(s){let h=s.findControl(this.getViewportPoint(t),s0(t)),{key:u,control:d}=h||{};if(c=u,s.selectable&&s!==this._activeObject&&s.activeOn==="up")this.setActiveObject(s,t),l=!0;else if(d){let x=d.getMouseUpHandler(t,s,d);x&&(a=this.getScenePoint(t),x.call(d,t,n,a.x,a.y))}s.isMoving=!1}if(n&&(n.target!==s||n.corner!==c)){let h=n.target&&n.target.controls[n.corner],u=h&&h.getMouseUpHandler(t,n.target,h);a=a||this.getScenePoint(t),u&&u.call(h,t,n,a.x,a.y)}this._setCursorFromEvent(t,s),this._handleEvent(t,"up"),this._groupSelector=null,this._currentTransform=null,s&&(s.__corner=void 0),l?this.requestRenderAll():i||(e=this._activeObject)!==null&&e!==void 0&&e.isEditing||this.renderTop()}_basicEventHandler(t,e){let{target:n,subTargets:i=[]}=e;this.fire(t,e),n&&n.fire(t,e);for(let s=0;s<i.length;s++)i[s]!==n&&i[s].fire(t,e);return e}_handleEvent(t,e){let n=this._target,i=this.targets||[],s=U(U({e:t,target:n,subTargets:i},Zo(this,t)),{},{transform:this._currentTransform},e==="up:before"||e==="up"?{isClick:this._isClick,currentTarget:this.findTarget(t),currentSubTargets:this.targets}:{});this.fire("mouse:".concat(e),s),n&&n.fire("mouse".concat(e),s);for(let o=0;o<i.length;o++)i[o]!==n&&i[o].fire("mouse".concat(e),s)}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());let e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){let e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){let e=this.getScenePoint(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target,{button:n}=t;if(n)return(this.fireMiddleClick&&n===1||this.fireRightClick&&n===2)&&this._handleEvent(t,"down"),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._isMainEvent(t)||this._currentTransform)return;let i=this._shouldRender(e),s=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,s=!0,i=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){let o=this.getScenePoint(t);this._groupSelector={x:o.x,y:o.y,deltaY:0,deltaX:0}}if(e){let o=e===this._activeObject;e.selectable&&e.activeOn==="down"&&this.setActiveObject(e,t);let a=e.findControl(this.getViewportPoint(t),s0(t));if(e===this._activeObject&&(a||!s)){this._setupCurrentTransform(t,e,o);let c=a?a.control:void 0,l=this.getScenePoint(t),h=c&&c.getMouseDownHandler(t,e,c);h&&h.call(c,t,this._currentTransform,l.x,l.y)}}i&&(this._objectsToRender=void 0),this._handleEvent(t,"down"),i&&this.requestRenderAll()}_resetTransformEventData(){this._target=void 0,this._pointer=void 0,this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getViewportPoint(t),this._absolutePointer=Kr(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}__onMouseMove(t){if(this._isClick=!1,this._handleEvent(t,"move:before"),this._cacheTransformEventData(t),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!this._isMainEvent(t))return;let e=this._groupSelector;if(e){let n=this.getScenePoint(t);e.deltaX=n.x-e.x,e.deltaY=n.y-e.y,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{let n=this.findTarget(t);this._setCursorFromEvent(t,n),this._fireOverOutEvents(t,n)}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData()}_fireOverOutEvents(t,e){let n=this._hoveredTarget,i=this._hoveredTargets,s=this.targets,o=Math.max(i.length,s.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:n,fireCanvas:!0});for(let a=0;a<o;a++)this.fireSyntheticInOutEvents("mouse",{e:t,target:s[a],oldTarget:i[a]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){let n=this._draggedoverTarget,i=this._hoveredTargets,s=this.targets,o=Math.max(i.length,s.length);this.fireSyntheticInOutEvents("drag",U(U({},e),{},{target:t,oldTarget:n,fireCanvas:!0}));for(let a=0;a<o;a++)this.fireSyntheticInOutEvents("drag",U(U({},e),{},{target:s[a],oldTarget:i[a]}));this._draggedoverTarget=t}fireSyntheticInOutEvents(t,e){let{target:n,oldTarget:i,fireCanvas:s,e:o}=e,a=ke(e,hD),{targetIn:c,targetOut:l,canvasIn:h,canvasOut:u}=uD[t],d=i!==n;if(i&&d){let x=U(U({},a),{},{e:o,target:i,nextTarget:n},Zo(this,o));s&&this.fire(u,x),i.fire(l,x)}if(n&&d){let x=U(U({},a),{},{e:o,target:n,previousTarget:i},Zo(this,o));s&&this.fire(h,x),n.fire(c,x)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){let e=this.getScenePoint(t),n=this._currentTransform,i=n.target,s=i.group?Kr(e,void 0,i.group.calcTransformMatrix()):e;n.shiftKey=t.shiftKey,n.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,n,s),n.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,n){let i=n.x,s=n.y,o=e.action,a=e.actionHandler,c=!1;a&&(c=a(t,e,i,s)),o==="drag"&&c&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||c}_setCursorFromEvent(t,e){if(!e)return void this.setCursor(this.defaultCursor);let n=e.hoverCursor||this.hoverCursor,i=Ko(this._activeObject)?this._activeObject:null,s=(!i||e.group!==i)&&e.findControl(this.getViewportPoint(t));if(s){let o=s.control;this.setCursor(o.cursorStyleHandler(t,o,e))}else e.subTargetCheck&&this.targets.concat().reverse().map(o=>{n=o.hoverCursor||n}),this.setCursor(n)}handleMultiSelection(t,e){let n=this._activeObject,i=Ko(n);if(n&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(n!==e||i)&&(i||!e.isDescendantOf(n)&&!n.isDescendantOf(e))&&!e.onSelect({e:t})&&!n.getActiveControl()){if(i){let s=n.getObjects();if(e===n){let o=this.getViewportPoint(t);if(!(e=this.searchPossibleTargets(s,o)||this.searchPossibleTargets(this._objects,o))||!e.selectable)return!1}e.group===n?(n.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],n.size()===1&&this._setActiveObject(n.item(0),t)):(n.multiSelectAdd(e),this._hoveredTarget=n,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(s,t)}else{n.exitEditing&&n.exitEditing();let s=new(St.getClass("ActiveSelection"))([],{canvas:this});s.multiSelectAdd(n,e),this._hoveredTarget=s,this._setActiveObject(s,t),this._fireSelectionEvents([n],t)}return!0}return!1}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;let{x:e,y:n,deltaX:i,deltaY:s}=this._groupSelector,o=new Q(e,n),a=o.add(new Q(i,s)),c=o.min(a),l=o.max(a).subtract(c),h=this.collectObjects({left:c.x,top:c.y,width:l.x,height:l.y},{includeIntersecting:!this.selectionFullyContained}),u=o.eq(a)?h[0]?[h[0]]:[]:h.length>1?h.filter(d=>!d.onSelect({e:t})).reverse():h;if(u.length===1)this.setActiveObject(u[0],t);else if(u.length>1){let d=St.getClass("ActiveSelection");this.setActiveObject(new d(u,{canvas:this}),t)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}},$_={x1:0,y1:0,x2:0,y2:0},dD=U(U({},$_),{},{r1:0,r2:0}),xD=/^(\d+\.\d+)%|(\d+)%$/;function Z_(r){return r&&xD.test(r)}function J_(r,t){let e=typeof r=="number"?r:typeof r=="string"?parseFloat(r)/(Z_(r)?100:1):NaN;return Ys(0,Jo(e,t),1)}var fD=/\s*;\s*/,pD=/\s*:\s*/;function mD(r,t){let e,n,i=r.getAttribute("style");if(i){let o=i.split(fD);o[o.length-1]===""&&o.pop();for(let a=o.length;a--;){let[c,l]=o[a].split(pD).map(h=>h.trim());c==="stop-color"?e=l:c==="stop-opacity"&&(n=l)}}let s=new Un(e||r.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:J_(r.getAttribute("offset"),0),color:s.toRgb(),opacity:Jo(parseFloat(n||r.getAttribute("stop-opacity")||""),1)*s.getAlpha()*t}}function gD(r,t){let e=[],n=r.getElementsByTagName("stop"),i=J_(t,1);for(let s=n.length;s--;)e.push(mD(n[s],i));return e}function K_(r){return r.nodeName==="linearGradient"||r.nodeName==="LINEARGRADIENT"?"linear":"radial"}function Q_(r){return r.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}function Pi(r,t){return r.getAttribute(t)}function vD(r,t){return function(e,n){let i,{width:s,height:o,gradientUnits:a}=n;return Object.keys(e).reduce((c,l)=>{let h=e[l];return h==="Infinity"?i=1:h==="-Infinity"?i=0:(i=typeof h=="string"?parseFloat(h):h,typeof h=="string"&&Z_(h)&&(i*=.01,a==="pixels"&&(l!=="x1"&&l!=="x2"&&l!=="r2"||(i*=s),l!=="y1"&&l!=="y2"||(i*=o)))),c[l]=i,c},{})}(K_(r)==="linear"?function(e){return{x1:Pi(e,"x1")||0,y1:Pi(e,"y1")||0,x2:Pi(e,"x2")||"100%",y2:Pi(e,"y2")||0}}(r):function(e){return{x1:Pi(e,"fx")||Pi(e,"cx")||"50%",y1:Pi(e,"fy")||Pi(e,"cy")||"50%",r1:0,x2:Pi(e,"cx")||"50%",y2:Pi(e,"cy")||"50%",r2:Pi(e,"r")||"50%"}}(r),U(U({},t),{},{gradientUnits:Q_(r)}))}var ta=class{constructor(t){let{type:e="linear",gradientUnits:n="pixels",coords:i={},colorStops:s=[],offsetX:o=0,offsetY:a=0,gradientTransform:c,id:l}=t;this.id=l?"".concat(l,"_").concat(is()):is(),this.type=e,this.gradientUnits=n,this.gradientTransform=c,this.offsetX=o,this.offsetY=a,this.coords=U(U({},this.type==="radial"?dD:$_),i),this.colorStops=s.slice()}addColorStop(t){for(let e in t){let n=new Un(t[e]);this.colorStops.push({offset:parseFloat(e),color:n.toRgb(),opacity:n.getAlpha()})}return this}toObject(t){return U(U({},$s(this,t)),{},{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(t){let{additionalTransform:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=[],i=this.gradientTransform?this.gradientTransform.concat():Nn.concat(),s=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",o=this.colorStops.map(u=>U({},u)).sort((u,d)=>u.offset-d.offset),a=-this.offsetX,c=-this.offsetY;var l;s==="objectBoundingBox"?(a/=t.width,c/=t.height):(a+=t.width/2,c+=t.height/2),(l=t)&&typeof l._renderPathCommands=="function"&&this.gradientUnits!=="percentage"&&(a-=t.pathOffset.x,c-=t.pathOffset.y),i[4]-=a,i[5]-=c;let h=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(s,'"'),'gradientTransform="'.concat(e?e+" ":"").concat(zc(i),'"'),""].join(" ");if(this.type==="linear"){let{x1:u,y1:d,x2:x,y2:m}=this.coords;n.push("<linearGradient ",h,' x1="',u,'" y1="',d,'" x2="',x,'" y2="',m,`">
`)}else if(this.type==="radial"){let{x1:u,y1:d,x2:x,y2:m,r1:g,r2:f}=this.coords,p=g>f;n.push("<radialGradient ",h,' cx="',p?u:x,'" cy="',p?d:m,'" r="',p?g:f,'" fx="',p?x:u,'" fy="',p?m:d,`">
`),p&&(o.reverse(),o.forEach(E=>{E.offset=1-E.offset}));let v=Math.min(g,f);if(v>0){let E=v/Math.max(g,f);o.forEach(C=>{C.offset+=E*(1-C.offset)})}}return o.forEach(u=>{let{color:d,offset:x,opacity:m}=u;n.push("<stop ",'offset="',100*x+"%",'" style="stop-color:',d,m!==void 0?";stop-opacity: "+m:";",`"/>
`)}),n.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),n.join("")}toLive(t){let e=this.coords,n=this.type==="linear"?t.createLinearGradient(e.x1,e.y1,e.x2,e.y2):t.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2);return this.colorStops.forEach(i=>{let{color:s,opacity:o,offset:a}=i;n.addColorStop(a,o!==void 0?new Un(s).setAlpha(o).toRgba():s)}),n}static fromObject(t){return Ut(this,null,function*(){return new this(t)})}static fromElement(t,e,n){let i=Q_(t),s=e._findCenterFromElement();return new this(U({id:t.getAttribute("id")||void 0,type:K_(t),coords:vD(t,{width:n.viewBoxWidth||n.width,height:n.viewBoxHeight||n.height}),colorStops:gD(t,n.opacity),gradientUnits:i,gradientTransform:vf(t.getAttribute("gradientTransform")||"")},i==="pixels"?{offsetX:e.width/2-s.x,offsetY:e.height/2-s.y}:{offsetX:0,offsetY:0}))}};z(ta,"type","Gradient"),St.setClass(ta,"gradient"),St.setClass(ta,"linear"),St.setClass(ta,"radial");var ED=["type","source"],Lc=class{get type(){return"pattern"}set type(t){es("warn","Setting type has no effect",t)}constructor(t){z(this,"repeat","repeat"),z(this,"offsetX",0),z(this,"offsetY",0),z(this,"crossOrigin",""),z(this,"patternTransform",null),this.id=is(),Object.assign(this,t)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&this.source.naturalWidth!==0&&this.source.naturalHeight!==0)?t.createPattern(this.source,this.repeat):null}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],{repeat:e,crossOrigin:n}=this;return U(U({},$s(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:n,offsetX:me(this.offsetX,ve.NUM_FRACTION_DIGITS),offsetY:me(this.offsetY,ve.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(t){let{width:e,height:n}=t,{source:i,repeat:s,id:o}=this,a=Jo(this.offsetX/e,0),c=Jo(this.offsetY/n,0),l=s==="repeat-y"||s==="no-repeat"?1+Math.abs(a||0):Jo(i.width/e,0),h=s==="repeat-x"||s==="no-repeat"?1+Math.abs(c||0):Jo(i.height/n,0);return['<pattern id="SVGID_'.concat(o,'" x="').concat(a,'" y="').concat(c,'" width="').concat(l,'" height="').concat(h,'">'),'<image x="0" y="0" width="'.concat(i.width,'" height="').concat(i.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static fromObject(t,e){return Ut(this,null,function*(){let{type:n,source:i}=t,s=ke(t,ED),o=yield Oc(i,U(U({},e),{},{crossOrigin:s.crossOrigin}));return new this(U(U({},s),{},{source:o}))})}};z(Lc,"type","Pattern"),St.setClass(Lc),St.setClass(Lc,"pattern");var _D=["path","left","top"],CD=["d"],Er=class extends Qe{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:n,left:i,top:s}=e;super(ke(e,_D)),this._setPath(t||[],!0),typeof i=="number"&&this.set(Se,i),typeof s=="number"&&this.set(Rn,s)}_setPath(t,e){this.path=V_(Array.isArray(t)?t:Y_(t)),this.setBoundingBox(e)}_findCenterFromElement(){let t=this._calcBoundsFromPath();return new Q(t.left+t.width/2,t.top+t.height/2)}_renderPathCommands(t){let e=-this.pathOffset.x,n=-this.pathOffset.y;t.beginPath();for(let i of this.path)switch(i[0]){case"L":t.lineTo(i[1]+e,i[2]+n);break;case"M":t.moveTo(i[1]+e,i[2]+n);break;case"C":t.bezierCurveTo(i[1]+e,i[2]+n,i[3]+e,i[4]+n,i[5]+e,i[6]+n);break;case"Q":t.quadraticCurveTo(i[1]+e,i[2]+n,i[3]+e,i[4]+n);break;case"Z":t.closePath()}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return U(U({},super.toObject(t)),{},{path:this.path.map(e=>e.slice())})}toDatalessObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e}_toSVG(){let t=q_(this.path,ve.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){let t=ve.NUM_FRACTION_DIGITS;return" translate(".concat(me(-this.pathOffset.x,t),", ").concat(me(-this.pathOffset.y,t),")")}toClipPathSVG(t){let e=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){let e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(t){let{width:e,height:n,pathOffset:i}=this._calcDimensions();this.set({width:e,height:n,pathOffset:i}),t&&this.setPositionByOrigin(i,ue,ue)}_calcBoundsFromPath(){let t=[],e=0,n=0,i=0,s=0;for(let o of this.path)switch(o[0]){case"L":i=o[1],s=o[2],t.push(new Q(e,n),new Q(i,s));break;case"M":i=o[1],s=o[2],e=i,n=s;break;case"C":t.push(..._f(i,s,o[1],o[2],o[3],o[4],o[5],o[6])),i=o[5],s=o[6];break;case"Q":t.push(..._f(i,s,o[1],o[2],o[1],o[2],o[3],o[4])),i=o[3],s=o[4];break;case"Z":i=e,s=n}return Qi(t)}_calcDimensions(){let t=this._calcBoundsFromPath();return U(U({},t),{},{pathOffset:new Q(t.left+t.width/2,t.top+t.height/2)})}static fromObject(t){return this._fromObject(t,{extraParam:"path"})}static fromElement(t,e,n){return Ut(this,null,function*(){let i=Ar(t,this.ATTRIBUTE_NAMES,n),{d:s}=i;return new this(s,U(U(U({},ke(i,CD)),e),{},{left:void 0,top:void 0}))})}};z(Er,"type","Path"),z(Er,"cacheProperties",[...yr,"path","fillRule"]),z(Er,"ATTRIBUTE_NAMES",[...ss,"d"]),St.setClass(Er),St.setSVGClass(Er);var yD=["left","top","radius"],t1=["radius","startAngle","endAngle","counterClockwise"],qr=class r extends Qe{static getDefaults(){return U(U({},super.getDefaults()),r.ownDefaults)}_set(t,e){return super._set(t,e),t==="radius"&&this.setRadius(e),this}_render(t){t.beginPath(),t.arc(0,0,this.radius,qe(this.startAngle),qe(this.endAngle),this.counterClockwise),this._renderPaintInOrder(t)}getRadiusX(){return this.get("radius")*this.get("scaleX")}getRadiusY(){return this.get("radius")*this.get("scaleY")}setRadius(t){this.radius=t,this.set({width:2*t,height:2*t})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...t1,...t])}_toSVG(){let t=(this.endAngle-this.startAngle)%360;if(t===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),`" />
`];{let{radius:e}=this,n=qe(this.startAngle),i=qe(this.endAngle),s=Ii(n)*e,o=Li(n)*e,a=Ii(i)*e,c=Li(i)*e,l=t>180?1:0,h=this.counterClockwise?0:1;return['<path d="M '.concat(s," ").concat(o," A ").concat(e," ").concat(e," 0 ").concat(l," ").concat(h," ").concat(a," ").concat(c,'" '),"COMMON_PARTS",` />
`]}}static fromElement(t,e,n){return Ut(this,null,function*(){let i=Ar(t,this.ATTRIBUTE_NAMES,n),{left:s=0,top:o=0,radius:a=0}=i;return new this(U(U({},ke(i,yD)),{},{radius:a,left:s-a,top:o-a}))})}static fromObject(t){return super._fromObject(t)}};z(qr,"type","Circle"),z(qr,"cacheProperties",[...yr,...t1]),z(qr,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),z(qr,"ATTRIBUTE_NAMES",["cx","cy","r",...ss]),St.setClass(qr),St.setSVGClass(qr);var AD=["x1","y1","x2","y2"],bD=["x1","y1","x2","y2"],Af=["x1","x2","y1","y2"],zs=class extends Qe{constructor(){let[t,e,n,i]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(U(U({},s),{},{x1:t,y1:e,x2:n,y2:i})),this._setWidthHeight();let{left:o,top:a}=s;typeof o=="number"&&this.set(Se,o),typeof a=="number"&&this.set(Rn,a)}_setWidthHeight(){let{x1:t,y1:e,x2:n,y2:i}=this;this.width=Math.abs(n-t),this.height=Math.abs(i-e);let{left:s,top:o,width:a,height:c}=Qi([{x:t,y:e},{x:n,y:i}]),l=new Q(s+a/2,o+c/2);this.setPositionByOrigin(l,ue,ue)}_set(t,e){return super._set(t,e),Af.includes(t)&&this._setWidthHeight(),this}_render(t){t.beginPath();let e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;let n=t.strokeStyle;var i;Ei(this.stroke)?t.strokeStyle=this.stroke.toLive(t):t.strokeStyle=(i=this.stroke)!==null&&i!==void 0?i:t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=n}_findCenterFromElement(){return new Q((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return U(U({},super.toObject(t)),this.calcLinePoints())}_getNonTransformedDimensions(){let t=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(t.y-=this.strokeWidth),this.height===0&&(t.x-=this.strokeWidth)),t}calcLinePoints(){let{x1:t,x2:e,y1:n,y2:i,width:s,height:o}=this,a=t<=e?-1:1,c=n<=i?-1:1;return{x1:a*s/2,x2:a*-s/2,y1:c*o/2,y2:c*-o/2}}_toSVG(){let{x1:t,x2:e,y1:n,y2:i}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(t,'" y1="').concat(n,'" x2="').concat(e,'" y2="').concat(i,`" />
`)]}static fromElement(t,e,n){return Ut(this,null,function*(){let i=Ar(t,this.ATTRIBUTE_NAMES,n),{x1:s=0,y1:o=0,x2:a=0,y2:c=0}=i;return new this([s,o,a,c],ke(i,AD))})}static fromObject(t){let{x1:e,y1:n,x2:i,y2:s}=t,o=ke(t,bD);return this._fromObject(U(U({},o),{},{points:[e,n,i,s]}),{extraParam:"points"})}};z(zs,"type","Line"),z(zs,"cacheProperties",[...yr,...Af]),z(zs,"ATTRIBUTE_NAMES",ss.concat(Af)),St.setClass(zs),St.setSVGClass(zs);var ea=class r extends Qe{static getDefaults(){return U(U({},super.getDefaults()),r.ownDefaults)}_render(t){let e=this.width/2,n=this.height/2;t.beginPath(),t.moveTo(-e,n),t.lineTo(0,-n),t.lineTo(e,n),t.closePath(),this._renderPaintInOrder(t)}_toSVG(){let t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />']}};z(ea,"type","Triangle"),z(ea,"ownDefaults",{width:100,height:100}),St.setClass(ea),St.setSVGClass(ea);var e1=["rx","ry"],$r=class r extends Qe{static getDefaults(){return U(U({},super.getDefaults()),r.ownDefaults)}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this}getRx(){return this.get("rx")*this.get("scaleX")}getRy(){return this.get("ry")*this.get("scaleY")}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...e1,...t])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,`" />
`)]}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,Cr,!1),t.restore(),this._renderPaintInOrder(t)}static fromElement(t,e,n){return Ut(this,null,function*(){let i=Ar(t,this.ATTRIBUTE_NAMES,n);return i.left=(i.left||0)-i.rx,i.top=(i.top||0)-i.ry,new this(i)})}};function wD(r){if(!r)return[];let t=r.replace(/,/g," ").trim().split(/\s+/),e=[];for(let n=0;n<t.length;n+=2)e.push({x:parseFloat(t[n]),y:parseFloat(t[n+1])});return e}z($r,"type","Ellipse"),z($r,"cacheProperties",[...yr,...e1]),z($r,"ownDefaults",{rx:0,ry:0}),z($r,"ATTRIBUTE_NAMES",[...ss,"cx","cy","rx","ry"]),St.setClass($r),St.setSVGClass($r);var SD=["left","top"],n1={exactBoundingBox:!1},Ri=class r extends Qe{static getDefaults(){return U(U({},super.getDefaults()),r.ownDefaults)}constructor(){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(U({points:arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]},t)),z(this,"strokeDiff",void 0);let{left:e,top:n}=t;this.initialized=!0,this.setBoundingBox(!0),typeof e=="number"&&this.set(Se,e),typeof n=="number"&&this.set(Rn,n)}isOpen(){return!0}_projectStrokeOnPoints(t){return F_(this.points,t,this.isOpen())}_calcDimensions(t){t=U({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},t||{});let e=this.exactBoundingBox?this._projectStrokeOnPoints(t).map(l=>l.projectedPoint):this.points;if(e.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new Q,strokeOffset:new Q,strokeDiff:new Q};let n=Qi(e),i=Xc(U(U({},t),{},{scaleX:1,scaleY:1})),s=Qi(this.points.map(l=>Pn(l,i,!0))),o=new Q(this.scaleX,this.scaleY),a=n.left+n.width/2,c=n.top+n.height/2;return this.exactBoundingBox&&(a-=c*Math.tan(qe(this.skewX)),c-=a*Math.tan(qe(this.skewY))),U(U({},n),{},{pathOffset:new Q(a,c),strokeOffset:new Q(s.left,s.top).subtract(new Q(n.left,n.top)).multiply(o),strokeDiff:new Q(n.width,n.height).subtract(new Q(s.width,s.height)).multiply(o)})}_findCenterFromElement(){let t=Qi(this.points);return new Q(t.left+t.width/2,t.top+t.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(t){let{left:e,top:n,width:i,height:s,pathOffset:o,strokeOffset:a,strokeDiff:c}=this._calcDimensions();this.set({width:i,height:s,pathOffset:o,strokeOffset:a,strokeDiff:c}),t&&this.setPositionByOrigin(new Q(e+i/2,n+s/2),ue,ue)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new Q(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.exactBoundingBox){let o;if(Object.keys(t).some(a=>this.strokeUniform||this.constructor.layoutProperties.includes(a))){var e,n;let{width:a,height:c}=this._calcDimensions(t);o=new Q((e=t.width)!==null&&e!==void 0?e:a,(n=t.height)!==null&&n!==void 0?n:c)}else{var i,s;o=new Q((i=t.width)!==null&&i!==void 0?i:this.width,(s=t.height)!==null&&s!==void 0?s:this.height)}return o.multiply(new Q(t.scaleX||this.scaleX,t.scaleY||this.scaleY))}return super._getTransformedDimensions(t)}_set(t,e){let n=this.initialized&&this[t]!==e,i=super._set(t,e);return this.exactBoundingBox&&n&&((t==="scaleX"||t==="scaleY")&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),i}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return U(U({},super.toObject(t)),{},{points:$c(this.points)})}_toSVG(){let t=[],e=this.pathOffset.x,n=this.pathOffset.y,i=ve.NUM_FRACTION_DIGITS;for(let s=0,o=this.points.length;s<o;s++)t.push(me(this.points[s].x-e,i),",",me(this.points[s].y-n,i)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),`" />
`)]}_render(t){let e=this.points.length,n=this.pathOffset.x,i=this.pathOffset.y;if(e&&!isNaN(this.points[e-1].y)){t.beginPath(),t.moveTo(this.points[0].x-n,this.points[0].y-i);for(let s=0;s<e;s++){let o=this.points[s];t.lineTo(o.x-n,o.y-i)}!this.isOpen()&&t.closePath(),this._renderPaintInOrder(t)}}complexity(){return this.points.length}static fromElement(t,e,n){return Ut(this,null,function*(){return new this(wD(t.getAttribute("points")),U(U({},ke(Ar(t,this.ATTRIBUTE_NAMES,n),SD)),e))})}static fromObject(t){return this._fromObject(t,{extraParam:"points"})}};z(Ri,"ownDefaults",n1),z(Ri,"type","Polyline"),z(Ri,"layoutProperties",["skewX","skewY","strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),z(Ri,"cacheProperties",[...yr,"points"]),z(Ri,"ATTRIBUTE_NAMES",[...ss]),St.setClass(Ri),St.setSVGClass(Ri);var na=class extends Ri{static getDefaults(){return U(U({},super.getDefaults()),Ri.ownDefaults)}isOpen(){return!1}};z(na,"ownDefaults",n1),z(na,"type","Polygon"),St.setClass(na),St.setSVGClass(na);var i1=["fontSize","fontWeight","fontFamily","fontStyle"],r1=["underline","overline","linethrough"],s1=[...i1,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],o1=[...s1,...r1,"textBackgroundColor","direction"],MD=[...i1,...r1,"stroke","strokeWidth","fill","deltaY","textBackgroundColor"],DD={_reNewline:Rf,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:Se,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:Se,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},Ji="justify",_0="justify-left",Nc="justify-right",Uc="justify-center",C0=class extends Qe{isEmptyStyles(t){if(!this.styles||t!==void 0&&!this.styles[t])return!0;let e=t===void 0?this.styles:{line:this.styles[t]};for(let n in e)for(let i in e[n])for(let s in e[n][i])return!1;return!0}styleHas(t,e){if(!this.styles||e!==void 0&&!this.styles[e])return!1;let n=e===void 0?this.styles:{0:this.styles[e]};for(let i in n)for(let s in n[i])if(n[i][s][t]!==void 0)return!0;return!1}cleanStyle(t){if(!this.styles)return!1;let e=this.styles,n,i,s=0,o=!0,a=0;for(let c in e){n=0;for(let l in e[c]){let h=e[c][l]||{};s++,h[t]!==void 0?(i?h[t]!==i&&(o=!1):i=h[t],h[t]===this[t]&&delete h[t]):o=!1,Object.keys(h).length!==0?n++:delete e[c][l]}n===0&&delete e[c]}for(let c=0;c<this._textLines.length;c++)a+=this._textLines[c].length;o&&s===a&&(this[t]=i,this.removeStyle(t))}removeStyle(t){if(!this.styles)return;let e=this.styles,n,i,s;for(i in e){for(s in n=e[i],n)delete n[s][t],Object.keys(n[s]).length===0&&delete n[s];Object.keys(n).length===0&&delete e[i]}}_extendStyles(t,e){let{lineIndex:n,charIndex:i}=this.get2DCursorLocation(t);this._getLineStyle(n)||this._setLineStyle(n);let s=Nf(U(U({},this._getStyleDeclaration(n,i)),e),o=>o!==void 0);this._setStyleDeclaration(n,i,s)}getSelectionStyles(t,e,n){let i=[];for(let s=t;s<(e||t);s++)i.push(this.getStyleAtPosition(s,n));return i}getStyleAtPosition(t,e){let{lineIndex:n,charIndex:i}=this.get2DCursorLocation(t);return e?this.getCompleteStyleDeclaration(n,i):this._getStyleDeclaration(n,i)}setSelectionStyles(t,e,n){for(let i=e;i<(n||e);i++)this._extendStyles(i,t);this._forceClearCache=!0}_getStyleDeclaration(t,e){var n;let i=this.styles&&this.styles[t];return i&&(n=i[e])!==null&&n!==void 0?n:{}}getCompleteStyleDeclaration(t,e){return U(U({},$s(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e))}_setStyleDeclaration(t,e,n){this.styles[t][e]=n}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}};z(C0,"_styleProperties",MD);var BD=/  +/g,TD=/"/g;function Yx(r,t,e,n,i){return"		".concat(function(s,o){let{left:a,top:c,width:l,height:h}=o,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ve.NUM_FRACTION_DIGITS,d=Vc("fill",s,!1),[x,m,g,f]=[a,c,l,h].map(p=>me(p,u));return"<rect ".concat(d,' x="').concat(x,'" y="').concat(m,'" width="').concat(g,'" height="').concat(f,'"></rect>')}(r,{left:t,top:e,width:n,height:i}),`
`)}var FD=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"],qx,Cn=class r extends C0{static getDefaults(){return U(U({},super.getDefaults()),r.ownDefaults)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(U(U({},e),{},{text:t,styles:e?.styles||{}})),z(this,"__charBounds",[]),this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){let t=this.path;t&&(t.segmentsInfo=Yf(t.path))}_splitText(){let t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(Ji)&&this.enlargeSpaces()}enlargeSpaces(){let t,e,n,i,s,o,a;for(let c=0,l=this._textLines.length;c<l;c++)if((this.textAlign===Ji||c!==l-1&&!this.isEndOfWrapping(c))&&(i=0,s=this._textLines[c],e=this.getLineWidth(c),e<this.width&&(a=this.textLines[c].match(this._reSpacesAndTabs)))){n=a.length,t=(this.width-e)/n;for(let h=0;h<=s.length;h++)o=this.__charBounds[c][h],this._reSpaceAndTab.test(s[h])?(o.width+=t,o.kernedWidth+=t,o.left+=i,i+=t):o.left+=i}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}get2DCursorLocation(t,e){let n=e?this._unwrappedTextLines:this._textLines,i;for(i=0;i<n.length;i++){if(t<=n[i].length)return{lineIndex:i,charIndex:t};t-=n[i].length+this.missingNewlineOffset(i,e)}return{lineIndex:i-1,charIndex:n[i-1].length<t?n[i-1].length:t}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){let t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){let e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){this.paintFirst==="stroke"?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,n){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case ue:t.textBaseline="middle";break;case"ascender":t.textBaseline=Rn;break;case"descender":t.textBaseline=ef}t.font=this._getFontDeclaration(e,n)}calcTextWidth(){let t=this.getLineWidth(0);for(let e=1,n=this._textLines.length;e<n;e++){let i=this.getLineWidth(e);i>t&&(t=i)}return t}_renderTextLine(t,e,n,i,s,o){this._renderChars(t,e,n,i,s,o)}_renderTextLinesBackground(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;let e=t.fillStyle,n=this._getLeftOffset(),i=this._getTopOffset();for(let s=0,o=this._textLines.length;s<o;s++){let a=this.getHeightOfLine(s);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",s)){i+=a;continue}let c=this._textLines[s].length,l=this._getLineLeftOffset(s),h,u,d=0,x=0,m=this.getValueOfPropertyAt(s,0,"textBackgroundColor");for(let g=0;g<c;g++){let f=this.__charBounds[s][g];u=this.getValueOfPropertyAt(s,g,"textBackgroundColor"),this.path?(t.save(),t.translate(f.renderLeft,f.renderTop),t.rotate(f.angle),t.fillStyle=u,u&&t.fillRect(-f.width/2,-a/this.lineHeight*(1-this._fontSizeFraction),f.width,a/this.lineHeight),t.restore()):u!==m?(h=n+l+x,this.direction==="rtl"&&(h=this.width-h-d),t.fillStyle=m,m&&t.fillRect(h,i,d,a/this.lineHeight),x=f.left,d=f.width,m=u):d+=f.kernedWidth}u&&!this.path&&(h=n+l+x,this.direction==="rtl"&&(h=this.width-h-d),t.fillStyle=u,t.fillRect(h,i,d,a/this.lineHeight)),i+=a}t.fillStyle=e,this._removeShadow(t)}_measureChar(t,e,n,i){let s=Rc.getFontCache(e),o=this._getFontDeclaration(e),a=n+t,c=n&&o===this._getFontDeclaration(i),l=e.fontSize/this.CACHE_FONT_SIZE,h,u,d,x;if(n&&s[n]!==void 0&&(d=s[n]),s[t]!==void 0&&(x=h=s[t]),c&&s[a]!==void 0&&(u=s[a],x=u-d),h===void 0||d===void 0||u===void 0){let m=function(){if(!qx){let g=Ke();g.width=g.height=0,qx=g.getContext("2d")}return qx}();this._setTextStyles(m,e,!0),h===void 0&&(x=h=m.measureText(t).width,s[t]=h),d===void 0&&c&&n&&(d=m.measureText(n).width,s[n]=d),c&&u===void 0&&(u=m.measureText(a).width,s[a]=u,x=u-d)}return{width:h*l,kernedWidth:x*l}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){let e=this._measureLine(t);return this.charSpacing!==0&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){let e,n,i=0,s=this.pathSide===Je,o=this.path,a=this._textLines[t],c=a.length,l=new Array(c);this.__charBounds[t]=l;for(let h=0;h<c;h++){let u=a[h];n=this._getGraphemeBox(u,t,h,e),l[h]=n,i+=n.kernedWidth,e=u}if(l[c]={left:n?n.left+n.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},o&&o.segmentsInfo){let h=0,u=o.segmentsInfo[o.segmentsInfo.length-1].length;switch(this.textAlign){case Se:h=s?u-i:0;break;case ue:h=(u-i)/2;break;case Je:h=s?0:u-i}h+=this.pathStartOffset*(s?-1:1);for(let d=s?c-1:0;s?d>=0:d<c;s?d--:d++)n=l[d],h>u?h%=u:h<0&&(h+=u),this._setGraphemeOnPath(h,n),h+=n.kernedWidth}return{width:i,numOfSpaces:0}}_setGraphemeOnPath(t,e){let n=t+e.kernedWidth/2,i=this.path,s=X_(i.path,n,i.segmentsInfo);e.renderLeft=s.x-i.pathOffset.x,e.renderTop=s.y-i.pathOffset.y,e.angle=s.angle+(this.pathSide===Je?Math.PI:0)}_getGraphemeBox(t,e,n,i,s){let o=this.getCompleteStyleDeclaration(e,n),a=i?this.getCompleteStyleDeclaration(e,n-1):{},c=this._measureChar(t,o,i,a),l,h=c.kernedWidth,u=c.width;this.charSpacing!==0&&(l=this._getWidthOfCharSpacing(),u+=l,h+=l);let d={width:u,left:0,height:o.fontSize,kernedWidth:h,deltaY:o.deltaY};if(n>0&&!s){let x=this.__charBounds[e][n-1];d.left=x.left+x.width+c.kernedWidth-c.width}return d}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];let e=this.getHeightOfChar(t,0);for(let n=1,i=this._textLines[t].length;n<i;n++)e=Math.max(this.getHeightOfChar(t,n),e);return this.__lineHeights[t]=e*this.lineHeight*this._fontSizeMult}calcTextHeight(){let t,e=0;for(let n=0,i=this._textLines.length;n<i;n++)t=this.getHeightOfLine(n),e+=n===i-1?t/this.lineHeight:t;return e}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();let n=0,i=this._getLeftOffset(),s=this._getTopOffset();for(let o=0,a=this._textLines.length;o<a;o++){let c=this.getHeightOfLine(o),l=c/this.lineHeight,h=this._getLineLeftOffset(o);this._renderTextLine(e,t,this._textLines[o],i+h,s+n+l,o),n+=c}t.restore()}_renderTextFill(t){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,n,i,s,o){let a=this.getHeightOfLine(o),c=this.textAlign.includes(Ji),l=this.path,h=!c&&this.charSpacing===0&&this.isEmptyStyles(o)&&!l,u=this.direction==="ltr",d=this.direction==="ltr"?1:-1,x=e.direction,m,g,f,p,v,E="",C=0;if(e.save(),x!==this.direction&&(e.canvas.setAttribute("dir",u?"ltr":"rtl"),e.direction=u?"ltr":"rtl",e.textAlign=u?Se:Je),s-=a*this._fontSizeFraction/this.lineHeight,h)return this._renderChar(t,e,o,0,n.join(""),i,s),void e.restore();for(let b=0,A=n.length-1;b<=A;b++)p=b===A||this.charSpacing||l,E+=n[b],f=this.__charBounds[o][b],C===0?(i+=d*(f.kernedWidth-f.width),C+=f.width):C+=f.kernedWidth,c&&!p&&this._reSpaceAndTab.test(n[b])&&(p=!0),p||(m=m||this.getCompleteStyleDeclaration(o,b),g=this.getCompleteStyleDeclaration(o,b+1),p=R0(m,g,!1)),p&&(l?(e.save(),e.translate(f.renderLeft,f.renderTop),e.rotate(f.angle),this._renderChar(t,e,o,b,E,-C/2,0),e.restore()):(v=i,this._renderChar(t,e,o,b,E,v,s)),E="",m=g,i+=d*C,C=0);e.restore()}_applyPatternGradientTransformText(t){let e=Ke(),n=this.width+this.strokeWidth,i=this.height+this.strokeWidth,s=e.getContext("2d");return e.width=n,e.height=i,s.beginPath(),s.moveTo(0,0),s.lineTo(n,0),s.lineTo(n,i),s.lineTo(0,i),s.closePath(),s.translate(n/2,i/2),s.fillStyle=t.toLive(s),this._applyPatternGradientTransform(s,t),s.fill(),s.createPattern(e,"no-repeat")}handleFiller(t,e,n){let i,s;return Ei(n)?n.gradientUnits==="percentage"||n.gradientTransform||n.patternTransform?(i=-this.width/2,s=-this.height/2,t.translate(i,s),t[e]=this._applyPatternGradientTransformText(n),{offsetX:i,offsetY:s}):(t[e]=n.toLive(t),this._applyPatternGradientTransform(t,n)):(t[e]=n,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){let{stroke:n,strokeWidth:i}=e;return t.lineWidth=i,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",n)}_setFillStyles(t,e){let{fill:n}=e;return this.handleFiller(t,"fillStyle",n)}_renderChar(t,e,n,i,s,o,a){let c=this._getStyleDeclaration(n,i),l=this.getCompleteStyleDeclaration(n,i),h=t==="fillText"&&l.fill,u=t==="strokeText"&&l.stroke&&l.strokeWidth;if(u||h){if(e.save(),e.font=this._getFontDeclaration(l),c.textBackgroundColor&&this._removeShadow(e),c.deltaY&&(a+=c.deltaY),h){let d=this._setFillStyles(e,l);e.fillText(s,o-d.offsetX,a-d.offsetY)}if(u){let d=this._setStrokeStyles(e,l);e.strokeText(s,o-d.offsetX,a-d.offsetY)}e.restore()}}setSuperscript(t,e){this._setScript(t,e,this.superscript)}setSubscript(t,e){this._setScript(t,e,this.subscript)}_setScript(t,e,n){let i=this.get2DCursorLocation(t,!0),s=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"fontSize"),o=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"deltaY"),a={fontSize:s*n.size,deltaY:o+s*n.baseline};this.setSelectionStyles(a,t,e)}_getLineLeftOffset(t){let e=this.getLineWidth(t),n=this.width-e,i=this.textAlign,s=this.direction,o=this.isEndOfWrapping(t),a=0;return i===Ji||i===Uc&&!o||i===Nc&&!o||i===_0&&!o?0:(i===ue&&(a=n/2),i===Je&&(a=n),i===Uc&&(a=n/2),i===Nc&&(a=n),s==="rtl"&&(i===Je||i===Ji||i===Nc?a=0:i===Se||i===_0?a=-n:i!==ue&&i!==Uc||(a=-n/2)),a)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(t){if(this.__lineWidths[t]!==void 0)return this.__lineWidths[t];let{width:e}=this.measureLine(t);return this.__lineWidths[t]=e,e}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,n){var i;return(i=this._getStyleDeclaration(t,e)[n])!==null&&i!==void 0?i:this[n]}_renderTextDecoration(t,e){if(!this[e]&&!this.styleHas(e))return;let n=this._getTopOffset(),i=this._getLeftOffset(),s=this.path,o=this._getWidthOfCharSpacing(),a=this.offsets[e];for(let c=0,l=this._textLines.length;c<l;c++){let h=this.getHeightOfLine(c);if(!this[e]&&!this.styleHas(e,c)){n+=h;continue}let u=this._textLines[c],d=h/this.lineHeight,x=this._getLineLeftOffset(c),m,g,f=0,p=0,v=this.getValueOfPropertyAt(c,0,e),E=this.getValueOfPropertyAt(c,0,"fill"),C=n+d*(1-this._fontSizeFraction),b=this.getHeightOfChar(c,0),A=this.getValueOfPropertyAt(c,0,"deltaY");for(let S=0,_=u.length;S<_;S++){let y=this.__charBounds[c][S];m=this.getValueOfPropertyAt(c,S,e),g=this.getValueOfPropertyAt(c,S,"fill");let D=this.getHeightOfChar(c,S),F=this.getValueOfPropertyAt(c,S,"deltaY");if(s&&m&&g)t.save(),t.fillStyle=E,t.translate(y.renderLeft,y.renderTop),t.rotate(y.angle),t.fillRect(-y.kernedWidth/2,a*D+F,y.kernedWidth,this.fontSize/15),t.restore();else if((m!==v||g!==E||D!==b||F!==A)&&p>0){let T=i+x+f;this.direction==="rtl"&&(T=this.width-T-p),v&&E&&(t.fillStyle=E,t.fillRect(T,C+a*b+A,p,this.fontSize/15)),f=y.left,p=y.width,v=m,E=g,b=D,A=F}else p+=y.kernedWidth}let w=i+x+f;this.direction==="rtl"&&(w=this.width-w-p),t.fillStyle=g,m&&g&&t.fillRect(w,C+a*b+A,p-o,this.fontSize/15),n+=h}this._removeShadow(t)}_getFontDeclaration(){let{fontFamily:t=this.fontFamily,fontStyle:e=this.fontStyle,fontWeight:n=this.fontWeight,fontSize:i=this.fontSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0,o=t.includes("'")||t.includes('"')||t.includes(",")||r.genericFonts.includes(t.toLowerCase())?t:'"'.concat(t,'"');return[e,n,"".concat(s?this.CACHE_FONT_SIZE:i,"px"),o].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)))}graphemeSplit(t){return P0(t)}_splitTextIntoLines(t){let e=t.split(this._reNewline),n=new Array(e.length),i=[`
`],s=[];for(let o=0;o<e.length;o++)n[o]=this.graphemeSplit(e[o]),s=s.concat(n[o],i);return s.pop(),{_unwrappedLines:n,lines:e,graphemeText:s,graphemeLines:n}}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return U(U({},super.toObject([...o1,...t])),{},{styles:R_(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(t,e){let{textLayoutProperties:n}=this.constructor;super.set(t,e);let i=!1,s=!1;if(typeof t=="object")for(let o in t)o==="path"&&this.setPathInfo(),i=i||n.includes(o),s=s||o==="path";else i=n.includes(t),s=t==="path";return s&&this.setPathInfo(),i&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static fromElement(t,e,n){return Ut(this,null,function*(){let i=Ar(t,r.ATTRIBUTE_NAMES,n),s=U(U({},e),i),{textAnchor:o=Se,textDecoration:a="",dx:c=0,dy:l=0,top:h=0,left:u=0,fontSize:d=Pf,strokeWidth:x=1}=s,m=ke(s,FD),g=new this((t.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),U({left:u+c,top:h+l,underline:a.includes("underline"),overline:a.includes("overline"),linethrough:a.includes("line-through"),strokeWidth:0,fontSize:d},m)),f=g.getScaledHeight()/g.height,p=((g.height+g.strokeWidth)*g.lineHeight-g.height)*f,v=g.getScaledHeight()+p,E=0;return o===ue&&(E=g.getScaledWidth()/2),o===Je&&(E=g.getScaledWidth()),g.set({left:g.left-E,top:g.top-(v-g.fontSize*(.07+g._fontSizeFraction))/g.lineHeight,strokeWidth:x}),g})}static fromObject(t){return this._fromObject(U(U({},t),{},{styles:k_(t.styles||{},t.text)}),{extraParam:"text"})}};z(Cn,"textLayoutProperties",s1),z(Cn,"cacheProperties",[...yr,...o1]),z(Cn,"ownDefaults",DD),z(Cn,"type","Text"),z(Cn,"genericFonts",["sans-serif","serif","cursive","fantasy","monospace"]),z(Cn,"ATTRIBUTE_NAMES",ss.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),B_(Cn,[class extends a0{_toSVG(){let r=this._getSVGLeftTopOffsets(),t=this._getSVGTextAndBg(r.textTop,r.textLeft);return this._wrapSVGTextAndBg(t)}toSVG(r){return this._createBaseSVGMarkup(this._toSVG(),{reviver:r,noStyle:!0,withShadow:!0})}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(r){let{textBgRects:t,textSpans:e}=r,n=this.getSvgTextDecoration(this);return[t.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(TD,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",n?'text-decoration="'.concat(n,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",e.join(""),`</text>
`]}_getSVGTextAndBg(r,t){let e=[],n=[],i,s=r;this.backgroundColor&&n.push(...Yx(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let o=0,a=this._textLines.length;o<a;o++)i=this._getLineLeftOffset(o),this.direction==="rtl"&&(i+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(n,o,t+i,s),this._setSVGTextLineText(e,o,t+i,s),s+=this.getHeightOfLine(o);return{textSpans:e,textBgRects:n}}_createTextCharSpan(r,t,e,n){let i=this.getSvgSpanStyles(t,r!==r.trim()||!!r.match(BD)),s=i?'style="'.concat(i,'"'):"",o=t.deltaY,a=o?' dy="'.concat(me(o,ve.NUM_FRACTION_DIGITS),'" '):"";return'<tspan x="'.concat(me(e,ve.NUM_FRACTION_DIGITS),'" y="').concat(me(n,ve.NUM_FRACTION_DIGITS),'" ').concat(a).concat(s,">").concat(P_(r),"</tspan>")}_setSVGTextLineText(r,t,e,n){let i=this.getHeightOfLine(t),s=this.textAlign.includes(Ji),o=this._textLines[t],a,c,l,h,u,d="",x=0;n+=i*(1-this._fontSizeFraction)/this.lineHeight;for(let m=0,g=o.length-1;m<=g;m++)u=m===g||this.charSpacing,d+=o[m],l=this.__charBounds[t][m],x===0?(e+=l.kernedWidth-l.width,x+=l.width):x+=l.kernedWidth,s&&!u&&this._reSpaceAndTab.test(o[m])&&(u=!0),u||(a=a||this.getCompleteStyleDeclaration(t,m),c=this.getCompleteStyleDeclaration(t,m+1),u=R0(a,c,!0)),u&&(h=this._getStyleDeclaration(t,m),r.push(this._createTextCharSpan(d,h,e,n)),d="",a=c,this.direction==="rtl"?e-=x:e+=x,x=0)}_setSVGTextLineBg(r,t,e,n){let i=this._textLines[t],s=this.getHeightOfLine(t)/this.lineHeight,o,a=0,c=0,l=this.getValueOfPropertyAt(t,0,"textBackgroundColor");for(let h=0;h<i.length;h++){let{left:u,width:d,kernedWidth:x}=this.__charBounds[t][h];o=this.getValueOfPropertyAt(t,h,"textBackgroundColor"),o!==l?(l&&r.push(...Yx(l,e+c,n,a,s)),c=u,a=d,l=o):a+=x}o&&r.push(...Yx(l,e+c,n,a,s))}_getSVGLineTopOffset(r){let t,e=0;for(t=0;t<r;t++)e+=this.getHeightOfLine(t);let n=this.getHeightOfLine(t);return{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*n/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(r){return"".concat(super.getSvgStyles(r)," white-space: pre;")}getSvgSpanStyles(r,t){let{fontFamily:e,strokeWidth:n,stroke:i,fill:s,fontSize:o,fontStyle:a,fontWeight:c,deltaY:l}=r,h=this.getSvgTextDecoration(r);return[i?Vc("stroke",i):"",n?"stroke-width: ".concat(n,"; "):"",e?"font-family: ".concat(e.includes("'")||e.includes('"')?e:"'".concat(e,"'"),"; "):"",o?"font-size: ".concat(o,"px; "):"",a?"font-style: ".concat(a,"; "):"",c?"font-weight: ".concat(c,"; "):"",h&&"text-decoration: ".concat(h,"; "),s?Vc("fill",s):"",l?"baseline-shift: ".concat(-l,"; "):"",t?"white-space: pre; ":""].join("")}getSvgTextDecoration(r){return["overline","underline","line-through"].filter(t=>r[t.replace("-","")]).join(" ")}}]),St.setClass(Cn),St.setSVGClass(Cn);var bf=class{constructor(t){z(this,"target",void 0),z(this,"__mouseDownInPlace",!1),z(this,"__dragStartFired",!1),z(this,"__isDraggingOver",!1),z(this,"__dragStartSelection",void 0),z(this,"__dragImageDisposer",void 0),z(this,"_dispose",void 0),this.target=t;let e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach(n=>n()),this._dispose=void 0}}isPointerOverSelection(t){let e=this.target,n=e.getSelectionStartFromPointer(t);return e.isEditing&&n>=e.selectionStart&&n<=e.selectionEnd&&e.selectionStart<e.selectionEnd}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t)}isActive(){return this.__mouseDownInPlace}end(t){let e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e}getDragStartSelection(){return this.__dragStartSelection}setDragImage(t,e){var n;let{selectionStart:i,selectionEnd:s}=e,o=this.target,a=o.canvas,c=new Q(o.flipX?-1:1,o.flipY?-1:1),l=o._getCursorBoundaries(i),h=new Q(l.left+l.leftOffset,l.top+l.topOffset).multiply(c).transform(o.calcTransformMatrix()),u=a.getScenePoint(t).subtract(h),d=o.getCanvasRetinaScaling(),x=o.getBoundingRect(),m=h.subtract(new Q(x.left,x.top)),g=a.viewportTransform,f=m.add(u).transform(g,!0),p=o.backgroundColor,v=$c(o.styles);o.backgroundColor="";let E={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};o.setSelectionStyles(E,0,i),o.setSelectionStyles(E,s,o.text.length),o.dirty=!0;let C=o.toCanvasElement({enableRetinaScaling:a.enableRetinaScaling,viewportTransform:!0});o.backgroundColor=p,o.styles=v,o.dirty=!0,Ic(C,{position:"fixed",left:"".concat(-C.width,"px"),border:Xn,width:"".concat(C.width/d,"px"),height:"".concat(C.height/d,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{C.remove()},ki(t.target||this.target.hiddenTextarea).body.appendChild(C),(n=t.dataTransfer)===null||n===void 0||n.setDragImage(C,f.x,f.y)}onDragStart(t){this.__dragStartFired=!0;let e=this.target,n=this.isActive();if(n&&t.dataTransfer){let i=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},s=e._text.slice(i.selectionStart,i.selectionEnd).join(""),o=U({text:e.text,value:s},i);t.dataTransfer.setData("text/plain",s),t.dataTransfer.setData("application/fabric",JSON.stringify({value:s,styles:e.getSelectionStyles(i.selectionStart,i.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,o)}return e.abortCursorAnimation(),n}canDrop(t){if(this.target.editable&&!this.target.getActiveControl()&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){let e=this.target.getSelectionStartFromPointer(t),n=this.__dragStartSelection;return e<n.selectionStart||e>n.selectionEnd}return!0}return!1}targetCanDrop(t){return this.target.canDrop(t)}dragEnterHandler(t){let{e}=t,n=this.targetCanDrop(e);!this.__isDraggingOver&&n&&(this.__isDraggingOver=!0)}dragOverHandler(t){let{e}=t,n=this.targetCanDrop(e);!this.__isDraggingOver&&n?this.__isDraggingOver=!0:this.__isDraggingOver&&!n&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(t){var e;let{e:n}=t,i=n.defaultPrevented;this.__isDraggingOver=!1,n.preventDefault();let s=(e=n.dataTransfer)===null||e===void 0?void 0:e.getData("text/plain");if(s&&!i){let o=this.target,a=o.canvas,c=o.getSelectionStartFromPointer(n),{styles:l}=n.dataTransfer.types.includes("application/fabric")?JSON.parse(n.dataTransfer.getData("application/fabric")):{},h=s[Math.max(0,s.length-1)],u=0;if(this.__dragStartSelection){let d=this.__dragStartSelection.selectionStart,x=this.__dragStartSelection.selectionEnd;c>d&&c<=x?c=d:c>x&&(c-=x-d),o.removeChars(d,x),delete this.__dragStartSelection}o._reNewline.test(h)&&(o._reNewline.test(o._text[c])||c===o._text.length)&&(s=s.trimEnd()),t.didDrop=!0,t.dropTarget=o,o.insertChars(s,l,c),a.setActiveObject(o),o.enterEditing(n),o.selectionStart=Math.min(c+u,o._text.length),o.selectionEnd=Math.min(o.selectionStart+s.length,o._text.length),o.hiddenTextarea.value=o.text,o._updateTextarea(),o.hiddenTextarea.focus(),o.fire("changed",{index:c+u,action:"drop"}),a.fire("text:changed",{target:o}),a.contextTopDirty=!0,a.requestRenderAll()}}dragEndHandler(t){let{e}=t;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var n;let i=this.target,s=this.target.canvas,{selectionStart:o,selectionEnd:a}=this.__dragStartSelection,c=((n=e.dataTransfer)===null||n===void 0?void 0:n.dropEffect)||Xn;c===Xn?(i.selectionStart=o,i.selectionEnd=a,i._updateTextarea(),i.hiddenTextarea.focus()):(i.clearContextTop(),c==="move"&&(i.removeChars(o,a),i.selectionStart=i.selectionEnd=o,i.hiddenTextarea&&(i.hiddenTextarea.value=i.text),i._updateTextarea(),i.fire("changed",{index:o,action:"dragend"}),s.fire("text:changed",{target:i}),s.requestRenderAll()),i.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}},NE=/[ \n\.,;!\?\-]/,wf=class extends Cn{constructor(){super(...arguments),z(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t)}_animateCursor(t){let{toValue:e,duration:n,delay:i,onComplete:s}=t;return zf({startValue:this._currentCursorOpacity,endValue:e,duration:n,delay:i,onComplete:s,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:o=>{this._currentCursorOpacity=o,this.renderCursorOrSelection()}})}_tick(t){this._currentTickState=this._animateCursor({toValue:1,duration:this.cursorDuration,delay:t,onComplete:this._onTickComplete})}_onTickComplete(){var t;(t=this._currentTickCompleteState)===null||t===void 0||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:100,onComplete:this._tick})}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay)}abortCursorAnimation(){let t=!1;[this._currentTickState,this._currentTickCompleteState].forEach(e=>{e&&!e.isDone()&&(t=!0,e.abort())}),this._currentCursorOpacity=1,t&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(t=>!t||t.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(t){let e=0,n=t-1;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)e++,n--;for(;/\S/.test(this._text[n])&&n>-1;)e++,n--;return t-e}findWordBoundaryRight(t){let e=0,n=t;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)e++,n++;for(;/\S/.test(this._text[n])&&n<this._text.length;)e++,n++;return t+e}findLineBoundaryLeft(t){let e=0,n=t-1;for(;!/\n/.test(this._text[n])&&n>-1;)e++,n--;return t-e}findLineBoundaryRight(t){let e=0,n=t;for(;!/\n/.test(this._text[n])&&n<this._text.length;)e++,n++;return t+e}searchWordBoundary(t,e){let n=this._text,i=t>0&&this._reSpace.test(n[t])&&(e===-1||!Rf.test(n[t-1]))?t-1:t,s=n[i];for(;i>0&&i<n.length&&!NE.test(s);)i+=e,s=n[i];return e===-1&&NE.test(s)&&i++,i}selectWord(t){t=t||this.selectionStart;let e=this.searchWordBoundary(t,-1),n=Math.max(e,this.searchWordBoundary(t,1));this.selectionStart=e,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(t){t=t||this.selectionStart;let e=this.findLineBoundaryLeft(t),n=this.findLineBoundaryRight(t);return this.selectionStart=e,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea(),this}enterEditing(t){!this.isEditing&&this.editable&&(this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered",t?{e:t}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()))}updateSelectionOnMouseMove(t){if(this.getActiveControl())return;let e=this.hiddenTextarea;ki(e).activeElement!==e&&e.focus();let n=this.getSelectionStartFromPointer(t),i=this.selectionStart,s=this.selectionEnd;(n===this.__selectionStartOnMouseDown&&i!==s||i!==n&&s!==n)&&(n>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=n):(this.selectionStart=n,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===s||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(t,e,n){let i=n.slice(0,t),s=this.graphemeSplit(i).length;if(t===e)return{selectionStart:s,selectionEnd:s};let o=n.slice(t,e);return{selectionStart:s,selectionEnd:s+this.graphemeSplit(o).length}}fromGraphemeToStringSelection(t,e,n){let i=n.slice(0,t).join("").length;return t===e?{selectionStart:i,selectionEnd:i}:{selectionStart:i,selectionEnd:i+n.slice(t,e).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){let t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};let t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();let e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){let t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};let t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),n=this.get2DCursorLocation(t),i=n.lineIndex,s=n.charIndex,o=this.getValueOfPropertyAt(i,s,"fontSize")*this.lineHeight,a=e.leftOffset,c=this.getCanvasRetinaScaling(),l=this.canvas.upperCanvasEl,h=l.width/c,u=l.height/c,d=h-o,x=u-o,m=new Q(e.left+a,e.top+e.topOffset+o).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new Q(l.clientWidth/h,l.clientHeight/u));return m.x<0&&(m.x=0),m.x>d&&(m.x=d),m.y<0&&(m.y=0),m.y>x&&(m.y=x),m.x+=this.canvas._offset.left,m.y+=this.canvas._offset.top,{left:"".concat(m.x,"px"),top:"".concat(m.y,"px"),fontSize:"".concat(o,"px"),charHeight:o}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){let t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditing(){let t=this._textBeforeEdit!==this.text;return this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(let t in this.styles)this._textLines[t]||delete this.styles[t]}removeStyleFromTo(t,e){let{lineIndex:n,charIndex:i}=this.get2DCursorLocation(t,!0),{lineIndex:s,charIndex:o}=this.get2DCursorLocation(e,!0);if(n!==s){if(this.styles[n])for(let a=i;a<this._unwrappedTextLines[n].length;a++)delete this.styles[n][a];if(this.styles[s])for(let a=o;a<this._unwrappedTextLines[s].length;a++){let c=this.styles[s][a];c&&(this.styles[n]||(this.styles[n]={}),this.styles[n][i+a-o]=c)}for(let a=n+1;a<=s;a++)delete this.styles[a];this.shiftLineStyles(s,n-s)}else if(this.styles[n]){let a=this.styles[n],c=o-i;for(let l=i;l<o;l++)delete a[l];for(let l in this.styles[n]){let h=parseInt(l,10);h>=o&&(a[h-c]=a[l],delete a[l])}}}shiftLineStyles(t,e){let n=Object.assign({},this.styles);for(let i in this.styles){let s=parseInt(i,10);s>t&&(this.styles[s+e]=n[s],n[s-e]||delete this.styles[s])}}insertNewlineStyleObject(t,e,n,i){let s={},o=this._unwrappedTextLines[t].length,a=o===e,c=!1;n||(n=1),this.shiftLineStyles(t,n);let l=this.styles[t]?this.styles[t][e===0?e:e-1]:void 0;for(let u in this.styles[t]){let d=parseInt(u,10);d>=e&&(c=!0,s[d-e]=this.styles[t][u],a&&e===0||delete this.styles[t][u])}let h=!1;for(c&&!a&&(this.styles[t+n]=s,h=!0),(h||o>e)&&n--;n>0;)i&&i[n-1]?this.styles[t+n]={0:U({},i[n-1])}:l?this.styles[t+n]={0:U({},l)}:delete this.styles[t+n],n--;this._forceClearCache=!0}insertCharStyleObject(t,e,n,i){this.styles||(this.styles={});let s=this.styles[t],o=s?U({},s):{};n||(n=1);for(let c in o){let l=parseInt(c,10);l>=e&&(s[l+n]=o[l],o[l-n]||delete s[l])}if(this._forceClearCache=!0,i){for(;n--;)Object.keys(i[n]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+n]=U({},i[n]));return}if(!s)return;let a=s[e?e-1:1];for(;a&&n--;)this.styles[t][e+n]=U({},a)}insertNewStyleBlock(t,e,n){let i=this.get2DCursorLocation(e,!0),s=[0],o,a=0;for(let c=0;c<t.length;c++)t[c]===`
`?(a++,s[a]=0):s[a]++;for(s[0]>0&&(this.insertCharStyleObject(i.lineIndex,i.charIndex,s[0],n),n=n&&n.slice(s[0]+1)),a&&this.insertNewlineStyleObject(i.lineIndex,i.charIndex+s[0],a),o=1;o<a;o++)s[o]>0?this.insertCharStyleObject(i.lineIndex+o,0,s[o],n):n&&this.styles[i.lineIndex+o]&&n[0]&&(this.styles[i.lineIndex+o][0]=n[0]),n=n&&n.slice(s[o]+1);s[o]>0&&this.insertCharStyleObject(i.lineIndex+o,0,s[o],n)}removeChars(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:n;i>n&&this.removeStyleFromTo(n,i);let s=this.graphemeSplit(t);this.insertNewStyleBlock(s,n,e),this._text=[...this._text.slice(0,n),...s,...this._text.slice(i)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(t,e,n){n<=t?(e===t?this._selectionDirection=Se:this._selectionDirection===Je&&(this._selectionDirection=Se,this.selectionEnd=t),this.selectionStart=n):n>t&&n<e?this._selectionDirection===Je?this.selectionEnd=n:this.selectionStart=n:(e===t?this._selectionDirection=Je:this._selectionDirection===Se&&(this._selectionDirection=Je,this.selectionStart=e),this.selectionEnd=n)}},Sf=class extends wf{initHiddenTextarea(){let t=this.canvas&&ki(this.canvas.getElement())||Sa(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map(o=>{let[a,c]=o;return e.setAttribute(a,c)});let{top:n,left:i,fontSize:s}=this._calcTextareaPosition();e.style.cssText="position: absolute; top: ".concat(n,"; left: ").concat(i,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(s,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(o=>{let[a,c]=o;return e.addEventListener(a,this[c].bind(this))}),this.hiddenTextarea=e}blur(){this.abortCursorAnimation()}onKeyDown(t){if(!this.isEditing)return;let e=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(t){let e=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),!this.isEditing)return;let n=()=>{this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value==="")return this.styles={},void n();let i=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,s=this._text.length,o=i.length,a=this.selectionStart,c=this.selectionEnd,l=a!==c,h,u,d,x,m=o-s,g=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),f=a>g.selectionStart;l?(u=this._text.slice(a,c),m+=c-a):o<s&&(u=f?this._text.slice(c+m,c):this._text.slice(a,a-m));let p=i.slice(g.selectionEnd-m,g.selectionEnd);if(u&&u.length&&(p.length&&(h=this.getSelectionStyles(a,a+1,!1),h=p.map(()=>h[0])),l?(d=a,x=c):f?(d=c-u.length,x=c):(d=c,x=c+u.length),this.removeStyleFromTo(d,x)),p.length){let{copyPasteData:v}=tr();e&&p.join("")===v.copiedText&&!ve.disableStyleCopyPaste&&(h=v.copiedTextStyle),this.insertNewStyleBlock(p,a,h)}n()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(t){let{target:e}=t,{selectionStart:n,selectionEnd:i}=e;this.compositionStart=n,this.compositionEnd=i,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;let{copyPasteData:t}=tr();t.copiedText=this.getSelectedText(),ve.disableStyleCopyPaste?t.copiedTextStyle=void 0:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(t,e){let n,i=this._getLineLeftOffset(t);return e>0&&(n=this.__charBounds[t][e-1],i+=n.left+n.width),i}getDownCursorOffset(t,e){let n=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(n),s=i.lineIndex;if(s===this._textLines.length-1||t.metaKey||t.keyCode===34)return this._text.length-n;let o=i.charIndex,a=this._getWidthBeforeCursor(s,o),c=this._getIndexOnLine(s+1,a);return this._textLines[s].slice(o).length+c+1+this.missingNewlineOffset(s)}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart}getUpCursorOffset(t,e){let n=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(n),s=i.lineIndex;if(s===0||t.metaKey||t.keyCode===33)return-n;let o=i.charIndex,a=this._getWidthBeforeCursor(s,o),c=this._getIndexOnLine(s-1,a),l=this._textLines[s].slice(0,o),h=this.missingNewlineOffset(s-1);return-this._textLines[s-1].length+c-l.length+(1-h)}_getIndexOnLine(t,e){let n=this._textLines[t],i,s,o=this._getLineLeftOffset(t),a=0;for(let c=0,l=n.length;c<l;c++)if(i=this.__charBounds[t][c].width,o+=i,o>e){s=!0;let h=o-i,u=o,d=Math.abs(h-e);a=Math.abs(u-e)<d?c:c-1;break}return s||(a=n.length-1),a}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)}moveCursorUp(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",t)}_moveCursorUpOrDown(t,e){let n=this["get".concat(t,"CursorOffset")](e,this._selectionDirection===Je);if(e.shiftKey?this.moveCursorWithShift(n):this.moveCursorWithoutShift(n),n!==0){let i=this.text.length;this.selectionStart=Ys(0,this.selectionStart,i),this.selectionEnd=Ys(0,this.selectionEnd,i),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(t){let e=this._selectionDirection===Se?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),t!==0}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),t!==0}moveCursorLeft(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",t)}_move(t,e,n){let i;if(t.altKey)i=this["findWordBoundary".concat(n)](this[e]);else{if(!t.metaKey&&t.keyCode!==35&&t.keyCode!==36)return this[e]+=n==="Left"?-1:1,!0;i=this["findLineBoundary".concat(n)](this[e])}return i!==void 0&&this[e]!==i&&(this[e]=i,!0)}_moveLeft(t,e){return this._move(t,e,"Left")}_moveRight(t,e){return this._move(t,e,"Right")}moveCursorLeftWithoutShift(t){let e=!0;return this._selectionDirection=Se,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e}moveCursorLeftWithShift(t){return this._selectionDirection===Je&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection=Se,this._moveLeft(t,"selectionStart")):void 0}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)}_moveCursorLeftOrRight(t,e){let n="moveCursor".concat(t).concat(e.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[n](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(t){return this._selectionDirection===Se&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=Je,this._moveRight(t,"selectionEnd")):void 0}moveCursorRightWithoutShift(t){let e=!0;return this._selectionDirection=Je,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e}},$x=r=>!!r.button,Mf=class extends Sf{constructor(){super(...arguments),z(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler),this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown),this.draggableTextDelegate=new bf(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(t){return this.draggableTextDelegate.onDragStart(t)}canDrop(t){return this.draggableTextDelegate.canDrop(t)}onMouseDown(t){if(!this.canvas)return;this.__newClickTime=+new Date;let e=t.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",t),sf(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastSelected=this.selected&&!this.getActiveControl()}isTripleClick(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y}doubleClickHandler(t){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(t.e))}tripleClickHandler(t){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(t.e))}_mouseDownHandler(t){let{e}=t;this.canvas&&this.editable&&!$x(e)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())))}_mouseDownHandlerBefore(t){let{e}=t;this.canvas&&this.editable&&!$x(e)&&(this.selected=this===this.canvas._activeObject)}mouseUpHandler(t){let{e,transform:n}=t,i=this.draggableTextDelegate.end(e);if(this.canvas){this.canvas.textEditingManager.unregister(this);let s=this.canvas._activeObject;if(s&&s!==this)return}!this.editable||this.group&&!this.group.interactive||n&&n.actionPerformed||$x(e)||i||(this.__lastSelected&&!this.getActiveControl()?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0)}setCursorByClick(t){let e=this.getSelectionStartFromPointer(t),n=this.selectionStart,i=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(n,i,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(t){let e=this.canvas.getScenePoint(t).transform(ei(this.calcTransformMatrix())).add(new Q(-this._getLeftOffset(),-this._getTopOffset())),n=0,i=0,s=0;for(let l=0;l<this._textLines.length&&n<=e.y;l++)n+=this.getHeightOfLine(l),s=l,l>0&&(i+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));let o=Math.abs(this._getLineLeftOffset(s)),a=this._textLines[s].length,c=this.__charBounds[s];for(let l=0;l<a;l++){let h=o+c[l].kernedWidth;if(e.x<=h){Math.abs(e.x-h)<=Math.abs(e.x-o)&&i++;break}o=h,i++}return Math.min(this.flipX?a-i:i,this._text.length)}},qh="moveCursorUp",$h="moveCursorDown",Zh="moveCursorLeft",Jh="moveCursorRight",Kh="exitEditing",PD=U({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:Kh,27:Kh,33:qh,34:$h,35:Jh,36:Zh,37:Zh,38:qh,39:Jh,40:$h},keysMapRtl:{9:Kh,27:Kh,33:qh,34:$h,35:Zh,36:Jh,37:Jh,38:qh,39:Zh,40:$h},ctrlKeysMapDown:{65:"selectAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1}),Jr=class r extends Mf{static getDefaults(){return U(U({},super.getDefaults()),r.ownDefaults)}get type(){let t=super.type;return t==="itext"?"i-text":t}constructor(t,e){super(t,e),this.initBehavior()}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):(t==="canvas"&&(this.canvas instanceof er&&this.canvas.textEditingManager.remove(this),e instanceof er&&e.textEditingManager.add(this)),super._set(t,e))}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,n=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,n)}setSelectionStyles(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,n)}get2DCursorLocation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e)}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(t){let e=this.isEditing;this.isEditing=!1;let n=super.toCanvasElement(t);return this.isEditing=e,n}renderCursorOrSelection(){if(!this.isEditing)return;let t=this.clearContextTop(!0);if(!t)return;let e=this._getCursorBoundaries();this.selectionStart===this.selectionEnd?this.renderCursor(t,e):this.renderSelection(t,e),this.canvas.contextTopDirty=!0,t.restore()}_getCursorBoundaries(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0,n=this._getLeftOffset(),i=this._getTopOffset(),s=this._getCursorBoundariesOffsets(t,e);return{left:n,top:i,leftOffset:s.left,topOffset:s.top}}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t)}__getCursorBoundariesOffsets(t){let e=0,n=0,{charIndex:i,lineIndex:s}=this.get2DCursorLocation(t);for(let l=0;l<s;l++)e+=this.getHeightOfLine(l);let o=this._getLineLeftOffset(s),a=this.__charBounds[s][i];a&&(n=a.left),this.charSpacing!==0&&i===this._textLines[s].length&&(n-=this._getWidthOfCharSpacing());let c={top:e,left:o+(n>0?n:0)};return this.direction==="rtl"&&(this.textAlign===Je||this.textAlign===Ji||this.textAlign===Nc?c.left*=-1:this.textAlign===Se||this.textAlign===_0?c.left=o-(n>0?n:0):this.textAlign!==ue&&this.textAlign!==Uc||(c.left=o-(n>0?n:0))),c}renderCursorAt(t){let e=this._getCursorBoundaries(t,!0);this._renderCursor(this.canvas.contextTop,e,t)}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart)}_renderCursor(t,e,n){let i=this.get2DCursorLocation(n),s=i.lineIndex,o=i.charIndex>0?i.charIndex-1:0,a=this.getValueOfPropertyAt(s,o,"fontSize"),c=this.getObjectScaling().x*this.canvas.getZoom(),l=this.cursorWidth/c,h=this.getValueOfPropertyAt(s,o,"deltaY"),u=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(s)/this.lineHeight-a*(1-this._fontSizeFraction);this.inCompositionMode&&this.renderSelection(t,e),t.fillStyle=this.cursorColor||this.getValueOfPropertyAt(s,o,"fill"),t.globalAlpha=this._currentCursorOpacity,t.fillRect(e.left+e.leftOffset-l/2,u+e.top+h,l,a)}renderSelection(t,e){let n={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,n,e)}renderDragSourceEffect(){let t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0))}renderDropTargetEffect(t){let e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e)}_renderSelection(t,e,n){let i=e.selectionStart,s=e.selectionEnd,o=this.textAlign.includes(Ji),a=this.get2DCursorLocation(i),c=this.get2DCursorLocation(s),l=a.lineIndex,h=c.lineIndex,u=a.charIndex<0?0:a.charIndex,d=c.charIndex<0?0:c.charIndex;for(let x=l;x<=h;x++){let m=this._getLineLeftOffset(x)||0,g=this.getHeightOfLine(x),f=0,p=0,v=0;if(x===l&&(p=this.__charBounds[l][u].left),x>=l&&x<h)v=o&&!this.isEndOfWrapping(x)?this.width:this.getLineWidth(x)||5;else if(x===h)if(d===0)v=this.__charBounds[h][d].left;else{let w=this._getWidthOfCharSpacing();v=this.__charBounds[h][d-1].left+this.__charBounds[h][d-1].width-w}f=g,(this.lineHeight<1||x===h&&this.lineHeight>1)&&(g/=this.lineHeight);let E=n.left+m+p,C=g,b=0,A=v-p;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",C=1,b=g):t.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===Je||this.textAlign===Ji||this.textAlign===Nc?E=this.width-E-A:this.textAlign===Se||this.textAlign===_0?E=n.left+m-v:this.textAlign!==ue&&this.textAlign!==Uc||(E=n.left+m-v)),t.fillRect(E,n.top+n.topOffset+b,A,C),n.topOffset+=f}}getCurrentCharFontSize(){let t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")}getCurrentCharColor(){let t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fill")}_getCurrentCharIndex(){let t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}dispose(){this._exitEditing(),this.draggableTextDelegate.dispose(),super.dispose()}};z(Jr,"ownDefaults",PD),z(Jr,"type","IText"),St.setClass(Jr),St.setClass(Jr,"i-text");var ia=class r extends Jr{static getDefaults(){return U(U({},super.getDefaults()),{},{controls:D_()},r.ownDefaults)}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(Ji)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(t){let e=0,n=0,i=0,s={};for(let o=0;o<t.graphemeLines.length;o++)t.graphemeText[i]===`
`&&o>0?(n=0,i++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[i])&&o>0&&(n++,i++),s[o]={line:e,offset:n},i+=t.graphemeLines[o].length,n+=t.graphemeLines[o].length;return s}styleHas(t,e){if(this._styleMap&&!this.isWrapping){let n=this._styleMap[e];n&&(e=n.line)}return super.styleHas(t,e)}isEmptyStyles(t){if(!this.styles)return!0;let e,n=0,i=t+1,s=!1,o=this._styleMap[t],a=this._styleMap[t+1];o&&(t=o.line,n=o.offset),a&&(i=a.line,s=i===t,e=a.offset);let c=t===void 0?this.styles:{line:this.styles[t]};for(let l in c)for(let h in c[l]){let u=parseInt(h,10);if(u>=n&&(!s||u<e))for(let d in c[l][h])return!1}return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){let n=this._styleMap[t];if(!n)return{};t=n.line,e=n.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,n){let i=this._styleMap[t];super._setStyleDeclaration(i.line,i.offset+e,n)}_deleteStyleDeclaration(t,e){let n=this._styleMap[t];super._deleteStyleDeclaration(n.line,n.offset+e)}_getLineStyle(t){let e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){let e=this._styleMap[t];super._setLineStyle(e.line)}_wrapText(t,e){this.isWrapping=!0;let n=this.getGraphemeDataForRender(t),i=[];for(let s=0;s<n.wordsData.length;s++)i.push(...this._wrapLine(s,e,n));return this.isWrapping=!1,i}getGraphemeDataForRender(t){let e=this.splitByGrapheme,n=e?"":" ",i=0;return{wordsData:t.map((s,o)=>{let a=0,c=e?this.graphemeSplit(s):this.wordSplit(s);return c.length===0?[{word:[],width:0}]:c.map(l=>{let h=e?[l]:this.graphemeSplit(l),u=this._measureWord(h,o,a);return i=Math.max(u,i),a+=h.length+n.length,{word:h,width:u}})}),largestWordWidth:i}}_measureWord(t,e){let n,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=0;for(let o=0,a=t.length;o<a;o++)s+=this._getGraphemeBox(t[o],e,o+i,n,!0).kernedWidth,n=t[o];return s}wordSplit(t){return t.split(this._wordJoiners)}_wrapLine(t,e,n){let{largestWordWidth:i,wordsData:s}=n,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,a=this._getWidthOfCharSpacing(),c=this.splitByGrapheme,l=[],h=c?"":" ",u=0,d=[],x=0,m=0,g=!0;e-=o;let f=Math.max(e,i,this.dynamicMinWidth),p=s[t],v;for(x=0,v=0;v<p.length;v++){let{word:E,width:C}=p[v];x+=E.length,u+=m+C-a,u>f&&!g?(l.push(d),d=[],u=C,g=!0):u+=a,g||c||d.push(h),d=d.concat(E),m=c?0:this._measureWord([h],t,x),x++,g=!1}return v&&l.push(d),i+o>this.dynamicMinWidth&&(this.dynamicMinWidth=i-a+o),l}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t,e){return this.splitByGrapheme&&!e?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){let e=super._splitTextIntoLines(t),n=this._wrapText(e.lines,this.width),i=new Array(n.length);for(let s=0;s<n.length;s++)i[s]=n[s].join("");return e.lines=i,e.graphemeLines=n,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){let t=new Map;for(let e in this._styleMap){let n=parseInt(e,10);if(this._textLines[n]){let i=this._styleMap[e].line;t.set("".concat(i),!0)}}for(let e in this.styles)t.has(e)||delete this.styles[e]}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...t])}};z(ia,"type","Textbox"),z(ia,"textLayoutProperties",[...Jr.textLayoutProperties,"width"]),z(ia,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),St.setClass(ia);var y0=class extends wa{shouldPerformLayout(t){return!!t.target.clipPath&&super.shouldPerformLayout(t)}shouldLayoutClipPath(){return!1}calcLayoutResult(t,e){let{target:n}=t,{clipPath:i}=n;if(!i||!this.shouldPerformLayout(t))return;let{width:s,height:o}=Qi(L_(n,i)),a=new Q(s,o);if(i.absolutePositioned){var c;return{center:Kr(i.getRelativeCenterPoint(),void 0,(c=n.group)===null||c===void 0?void 0:c.calcTransformMatrix()),size:a}}{let l=i.getRelativeCenterPoint().transform(n.calcOwnMatrix(),!0);if(this.shouldPerformLayout(t)){let{center:h=new Q,correction:u=new Q}=this.calcBoundingBox(e,t)||{};return{center:h.add(l),correction:u.subtract(l),size:a}}return{center:n.getRelativeCenterPoint().add(l),size:a}}}};z(y0,"type","clip-path"),St.setClass(y0);var A0=class extends wa{getInitialSize(t,e){let{target:n}=t,{size:i}=e;return new Q(n.width||i.x,n.height||i.y)}};z(A0,"type","fixed"),St.setClass(A0);var Df=class extends qs{subscribeTargets(t){let e=t.target;t.targets.reduce((n,i)=>(i.parent&&n.add(i.parent),n),new Set).forEach(n=>{n.layoutManager.subscribeTargets({target:n,targets:[e]})})}unsubscribeTargets(t){let e=t.target,n=e.getObjects();t.targets.reduce((i,s)=>(s.parent&&i.add(s.parent),i),new Set).forEach(i=>{!n.some(s=>s.parent===i)&&i.layoutManager.unsubscribeTargets({target:i,targets:[e]})})}},ra=class r extends Qr{static getDefaults(){return U(U({},super.getDefaults()),r.ownDefaults)}constructor(){var t;let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],U(U({},e),{},{layoutManager:(t=e.layoutManager)!==null&&t!==void 0?t:new Df}))}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.multiSelectionStacking==="selection-order"?this.add(...e):e.forEach(i=>{let s=this._objects.findIndex(a=>a.isInFrontOf(i)),o=s===-1?this.size():s;this.insertAt(o,i)})}canEnterGroup(t){return this.getObjects().some(e=>e.isDescendantOf(t)||t.isDescendantOf(e))?(es("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(t)}enterGroup(t,e){t.parent&&t.parent===t.group?t.parent._exitGroup(t):t.group&&t.parent!==t.group&&t.group.remove(t),this._enterGroup(t,e)}exitGroup(t,e){this._exitGroup(t,e),t.parent&&t.parent._enterGroup(t,!0)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);let n=new Set;e.forEach(i=>{let{parent:s}=i;s&&n.add(s)}),t===Xf?n.forEach(i=>{i._onAfterObjectsChange(m0,e)}):n.forEach(i=>{i._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,n){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,super._renderControls(t,e);let i=U(U({hasControls:!1},n),{},{forActiveSelection:!0});for(let s=0;s<this._objects.length;s++)this._objects[s]._renderControls(t,i);t.restore()}};z(ra,"type","ActiveSelection"),z(ra,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),St.setClass(ra),St.setClass(ra,"activeSelection");var Bf=class{constructor(){z(this,"resources",{})}applyFilters(t,e,n,i,s){let o=s.getContext("2d");if(!o)return;o.drawImage(e,0,0,n,i);let a={sourceWidth:n,sourceHeight:i,imageData:o.getImageData(0,0,n,i),originalEl:e,originalImageData:o.getImageData(0,0,n,i),canvasEl:s,ctx:o,filterBackend:this};t.forEach(l=>{l.applyTo(a)});let{imageData:c}=a;return c.width===n&&c.height===i||(s.width=c.width,s.height=c.height),o.putImageData(c,0,0),a}},b0=class{constructor(){let{tileSize:t=ve.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};z(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),z(this,"resources",{}),this.tileSize=t,this.setupGLContext(t,t),this.captureGPUInfo()}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e)}createWebGLCanvas(t,e){let n=Ke();n.width=t,n.height=e;let i=n.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});i&&(i.clearColor(0,0,0,0),this.canvas=n,this.gl=i)}applyFilters(t,e,n,i,s,o){let a=this.gl,c=s.getContext("2d");if(!a||!c)return;let l;o&&(l=this.getCachedTexture(o,e));let h={originalWidth:e.width||e.originalWidth||0,originalHeight:e.height||e.originalHeight||0,sourceWidth:n,sourceHeight:i,destinationWidth:n,destinationHeight:i,context:a,sourceTexture:this.createTexture(a,n,i,l?void 0:e),targetTexture:this.createTexture(a,n,i),originalTexture:l||this.createTexture(a,n,i,l?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:s},u=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,u),t.forEach(d=>{d&&d.applyTo(h)}),function(d){let x=d.targetCanvas,m=x.width,g=x.height,f=d.destinationWidth,p=d.destinationHeight;m===f&&g===p||(x.width=f,x.height=p)}(h),this.copyGLTo2D(a,h),a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(h.sourceTexture),a.deleteTexture(h.targetTexture),a.deleteFramebuffer(u),c.setTransform(1,0,0,1,0,0),h}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(t,e,n,i,s){let{NEAREST:o,TEXTURE_2D:a,RGBA:c,UNSIGNED_BYTE:l,CLAMP_TO_EDGE:h,TEXTURE_MAG_FILTER:u,TEXTURE_MIN_FILTER:d,TEXTURE_WRAP_S:x,TEXTURE_WRAP_T:m}=t,g=t.createTexture();return t.bindTexture(a,g),t.texParameteri(a,u,s||o),t.texParameteri(a,d,s||o),t.texParameteri(a,x,h),t.texParameteri(a,m,h),i?t.texImage2D(a,0,c,c,l,i):t.texImage2D(a,0,c,e,n,0,c,l,null),g}getCachedTexture(t,e,n){let{textureCache:i}=this;if(i[t])return i[t];{let s=this.createTexture(this.gl,e.width,e.height,e,n);return s&&(i[t]=s),s}}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])}copyGLTo2D(t,e){let n=t.canvas,i=e.targetCanvas,s=i.getContext("2d");if(!s)return;s.translate(0,i.height),s.scale(1,-1);let o=n.height-i.height;s.drawImage(n,0,o,i.width,i.height,0,0,i.width,i.height)}copyGLTo2DPutImageData(t,e){let n=e.targetCanvas.getContext("2d"),i=e.destinationWidth,s=e.destinationHeight,o=i*s*4;if(!n)return;let a=new Uint8Array(this.imageBuffer,0,o),c=new Uint8ClampedArray(this.imageBuffer,0,o);t.readPixels(0,0,i,s,t.RGBA,t.UNSIGNED_BYTE,a);let l=new ImageData(c,i,s);n.putImageData(l,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;let t=this.gl,e={renderer:"",vendor:""};if(!t)return e;let n=t.getExtension("WEBGL_debug_renderer_info");if(n){let i=t.getParameter(n.UNMASKED_RENDERER_WEBGL),s=t.getParameter(n.UNMASKED_VENDOR_WEBGL);i&&(e.renderer=i.toLowerCase()),s&&(e.vendor=s.toLowerCase())}return this.gpuInfo=e,e}},Zx;function RD(){let{WebGLProbe:r}=tr();return r.queryWebGL(Ke()),ve.enableGLFiltering&&r.isSupported(ve.textureSize)?new b0({tileSize:ve.textureSize}):new Bf}function Jx(){return!Zx&&(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(Zx=RD()),Zx}var kD=["filters","resizeFilter","src","crossOrigin","type"],a1=["cropX","cropY"],vi=class r extends Qe{static getDefaults(){return U(U({},super.getDefaults()),r.ownDefaults)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(U({filters:[]},e)),z(this,"_lastScaleX",1),z(this,"_lastScaleY",1),z(this,"_filterScalingX",1),z(this,"_filterScalingY",1),this.cacheKey="texture".concat(is()),this.setElement(typeof t=="string"?(this.canvas&&ki(this.canvas.getElement())||Sa()).getElementById(t):t,e)}getElement(){return this._element}setElement(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(e),t.classList.add(r.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(t){let e=Jx(!1);e instanceof b0&&e.evictCachesForKey(t)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(t=>{let e=this[t];e&&tr().dispose(e),this[t]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){let t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0}}_stroke(t){if(!this.stroke||this.strokeWidth===0)return;let e=this.width/2,n=this.height/2;t.beginPath(),t.moveTo(-e,-n),t.lineTo(e,-n),t.lineTo(e,n),t.lineTo(-e,n),t.lineTo(-e,-n),t.closePath()}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=[];return this.filters.forEach(n=>{n&&e.push(n.toObject())}),U(U({},super.toObject([...a1,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){let t=[],e=this._element,n=-this.width/2,i=-this.height/2,s=[],o=[],a="",c="";if(!e)return[];if(this.hasCrop()){let l=is();s.push('<clipPath id="imageCrop_'+l+`">
`,'	<rect x="'+n+'" y="'+i+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),a=' clip-path="url(#imageCrop_'+l+')" '}if(this.imageSmoothing||(c=' image-rendering="optimizeSpeed"'),t.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(n-this.cropX,'" y="').concat(i-this.cropY,'" width="').concat(e.width||e.naturalWidth,'" height="').concat(e.height||e.naturalHeight,'"').concat(c).concat(a,`></image>
`)),this.stroke||this.strokeDashArray){let l=this.fill;this.fill=null,o=['	<rect x="'.concat(n,'" y="').concat(i,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),`" />
`)],this.fill=l}return s=this.paintFirst!=="fill"?s.concat(o,t):s.concat(t,o),s}getSrc(t){let e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src")||"":e.src:this.src||""}getSvgSrc(t){return this.getSrc(t)}setSrc(t){let{crossOrigin:e,signal:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Oc(t,{crossOrigin:e,signal:n}).then(i=>{e!==void 0&&this.set({crossOrigin:e}),this.setElement(i)})}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){let t=this.resizeFilter,e=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),i=n.x,s=n.y,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||i>e&&s>e)return this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=i,void(this._lastScaleY=s);let a=Ke(),c=o.width,l=o.height;a.width=c,a.height=l,this._element=a,this._lastScaleX=t.scaleX=i,this._lastScaleY=t.scaleY=s,Jx().applyFilters([t],o,c,l,this._element),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height}applyFilters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(t=t.filter(s=>s&&!s.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),t.length===0)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);let e=this._originalElement,n=e.naturalWidth||e.width,i=e.naturalHeight||e.height;if(this._element===this._originalElement){let s=Ke();s.width=n,s.height=i,this._element=s,this._filteredEl=s}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,i),this._lastScaleX=1,this._lastScaleY=1);Jx().applyFilters(t,this._originalElement,n,i,this._element),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){let e=this._element;if(!e)return;let n=this._filterScalingX,i=this._filterScalingY,s=this.width,o=this.height,a=Math.max(this.cropX,0),c=Math.max(this.cropY,0),l=e.naturalWidth||e.width,h=e.naturalHeight||e.height,u=a*n,d=c*i,x=Math.min(s*n,l-u),m=Math.min(o*i,h-d),g=-s/2,f=-o/2,p=Math.min(s,l/n-a),v=Math.min(o,h/i-c);e&&t.drawImage(e,u,d,x,m,g,f,p,v)}_needsResize(){let t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:t,height:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.getOriginalSize();this.width=t||n.width,this.height=e||n.height}parsePreserveAspectRatioAttribute(){let t=$E(this.preserveAspectRatio||""),e=this.width,n=this.height,i={width:e,height:n},s,o=this._element.width,a=this._element.height,c=1,l=1,h=0,u=0,d=0,x=0;return!t||t.alignX===Xn&&t.alignY===Xn?(c=e/o,l=n/a):(t.meetOrSlice==="meet"&&(c=l=U_(this._element,i),s=(e-o*c)/2,t.alignX==="Min"&&(h=-s),t.alignX==="Max"&&(h=s),s=(n-a*l)/2,t.alignY==="Min"&&(u=-s),t.alignY==="Max"&&(u=s)),t.meetOrSlice==="slice"&&(c=l=z_(this._element,i),s=o-e/c,t.alignX==="Mid"&&(d=s/2),t.alignX==="Max"&&(d=s),s=a-n/l,t.alignY==="Mid"&&(x=s/2),t.alignY==="Max"&&(x=s),o=e/c,a=n/l)),{width:o,height:a,scaleX:c,scaleY:l,offsetLeft:h,offsetTop:u,cropX:d,cropY:x}}static fromObject(t){let{filters:e,resizeFilter:n,src:i,crossOrigin:s,type:o}=t,a=ke(t,kD),c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Promise.all([Oc(i,U(U({},c),{},{crossOrigin:s})),e&&Aa(e,c),n&&Aa([n],c),Yc(a,c)]).then(l=>{let[h,u=[],[d]=[],x={}]=l;return new this(h,U(U({},a),{},{src:i,filters:u,resizeFilter:d},x))})}static fromURL(t){let{crossOrigin:e=null,signal:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return Oc(t,{crossOrigin:e,signal:n}).then(s=>new this(s,i))}static fromElement(e){return Ut(this,arguments,function*(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,s=Ar(t,this.ATTRIBUTE_NAMES,i);return this.fromURL(s["xlink:href"],n,s).catch(o=>(es("log","Unable to parse Image",o),null))})}};z(vi,"type","Image"),z(vi,"cacheProperties",[...yr,...a1]),z(vi,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),z(vi,"CSS_CANVAS","canvas-img"),z(vi,"ATTRIBUTE_NAMES",[...ss,"x","y","width","height","preserveAspectRatio","xlink:href","crossOrigin","image-rendering"]),St.setClass(vi),St.setSVGClass(vi);var u6=T0(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);var c1="modifyPoly",UE=r=>function(t,e,n){let{points:i,pathOffset:s}=n;return new Q(i[r]).subtract(s).transform(yn(n.getViewportTransform(),n.calcTransformMatrix()))},l1=(r,t,e,n)=>{let{target:i,pointIndex:s}=t,o=i,a=Kr(new Q(e,n),void 0,o.calcOwnMatrix());return o.points[s]=a.add(o.pathOffset),o.setDimensions(),!0},h1=(r,t)=>function(e,n,i,s){let o=n.target,a=new Q(o.points[(r>0?r:o.points.length)-1]),c=a.subtract(o.pathOffset).transform(o.calcOwnMatrix()),l=t(e,U(U({},n),{},{pointIndex:r}),i,s),h=a.subtract(o.pathOffset).transform(o.calcOwnMatrix()).subtract(c);return o.left-=h.x,o.top-=h.y,l},zE=r=>rs(c1,h1(r,l1)),d6=Object.freeze({__proto__:null,changeWidth:pf,createObjectDefaultControls:Wf,createPolyActionHandler:zE,createPolyControls:function(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e={};for(let n=0;n<(typeof r=="number"?r:r.points.length);n++)e["p".concat(n)]=new Fn(U({actionName:c1,positionHandler:UE(n),actionHandler:zE(n)},t));return e},createPolyPositionHandler:UE,createResizeControls:M_,createTextboxDefaultControls:D_,dragHandler:c_,factoryPolyActionHandler:h1,getLocalPoint:D0,polyActionHandler:l1,renderCircleControl:p_,renderSquareControl:m_,rotationStyleHandler:g_,rotationWithSnapping:v_,scaleCursorStyleHandler:Qo,scaleOrSkewActionName:Pc,scaleSkewCursorStyleHandler:Vs,scalingEqually:Fc,scalingX:C_,scalingXOrSkewingY:mf,scalingY:y_,scalingYOrSkewingX:gf,skewCursorStyleHandler:A_,skewHandlerX:w_,skewHandlerY:S_,wrapWithFireEvent:rs,wrapWithFixedAnchor:Zs}),k0=r=>r.webgl!==void 0;var Tf="precision highp float",OD=`
    `.concat(Tf,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),ID=["type"],LD=["type"],tn=class{get type(){return this.constructor.type}constructor(){let t=ke(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ID);z(this,"vertexSource",`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`),Object.assign(this,this.constructor.defaults,t)}getFragmentSource(){return OD}createProgram(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.vertexSource,{WebGLProbe:{GLPrecision:i="highp"}}=tr();i!=="highp"&&(e=e.replace(new RegExp(Tf,"g"),Tf.replace("highp",i)));let s=t.createShader(t.VERTEX_SHADER),o=t.createShader(t.FRAGMENT_SHADER),a=t.createProgram();if(!s||!o||!a)throw new _i("Vertex, fragment shader or program creation error");if(t.shaderSource(s,n),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new _i("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(s)));if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw new _i("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(o)));if(t.attachShader(a,s),t.attachShader(a,o),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new _i('Shader link error for "'.concat(this.type,'" ').concat(t.getProgramInfoLog(a)));let c=this.getUniformLocations(t,a)||{};return c.uStepW=t.getUniformLocation(a,"uStepW"),c.uStepH=t.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:this.getAttributeLocations(t,a),uniformLocations:c}}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}}getUniformLocations(t,e){return{}}sendAttributeData(t,e,n){let i=e.aPosition,s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}_setupFrameBuffer(t){let e=t.context;if(t.passes>1){let n=t.destinationWidth,i=t.destinationHeight;t.sourceWidth===n&&t.sourceHeight===i||(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,n,i)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0)}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish()}_swapTextures(t){t.passes--,t.pass++;let e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e}isNeutralState(t){let e=this.mainParameter,n=this.constructor.defaults[e];if(e){let i=this[e];return Array.isArray(n)&&Array.isArray(i)?n.every((s,o)=>s===i[o]):n===i}return!1}applyTo(t){k0(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){}getCacheKey(){return this.type}retrieveShader(t){let e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e]}applyToWebGL(t){let e=t.context,n=this.retrieveShader(t);t.pass===0&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(n.program),this.sendAttributeData(e,n.attributeLocations,t.aPosition),e.uniform1f(n.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(n.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,n.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(t,e,n){t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)}getMainParameter(){return this.mainParameter?this[this.mainParameter]:void 0}setMainParameter(t){this.mainParameter&&(this[this.mainParameter]=t)}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){let e=Ke();e.width=t.sourceWidth,e.height=t.sourceHeight,t.helpLayer=e}}toObject(){let t=this.mainParameter;return U({type:this.type},t?{[t]:this[t]}:{})}toJSON(){return this.toObject()}static fromObject(t,e){return Ut(this,null,function*(){return new this(ke(t,LD))})}};z(tn,"type","BaseFilter");var ND={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `},oa=class extends tn{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(ND[this.mode],`
        }
      }
      `)}applyTo2d(t){let{imageData:{data:e}}=t,n=new Un(this.color).getSource(),i=n[0]*this.alpha,s=n[1]*this.alpha,o=n[2]*this.alpha,a=1-this.alpha;for(let c=0;c<e.length;c+=4){let l=e[c],h=e[c+1],u=e[c+2];switch(this.mode){case"multiply":e[c]=l*i/255,e[c+1]=h*s/255,e[c+2]=u*o/255;break;case"screen":e[c]=255-(255-l)*(255-i)/255,e[c+1]=255-(255-h)*(255-s)/255,e[c+2]=255-(255-u)*(255-o)/255;break;case"add":e[c]=l+i,e[c+1]=h+s,e[c+2]=u+o;break;case"difference":e[c]=Math.abs(l-i),e[c+1]=Math.abs(h-s),e[c+2]=Math.abs(u-o);break;case"subtract":e[c]=l-i,e[c+1]=h-s,e[c+2]=u-o;break;case"darken":e[c]=Math.min(l,i),e[c+1]=Math.min(h,s),e[c+2]=Math.min(u,o);break;case"lighten":e[c]=Math.max(l,i),e[c+1]=Math.max(h,s),e[c+2]=Math.max(u,o);break;case"overlay":e[c]=i<128?2*l*i/255:255-2*(255-l)*(255-i)/255,e[c+1]=s<128?2*h*s/255:255-2*(255-h)*(255-s)/255,e[c+2]=o<128?2*u*o/255:255-2*(255-u)*(255-o)/255;break;case"exclusion":e[c]=i+l-2*i*l/255,e[c+1]=s+h-2*s*h/255,e[c+2]=o+u-2*o*u/255;break;case"tint":e[c]=i+l*a,e[c+1]=s+h*a,e[c+2]=o+u*a}}}getUniformLocations(t,e){return{uColor:t.getUniformLocation(e,"uColor")}}sendUniformData(t,e){let n=new Un(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,t.uniform4fv(e.uColor,n)}toObject(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}};z(oa,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),z(oa,"type","BlendColor"),St.setClass(oa);var UD={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},zD=["type","image"],aa=class extends tn{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return UD[this.mode]}applyToWebGL(t){let e=t.context,n=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,n,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1)}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement())}calculateMatrix(){let t=this.image,{width:e,height:n}=t.getElement();return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/n,1]}applyTo2d(t){let{imageData:{data:e,width:n,height:i},filterBackend:{resources:s}}=t,o=this.image;s.blendImage||(s.blendImage=Ke());let a=s.blendImage,c=a.getContext("2d");a.width!==n||a.height!==i?(a.width=n,a.height=i):c.clearRect(0,0,n,i),c.setTransform(o.scaleX,0,0,o.scaleY,o.left,o.top),c.drawImage(o.getElement(),0,0,n,i);let l=c.getImageData(0,0,n,i).data;for(let h=0;h<e.length;h+=4){let u=e[h],d=e[h+1],x=e[h+2],m=e[h+3],g=l[h],f=l[h+1],p=l[h+2],v=l[h+3];switch(this.mode){case"multiply":e[h]=u*g/255,e[h+1]=d*f/255,e[h+2]=x*p/255,e[h+3]=m*v/255;break;case"mask":e[h+3]=v}}}getUniformLocations(t,e){return{uTransformMatrix:t.getUniformLocation(e,"uTransformMatrix"),uImage:t.getUniformLocation(e,"uImage")}}sendUniformData(t,e){let n=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,n)}toObject(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}static fromObject(t,e){let{type:n,image:i}=t,s=ke(t,zD);return vi.fromObject(i,e).then(o=>new this(U(U({},s),{},{image:o})))}};z(aa,"type","BlendImage"),z(aa,"defaults",{mode:"multiply",alpha:1,vertexSource:`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `}),St.setClass(aa);var ca=class extends tn{getFragmentSource(){return`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float total = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        float weight = 1.0 - abs(percent);
        color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
        total += weight;
      }
      gl_FragColor = color / total;
    }
  `}applyTo(t){k0(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){t.imageData=this.simpleBlur(t)}simpleBlur(t){let{ctx:e,imageData:n,filterBackend:{resources:i}}=t,{width:s,height:o}=n;i.blurLayer1||(i.blurLayer1=Ke(),i.blurLayer2=Ke());let a=i.blurLayer1,c=i.blurLayer2;a.width===s&&a.height===o||(c.width=a.width=s,c.height=a.height=o);let l=a.getContext("2d"),h=c.getContext("2d"),u=15,d=.06*this.blur*.5,x,m,g,f;for(l.putImageData(n,0,0),h.clearRect(0,0,s,o),f=-15;f<=u;f++)x=(Math.random()-.5)/4,m=f/u,g=d*m*s+x,h.globalAlpha=1-Math.abs(m),h.drawImage(a,g,x),l.drawImage(c,0,0),h.globalAlpha=1,h.clearRect(0,0,c.width,c.height);for(f=-15;f<=u;f++)x=(Math.random()-.5)/4,m=f/u,g=d*m*o+x,h.globalAlpha=1-Math.abs(m),h.drawImage(a,x,g),l.drawImage(c,0,0),h.globalAlpha=1,h.clearRect(0,0,c.width,c.height);e.drawImage(a,0,0);let p=e.getImageData(0,0,a.width,a.height);return l.globalAlpha=1,l.clearRect(0,0,a.width,a.height),p}getUniformLocations(t,e){return{delta:t.getUniformLocation(e,"uDelta")}}sendUniformData(t,e){let n=this.chooseRightDelta();t.uniform2fv(e.delta,n)}chooseRightDelta(){let t=1,e=[0,0];this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio);let n=t*this.blur*.12;return this.horizontal?e[0]=n:e[1]=n,e}};z(ca,"type","Blur"),z(ca,"defaults",{blur:0,mainParameter:"blur"}),St.setClass(ca);var la=class extends tn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;if(this.brightness===0)return;let n=Math.round(255*this.brightness);for(let i=0;i<e.length;i+=4)e[i]=e[i]+n,e[i+1]=e[i+1]+n,e[i+2]=e[i+2]+n}getUniformLocations(t,e){return{uBrightness:t.getUniformLocation(e,"uBrightness")}}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness)}};z(la,"type","Brightness"),z(la,"defaults",{brightness:0,mainParameter:"brightness"}),St.setClass(la);var VD=["matrix"],u1={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0},ts=class extends tn{setOptions(t){let{matrix:e}=t,n=ke(t,VD);e&&(this.matrix=[...e]),Object.assign(this,n)}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`}applyTo2d(t){let e=t.imageData.data,n=this.matrix,i=this.colorsOnly;for(let s=0;s<e.length;s+=4){let o=e[s],a=e[s+1],c=e[s+2];if(i)e[s]=o*n[0]+a*n[1]+c*n[2]+255*n[4],e[s+1]=o*n[5]+a*n[6]+c*n[7]+255*n[9],e[s+2]=o*n[10]+a*n[11]+c*n[12]+255*n[14];else{let l=e[s+3];e[s]=o*n[0]+a*n[1]+c*n[2]+l*n[3]+255*n[4],e[s+1]=o*n[5]+a*n[6]+c*n[7]+l*n[8]+255*n[9],e[s+2]=o*n[10]+a*n[11]+c*n[12]+l*n[13]+255*n[14],e[s+3]=o*n[15]+a*n[16]+c*n[17]+l*n[18]+255*n[19]}}}getUniformLocations(t,e){return{uColorMatrix:t.getUniformLocation(e,"uColorMatrix"),uConstants:t.getUniformLocation(e,"uConstants")}}sendUniformData(t,e){let n=this.matrix,i=[n[0],n[1],n[2],n[3],n[5],n[6],n[7],n[8],n[10],n[11],n[12],n[13],n[15],n[16],n[17],n[18]],s=[n[4],n[9],n[14],n[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,i),t.uniform4fv(e.uConstants,s)}};function Js(r,t){var e;let n=(z(e=class extends ts{},"type",r),z(e,"defaults",U(U({},u1),{},{mainParameter:void 0,matrix:t})),e);return St.setClass(n,r),n}z(ts,"type","ColorMatrix"),z(ts,"defaults",u1),St.setClass(ts);var HD=Js("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),GD=Js("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),WD=Js("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),jD=Js("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),XD=Js("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),YD=Js("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),qD=Js("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]),$D=["subFilters"],jc=class extends tn{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{subFilters:e=[]}=t;super(ke(t,$D)),this.subFilters=e}applyTo(t){k0(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach(e=>{e.applyTo(t)})}toObject(){return U(U({},super.toObject()),{},{subFilters:this.subFilters.map(t=>t.toObject())})}isNeutralState(){return!this.subFilters.some(t=>!t.isNeutralState())}static fromObject(t,e){return Promise.all((t.subFilters||[]).map(n=>St.getClass(n.type).fromObject(n,e))).then(n=>new this({subFilters:n}))}};z(jc,"type","Composed"),St.setClass(jc);var ha=class extends tn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`}applyTo2d(t){let{imageData:{data:e}}=t;if(this.contrast===0)return;let n=Math.floor(255*this.contrast),i=259*(n+255)/(255*(259-n));for(let s=0;s<e.length;s+=4)e[s]=i*(e[s]-128)+128,e[s+1]=i*(e[s+1]-128)+128,e[s+2]=i*(e[s+2]-128)+128}getUniformLocations(t,e){return{uContrast:t.getUniformLocation(e,"uContrast")}}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast)}};z(ha,"type","Contrast"),z(ha,"defaults",{contrast:0,mainParameter:"contrast"}),St.setClass(ha);var ZD={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `},ua=class extends tn{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return ZD[this.getCacheKey()]}applyTo2d(t){let e=t.imageData,n=e.data,i=this.matrix,s=Math.round(Math.sqrt(i.length)),o=Math.floor(s/2),a=e.width,c=e.height,l=t.ctx.createImageData(a,c),h=l.data,u=this.opaque?1:0,d,x,m,g,f,p,v,E,C,b,A,w,S;for(A=0;A<c;A++)for(b=0;b<a;b++){for(f=4*(A*a+b),d=0,x=0,m=0,g=0,S=0;S<s;S++)for(w=0;w<s;w++)v=A+S-o,p=b+w-o,v<0||v>=c||p<0||p>=a||(E=4*(v*a+p),C=i[S*s+w],d+=n[E]*C,x+=n[E+1]*C,m+=n[E+2]*C,u||(g+=n[E+3]*C));h[f]=d,h[f+1]=x,h[f+2]=m,h[f+3]=u?n[f+3]:g}t.imageData=l}getUniformLocations(t,e){return{uMatrix:t.getUniformLocation(e,"uMatrix"),uOpaque:t.getUniformLocation(e,"uOpaque"),uHalfSize:t.getUniformLocation(e,"uHalfSize"),uSize:t.getUniformLocation(e,"uSize")}}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return U(U({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}};z(ua,"type","Convolute"),z(ua,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),St.setClass(ua);var JD=["gamma"],da=class extends tn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{gamma:e=[1,1,1]}=t;super(ke(t,JD)),this.gamma=e}applyTo2d(t){let{imageData:{data:e}}=t,n=this.gamma,i=1/n[0],s=1/n[1],o=1/n[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});let a=this.rgbValues;for(let c=0;c<256;c++)a.r[c]=255*Math.pow(c/255,i),a.g[c]=255*Math.pow(c/255,s),a.b[c]=255*Math.pow(c/255,o);for(let c=0;c<e.length;c+=4)e[c]=a.r[e[c]],e[c+1]=a.g[e[c+1]],e[c+2]=a.b[e[c+2]]}getUniformLocations(t,e){return{uGamma:t.getUniformLocation(e,"uGamma")}}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma)}};z(da,"type","Gamma"),z(da,"defaults",{mainParameter:"gamma",gamma:[1,1,1]}),St.setClass(da);var KD={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `},xa=class extends tn{applyTo2d(t){let{imageData:{data:e}}=t;for(let n,i=0;i<e.length;i+=4){switch(this.mode){case"average":n=(e[i]+e[i+1]+e[i+2])/3;break;case"lightness":n=(Math.min(e[i],e[i+1],e[i+2])+Math.max(e[i],e[i+1],e[i+2]))/2;break;case"luminosity":n=.21*e[i]+.72*e[i+1]+.07*e[i+2]}e[i]=n,e[i+1]=n,e[i+2]=n}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return KD[this.mode]}getUniformLocations(t,e){return{uMode:t.getUniformLocation(e,"uMode")}}sendUniformData(t,e){t.uniform1i(e.uMode,1)}isNeutralState(){return!1}};z(xa,"type","Grayscale"),z(xa,"defaults",{mode:"average",mainParameter:"mode"}),St.setClass(xa);var fa=class extends ts{calculateMatrix(){let t=this.rotation*Math.PI,e=Ii(t),n=Li(t),i=1/3,s=Math.sqrt(i)*n,o=1-e;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=e+o/3,this.matrix[1]=i*o-s,this.matrix[2]=i*o+s,this.matrix[5]=i*o+s,this.matrix[6]=e+i*o,this.matrix[7]=i*o-s,this.matrix[10]=i*o-s,this.matrix[11]=i*o+s,this.matrix[12]=e+i*o}isNeutralState(){return this.calculateMatrix(),super.isNeutralState()}applyTo(t){this.calculateMatrix(),super.applyTo(t)}};z(fa,"type","HueRotation"),z(fa,"defaults",{rotation:0,mainParameter:"rotation"}),St.setClass(fa);var pa=class extends tn{applyTo2d(t){let{imageData:{data:e}}=t;for(let n=0;n<e.length;n+=4)e[n]=255-e[n],e[n+1]=255-e[n+1],e[n+2]=255-e[n+2],this.alpha&&(e[n+3]=255-e[n+3])}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`}isNeutralState(){return!this.invert}getUniformLocations(t,e){return{uInvert:t.getUniformLocation(e,"uInvert"),uAlpha:t.getUniformLocation(e,"uAlpha")}}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha))}};z(pa,"type","Invert"),z(pa,"defaults",{alpha:!1,invert:!0,mainParameter:"invert"}),St.setClass(pa);var ma=class extends tn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;if(this.noise===0)return;let n=this.noise;for(let i=0;i<e.length;i+=4){let s=(.5-Math.random())*n;e[i]+=s,e[i+1]+=s,e[i+2]+=s}}getUniformLocations(t,e){return{uNoise:t.getUniformLocation(e,"uNoise"),uSeed:t.getUniformLocation(e,"uSeed")}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())}toObject(){return U(U({},super.toObject()),{},{noise:this.noise})}};z(ma,"type","Noise"),z(ma,"defaults",{mainParameter:"noise",noise:0}),St.setClass(ma);var ga=class extends tn{applyTo2d(t){let{imageData:{data:e,width:n,height:i}}=t;for(let s=0;s<i;s+=this.blocksize)for(let o=0;o<n;o+=this.blocksize){let a=4*s*n+4*o,c=e[a],l=e[a+1],h=e[a+2],u=e[a+3];for(let d=s;d<Math.min(s+this.blocksize,i);d++)for(let x=o;x<Math.min(o+this.blocksize,n);x++){let m=4*d*n+4*x;e[m]=c,e[m+1]=l,e[m+2]=h,e[m+3]=u}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepW;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`}getUniformLocations(t,e){return{uBlocksize:t.getUniformLocation(e,"uBlocksize"),uStepW:t.getUniformLocation(e,"uStepW"),uStepH:t.getUniformLocation(e,"uStepH")}}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}};z(ga,"type","Pixelate"),z(ga,"defaults",{blocksize:4,mainParameter:"blocksize"}),St.setClass(ga);var va=class extends tn{getFragmentShader(){return`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`}applyTo2d(t){let{imageData:{data:e}}=t,n=255*this.distance,i=new Un(this.color).getSource(),s=[i[0]-n,i[1]-n,i[2]-n],o=[i[0]+n,i[1]+n,i[2]+n];for(let a=0;a<e.length;a+=4){let c=e[a],l=e[a+1],h=e[a+2];c>s[0]&&l>s[1]&&h>s[2]&&c<o[0]&&l<o[1]&&h<o[2]&&(e[a+3]=0)}}getUniformLocations(t,e){return{uLow:t.getUniformLocation(e,"uLow"),uHigh:t.getUniformLocation(e,"uHigh")}}sendUniformData(t,e){let n=new Un(this.color).getSource(),i=this.distance,s=[0+n[0]/255-i,0+n[1]/255-i,0+n[2]/255-i,1],o=[n[0]/255+i,n[1]/255+i,n[2]/255+i,1];t.uniform4fv(e.uLow,s),t.uniform4fv(e.uHigh,o)}toObject(){return U(U({},super.toObject()),{},{color:this.color,distance:this.distance})}};z(va,"type","RemoveColor"),z(va,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),St.setClass(va);var Ea=class extends tn{getUniformLocations(t,e){return{uDelta:t.getUniformLocation(e,"uDelta"),uTaps:t.getUniformLocation(e,"uTaps")}}sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)}getFilterWindow(){let t=this.tempScale;return Math.ceil(this.lanczosLobes/t)}getCacheKey(){let t=this.getFilterWindow();return"".concat(this.type,"_").concat(t)}getFragmentSource(){let t=this.getFilterWindow();return this.generateShader(t)}getTaps(){let t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,n=this.getFilterWindow(),i=new Array(n);for(let s=1;s<=n;s++)i[s-1]=t(s*e);return i}generateShader(t){let e=new Array(t);for(let n=1;n<=t;n++)e[n-1]="".concat(n,".0 * uDelta");return`
      `.concat(this.fragmentSourceTOP,`
      uniform float uTaps[`).concat(t,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(e.map((n,i)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(n,") * uTaps[").concat(i,"] + texture2D(uTexture, vTexCoord - ").concat(n,") * uTaps[").concat(i,`];
              sum += 2.0 * uTaps[`).concat(i,`];
            `)).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyToForWebgl(t){t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,super.applyTo(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,super.applyTo(t),t.sourceHeight=t.destinationHeight}applyTo(t){k0(t)?this.applyToForWebgl(t):this.applyTo2d(t)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<11920929e-14&&e>-11920929e-14)return 1;let n=(e*=Math.PI)/t;return Math.sin(e)/e*Math.sin(n)/n}}applyTo2d(t){let e=t.imageData,n=this.scaleX,i=this.scaleY;this.rcpScaleX=1/n,this.rcpScaleY=1/i;let s=e.width,o=e.height,a=Math.round(s*n),c=Math.round(o*i),l;l=this.resizeType==="sliceHack"?this.sliceByTwo(t,s,o,a,c):this.resizeType==="hermite"?this.hermiteFastResize(t,s,o,a,c):this.resizeType==="bilinear"?this.bilinearFiltering(t,s,o,a,c):this.resizeType==="lanczos"?this.lanczosResize(t,s,o,a,c):new ImageData(a,c),t.imageData=l}sliceByTwo(t,e,n,i,s){let o=t.imageData,a=.5,c=!1,l=!1,h=e*a,u=n*a,d=t.filterBackend.resources,x=0,m=0,g=e,f=0;d.sliceByTwo||(d.sliceByTwo=Ke());let p=d.sliceByTwo;(p.width<1.5*e||p.height<n)&&(p.width=1.5*e,p.height=n);let v=p.getContext("2d");for(v.clearRect(0,0,1.5*e,n),v.putImageData(o,0,0),i=Math.floor(i),s=Math.floor(s);!c||!l;)e=h,n=u,i<Math.floor(h*a)?h=Math.floor(h*a):(h=i,c=!0),s<Math.floor(u*a)?u=Math.floor(u*a):(u=s,l=!0),v.drawImage(p,x,m,e,n,g,f,h,u),x=g,m=f,f+=u;return v.getImageData(x,m,i,s)}lanczosResize(t,e,n,i,s){let o=t.imageData.data,a=t.ctx.createImageData(i,s),c=a.data,l=this.lanczosCreate(this.lanczosLobes),h=this.rcpScaleX,u=this.rcpScaleY,d=2/this.rcpScaleX,x=2/this.rcpScaleY,m=Math.ceil(h*this.lanczosLobes/2),g=Math.ceil(u*this.lanczosLobes/2),f={},p={x:0,y:0},v={x:0,y:0};return function E(C){let b,A,w,S,_,y,D,F,T,L,N;for(p.x=(C+.5)*h,v.x=Math.floor(p.x),b=0;b<s;b++){for(p.y=(b+.5)*u,v.y=Math.floor(p.y),_=0,y=0,D=0,F=0,T=0,A=v.x-m;A<=v.x+m;A++)if(!(A<0||A>=e)){L=Math.floor(1e3*Math.abs(A-p.x)),f[L]||(f[L]={});for(let J=v.y-g;J<=v.y+g;J++)J<0||J>=n||(N=Math.floor(1e3*Math.abs(J-p.y)),f[L][N]||(f[L][N]=l(Math.sqrt(Math.pow(L*d,2)+Math.pow(N*x,2))/1e3)),w=f[L][N],w>0&&(S=4*(J*e+A),_+=w,y+=w*o[S],D+=w*o[S+1],F+=w*o[S+2],T+=w*o[S+3]))}S=4*(b*i+C),c[S]=y/_,c[S+1]=D/_,c[S+2]=F/_,c[S+3]=T/_}return++C<i?E(C):a}(0)}bilinearFiltering(t,e,n,i,s){let o,a,c,l,h,u,d,x,m,g,f,p,v,E=0,C=this.rcpScaleX,b=this.rcpScaleY,A=4*(e-1),w=t.imageData.data,S=t.ctx.createImageData(i,s),_=S.data;for(d=0;d<s;d++)for(x=0;x<i;x++)for(h=Math.floor(C*x),u=Math.floor(b*d),m=C*x-h,g=b*d-u,v=4*(u*e+h),f=0;f<4;f++)o=w[v+f],a=w[v+4+f],c=w[v+A+f],l=w[v+A+4+f],p=o*(1-m)*(1-g)+a*m*(1-g)+c*g*(1-m)+l*m*g,_[E++]=p;return S}hermiteFastResize(t,e,n,i,s){let o=this.rcpScaleX,a=this.rcpScaleY,c=Math.ceil(o/2),l=Math.ceil(a/2),h=t.imageData.data,u=t.ctx.createImageData(i,s),d=u.data;for(let x=0;x<s;x++)for(let m=0;m<i;m++){let g=4*(m+x*i),f=0,p=0,v=0,E=0,C=0,b=0,A=0,w=(x+.5)*a;for(let S=Math.floor(x*a);S<(x+1)*a;S++){let _=Math.abs(w-(S+.5))/l,y=(m+.5)*o,D=_*_;for(let F=Math.floor(m*o);F<(m+1)*o;F++){let T=Math.abs(y-(F+.5))/c,L=Math.sqrt(D+T*T);L>1&&L<-1||(f=2*L*L*L-3*L*L+1,f>0&&(T=4*(F+S*e),A+=f*h[T+3],v+=f,h[T+3]<255&&(f=f*h[T+3]/250),E+=f*h[T],C+=f*h[T+1],b+=f*h[T+2],p+=f))}}d[g]=E/p,d[g+1]=C/p,d[g+2]=b/p,d[g+3]=A/v}return u}toObject(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}};z(Ea,"type","Resize"),z(Ea,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,fragmentSourceTOP:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
  `}),St.setClass(Ea);var _a=class extends tn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;if(this.saturation===0)return;let n=-this.saturation;for(let i=0;i<e.length;i+=4){let s=Math.max(e[i],e[i+1],e[i+2]);e[i]+=s!==e[i]?(s-e[i])*n:0,e[i+1]+=s!==e[i+1]?(s-e[i+1])*n:0,e[i+2]+=s!==e[i+2]?(s-e[i+2])*n:0}}getUniformLocations(t,e){return{uSaturation:t.getUniformLocation(e,"uSaturation")}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation)}};z(_a,"type","Saturation"),z(_a,"defaults",{saturation:0,mainParameter:"saturation"}),St.setClass(_a);var Ca=class extends tn{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;if(this.vibrance===0)return;let n=-this.vibrance;for(let i=0;i<e.length;i+=4){let s=Math.max(e[i],e[i+1],e[i+2]),o=(e[i]+e[i+1]+e[i+2])/3,a=2*Math.abs(s-o)/255*n;e[i]+=s!==e[i]?(s-e[i])*a:0,e[i+1]+=s!==e[i+1]?(s-e[i+1])*a:0,e[i+2]+=s!==e[i+2]?(s-e[i+2])*a:0}}getUniformLocations(t,e){return{uVibrance:t.getUniformLocation(e,"uVibrance")}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}};z(Ca,"type","Vibrance"),z(Ca,"defaults",{vibrance:0,mainParameter:"vibrance"}),St.setClass(Ca);var x6=Object.freeze({__proto__:null,BaseFilter:tn,BlackWhite:qD,BlendColor:oa,BlendImage:aa,Blur:ca,Brightness:la,Brownie:HD,ColorMatrix:ts,Composed:jc,Contrast:ha,Convolute:ua,Gamma:da,Grayscale:xa,HueRotation:fa,Invert:pa,Kodachrome:WD,Noise:ma,Pixelate:ga,Polaroid:XD,RemoveColor:va,Resize:Ea,Saturation:_a,Sepia:YD,Technicolor:jD,Vibrance:Ca,Vintage:GD});var Zc=class extends Vh{constructor(t,e,n){super(document.createElement("div")),this.fabricCanvas=null,this.ticketSize=null,this.side=null,this.decoration=null,this.axiosInstance=null,this.ticketSize=t,this.side=e,this.decoration=n,this.initCanvas(),this.loadFabric(n)}initCanvas(){this.fabricCanvas=new er(this.name,{width:this.ticketSize.x,height:this.ticketSize.y}),this.element=this.fabricCanvas.getElement()}loadFabric(t){return Ut(this,null,function*(){yield this.fabricCanvas?.loadFromJSON(t),this.fabricCanvas?.renderAll()})}};var O0=class{constructor(t,e){this._apiExecutorService=t,this._sceneGraphService=e,this.mobileTicket=null,this.frontSide=null,this.frontDecorationInfo=null,this.backSide=null,this.backDecorationinfo=null}initMobileTicket(){return Ut(this,null,function*(){this.frontDecorationInfo=yield this._apiExecutorService.getTicket(),this.backDecorationinfo=yield this._apiExecutorService.getTicket(),this.loadMaterial()})}loadMaterial(){new Wh().load("assets/untitled.mtl",e=>{e.preload(),this.loadObject(e)})}loadObject(t){let e=new Xh;e.setMaterials(t),e.load("assets/untitled.obj",n=>{this.initCardObject(n)})}initCardObject(t){this.mobileTicket=t.children[0],this.mobileTicket.scale.multiplyScalar(5);let e=this.frontDecorationInfo?.backgroundColor;this.mobileTicket.material.color.set(parseInt(e?.slice(1),16)),this.mobileTicket.rotateOnAxis(new I(0,0,1),Math.PI/2),this.mobileTicket.rotateX(Math.PI/8),this.mobileTicket.rotateY(Math.PI/8),this._sceneGraphService.scene.add(this.mobileTicket),this.initSide("front"),this.initSide("back"),this.checkFaceVisible()}initSide(t){t==="front"?(this.frontSide=new Zc(new Zt(350,600),"front",this.frontDecorationInfo?.fabric),this.frontSide.rotateZ(-Math.PI/2),this.frontSide.position.add(new I(0,0,2.05)),this.mobileTicket?.add(this.frontSide),this.frontSide.scale.multiplyScalar(.205)):t==="back"&&(this.backSide=new Zc(new Zt(350,600),"back",this.backDecorationinfo?.fabric),this.backSide.rotateZ(-Math.PI/2),this.backSide.rotateY(-Math.PI),this.mobileTicket?.add(this.backSide),this.backSide.scale.multiplyScalar(.205))}checkFaceVisible(){let t=this._sceneGraphService.camera?.getWorldDirection(new I(0,0,0)),e=this.frontSide===null?new I(0,0,1):new I(0,0,1).applyQuaternion(this.frontSide.quaternion);t.dot(e)>=0?(this.frontSide.visible=!1,this.backSide.visible=!0):(this.frontSide.visible=!0,this.backSide.visible=!1)}};function Jc(r,t){return function(){return r.apply(t,arguments)}}var{toString:QD}=Object.prototype,{getPrototypeOf:Zf}=Object,L0=(r=>t=>{let e=QD.call(t);return r[e]||(r[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),ir=r=>(r=r.toLowerCase(),t=>L0(t)===r),N0=r=>t=>typeof t===r,{isArray:Ta}=Array,Kc=N0("undefined");function tB(r){return r!==null&&!Kc(r)&&r.constructor!==null&&!Kc(r.constructor)&&Ci(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}var f1=ir("ArrayBuffer");function eB(r){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(r):t=r&&r.buffer&&f1(r.buffer),t}var nB=N0("string"),Ci=N0("function"),p1=N0("number"),U0=r=>r!==null&&typeof r=="object",iB=r=>r===!0||r===!1,I0=r=>{if(L0(r)!=="object")return!1;let t=Zf(r);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},rB=ir("Date"),sB=ir("File"),oB=ir("Blob"),aB=ir("FileList"),cB=r=>U0(r)&&Ci(r.pipe),lB=r=>{let t;return r&&(typeof FormData=="function"&&r instanceof FormData||Ci(r.append)&&((t=L0(r))==="formdata"||t==="object"&&Ci(r.toString)&&r.toString()==="[object FormData]"))},hB=ir("URLSearchParams"),uB=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Qc(r,t,{allOwnKeys:e=!1}={}){if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),Ta(r))for(n=0,i=r.length;n<i;n++)t.call(null,r[n],n,r);else{let s=e?Object.getOwnPropertyNames(r):Object.keys(r),o=s.length,a;for(n=0;n<o;n++)a=s[n],t.call(null,r[a],a,r)}}function m1(r,t){t=t.toLowerCase();let e=Object.keys(r),n=e.length,i;for(;n-- >0;)if(i=e[n],t===i.toLowerCase())return i;return null}var g1=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,v1=r=>!Kc(r)&&r!==g1;function $f(){let{caseless:r}=v1(this)&&this||{},t={},e=(n,i)=>{let s=r&&m1(t,i)||i;I0(t[s])&&I0(n)?t[s]=$f(t[s],n):I0(n)?t[s]=$f({},n):Ta(n)?t[s]=n.slice():t[s]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&Qc(arguments[n],e);return t}var dB=(r,t,e,{allOwnKeys:n}={})=>(Qc(t,(i,s)=>{e&&Ci(i)?r[s]=Jc(i,e):r[s]=i},{allOwnKeys:n}),r),xB=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),fB=(r,t,e,n)=>{r.prototype=Object.create(t.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:t.prototype}),e&&Object.assign(r.prototype,e)},pB=(r,t,e,n)=>{let i,s,o,a={};if(t=t||{},r==null)return t;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],(!n||n(o,r,t))&&!a[o]&&(t[o]=r[o],a[o]=!0);r=e!==!1&&Zf(r)}while(r&&(!e||e(r,t))&&r!==Object.prototype);return t},mB=(r,t,e)=>{r=String(r),(e===void 0||e>r.length)&&(e=r.length),e-=t.length;let n=r.indexOf(t,e);return n!==-1&&n===e},gB=r=>{if(!r)return null;if(Ta(r))return r;let t=r.length;if(!p1(t))return null;let e=new Array(t);for(;t-- >0;)e[t]=r[t];return e},vB=(r=>t=>r&&t instanceof r)(typeof Uint8Array<"u"&&Zf(Uint8Array)),EB=(r,t)=>{let n=(r&&r[Symbol.iterator]).call(r),i;for(;(i=n.next())&&!i.done;){let s=i.value;t.call(r,s[0],s[1])}},_B=(r,t)=>{let e,n=[];for(;(e=r.exec(t))!==null;)n.push(e);return n},CB=ir("HTMLFormElement"),yB=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),d1=(({hasOwnProperty:r})=>(t,e)=>r.call(t,e))(Object.prototype),AB=ir("RegExp"),E1=(r,t)=>{let e=Object.getOwnPropertyDescriptors(r),n={};Qc(e,(i,s)=>{let o;(o=t(i,s,r))!==!1&&(n[s]=o||i)}),Object.defineProperties(r,n)},bB=r=>{E1(r,(t,e)=>{if(Ci(r)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;let n=r[e];if(Ci(n)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},wB=(r,t)=>{let e={},n=i=>{i.forEach(s=>{e[s]=!0})};return Ta(r)?n(r):n(String(r).split(t)),e},SB=()=>{},MB=(r,t)=>(r=+r,Number.isFinite(r)?r:t),qf="abcdefghijklmnopqrstuvwxyz",x1="0123456789",_1={DIGIT:x1,ALPHA:qf,ALPHA_DIGIT:qf+qf.toUpperCase()+x1},DB=(r=16,t=_1.ALPHA_DIGIT)=>{let e="",{length:n}=t;for(;r--;)e+=t[Math.random()*n|0];return e};function BB(r){return!!(r&&Ci(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}var TB=r=>{let t=new Array(10),e=(n,i)=>{if(U0(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[i]=n;let s=Ta(n)?[]:{};return Qc(n,(o,a)=>{let c=e(o,i+1);!Kc(c)&&(s[a]=c)}),t[i]=void 0,s}}return n};return e(r,0)},FB=ir("AsyncFunction"),PB=r=>r&&(U0(r)||Ci(r))&&Ci(r.then)&&Ci(r.catch),it={isArray:Ta,isArrayBuffer:f1,isBuffer:tB,isFormData:lB,isArrayBufferView:eB,isString:nB,isNumber:p1,isBoolean:iB,isObject:U0,isPlainObject:I0,isUndefined:Kc,isDate:rB,isFile:sB,isBlob:oB,isRegExp:AB,isFunction:Ci,isStream:cB,isURLSearchParams:hB,isTypedArray:vB,isFileList:aB,forEach:Qc,merge:$f,extend:dB,trim:uB,stripBOM:xB,inherits:fB,toFlatObject:pB,kindOf:L0,kindOfTest:ir,endsWith:mB,toArray:gB,forEachEntry:EB,matchAll:_B,isHTMLForm:CB,hasOwnProperty:d1,hasOwnProp:d1,reduceDescriptors:E1,freezeMethods:bB,toObjectSet:wB,toCamelCase:yB,noop:SB,toFiniteNumber:MB,findKey:m1,global:g1,isContextDefined:v1,ALPHABET:_1,generateString:DB,isSpecCompliantForm:BB,toJSONObject:TB,isAsyncFn:FB,isThenable:PB};function Fa(r,t,e,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),n&&(this.request=n),i&&(this.response=i)}it.inherits(Fa,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:it.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var C1=Fa.prototype,y1={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{y1[r]={value:r}});Object.defineProperties(Fa,y1);Object.defineProperty(C1,"isAxiosError",{value:!0});Fa.from=(r,t,e,n,i,s)=>{let o=Object.create(C1);return it.toFlatObject(r,o,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),Fa.call(o,r.message,t,e,n,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};var xe=Fa;var z0=null;function Jf(r){return it.isPlainObject(r)||it.isArray(r)}function b1(r){return it.endsWith(r,"[]")?r.slice(0,-2):r}function A1(r,t,e){return r?r.concat(t).map(function(i,s){return i=b1(i),!e&&s?"["+i+"]":i}).join(e?".":""):t}function RB(r){return it.isArray(r)&&!r.some(Jf)}var kB=it.toFlatObject(it,{},null,function(t){return/^is[A-Z]/.test(t)});function OB(r,t,e){if(!it.isObject(r))throw new TypeError("target must be an object");t=t||new(z0||FormData),e=it.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,f){return!it.isUndefined(f[g])});let n=e.metaTokens,i=e.visitor||h,s=e.dots,o=e.indexes,c=(e.Blob||typeof Blob<"u"&&Blob)&&it.isSpecCompliantForm(t);if(!it.isFunction(i))throw new TypeError("visitor must be a function");function l(m){if(m===null)return"";if(it.isDate(m))return m.toISOString();if(!c&&it.isBlob(m))throw new xe("Blob is not supported. Use a Buffer instead.");return it.isArrayBuffer(m)||it.isTypedArray(m)?c&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function h(m,g,f){let p=m;if(m&&!f&&typeof m=="object"){if(it.endsWith(g,"{}"))g=n?g:g.slice(0,-2),m=JSON.stringify(m);else if(it.isArray(m)&&RB(m)||(it.isFileList(m)||it.endsWith(g,"[]"))&&(p=it.toArray(m)))return g=b1(g),p.forEach(function(E,C){!(it.isUndefined(E)||E===null)&&t.append(o===!0?A1([g],C,s):o===null?g:g+"[]",l(E))}),!1}return Jf(m)?!0:(t.append(A1(f,g,s),l(m)),!1)}let u=[],d=Object.assign(kB,{defaultVisitor:h,convertValue:l,isVisitable:Jf});function x(m,g){if(!it.isUndefined(m)){if(u.indexOf(m)!==-1)throw Error("Circular reference detected in "+g.join("."));u.push(m),it.forEach(m,function(p,v){(!(it.isUndefined(p)||p===null)&&i.call(t,p,it.isString(v)?v.trim():v,g,d))===!0&&x(p,g?g.concat(v):[v])}),u.pop()}}if(!it.isObject(r))throw new TypeError("data must be an object");return x(r),t}var os=OB;function w1(r){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function S1(r,t){this._pairs=[],r&&os(r,this,t)}var M1=S1.prototype;M1.append=function(t,e){this._pairs.push([t,e])};M1.toString=function(t){let e=t?function(n){return t.call(this,n,w1)}:w1;return this._pairs.map(function(i){return e(i[0])+"="+e(i[1])},"").join("&")};var V0=S1;function IB(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function tl(r,t,e){if(!t)return r;let n=e&&e.encode||IB,i=e&&e.serialize,s;if(i?s=i(t,e):s=it.isURLSearchParams(t)?t.toString():new V0(t,e).toString(n),s){let o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}var Kf=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){it.forEach(this.handlers,function(n){n!==null&&t(n)})}},Qf=Kf;var H0={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var D1=typeof URLSearchParams<"u"?URLSearchParams:V0;var B1=typeof FormData<"u"?FormData:null;var T1=typeof Blob<"u"?Blob:null;var F1={isBrowser:!0,classes:{URLSearchParams:D1,FormData:B1,Blob:T1},protocols:["http","https","file","blob","url","data"]};var tp={};wC(tp,{hasBrowserEnv:()=>P1,hasStandardBrowserEnv:()=>LB,hasStandardBrowserWebWorkerEnv:()=>NB});var P1=typeof window<"u"&&typeof document<"u",LB=(r=>P1&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),NB=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";var zn=Ot(Ot({},tp),F1);function ep(r,t){return os(r,new zn.classes.URLSearchParams,Object.assign({visitor:function(e,n,i,s){return zn.isNode&&it.isBuffer(e)?(this.append(n,e.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},t))}function UB(r){return it.matchAll(/\w+|\[(\w*)]/g,r).map(t=>t[0]==="[]"?"":t[1]||t[0])}function zB(r){let t={},e=Object.keys(r),n,i=e.length,s;for(n=0;n<i;n++)s=e[n],t[s]=r[s];return t}function VB(r){function t(e,n,i,s){let o=e[s++];if(o==="__proto__")return!0;let a=Number.isFinite(+o),c=s>=e.length;return o=!o&&it.isArray(i)?i.length:o,c?(it.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!a):((!i[o]||!it.isObject(i[o]))&&(i[o]=[]),t(e,n,i[o],s)&&it.isArray(i[o])&&(i[o]=zB(i[o])),!a)}if(it.isFormData(r)&&it.isFunction(r.entries)){let e={};return it.forEachEntry(r,(n,i)=>{t(UB(n),i,e,0)}),e}return null}var G0=VB;function HB(r,t,e){if(it.isString(r))try{return(t||JSON.parse)(r),it.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(e||JSON.stringify)(r)}var np={transitional:H0,adapter:["xhr","http"],transformRequest:[function(t,e){let n=e.getContentType()||"",i=n.indexOf("application/json")>-1,s=it.isObject(t);if(s&&it.isHTMLForm(t)&&(t=new FormData(t)),it.isFormData(t))return i?JSON.stringify(G0(t)):t;if(it.isArrayBuffer(t)||it.isBuffer(t)||it.isStream(t)||it.isFile(t)||it.isBlob(t))return t;if(it.isArrayBufferView(t))return t.buffer;if(it.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return ep(t,this.formSerializer).toString();if((a=it.isFileList(t))||n.indexOf("multipart/form-data")>-1){let c=this.env&&this.env.FormData;return os(a?{"files[]":t}:t,c&&new c,this.formSerializer)}}return s||i?(e.setContentType("application/json",!1),HB(t)):t}],transformResponse:[function(t){let e=this.transitional||np.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(t&&it.isString(t)&&(n&&!this.responseType||i)){let o=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(a){if(o)throw a.name==="SyntaxError"?xe.from(a,xe.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:zn.classes.FormData,Blob:zn.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};it.forEach(["delete","get","head","post","put","patch"],r=>{np.headers[r]={}});var Pa=np;var GB=it.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),R1=r=>{let t={},e,n,i;return r&&r.split(`
`).forEach(function(o){i=o.indexOf(":"),e=o.substring(0,i).trim().toLowerCase(),n=o.substring(i+1).trim(),!(!e||t[e]&&GB[e])&&(e==="set-cookie"?t[e]?t[e].push(n):t[e]=[n]:t[e]=t[e]?t[e]+", "+n:n)}),t};var k1=Symbol("internals");function el(r){return r&&String(r).trim().toLowerCase()}function W0(r){return r===!1||r==null?r:it.isArray(r)?r.map(W0):String(r)}function WB(r){let t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,n;for(;n=e.exec(r);)t[n[1]]=n[2];return t}var jB=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function ip(r,t,e,n,i){if(it.isFunction(n))return n.call(this,t,e);if(i&&(t=e),!!it.isString(t)){if(it.isString(n))return t.indexOf(n)!==-1;if(it.isRegExp(n))return n.test(t)}}function XB(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,n)=>e.toUpperCase()+n)}function YB(r,t){let e=it.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+e,{value:function(i,s,o){return this[n].call(this,t,i,s,o)},configurable:!0})})}var Ra=class{constructor(t){t&&this.set(t)}set(t,e,n){let i=this;function s(a,c,l){let h=el(c);if(!h)throw new Error("header name must be a non-empty string");let u=it.findKey(i,h);(!u||i[u]===void 0||l===!0||l===void 0&&i[u]!==!1)&&(i[u||c]=W0(a))}let o=(a,c)=>it.forEach(a,(l,h)=>s(l,h,c));return it.isPlainObject(t)||t instanceof this.constructor?o(t,e):it.isString(t)&&(t=t.trim())&&!jB(t)?o(R1(t),e):t!=null&&s(e,t,n),this}get(t,e){if(t=el(t),t){let n=it.findKey(this,t);if(n){let i=this[n];if(!e)return i;if(e===!0)return WB(i);if(it.isFunction(e))return e.call(this,i,n);if(it.isRegExp(e))return e.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=el(t),t){let n=it.findKey(this,t);return!!(n&&this[n]!==void 0&&(!e||ip(this,this[n],n,e)))}return!1}delete(t,e){let n=this,i=!1;function s(o){if(o=el(o),o){let a=it.findKey(n,o);a&&(!e||ip(n,n[a],a,e))&&(delete n[a],i=!0)}}return it.isArray(t)?t.forEach(s):s(t),i}clear(t){let e=Object.keys(this),n=e.length,i=!1;for(;n--;){let s=e[n];(!t||ip(this,this[s],s,t,!0))&&(delete this[s],i=!0)}return i}normalize(t){let e=this,n={};return it.forEach(this,(i,s)=>{let o=it.findKey(n,s);if(o){e[o]=W0(i),delete e[s];return}let a=t?XB(s):String(s).trim();a!==s&&delete e[s],e[a]=W0(i),n[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){let e=Object.create(null);return it.forEach(this,(n,i)=>{n!=null&&n!==!1&&(e[i]=t&&it.isArray(n)?n.join(", "):n)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){let n=new this(t);return e.forEach(i=>n.set(i)),n}static accessor(t){let n=(this[k1]=this[k1]={accessors:{}}).accessors,i=this.prototype;function s(o){let a=el(o);n[a]||(YB(i,o),n[a]=!0)}return it.isArray(t)?t.forEach(s):s(t),this}};Ra.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);it.reduceDescriptors(Ra.prototype,({value:r},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(n){this[e]=n}}});it.freezeMethods(Ra);var Vn=Ra;function nl(r,t){let e=this||Pa,n=t||e,i=Vn.from(n.headers),s=n.data;return it.forEach(r,function(a){s=a.call(e,s,i.normalize(),t?t.status:void 0)}),i.normalize(),s}function il(r){return!!(r&&r.__CANCEL__)}function O1(r,t,e){xe.call(this,r??"canceled",xe.ERR_CANCELED,t,e),this.name="CanceledError"}it.inherits(O1,xe,{__CANCEL__:!0});var as=O1;function rp(r,t,e){let n=e.config.validateStatus;!e.status||!n||n(e.status)?r(e):t(new xe("Request failed with status code "+e.status,[xe.ERR_BAD_REQUEST,xe.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}var I1=zn.hasStandardBrowserEnv?{write(r,t,e,n,i,s){let o=[r+"="+encodeURIComponent(t)];it.isNumber(e)&&o.push("expires="+new Date(e).toGMTString()),it.isString(n)&&o.push("path="+n),it.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(r){let t=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function sp(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function op(r,t){return t?r.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):r}function rl(r,t){return r&&!sp(t)?op(r,t):t}var L1=zn.hasStandardBrowserEnv?function(){let t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a"),n;function i(s){let o=s;return t&&(e.setAttribute("href",o),o=e.href),e.setAttribute("href",o),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return n=i(window.location.href),function(o){let a=it.isString(o)?i(o):o;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}();function ap(r){let t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return t&&t[1]||""}function qB(r,t){r=r||10;let e=new Array(r),n=new Array(r),i=0,s=0,o;return t=t!==void 0?t:1e3,function(c){let l=Date.now(),h=n[s];o||(o=l),e[i]=c,n[i]=l;let u=s,d=0;for(;u!==i;)d+=e[u++],u=u%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),l-o<t)return;let x=h&&l-h;return x?Math.round(d*1e3/x):void 0}}var N1=qB;function U1(r,t){let e=0,n=N1(50,250);return i=>{let s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-e,c=n(a),l=s<=o;e=s;let h={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&l?(o-s)/c:void 0,event:i};h[t?"download":"upload"]=!0,r(h)}}var $B=typeof XMLHttpRequest<"u",z1=$B&&function(r){return new Promise(function(e,n){let i=r.data,s=Vn.from(r.headers).normalize(),{responseType:o,withXSRFToken:a}=r,c;function l(){r.cancelToken&&r.cancelToken.unsubscribe(c),r.signal&&r.signal.removeEventListener("abort",c)}let h;if(it.isFormData(i)){if(zn.hasStandardBrowserEnv||zn.hasStandardBrowserWebWorkerEnv)s.setContentType(!1);else if((h=s.getContentType())!==!1){let[g,...f]=h?h.split(";").map(p=>p.trim()).filter(Boolean):[];s.setContentType([g||"multipart/form-data",...f].join("; "))}}let u=new XMLHttpRequest;if(r.auth){let g=r.auth.username||"",f=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";s.set("Authorization","Basic "+btoa(g+":"+f))}let d=rl(r.baseURL,r.url);u.open(r.method.toUpperCase(),tl(d,r.params,r.paramsSerializer),!0),u.timeout=r.timeout;function x(){if(!u)return;let g=Vn.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),p={data:!o||o==="text"||o==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:g,config:r,request:u};rp(function(E){e(E),l()},function(E){n(E),l()},p),u=null}if("onloadend"in u?u.onloadend=x:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(x)},u.onabort=function(){u&&(n(new xe("Request aborted",xe.ECONNABORTED,r,u)),u=null)},u.onerror=function(){n(new xe("Network Error",xe.ERR_NETWORK,r,u)),u=null},u.ontimeout=function(){let f=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",p=r.transitional||H0;r.timeoutErrorMessage&&(f=r.timeoutErrorMessage),n(new xe(f,p.clarifyTimeoutError?xe.ETIMEDOUT:xe.ECONNABORTED,r,u)),u=null},zn.hasStandardBrowserEnv&&(a&&it.isFunction(a)&&(a=a(r)),a||a!==!1&&L1(d))){let g=r.xsrfHeaderName&&r.xsrfCookieName&&I1.read(r.xsrfCookieName);g&&s.set(r.xsrfHeaderName,g)}i===void 0&&s.setContentType(null),"setRequestHeader"in u&&it.forEach(s.toJSON(),function(f,p){u.setRequestHeader(p,f)}),it.isUndefined(r.withCredentials)||(u.withCredentials=!!r.withCredentials),o&&o!=="json"&&(u.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&u.addEventListener("progress",U1(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",U1(r.onUploadProgress)),(r.cancelToken||r.signal)&&(c=g=>{u&&(n(!g||g.type?new as(null,r,u):g),u.abort(),u=null)},r.cancelToken&&r.cancelToken.subscribe(c),r.signal&&(r.signal.aborted?c():r.signal.addEventListener("abort",c)));let m=ap(d);if(m&&zn.protocols.indexOf(m)===-1){n(new xe("Unsupported protocol "+m+":",xe.ERR_BAD_REQUEST,r));return}u.send(i||null)})};var cp={http:z0,xhr:z1};it.forEach(cp,(r,t)=>{if(r){try{Object.defineProperty(r,"name",{value:t})}catch{}Object.defineProperty(r,"adapterName",{value:t})}});var V1=r=>`- ${r}`,ZB=r=>it.isFunction(r)||r===null||r===!1,j0={getAdapter:r=>{r=it.isArray(r)?r:[r];let{length:t}=r,e,n,i={};for(let s=0;s<t;s++){e=r[s];let o;if(n=e,!ZB(e)&&(n=cp[(o=String(e)).toLowerCase()],n===void 0))throw new xe(`Unknown adapter '${o}'`);if(n)break;i[o||"#"+s]=n}if(!n){let s=Object.entries(i).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build")),o=t?s.length>1?`since :
`+s.map(V1).join(`
`):" "+V1(s[0]):"as no adapter specified";throw new xe("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n},adapters:cp};function lp(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new as(null,r)}function X0(r){return lp(r),r.headers=Vn.from(r.headers),r.data=nl.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),j0.getAdapter(r.adapter||Pa.adapter)(r).then(function(n){return lp(r),n.data=nl.call(r,r.transformResponse,n),n.headers=Vn.from(n.headers),n},function(n){return il(n)||(lp(r),n&&n.response&&(n.response.data=nl.call(r,r.transformResponse,n.response),n.response.headers=Vn.from(n.response.headers))),Promise.reject(n)})}var H1=r=>r instanceof Vn?Ot({},r):r;function br(r,t){t=t||{};let e={};function n(l,h,u){return it.isPlainObject(l)&&it.isPlainObject(h)?it.merge.call({caseless:u},l,h):it.isPlainObject(h)?it.merge({},h):it.isArray(h)?h.slice():h}function i(l,h,u){if(it.isUndefined(h)){if(!it.isUndefined(l))return n(void 0,l,u)}else return n(l,h,u)}function s(l,h){if(!it.isUndefined(h))return n(void 0,h)}function o(l,h){if(it.isUndefined(h)){if(!it.isUndefined(l))return n(void 0,l)}else return n(void 0,h)}function a(l,h,u){if(u in t)return n(l,h);if(u in r)return n(void 0,l)}let c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(l,h)=>i(H1(l),H1(h),!0)};return it.forEach(Object.keys(Object.assign({},r,t)),function(h){let u=c[h]||i,d=u(r[h],t[h],h);it.isUndefined(d)&&u!==a||(e[h]=d)}),e}var Y0="1.6.8";var hp={};["object","boolean","number","function","string","symbol"].forEach((r,t)=>{hp[r]=function(n){return typeof n===r||"a"+(t<1?"n ":" ")+r}});var G1={};hp.transitional=function(t,e,n){function i(s,o){return"[Axios v"+Y0+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return(s,o,a)=>{if(t===!1)throw new xe(i(o," has been removed"+(e?" in "+e:"")),xe.ERR_DEPRECATED);return e&&!G1[o]&&(G1[o]=!0,console.warn(i(o," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(s,o,a):!0}};function JB(r,t,e){if(typeof r!="object")throw new xe("options must be an object",xe.ERR_BAD_OPTION_VALUE);let n=Object.keys(r),i=n.length;for(;i-- >0;){let s=n[i],o=t[s];if(o){let a=r[s],c=a===void 0||o(a,s,r);if(c!==!0)throw new xe("option "+s+" must be "+c,xe.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new xe("Unknown option "+s,xe.ERR_BAD_OPTION)}}var q0={assertOptions:JB,validators:hp};var cs=q0.validators,ka=class{constructor(t){this.defaults=t,this.interceptors={request:new Qf,response:new Qf}}request(t,e){return Ut(this,null,function*(){try{return yield this._request(t,e)}catch(n){if(n instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;let s=i.stack?i.stack.replace(/^.+\n/,""):"";n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}throw n}})}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=br(this.defaults,e);let{transitional:n,paramsSerializer:i,headers:s}=e;n!==void 0&&q0.assertOptions(n,{silentJSONParsing:cs.transitional(cs.boolean),forcedJSONParsing:cs.transitional(cs.boolean),clarifyTimeoutError:cs.transitional(cs.boolean)},!1),i!=null&&(it.isFunction(i)?e.paramsSerializer={serialize:i}:q0.assertOptions(i,{encode:cs.function,serialize:cs.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let o=s&&it.merge(s.common,s[e.method]);s&&it.forEach(["delete","get","head","post","put","patch","common"],m=>{delete s[m]}),e.headers=Vn.concat(o,s);let a=[],c=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(e)===!1||(c=c&&g.synchronous,a.unshift(g.fulfilled,g.rejected))});let l=[];this.interceptors.response.forEach(function(g){l.push(g.fulfilled,g.rejected)});let h,u=0,d;if(!c){let m=[X0.bind(this),void 0];for(m.unshift.apply(m,a),m.push.apply(m,l),d=m.length,h=Promise.resolve(e);u<d;)h=h.then(m[u++],m[u++]);return h}d=a.length;let x=e;for(u=0;u<d;){let m=a[u++],g=a[u++];try{x=m(x)}catch(f){g.call(this,f);break}}try{h=X0.call(this,x)}catch(m){return Promise.reject(m)}for(u=0,d=l.length;u<d;)h=h.then(l[u++],l[u++]);return h}getUri(t){t=br(this.defaults,t);let e=rl(t.baseURL,t.url);return tl(e,t.params,t.paramsSerializer)}};it.forEach(["delete","get","head","options"],function(t){ka.prototype[t]=function(e,n){return this.request(br(n||{},{method:t,url:e,data:(n||{}).data}))}});it.forEach(["post","put","patch"],function(t){function e(n){return function(s,o,a){return this.request(br(a||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}ka.prototype[t]=e(),ka.prototype[t+"Form"]=e(!0)});var sl=ka;var up=class r{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(s){e=s});let n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s,o=new Promise(a=>{n.subscribe(a),s=a}).then(i);return o.cancel=function(){n.unsubscribe(s)},o},t(function(s,o,a){n.reason||(n.reason=new as(s,o,a),e(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}static source(){let t;return{token:new r(function(i){t=i}),cancel:t}}},W1=up;function dp(r){return function(e){return r.apply(null,e)}}function xp(r){return it.isObject(r)&&r.isAxiosError===!0}var fp={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(fp).forEach(([r,t])=>{fp[t]=r});var j1=fp;function X1(r){let t=new sl(r),e=Jc(sl.prototype.request,t);return it.extend(e,sl.prototype,t,{allOwnKeys:!0}),it.extend(e,t,null,{allOwnKeys:!0}),e.create=function(i){return X1(br(r,i))},e}var cn=X1(Pa);cn.Axios=sl;cn.CanceledError=as;cn.CancelToken=W1;cn.isCancel=il;cn.VERSION=Y0;cn.toFormData=os;cn.AxiosError=xe;cn.Cancel=cn.CanceledError;cn.all=function(t){return Promise.all(t)};cn.spread=dp;cn.isAxiosError=xp;cn.mergeConfig=br;cn.AxiosHeaders=Vn;cn.formToJSON=r=>G0(it.isHTMLForm(r)?new FormData(r):r);cn.getAdapter=j0.getAdapter;cn.HttpStatusCode=j1;cn.default=cn;var ls=cn;var{Axios:hP,AxiosError:uP,CanceledError:dP,isCancel:xP,CancelToken:fP,VERSION:pP,all:mP,Cancel:gP,isAxiosError:vP,spread:EP,toFormData:_P,AxiosHeaders:CP,HttpStatusCode:yP,formToJSON:AP,getAdapter:bP,mergeConfig:wP}=ls;var hs=(()=>{let t=class t{constructor(){this.SCENE_BACKGROUND_COLOR="#FFFFFF",this.MOIM_ID="",this.DIARY_ID="",this.FACE_TYPE="",this.VIEW_TYPE=""}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();var Yn=(()=>{let t=class t{constructor(n){this._ssalonConfigService=n,this.apiExecutor=null,this.apiExecutorJson=null,this.apiURL="https://ssalon.co.kr/api",this.tokens={access:"eyJhbGciOiJIUzI1NiJ9.eyJjYXRlZ29yeSI6ImFjY2VzcyIsInVzZXJuYW1lIjoibmF2ZXIgbHphV19oUmprc1kzZXo1NUtJckpXdE9mMk1qTi1GZzJJbUF5SXBPOFNlcyIsInJvbGUiOiJST0xFX1VTRVIiLCJpYXQiOjE3MTU1OTE5NDksImV4cCI6MTcxNTY3ODM0OX0.HX1lfce-A3Z_1T7yTWx5BDBpyU6TlN2uVZC4Vws9c34",refresh:"eyJhbGciOiJIUzI1NiJ9.eyJjYXRlZ29yeSI6InJlZnJlc2giLCJ1c2VybmFtZSI6Im5hdmVyIGx6YVdfaFJqa3NZM2V6NTVLSXJKV3RPZjJNak4tRmcySW1BeUlwTzhTZXMiLCJyb2xlIjoiUk9MRV9VU0VSIiwiaWF0IjoxNzE1NTkxOTQ5LCJleHAiOjE3MTU2NzgzNDl9.BbsDE1762RDKxKmFGOyry46-wpkrcVv1SkYjBAy553U"},this._token=this.tokens.access,this.refreshToken=this.tokens.refresh,this.initApiExecutor()}setToken(n){this._token=n}initApiExecutor(){this.apiExecutor=ls.create({baseURL:this.apiURL,headers:{"Content-Type":"multipart/form-data","Access-Control-Allow-Origin":"*"}}),this.apiExecutorJson=ls.create({baseURL:this.apiURL,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*",Authorization:`Bearer ${this._token}`,Refresh:this.refreshToken}})}getTicket(){return Ut(this,null,function*(){try{return(yield this.apiExecutor?.get(`/tickets/${this._ssalonConfigService.MOIM_ID}`)).data}catch{return(yield ls.get("assets/decoration.json")).data}})}editTicket(n){return Ut(this,null,function*(){try{return(yield this.apiExecutor?.put(`/tickets/${this._ssalonConfigService.MOIM_ID}`,n)).data}catch(i){return console.log(i),(yield ls.get("assets/decoration.json")).data}})}getDiary(){return Ut(this,null,function*(){try{return(yield this.apiExecutor?.post(`/diary/${this._ssalonConfigService.DIARY_ID}`)).data}catch{return(yield ls.get("assets/decoration.json")).data}})}editDiary(n){return Ut(this,null,function*(){})}getBarcode(){return Ut(this,null,function*(){try{return(yield this.apiExecutorJson?.get(`/tickets/${this._ssalonConfigService.MOIM_ID}/link`)).data}catch{return"asdfo7a809sd7fwae9089iafa"}})}checkQR(n){return Ut(this,null,function*(){try{let i={qrKey:n};return(yield this.apiExecutorJson?.post(`/tickets/${this._ssalonConfigService.MOIM_ID}/link`,i)).data}catch{}})}changeAttendanceStatus(n,i=!1){return Ut(this,null,function*(){try{return(yield this.apiExecutorJson?.post(`/moims/${this._ssalonConfigService.MOIM_ID}/attendance/${n}`)).data}catch{}})}getJoiningUsers(){return Ut(this,null,function*(){try{return(yield this.apiExecutorJson?.get(`/moims/${this._ssalonConfigService.MOIM_ID}/users`)).data}catch{}})}getMoimInfo(n){return Ut(this,null,function*(){try{return(yield this.apiExecutorJson?.get(`/moims/${n}`)).data}catch(i){console.log(i)}})}makeMoim(n){return Ut(this,null,function*(){try{return(yield this.apiExecutorJson?.post("/moims",n)).data}catch(i){console.log(i)}})}getMoims(){return Ut(this,null,function*(){try{return(yield this.apiExecutorJson?.get("/moims")).data}catch(n){console.log(n)}})}};t.\u0275fac=function(i){return new(i||t)(Le(hs))},t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})();var Oa=(()=>{let t=class t{constructor(n,i,s){this._route=n,this._apiExecutorService=i,this._ssalonConfigService=s,this.scene=null,this.camera=null,this.lights={},this.nativeElement=null,this.webGLRenderer=null,this.css3dRenderer=null,this.arcballControls=null,this.mobileTicket=null,this.mobileTicketAutoRotate=!1,this._route.queryParams.subscribe(o=>{this._ssalonConfigService.MOIM_ID=o.moimId,this._ssalonConfigService.VIEW_TYPE=o.viewType,this._ssalonConfigService.FACE_TYPE=o.faceType,o.token!==void 0&&(this._apiExecutorService._token=o.token)})}initThree(){let n=this.nativeElement.clientWidth,i=this.nativeElement.clientHeight;this.scene=new Mh,this.scene.background=new $t(16777215),this.camera=new Tn(75,n/i,.1,2e3),this.camera.position.z=600,this.createLight("pointLight1",new I(0,0,300)),this.createLight("pointLight2",new I(0,0,-300)),this.createLight("pointLight3",new I(0,400,300)),this.initCss3dRenderer(n,i),this.initWebGLRenderer(n,i),this.createArcballControls(),this.mobileTicket=new O0(this._apiExecutorService,this),this.mobileTicket.initMobileTicket(),KB(this)}createLight(n,i){this.lights[n]=new Ph(16777215),this.lights[n].position.copy(i),this.lights[n].intensity=10,this.lights[n].decay=.3,this.lights[n].lookAt(0,0,0),this.scene.add(this.lights[n])}initWebGLRenderer(n,i){this.webGLRenderer=new Sh({antialias:!0}),this.webGLRenderer.setPixelRatio(window.devicePixelRatio),this.webGLRenderer.autoClear=!1,this.webGLRenderer.domElement.style.touchAction="none",this.webGLRenderer.setSize(n,i),this.nativeElement.appendChild(this.webGLRenderer.domElement)}initCss3dRenderer(n,i){this.css3dRenderer=new Hh,this.css3dRenderer.domElement.style.touchAction="none",this.css3dRenderer.domElement.style.position="absolute",this.css3dRenderer.setSize(n,i),this.nativeElement.appendChild(this.css3dRenderer.domElement)}destroy(){this.nativeElement.removeChild(this.webGLRenderer.domElement),this.nativeElement.removeChild(this.css3dRenderer.domElement)}createArcballControls(){this.arcballControls=new Gh(this.camera,this.css3dRenderer.domElement,this.scene),this.arcballControls.setGizmosVisible(!1),this.arcballControls.enableAnimations=!0,this.arcballControls.dampingFactor=2,this.arcballControls.addEventListener("change",()=>{this.css3dRenderer.render(this.scene,this.camera),this.mobileTicket?.checkFaceVisible()}),this.arcballControls.enabled=!0}onRender(){this.webGLRenderer.render(this.scene,this.camera),this.css3dRenderer.render(this.scene,this.camera)}focusFront(){this.arcballControls.reset()}rotateCard(){this.mobileTicket.mobileTicket?.rotateX(.002),this.mobileTicket.mobileTicket?.rotateY(.002),this.mobileTicket.mobileTicket?.rotateZ(.002),this.mobileTicket?.frontSide!==null&&this.mobileTicket?.backSide!==null&&this.mobileTicket?.checkFaceVisible()}};t.\u0275fac=function(i){return new(i||t)(Le(Gn),Le(Yn),Le(hs))},t.\u0275prov=Ae({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})(),KB=function(r){let t=new kh,e=function(){r.mobileTicketAutoRotate&&r.rotateCard(),r.onRender(),requestAnimationFrame(e)};e()};var QB=["rendererContainer"],Y1=(()=>{let t=class t{constructor(n){this._sceneGraphService=n,this.rendererContainer=null,this.majorFace="front",this.isEditing=!1}ngOnInit(){}ngAfterViewInit(){this._sceneGraphService.nativeElement=this.rendererContainer.nativeElement,this._sceneGraphService.initThree()}ngOnDestroy(){this._sceneGraphService.destroy()}};t.\u0275fac=function(i){return new(i||t)(ge(Oa))},t.\u0275cmp=zt({type:t,selectors:[["app-mobile-ticket-viewer"]],viewQuery:function(i,s){if(i&1&&De(QB,5),i&2){let o;be(o=we())&&(s.rendererContainer=o.first)}},standalone:!0,features:[Vt],decls:2,vars:0,consts:[["rendererContainer",""],["id","viewport"]],template:function(i,s){i&1&&Dt(0,"div",1,0)},styles:["#viewport[_ngcontent-%COMP%]{width:100%;height:100%}"]});let r=t;return r})();var tT=["toggleButton"];function eT(r,t){if(r&1){let e=Me();rt(0,"div",8,1),Lt("click",function(){Yt(e);let i=gt().$implicit,s=gt(2);return qt(s.onClickToggleButton(i.value))}),Dt(2,"img",9),ot()}if(r&2){let e=gt().$implicit,n=gt(2);Wt("width",n.outerSize)("height",n.outerSize),j(2),at("src",n.getImgSrc(e.imgSrc,e.value),xn)("width",n.innerSize)("height",n.innerSize)}}function nT(r,t){if(r&1&&(rt(0,"h4"),fe(1),ot()),r&2){let e=gt().$implicit,n=gt(2);Wt("width",n.innerSize+10,"px"),j(),ln(e.label)}}function iT(r,t){if(r&1&&(fn(0,5),rt(1,"div"),Gt(2,eT,3,7,"div",6)(3,nT,2,3,"h4",7),ot(),pn()),r&2){let e=t.$implicit,n=gt(2);j(2),at("ngIf",e.value!==n.noneStatusValue),j(),at("ngIf",!1)}}function rT(r,t){if(r&1&&(fn(0),Gt(1,iT,4,2,"ng-container",4),pn()),r&2){let e=t.$implicit;j(),at("ngForOf",e)}}var q1=(()=>{let t=class t{constructor(){this.buttons=null,this.elements=[],this.selectedValues=[],this.noneStatusValue=-1,this.outerSize="40px",this.innerSize=20,this.enableMultipleSelection=!1,this.columnNum=10,this.isLabelVisible=!0,this.onClickToggleButtonEvent=new Ce,this.modifiedElements=[]}ngOnInit(){let n=[];for(let i=0;i<this.elements.length;i+=this.columnNum)n.push(this.elements.slice(i,i+this.columnNum));this.modifiedElements=n}ngAfterViewInit(){let n=this.buttons.toArray();for(let i of this.selectedValues)n[i].nativeElement.classList.add("selected")}onClickToggleButton(n){let i=this.buttons.toArray();if(this.enableMultipleSelection)this.selectedValues.includes(n)?(i[n].nativeElement.classList.remove("selected"),this.selectedValues.splice(this.selectedValues.indexOf(n),1)):(i[n].nativeElement.classList.add("selected"),this.selectedValues.push(n));else{if(this.selectedValues.includes(n))return;for(let s in i)Number(s)!==n?i[Number(s)].nativeElement.classList.remove("selected"):i[n].nativeElement.classList.add("selected");this.selectedValues=[n]}this.onClickToggleButtonEvent.emit(n)}setUnselectedStatus(){let n=this.buttons.toArray();for(let i in n)n[Number(i)].nativeElement.classList.remove("selected");this.selectedValues=[],this.onClickToggleButtonEvent.emit(this.noneStatusValue)}getImgSrc(n,i){let s=n;return this.selectedValues.includes(i)&&(s=s.replace(".png","_selected.png")),s}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-circle-toggle-button-group"]],viewQuery:function(i,s){if(i&1&&De(tT,5),i&2){let o;be(o=we())&&(s.buttons=o)}},inputs:{elements:"elements",selectedValues:"selectedValues",noneStatusValue:"noneStatusValue",outerSize:"outerSize",innerSize:"innerSize",enableMultipleSelection:"enableMultipleSelection",columnNum:"columnNum",isLabelVisible:"isLabelVisible"},outputs:{onClickToggleButtonEvent:"onClickToggleButtonEvent"},standalone:!0,features:[Vt],decls:3,vars:1,consts:[["toggleButtonContainer",""],["toggleButton",""],["id","container"],[4,"ngFor","ngForOf"],["class","color-row",4,"ngFor","ngForOf"],[1,"color-row"],["class","toggle-button",3,"width","height","click",4,"ngIf"],[3,"width",4,"ngIf"],[1,"toggle-button",3,"click"],[3,"src","width","height"]],template:function(i,s){i&1&&(rt(0,"div",2,0),Gt(2,rT,2,1,"ng-container",3),ot()),i&2&&(j(2),at("ngForOf",s.modifiedElements))},dependencies:[rn,We],styles:["#container[_ngcontent-%COMP%]{display:flex}#container[_ngcontent-%COMP%]::-webkil-scrollbar{display:none}#feature-buttons[_ngcontent-%COMP%]{position:absolute;display:flex;right:0}.toggle-button[_ngcontent-%COMP%]{border-radius:50%;background-color:#efefef;display:flex;justify-content:center;align-items:center;margin:8px;flex:0 0 auto}.toggle-button[_ngcontent-%COMP%]:hover{cursor:pointer}.selected[_ngcontent-%COMP%]{background-color:#000!important}.color-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-evenly;margin-bottom:10px}"]});let r=t;return r})();var sT=["toggleButton"];function oT(r,t){if(r&1){let e=Me();rt(0,"div",6,1),Lt("click",function(){let i=Yt(e).$implicit,s=gt(2);return qt(s.onClickToggleButton(i.value))}),Dt(2,"div",7),ot()}if(r&2){let e=t.$implicit,n=gt(2);Wt("width",n.outerSize)("height",n.outerSize),j(2),Wt("background-color",e.color)("width",n.innerSize)("height",n.innerSize)}}function aT(r,t){if(r&1&&(rt(0,"div")(1,"div",4),Gt(2,oT,3,10,"div",5),ot()()),r&2){let e=t.$implicit;j(2),at("ngForOf",e)}}var ol=class{constructor(){this.BLACK={color:"#000000",value:An.BLACK},this.WHITE={color:"#FFFFFF",value:An.WHITE},this.RED={color:"#FF0000",value:An.RED},this.GREEN={color:"#00FF00",value:An.GREEN},this.BLUE={color:"#0000FF",value:An.BLUE},this.YELLOW={color:"#FFFF00",value:An.YELLOW},this.CYAN={color:"#00FFFF",value:An.CYAN},this.MAGENTA={color:"#FF00FF",value:An.MAGENTA},this.GRAY={color:"#808080",value:An.GRAY},this.LIGHT_GRAY={color:"#C0C0C0",value:An.LIGHT_GRAY},this.DARK_GRAY={color:"#A9A9A9",value:An.DARK_GRAY},this.ORANGE={color:"#FFA500",value:An.ORANGE},this.PINK={color:"#FFC0CB",value:An.PINK},this.PURPLE={color:"#800080",value:An.PURPLE},this.BROWN={color:"#A52A2A",value:An.BROWN},this.SSALON={color:"#006BFF",value:An.SSALON},this.SsalonColors=[this.BLACK,this.WHITE,this.RED,this.GREEN,this.BLUE,this.YELLOW,this.CYAN,this.MAGENTA,this.GRAY,this.LIGHT_GRAY,this.DARK_GRAY,this.ORANGE,this.PINK,this.PURPLE,this.BROWN,this.SSALON]}getColorByValue(t){return this.SsalonColors.find(e=>e.value===t).color}getSsalonColorObjectByValue(t){return this.SsalonColors.find(e=>e.value===t)}getSsalonColorObjectByColor(t){return this.SsalonColors.find(e=>e.color===t)}},An=function(r){return r[r.BLACK=0]="BLACK",r[r.WHITE=1]="WHITE",r[r.RED=2]="RED",r[r.GREEN=3]="GREEN",r[r.BLUE=4]="BLUE",r[r.YELLOW=5]="YELLOW",r[r.CYAN=6]="CYAN",r[r.MAGENTA=7]="MAGENTA",r[r.GRAY=8]="GRAY",r[r.LIGHT_GRAY=9]="LIGHT_GRAY",r[r.DARK_GRAY=10]="DARK_GRAY",r[r.ORANGE=11]="ORANGE",r[r.PINK=12]="PINK",r[r.PURPLE=13]="PURPLE",r[r.BROWN=14]="BROWN",r[r.SSALON=15]="SSALON",r}(An||{}),$1=(()=>{let t=class t{constructor(){this.buttons=null,this.selectedValue=0,this.noneStatusValue=0,this.outerSize="30px",this.innerSize="20px",this.columnNum=10,this.onClickToggleButtonEvent=new Ce,this.ssalonColor=new ol,this.modifiedSsalonColors=[]}ngOnInit(){for(var n=[],i=0;i<this.ssalonColor.SsalonColors.length;i+=this.columnNum)n.push(this.ssalonColor.SsalonColors.slice(i,i+this.columnNum));this.modifiedSsalonColors=n}ngAfterViewInit(){this.buttons.toArray()[this.selectedValue].nativeElement.classList.add("selected")}onClickToggleButton(n){let i=this.buttons.toArray();if(this.selectedValue!==n){for(let s in i)Number(s)!==n?i[Number(s)].nativeElement.classList.remove("selected"):i[n].nativeElement.classList.add("selected");this.selectedValue=n,this.onClickToggleButtonEvent.emit(n)}}getImgSrc(n,i){let s=n;return this.selectedValue===i&&(s=s.replace(".png","_selected.png")),s}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-color-board"]],viewQuery:function(i,s){if(i&1&&De(sT,5),i&2){let o;be(o=we())&&(s.buttons=o)}},inputs:{selectedValue:"selectedValue",noneStatusValue:"noneStatusValue",outerSize:"outerSize",innerSize:"innerSize",columnNum:"columnNum"},outputs:{onClickToggleButtonEvent:"onClickToggleButtonEvent"},standalone:!0,features:[Vt],decls:3,vars:1,consts:[["toggleButtonContainer",""],["toggleButton",""],["id","container"],[4,"ngFor","ngForOf"],[1,"color-row"],["class","color-back",3,"width","height","click",4,"ngFor","ngForOf"],[1,"color-back",3,"click"],[1,"color-circle"]],template:function(i,s){i&1&&(rt(0,"div",2,0),Gt(2,aT,3,1,"div",3),ot()),i&2&&(j(2),at("ngForOf",s.modifiedSsalonColors))},dependencies:[rn],styles:[".color-back[_ngcontent-%COMP%]{width:25px;height:25px;border-radius:50%;background-color:#efefef;display:flex;justify-content:center;align-items:center}.color-back[_ngcontent-%COMP%]:hover{cursor:pointer}.color-circle[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:50%}.color-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-evenly;margin-bottom:10px}.selected[_ngcontent-%COMP%]{background-color:#006bff!important}"]});let r=t;return r})();var cT=["toggleButton"];function lT(r,t){if(r&1){let e=Me();rt(0,"div",4,1),Lt("click",function(){let i=Yt(e).$implicit,s=gt();return qt(s.onClickToggleButton(i.value))}),fe(2),ot()}if(r&2){let e=t.$implicit,n=gt();Wt("width",n.buttonWidth)("font-family",e.imgSrc),j(2),vn(" ",e.label,"")}}var Z1=(()=>{let t=class t{constructor(){this.buttons=null,this.elements=[],this.selectedValue=0,this.onClickToggleButtonEvent=new Ce,this.buttonWidth="30%"}ngOnInit(){this.buttonWidth=`${100/this.elements.length}%`}ngAfterViewInit(){this.buttons.toArray()[this.selectedValue].nativeElement.classList.add("selected")}onClickToggleButton(n){if(this.selectedValue===n)return;let i=this.buttons.toArray();for(let s in i)Number(s)!==n?i[Number(s)].nativeElement.classList.remove("selected"):i[n].nativeElement.classList.add("selected");this.selectedValue=n,this.onClickToggleButtonEvent.emit(this.elements[n].imgSrc)}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-simple-toggle-button-group"]],viewQuery:function(i,s){if(i&1&&De(cT,5),i&2){let o;be(o=we())&&(s.buttons=o)}},inputs:{elements:"elements",selectedValue:"selectedValue"},outputs:{onClickToggleButtonEvent:"onClickToggleButtonEvent"},standalone:!0,features:[Vt],decls:3,vars:1,consts:[["toggleButtonContainer",""],["toggleButton",""],[1,"container"],["class","toggle-button",3,"width","font-family","click",4,"ngFor","ngForOf"],[1,"toggle-button",3,"click"]],template:function(i,s){i&1&&(rt(0,"div",2,0),Gt(2,lT,3,5,"div",3),ot()),i&2&&(j(2),at("ngForOf",s.elements))},dependencies:[rn],styles:[".container[_ngcontent-%COMP%]{width:auto;display:flex;flex-direction:row;overflow-x:auto}.toggle-button[_ngcontent-%COMP%]{height:100%;min-width:50px;display:flex;justify-content:center;align-items:center;border-radius:5px;margin:5px;color:#efefef;background-color:transparent}.toggle-button[_ngcontent-%COMP%]:hover{cursor:pointer}.selected[_ngcontent-%COMP%]{background-color:#0090f2}"]});let r=t;return r})();var hT=["editFeatureButtons"],uT=["backgroundPath"],dT=["textEditInput"],xT=["drawCanvas"],fT=["selectedPhotoContainer"],pT=r=>[r];function mT(r,t){if(r&1){let e=Me();rt(0,"div"),fs(),rt(1,"svg",18),Dt(2,"path",19,2),ot(),ps(),rt(4,"app-color-board",20),Lt("onClickToggleButtonEvent",function(i){Yt(e);let s=gt();return qt(s.changeBackgroundColor(i))}),ot()()}if(r&2){let e=gt();j(4),at("outerSize","30px")("innerSize","24px")("selectedValue",e.backgroundColor.value)}}function gT(r,t){if(r&1){let e=Me();rt(0,"div")(1,"div",21,3)(3,"textarea",22,4),Lt("input",function(i){Yt(e);let s=gt();return qt(s.onChangeSsalonTextAttribute("text",i))}),ot()(),rt(5,"div",23)(6,"app-circle-toggle-button-group",24),Lt("onClickToggleButtonEvent",function(i){Yt(e);let s=gt();return qt(s.onChangeSsalonTextAttribute("textAlign",i))}),ot()(),rt(7,"app-simple-toggle-button-group",25),Lt("onClickToggleButtonEvent",function(i){Yt(e);let s=gt();return qt(s.onChangeSsalonTextAttribute("fontFamily",i))}),ot(),rt(8,"app-color-board",20),Lt("onClickToggleButtonEvent",function(i){Yt(e);let s=gt();return qt(s.onChangeSsalonTextAttribute("color",i))}),ot()()}if(r&2){let e=gt();j(3),Wt("text-align",e.ssalonTextAttribute.textAlign)("color",e.ssalonTextAttribute.color)("font-family",e.ssalonTextAttribute.fontFamily),j(2),Wt("justify-content","center"),j(),at("elements",e.textAlignButtons)("outerSize","30px")("selectedValues",Kp(15,pT,e.getSsalonTextEnumByString(e.ssalonTextAttribute.textAlign))),j(),at("elements",e.fonts),j(),at("outerSize","30px")("innerSize","24px")("selectedValue",e.ssalonColor.getSsalonColorObjectByColor(e.ssalonTextAttribute.color).value)}}function vT(r,t){r&1&&(rt(0,"div",26),Dt(1,"img",27,5),ot())}function ET(r,t){if(r&1){let e=Me();rt(0,"div")(1,"div",31),Lt("click",function(){let i=Yt(e).$implicit,s=gt(3);return qt(s.selectSticker(i.value))}),Dt(2,"img",32),ot()()}if(r&2){let e=t.$implicit;j(),Wt("width","100px")("height","150px"),j(),at("src",e.imgSrc,xn)}}function _T(r,t){if(r&1&&(rt(0,"div"),Gt(1,ET,3,5,"div",30),ot()),r&2){let e=t.$implicit;Wt("display","flex")("justify-content","space-evenly")("margin-bottom","20px"),j(),at("ngForOf",e)}}function CT(r,t){if(r&1&&(rt(0,"div",28,6),Gt(2,_T,2,7,"div",29),ot()),r&2){let e=gt();j(2),at("ngForOf",e.getStickerArray())}}function yT(r,t){if(r&1){let e=Me();rt(0,"div"),fs(),rt(1,"svg",18),Dt(2,"path",19,2),rt(4,"foreignObject",33),ps(),Dt(5,"canvas",34,7),ot()(),rt(7,"app-color-board",35),Lt("onClickToggleButtonEvent",function(i){Yt(e);let s=gt();return qt(s.onChangeSsalonTextAttribute("color",i))}),ot()()}r&2&&(j(7),at("outerSize","30px")("innerSize","24px"))}var Ee=function(r){return r[r.BACKGROUND_COLOR_CHANGE=0]="BACKGROUND_COLOR_CHANGE",r[r.PHOTO=1]="PHOTO",r[r.STICKER=2]="STICKER",r[r.TEXT=3]="TEXT",r[r.DRAW=4]="DRAW",r[r.NONE=5]="NONE",r}(Ee||{}),Ni=function(r){return r[r.LEFT=0]="LEFT",r[r.CENTER=1]="CENTER",r[r.RIGHT=2]="RIGHT",r}(Ni||{}),J1=(()=>{let t=class t{constructor(n,i){this._apiExecutorService=n,this._sceneGraphService=i,this.editFeatureButtons=null,this.backgroundPath=null,this.textEditInput=null,this.drawCanvas=null,this.selectedPhotoContainer=null,this.onChangeViewer=new Ce,this.onObjectEditEnded=new Ce,this.onBackgroundColorEditEnded=new Ce,this.onClickPreview=new Ce,this.editMode=Ee.NONE,this.ssalonColor=new ol,this.mobileTicketEditMode=Ee,this.goBackButtonElement={imgSrc:"assets/icons/go-back.png",label:"\uB4A4\uB85C\uAC00\uAE30",value:0},this.previewButtonElement={imgSrc:"assets/icons/view.png",label:"\uBBF8\uB9AC\uBCF4\uAE30",value:0},this.completeButtonElement={imgSrc:"",label:"\uC644\uB8CC",value:0},this.editFeatures=[{imgSrc:"assets/icons/color-board.png",label:"\uBBF8\uB9AC\uBCF4\uAE30 \uBDF0",value:Ee.BACKGROUND_COLOR_CHANGE},{imgSrc:"assets/icons/photo.png",label:"\uC0AC\uC9C4",value:Ee.PHOTO},{imgSrc:"assets/icons/sticker.png",label:"\uC2A4\uD2F0\uCEE4",value:Ee.STICKER},{imgSrc:"assets/icons/text.png",label:"\uD14D\uC2A4\uD2B8",value:Ee.TEXT},{imgSrc:"assets/icons/draw.png",label:"\uADF8\uB9AC\uAE30",value:Ee.DRAW},{imgSrc:"assets/icons/view.png",label:"\uADF8\uB9AC\uAE30",value:Ee.NONE}],this._backgroundColorViewLoaded=!1,this.stickers=[],this.editingSticker=null,this.editingStickerSrc="",this.textFocused=!1,this.textAlign="left",this.textAlignButtons=[{imgSrc:"assets/text-aligns/textalign-left.png",label:"\uC88C",value:Ni.LEFT},{imgSrc:"assets/text-aligns/textalign-center.png",label:"\uC911",value:Ni.CENTER},{imgSrc:"assets/text-aligns/textalign-right.png",label:"\uC6B0",value:Ni.RIGHT}],this.fonts=[{imgSrc:"Ariel",label:"Aa",value:0},{imgSrc:"Josefin Sans",label:"Aa",value:1},{imgSrc:"Jersey 15",label:"Aa",value:2},{imgSrc:"Roboto",label:"Aa",value:3},{imgSrc:"Jacquarda Bastarda 9 Charted",label:"Aa",value:4}],this.fontFamily="Josefin Sans",this.isTextAddMode=!0,this.textColor=this.ssalonColor.WHITE,this.editingText=null,this.colorBoard=[],this.drawingFabricCanvas=null,this._isDrawing=!1,this._drawingPoints=[],this._isDrawingFabricCanvasLoaded=!1,this.drawingFabricPaths=[],this.backgroundColor=this.ssalonColor.LIGHT_GRAY,this.ssalonTextAttribute={text:"",fontFamily:"Josefin Sans",color:"#FFFFFF",textAlign:"left"},this.ssalonPhotoAttribute={src:[]},this.ssalonStickerAttribute={src:[]},this.ssalonPathAttribute={color:"#FFFFFF",strokeWidth:1},this.fabricObjects=[],this.lastUsedFeature=Ee.NONE}ngAfterViewInit(){this.loadDecorationInfo(),this.getStickers()}ngAfterViewChecked(){this.backgroundPath&&!this._backgroundColorViewLoaded&&(this.backgroundPath.nativeElement.setAttribute("fill",this.backgroundColor.color),this._backgroundColorViewLoaded=!0),this.textEditInput&&!this.textFocused&&(this.fabricObjects.length===1&&(this.textEditInput.nativeElement.value=this.ssalonTextAttribute.text),this.textEditInput.nativeElement.focus(),this.textFocused=!0),this.drawCanvas&&!this._isDrawingFabricCanvasLoaded&&(this.initDrawingCanvas(),this._isDrawingFabricCanvasLoaded=!0)}loadDecorationInfo(){return Ut(this,null,function*(){let n=yield this._apiExecutorService.getTicket();this.backgroundColor=this.ssalonColor.getSsalonColorObjectByColor(n.backgroundColor),this.onBackgroundColorEditEnded.emit(this.backgroundColor.color)})}onClickChangeEditMode(n){switch(n){case Ee.BACKGROUND_COLOR_CHANGE:break;case Ee.PHOTO:let i=document.createElement("input");i.type="file",i.accept="image/*",i.onchange=function(){if(i.files&&i.files[0]){let s=new FileReader;s.onload=(function(o){let a=document.getElementById("selected-photo-container");a.src=o.target.result,a.width=200}).bind(this),s.readAsDataURL(i.files[0])}},i.click();break;case Ee.STICKER:break;case Ee.TEXT:this.textFocused=!1;break;case Ee.DRAW:break;case Ee.NONE:break}this.editMode=n,this.onChangeViewer.emit(n)}onClickPreviewButton(){this.onClickPreview.emit()}onClickEndDetailedEditViewer(){this.lastUsedFeature=this.editMode,this.editMode=Ee.NONE,this.editFeatureButtons.setUnselectedStatus(),this.onChangeViewer.emit(Ee.NONE),this.onEndEditObject()}changeBackgroundColor(n){this.backgroundPath?.nativeElement.setAttribute("fill",this.ssalonColor.getSsalonColorObjectByValue(n).color),this.backgroundColor=this.ssalonColor.getSsalonColorObjectByValue(n)}getStickers(){["https://dokcohci6rkid.cloudfront.net/sticker/image+1.png?v=0","https://dokcohci6rkid.cloudfront.net/sticker/image+2.png?v=0","https://dokcohci6rkid.cloudfront.net/sticker/image+3.png?v=0","https://dokcohci6rkid.cloudfront.net/sticker/image+4.png?v=0","https://dokcohci6rkid.cloudfront.net/sticker/image+5.png?v=0","https://dokcohci6rkid.cloudfront.net/sticker/image+6.png?v=0","https://dokcohci6rkid.cloudfront.net/sticker/image+8.png?v=0"].forEach((i,s)=>{this.stickers.push({imgSrc:i+"?timestamp="+new Date().getTime(),label:`${s}`,value:s})})}getStickerArray(){let n=[];for(let i=0;i<this.stickers.length;i+=3)n.push(this.stickers.slice(i,i+3));return n}selectSticker(n){this.ssalonStickerAttribute.src.includes(this.stickers[n].imgSrc)?this.ssalonStickerAttribute.src.splice(this.ssalonStickerAttribute.src.indexOf(this.stickers[n].imgSrc),1):this.ssalonStickerAttribute.src.push(this.stickers[n].imgSrc)}syncTextAttributeWithSelectedText(){this.fabricObjects.length===1&&(this.ssalonTextAttribute={text:this.fabricObjects[0].text,fontFamily:this.fabricObjects[0].fontFamily,color:this.fabricObjects[0].fill,textAlign:this.fabricObjects[0].textAlign})}onChangeSsalonTextAttribute(n,i){switch(n){case"text":this.ssalonTextAttribute.text=this.textEditInput.nativeElement.value;break;case"fontFamily":this.ssalonTextAttribute.fontFamily=i;break;case"color":this.ssalonTextAttribute.color=this.ssalonColor.getSsalonColorObjectByValue(i).color;break;case"textAlign":switch(i){case Ni.LEFT:this.ssalonTextAttribute.textAlign="left";break;case Ni.CENTER:this.ssalonTextAttribute.textAlign="center";break;case Ni.RIGHT:this.ssalonTextAttribute.textAlign="right";break}break}}getSsalonTextEnumByString(n){switch(n){case"left":return Ni.LEFT;case"center":return Ni.CENTER;case"right":return Ni.RIGHT;default:return Ni.CENTER}}loadImageRecursive(n){return Ut(this,null,function*(){let i=this.lastUsedFeature===Ee.PHOTO?this.ssalonPhotoAttribute:this.ssalonStickerAttribute;if(n===i.src.length)this.onObjectEditEnded.emit(this.fabricObjects),this.lastUsedFeature===Ee.PHOTO?this.ssalonPhotoAttribute.src=[]:this.ssalonStickerAttribute.src=[],this.lastUsedFeature=Ee.NONE;else{let s=yield vi.fromURL(i.src[n],{crossOrigin:"anonymous"});this.fabricObjects.push(s),this.loadImageRecursive(n+1)}})}onEndEditObject(){if(this.lastUsedFeature===Ee.BACKGROUND_COLOR_CHANGE)this.onBackgroundColorEditEnded.emit(this.backgroundColor.color);else{switch(this.lastUsedFeature){case Ee.PHOTO:return;case Ee.STICKER:this.loadImageRecursive(0);return;case Ee.TEXT:this.fabricObjects.length===0?this.fabricObjects.push(new Cn(this.ssalonTextAttribute.text,{top:100,left:100,fill:this.ssalonTextAttribute.color,textAlign:this.ssalonTextAttribute.textAlign,fontFamily:this.ssalonTextAttribute.fontFamily})):(this.fabricObjects[0].set("text",this.ssalonTextAttribute.text),this.fabricObjects[0].set("fill",this.ssalonTextAttribute.color),this.fabricObjects[0].set("textAlign",this.ssalonTextAttribute.textAlign),this.fabricObjects[0].set("fontFamily",this.ssalonTextAttribute.fontFamily),this.lastUsedFeature=Ee.NONE);break;case Ee.DRAW:break;case Ee.NONE:break}this.onObjectEditEnded.emit(this.lastUsedFeature===Ee.NONE?null:this.fabricObjects),this.lastUsedFeature=Ee.NONE}this.fabricObjects=[],this.drawingFabricCanvas?.destroy()}onClickCompletedEditing(){}initDrawingCanvas(){this.drawingFabricCanvas=new er(this.drawCanvas.nativeElement),this.drawingFabricCanvas.renderAll(),this.drawingFabricCanvas.on("mouse:down",n=>{this._isDrawing=!0,this.addPoint(n.e),this.drawPath()}),this.drawingFabricCanvas.on("mouse:move",n=>{this._isDrawing&&(this.addPoint(n.e),this.drawPath())}),this.drawingFabricCanvas.on("mouse:up",()=>{this._isDrawing=!1,this._drawingPoints.length=0})}addPoint(n){let i=this.drawingFabricCanvas.getPointer(n);this._drawingPoints.push(new Zt(i.x,i.y))}drawPath(){let n=this._drawingPoints.map(s=>`${s.x} ${s.y}`).join(" "),i=new Er(`M ${n}`,{fill:"transparent",stroke:"white",strokeWidth:2});this.fabricObjects.length=0,this.fabricObjects.push(i),this.drawingFabricCanvas.clear(),this.drawingFabricCanvas.renderAll(),this.drawingFabricCanvas.add(i)}endTicketWebView(){}};t.\u0275fac=function(i){return new(i||t)(ge(Yn),ge(Oa))},t.\u0275cmp=zt({type:t,selectors:[["app-mobile-ticket-editor"]],viewQuery:function(i,s){if(i&1&&(De(hT,5),De(uT,5),De(dT,5),De(xT,5),De(fT,5)),i&2){let o;be(o=we())&&(s.editFeatureButtons=o.first),be(o=we())&&(s.backgroundPath=o.first),be(o=we())&&(s.textEditInput=o.first),be(o=we())&&(s.drawCanvas=o.first),be(o=we())&&(s.selectedPhotoContainer=o.first)}},outputs:{onChangeViewer:"onChangeViewer",onObjectEditEnded:"onObjectEditEnded",onBackgroundColorEditEnded:"onBackgroundColorEditEnded",onClickPreview:"onClickPreview"},standalone:!0,features:[Vt],decls:21,vars:21,consts:[["editFeatureButtons",""],["detailedEditor",""],["backgroundPath",""],["textEditFeatureContainer",""],["textEditInput",""],["selectedPhotoContainer",""],["stickerEditFeatureContainer",""],["drawCanvas",""],[1,"container"],[1,"horizontal-container"],[1,"back-button",3,"onClickEvent","buttonElement","heightSize"],["id","edit-feature-buttons",3,"onClickToggleButtonEvent","elements","innerSize","outerSize","noneStatusValue"],[1,"complete-button",3,"onClickEvent","buttonElement","heightSize","type"],["id","detail-editor",3,"hidden"],[1,"complete-button",3,"onClickEvent","buttonElement","heightSize","type","highContrast"],[4,"ngIf"],["id","photo-edit-feature-container",4,"ngIf"],["id","sticker-edit-feature-container",4,"ngIf"],["width","350","height","600","viewBox","-87.5 -150 525 900","fill","none","xmlns","http://www.w3.org/2000/svg",1,"ticket-background"],["fill-rule","evenodd","clip-rule","evenodd","d","M9.53674e-06 40C9.53674e-06 17.9086 17.9086 0 40 0H310C332.091 0 350 17.9086 350 40L350 451.714C333.431 451.714 320 463.227 320 477.429C320 491.63 333.431 503.143 350 503.143L350 560C350 582.091 332.091 600 310 600H40C17.9086 600 9.53674e-06 582.091 9.53674e-06 560L0 503.143C16.5685 503.143 30 491.63 30 477.429C30 463.227 16.5685 451.714 0 451.714L9.53674e-06 40Z","fill","#D9D9D9"],[1,"color-board",3,"onClickToggleButtonEvent","outerSize","innerSize","selectedValue"],["id","text-edit-feature-container"],["id","text-edit-input","autocomplete","off","type","text",3,"input"],["id","text-align",1,"horizontal-container"],[3,"onClickToggleButtonEvent","elements","outerSize","selectedValues"],[1,"fonts",3,"onClickToggleButtonEvent","elements"],["id","photo-edit-feature-container"],["id","selected-photo-container"],["id","sticker-edit-feature-container"],[3,"display","justify-content","margin-bottom",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"sticker",3,"click"],["width","80px",3,"src"],["width","350","height","600"],["id","draw-canvas","width","350","height","600"],[1,"color-board",3,"onClickToggleButtonEvent","outerSize","innerSize"]],template:function(i,s){if(i&1){let o=Me();rt(0,"div",8)(1,"div",9)(2,"div")(3,"app-simple-button",10),Lt("onClickEvent",function(){return Yt(o),qt(s.endTicketWebView())}),ot()(),rt(4,"div")(5,"app-circle-toggle-button-group",11,0),Lt("onClickToggleButtonEvent",function(c){return Yt(o),qt(s.onClickChangeEditMode(c))}),ot()(),rt(7,"div")(8,"app-simple-button",12),Lt("onClickEvent",function(){return Yt(o),qt(s.onClickPreviewButton())}),ot()()(),rt(9,"div",13,1)(11,"div",9)(12,"div")(13,"app-simple-button",10),Lt("onClickEvent",function(){return Yt(o),qt(s.onClickEndDetailedEditViewer())}),ot()(),rt(14,"div")(15,"app-simple-button",14),Lt("onClickEvent",function(){return Yt(o),qt(s.onClickEndDetailedEditViewer())}),ot()()(),Gt(16,mT,5,3,"div",15)(17,gT,9,17,"div",15)(18,vT,3,0,"div",16)(19,CT,3,1,"div",17)(20,yT,8,2,"div",15),ot()()}i&2&&(j(3),at("buttonElement",s.goBackButtonElement)("heightSize",36),j(2),at("elements",s.editFeatures)("innerSize",20)("outerSize","36px")("noneStatusValue",s.mobileTicketEditMode.NONE),j(3),at("buttonElement",s.previewButtonElement)("heightSize",15)("type","text"),j(),at("hidden",s.editMode===s.mobileTicketEditMode.NONE),j(4),at("buttonElement",s.goBackButtonElement)("heightSize",40),j(2),at("buttonElement",s.completeButtonElement)("heightSize",15)("type","text")("highContrast",!0),j(),at("ngIf",s.editMode===s.mobileTicketEditMode.BACKGROUND_COLOR_CHANGE),j(),at("ngIf",s.editMode===s.mobileTicketEditMode.TEXT),j(),at("ngIf",s.editMode===s.mobileTicketEditMode.PHOTO),j(),at("ngIf",s.editMode===s.mobileTicketEditMode.STICKER),j(),at("ngIf",s.editMode===s.mobileTicketEditMode.DRAW))},dependencies:[Rl,Z1,q1,$1,rn,We],styles:[".editor-button[_ngcontent-%COMP%]{width:50px;height:50px;margin:10px}.feature-button-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;width:100%}.container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.horizontal-container[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:row;justify-content:space-between;align-items:center}#detail-editor[_ngcontent-%COMP%]{position:fixed;top:0;left:0;background-color:#000000e6;width:100%;height:100%}#text-edit-input[_ngcontent-%COMP%]{font-size:30px;font-family:Courier New,Courier,monospace;-webkit-text-size-adjust:100%;background-color:transparent;caret-color:#006bff;color:#efefef;width:70%;height:400px;border:none;outline:none;text-align:center}#text-edit-feature-container[_ngcontent-%COMP%]{position:absolute;width:100%;top:30%;left:50%;transform:translate(-50%,-30%);display:flex;justify-content:center}.fonts[_ngcontent-%COMP%]{position:absolute;bottom:120px;left:0;width:100%;height:20px}.color-board[_ngcontent-%COMP%]{position:absolute;width:100%;bottom:20px}#text-align[_ngcontent-%COMP%]{position:absolute;bottom:180px;left:0;width:100%}#preview[_ngcontent-%COMP%]{position:absolute;top:0;right:0}.sticker[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.sticker[_ngcontent-%COMP%]:hover{cursor:pointer}.selected[_ngcontent-%COMP%]{border:2px solid #006BFF}.ticket-background[_ngcontent-%COMP%]{position:absolute;top:0;left:50%;transform:translate(-50%)}#sticker-edit-feature-container[_ngcontent-%COMP%]{overflow-y:auto;height:100%}#selected-photo-container[_ngcontent-%COMP%]{position:absolute;width:200px;top:40%;left:50%;transform:translate(-50%,-30%);display:flex;justify-content:center}"]});let r=t;return r})();var AT=Math.PI/180,fR=180/Math.PI;function K1(r){return r*AT}var bT=["backgroundPath"],wT=["editCanvas"],Q1=(()=>{let t=class t{constructor(n){this._apiExecutorService=n,this.backgroundPath=null,this.editCanvas=null,this.onClickText=new Ce,this.canvas=null,this.isCursorDown=!1}ngOnInit(){}ngAfterViewInit(){this.initFabric()}initFabric(){return Ut(this,null,function*(){this.canvas=new er(this.editCanvas?.nativeElement),this.canvas.selection=!1,this.canvas.on("mouse:down",n=>{n.target!==null&&n.target instanceof Cn&&(this.isCursorDown=!0)}),this.canvas.on("mouse:up",n=>{n.target!==null&&n.target instanceof Cn&&(this.isCursorDown&&this.onClickText?.emit(n.target),this.isCursorDown=!1)}),this.canvas.on("object:moving",n=>{this.isCursorDown=!1}),this.canvas.on("object:scaling",n=>{this.isCursorDown=!1}),this.canvas.on("object:rotating",n=>{this.isCursorDown=!1}),yield this.loadDecorationInfo()})}addRemoveIconToControl(){var n="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E",i=document.createElement("img");i.src=n,console.log(Qe.prototype),Qe.prototype.controls.deleteControl=new Fn({x:.5,y:-.5,offsetY:16,cursorStyle:"pointer",mouseUpHandler:s,render:o});function s(a,c){var l=c.target,h=l.canvas;h.remove(l),h.requestRenderAll()}function o(a,c,l,h,u){var d=20;a.save(),a.translate(c,l),a.rotate(K1(u.angle)),a.drawImage(i,-d/2,-d/2,d,d),a.restore()}}loadDecorationInfo(){return Ut(this,null,function*(){let n=yield this._apiExecutorService.getTicket();yield this.canvas?.loadFromJSON(n.fabric),this.canvas?.renderAll()})}updateCanvas(n){if(console.log(this.canvas?.toJSON()),n!==null)for(let i=0;i<n.length;i++)this.canvas?.add(n[i]);this.canvas?.renderAll()}getCanvasCapture(){return this.canvas?.toDataURL({format:"png",multiplier:2,enableRetinaScaling:!0})}updateBackgroundColor(n){this.backgroundPath?.nativeElement.setAttribute("fill",n)}};t.\u0275fac=function(i){return new(i||t)(ge(Yn))},t.\u0275cmp=zt({type:t,selectors:[["app-mobile-ticket-edit-viewer"]],viewQuery:function(i,s){if(i&1&&(De(bT,5),De(wT,5)),i&2){let o;be(o=we())&&(s.backgroundPath=o.first),be(o=we())&&(s.editCanvas=o.first)}},outputs:{onClickText:"onClickText"},standalone:!0,features:[Vt],decls:7,vars:0,consts:[["backgroundPath",""],["editCanvas",""],[1,"container"],["width","350","height","600","viewBox","0 0 350 600","fill","none","xmlns","http://www.w3.org/2000/svg",1,"ticket-view-elements"],["fill-rule","evenodd","clip-rule","evenodd","d","M0 40C0 17.9086 17.9086 0 40 0H310C332.091 0 350 17.9086 350 40V425C336.193 425 325 436.193 325 450C325 463.807 336.193 475 350 475V560C350 582.091 332.091 600 310 600H40C17.9086 600 0 582.091 0 560V475C13.8071 475 25 463.807 25 450C25 436.193 13.8071 425 0 425V40Z","fill","#D9D9D9"],["width","100%","height","100%"],["width","350","height","600"]],template:function(i,s){i&1&&(rt(0,"div",2),fs(),rt(1,"svg",3),Dt(2,"path",4,0),rt(4,"foreignObject",5),ps(),Dt(5,"canvas",6,1),ot()()())},styles:[".ticket-view-elements[_ngcontent-%COMP%]{width:350px;height:600px}.container[_ngcontent-%COMP%]{display:flex;justify-content:center;height:100%;width:100%}"]});let r=t;return r})();var oC=Mp(tC()),aC=Mp(rC());var ST=["circleStatus"];function MT(r,t){if(r&1&&(rt(0,"div",10),fe(1),ot()),r&2){let e=gt().$implicit,n=gt(2);Wt("width",n.outerSize*2,"px"),j(),vn(" ",e.label,"")}}function DT(r,t){if(r&1&&(fn(0,5),rt(1,"div",6)(2,"div",7),Dt(3,"img",8,1),ot(),Gt(5,MT,2,3,"div",9),ot(),pn()),r&2){let e=t.$implicit,n=gt(2);j(2),Wt("width",n.outerSize+3,"px")("height",n.outerSize+3,"px")("background-color",n.getBorderColor(e.status)),j(),at("src",e.imgSrc,xn)("width",n.outerSize)("height",n.outerSize),j(2),at("ngIf",n.isLabelVisible)}}function BT(r,t){if(r&1&&(fn(0),Gt(1,DT,6,10,"ng-container",4),pn()),r&2){let e=t.$implicit;j(),at("ngForOf",e)}}var sC=(()=>{let t=class t{constructor(){this.buttons=null,this.elements=[],this.outerSize=40,this.columnNum=10,this.isLabelVisible=!0,this.onClickToggleButtonEvent=new Ce,this.modifiedElements=[]}ngOnInit(){let n=[];for(let i=0;i<this.elements.length;i+=this.columnNum)n.push(this.elements.slice(i,i+this.columnNum));this.modifiedElements=n}ngAfterViewInit(){}changeStatus(n,i){this.elements.find(s=>s.value===n).status=i}getBorderColor(n){return n?"#4DAF50":"#F44336"}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-circle-toggle-status-group"]],viewQuery:function(i,s){if(i&1&&De(ST,5),i&2){let o;be(o=we())&&(s.buttons=o)}},inputs:{elements:"elements",outerSize:"outerSize",columnNum:"columnNum",isLabelVisible:"isLabelVisible"},outputs:{onClickToggleButtonEvent:"onClickToggleButtonEvent"},standalone:!0,features:[Vt],decls:3,vars:1,consts:[["toggleButtonContainer",""],["circleStatus",""],["id","container"],[4,"ngFor","ngForOf"],["class","color-row",4,"ngFor","ngForOf"],[1,"color-row"],[1,"status-container"],[1,"img-container"],[1,"circle-status",3,"src","width","height"],["class","nickname-container",3,"width",4,"ngIf"],[1,"nickname-container"]],template:function(i,s){i&1&&(rt(0,"div",2,0),Gt(2,BT,2,1,"ng-container",3),ot()),i&2&&(j(2),at("ngForOf",s.modifiedElements))},dependencies:[rn,We],styles:["#container[_ngcontent-%COMP%]{display:flex}#container[_ngcontent-%COMP%]::-webkil-scrollbar{display:none}#feature-buttons[_ngcontent-%COMP%]{position:absolute;display:flex;right:0}.status-container[_ngcontent-%COMP%]{margin:5px;display:flex;flex-direction:column;align-items:center}.circle-status[_ngcontent-%COMP%]{border-radius:50%}.img-container[_ngcontent-%COMP%]{border-radius:50%;background-color:#efefef;border-width:2px;display:flex;justify-content:center;align-items:center;margin:8px;flex:0 0 auto}.nickname-container[_ngcontent-%COMP%]{text-align:center;text-overflow:ellipsis;font-weight:500}.toggle-button[_ngcontent-%COMP%]:hover{cursor:pointer}.selected[_ngcontent-%COMP%]{background-color:#000!important}.color-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-evenly;margin-bottom:10px}"]});let r=t;return r})();var TT=["mobileTicketEditViewer"],FT=["mobileTicketEditor"],PT=["barcodeContainer"],RT=["qrVideo"],kT=["qrCanvas"],OT=["joiningUsersComponent"];function IT(r,t){if(r&1){let e=Me();rt(0,"div",11,0)(2,"div",12)(3,"div")(4,"app-simple-button",13),Lt("onClickEvent",function(){Yt(e);let i=gt();return qt(i.onClickBackButton())}),ot()()(),rt(5,"div"),Dt(6,"app-mobile-ticket-viewer"),ot()()}if(r&2){let e=gt();j(2),Wt("justify-content","space-between"),j(2),at("buttonElement",e.goBackButtonElement)("heightSize",36),j(),Wt("height","100%")}}function LT(r,t){if(r&1){let e=Me();rt(0,"div",11,1)(2,"div")(3,"app-mobile-ticket-edit-viewer",14,2),Lt("onClickText",function(i){Yt(e);let s=gt();return qt(s.openTextEditor(i))}),ot()(),rt(5,"app-mobile-ticket-editor",15,3),Lt("onChangeViewer",function(i){Yt(e);let s=gt();return qt(s.changeEditMode(i))})("onClickPreview",function(){Yt(e);let i=gt();return qt(i.onClickPreviewButton())})("onObjectEditEnded",function(i){Yt(e);let s=gt();return qt(s.applyEdit(i))})("onBackgroundColorEditEnded",function(i){Yt(e);let s=gt();return qt(s.applyBackgroundColorEdit(i))}),ot()()}if(r&2){let e=gt();j(2),Wt("height","100%")("width","100%")("position","absolute")("top","60px")("left","0px"),j(3),Wt("position","absolute")("top","0px")("left","0px")("width","100%")("height",e.editMode===e.mobileTicketEditMode.NONE?"60px":"100%")}}function NT(r,t){if(r&1&&(rt(0,"div",11,4)(2,"div"),Dt(3,"app-mobile-ticket-viewer"),ot(),rt(4,"div"),Dt(5,"app-simple-button",16),ot()()),r&2){let e=gt();j(2),Wt("height","100%"),j(3),at("buttonElement",e.joinButtonElement)}}function UT(r,t){if(r&1&&(rt(0,"div",11,5)(2,"div",17),Dt(3,"video",18,6)(5,"canvas",19,7),rt(7,"div",20),Dt(8,"img",21),ot()(),rt(9,"div",22)(10,"div",12)(11,"div",23)(12,"div",24),Dt(13,"img",25),ot(),rt(14,"div",26)(15,"div",27),fe(16),ot(),rt(17,"div",27),fe(18),ot()()()(),rt(19,"div",28),Dt(20,"app-circle-toggle-status-group",29,8),ot()()()),r&2){let e=gt();j(3),Wt("width","100%")("height","100%")("object-fit","cover"),j(2),Wt("display","none"),j(4),Wt("margin-top","30px"),j(),Wt("justify-content","center"),j(2),Wt("width",52,"px")("height",52,"px"),j(),at("src",e.checkStatus.checkingUser?e.checkStatus.checkingUser.profilePictureUrl:"assets/data_error.png",xn),j(2),Wt("font-size","20px"),j(),vn(" ",e.checkStatus.checkingUser?e.checkStatus.checkingUser.nickname:"\uC54C\uC218\uC5C6\uC74C",""),j(),Wt("color",e.checkStatus.color),j(),ln(e.checkStatus.text),j(2),at("elements",e.joiningUsers)}}function zT(r,t){if(r&1&&(rt(0,"div",11,9)(2,"div"),Dt(3,"app-mobile-ticket-viewer"),ot(),rt(4,"div",30)(5,"div",31),Dt(6,"img",32),ot()()()),r&2){let e=gt();j(2),Wt("height","100%"),j(4),at("src",e.qrCodeSrc,xn)}}var Hn=function(r){return r[r.APPVIEW=0]="APPVIEW",r[r.APPEDITVIEW=1]="APPEDITVIEW",r[r.WEBVIEW=2]="WEBVIEW",r[r.QRCHECKVIEW=3]="QRCHECKVIEW",r[r.QRSHOWVIEW=4]="QRSHOWVIEW",r}(Hn||{}),cC=(()=>{let t=class t{constructor(n,i,s,o,a){this._apiExecutorService=n,this._ssalonConfigService=i,this._sceneGraphService=s,this._route=o,this._location=a,this.mobileTicketEditViewer=null,this.mobileTicketEditor=null,this.barcodeContainer=null,this.qrVideo=null,this.qrCanvas=null,this.joiningUsersComponent=null,this.mobileTicketViewMode=Hn,this.mode=Hn.APPEDITVIEW,this.mobileTicketEditMode=Ee,this.editMode=Ee.NONE,this.goBackButtonElement={imgSrc:"assets/icons/go-back.png",label:"\uB4A4\uB85C\uAC00\uAE30",value:0},this.joinButtonElement={imgSrc:"assets/icons/view.png",label:"\uCC38\uC5EC\uD558\uAE30",value:0},this.isDetectingQRCode=!1,this.isCameraLoaded=!1,this.qrStream=null,this.qrCodeSrc="",this.joiningUsers=[],this.checkStatus={checkStatus:null,color:"#006BFF",text:"QR\uCF54\uB4DC\uB97C \uC778\uC2DD\uD574\uC8FC\uC138\uC694."},this.moimId="",this.viewType="",this._route.queryParams.subscribe(c=>{this.moimId=c.moimId,this.viewType=c.viewType})}ngOnInit(){}ngAfterViewInit(){return Ut(this,null,function*(){})}ngAfterViewChecked(){return Ut(this,null,function*(){this.startQRCodeDetection()})}setFirstPage(){this._ssalonConfigService.VIEW_TYPE==="edit"?this.changeViewMode(Hn.APPEDITVIEW):this._ssalonConfigService.VIEW_TYPE==="view"?this.changeViewMode(Hn.APPVIEW):this._ssalonConfigService.VIEW_TYPE==="qrcheck"?this.changeViewMode(Hn.QRCHECKVIEW):this._ssalonConfigService.VIEW_TYPE==="qrshow"?this.changeViewMode(Hn.QRSHOWVIEW):this.changeViewMode(Hn.WEBVIEW)}startQRCodeDetection(){return Ut(this,null,function*(){if(this.qrVideo&&this.qrCanvas&&!this.isCameraLoaded)try{this.isCameraLoaded=!0,this.qrCanvas.nativeElement.setAttribute("willReadFrequently","true"),this.qrStream=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}),this.qrVideo.nativeElement.srcObject=this.qrStream,this.qrVideo.nativeElement.play(),this.detectQRCode()}catch(n){console.error(n)}})}detectQRCode(){return Ut(this,null,function*(){if(this.qrVideo&&this.qrCanvas)for(;;){if(this.qrVideo.nativeElement.readyState===this.qrVideo.nativeElement.HAVE_ENOUGH_DATA){let n=this.qrCanvas.nativeElement.getContext("2d");this.qrCanvas.nativeElement.height=this.qrVideo.nativeElement.videoHeight,this.qrCanvas.nativeElement.width=this.qrVideo.nativeElement.videoWidth,n?.drawImage(this.qrVideo?.nativeElement,0,0,this.qrCanvas.nativeElement?.width,this.qrCanvas.nativeElement?.height);let i=n?.getImageData(0,0,this.qrCanvas.nativeElement?.width,this.qrCanvas.nativeElement?.height),s=(0,oC.default)(i.data,i.width,i.height);if(s){try{let o=yield this._apiExecutorService.checkQR(s.data);this.checkStatus={checkStatus:o.attendance,checkingUser:{nickname:o.nickname,profilePictureUrl:o.profilePictureUrl,attendance:o.attendance,userId:o.userId},color:"#4DAF50",text:"\uD658\uC601\uD569\uB2C8\uB2E4."},this.checkStatus.checkingUser.attendance&&this.joiningUsersComponent?.changeStatus(this.checkStatus.checkingUser.userId,!0)}catch{this.checkStatus={checkStatus:!1,color:"#F44336",text:"\uCC38\uAC00\uC790\uAC00 \uC544\uB2D9\uB2C8\uB2E4."}}yield new Promise(o=>setTimeout(o,1e3)),this.checkStatus={checkStatus:null,color:"#006BFF",text:"QR\uCF54\uB4DC\uB97C \uC778\uC2DD\uD574\uC8FC\uC138\uC694."}}}yield new Promise(n=>setTimeout(n,100))}})}stopDetectQRCode(){this.qrStream&&(this.qrStream.getTracks().forEach(n=>{n.stop()}),this.isDetectingQRCode=!1,this.isCameraLoaded=!1)}onClickQRCodeButton(){this.isDetectingQRCode?this.stopDetectQRCode():this.changeViewMode(Hn.QRCHECKVIEW),this.isDetectingQRCode=!this.isDetectingQRCode}changeEditMode(n){this.editMode=n}changeViewMode(n){return Ut(this,null,function*(){n===Hn.APPVIEW?this.updateServer():n===Hn.QRSHOWVIEW?(yield this.setQrCodeImgSrc(),this._sceneGraphService.mobileTicketAutoRotate=!0):n===Hn.QRCHECKVIEW&&(yield this._apiExecutorService.getJoiningUsers()).forEach((s,o)=>{this.joiningUsers.push({imgSrc:s.profilePictureUrl,label:s.nickname,value:s.userId,status:s.attendance})}),this.stopDetectQRCode(),this.mode=n})}addFabricObject(n){}onClickBackButton(){this.mode===Hn.APPVIEW&&this._location.back(),this.changeViewMode(Hn.APPEDITVIEW)}applyEdit(n){this.mobileTicketEditViewer?.updateCanvas(n)}applyBackgroundColorEdit(n){this.mobileTicketEditViewer?.updateBackgroundColor(n)}onClickPreviewButton(){return Ut(this,null,function*(){yield this.updateServer(),this.changeViewMode(Hn.APPVIEW)})}setQrCodeImgSrc(){return Ut(this,null,function*(){let n=(0,aC.default)(0,"L");n.addData(yield this._apiExecutorService.getBarcode()),n.make(),this.qrCodeSrc=n.createDataURL(4,0)})}updateServer(){return Ut(this,null,function*(){if(this.mobileTicketEditViewer!==null&&this.mobileTicketEditor!==null){let o=function(c){for(var l=atob(c.split(",")[1]),h=c.split(",")[0].split(":")[1].split(";")[0],u=new ArrayBuffer(l.length),d=new Uint8Array(u),x=0;x<l.length;x++)d[x]=l.charCodeAt(x);return new Blob([u],{type:h})};var n=o;let i=new FormData,s=this.mobileTicketEditViewer.getCanvasCapture(),a={thumbnailUrl:"image.png",backgroundColor:this.mobileTicketEditor.backgroundColor.color,fabric:this.mobileTicketEditViewer.canvas?.toJSON()};i.append("json",JSON.stringify(a)),i.append("files",o(s),"image.png"),console.log(o(s)),yield this._apiExecutorService.editTicket(i)}})}openTextEditor(n){this.mobileTicketEditor.fabricObjects.push(n),this.mobileTicketEditor.syncTextAttributeWithSelectedText(),this.mobileTicketEditor.onClickChangeEditMode(Ee.TEXT)}};t.\u0275fac=function(i){return new(i||t)(ge(Yn),ge(hs),ge(Oa),ge(Gn),ge(Dr))},t.\u0275cmp=zt({type:t,selectors:[["app-ticket"]],viewQuery:function(i,s){if(i&1&&(De(TT,5),De(FT,5),De(PT,5),De(RT,5),De(kT,5),De(OT,5)),i&2){let o;be(o=we())&&(s.mobileTicketEditViewer=o.first),be(o=we())&&(s.mobileTicketEditor=o.first),be(o=we())&&(s.barcodeContainer=o.first),be(o=we())&&(s.qrVideo=o.first),be(o=we())&&(s.qrCanvas=o.first),be(o=we())&&(s.joiningUsersComponent=o.first)}},standalone:!0,features:[Vt],decls:5,vars:5,consts:[["appView",""],["appEditView",""],["mobileTicketEditViewer",""],["mobileTicketEditor",""],["webView",""],["qrCheckView",""],["qrVideo",""],["qrCanvas",""],["joiningUsersComponent",""],["qrShowView",""],["class","container",4,"ngIf"],[1,"container"],[1,"horizontal-container"],[1,"back-button",3,"onClickEvent","buttonElement","heightSize"],[3,"onClickText"],[3,"onChangeViewer","onClickPreview","onObjectEditEnded","onBackgroundColorEditEnded"],[3,"buttonElement"],["id","qr-detector"],["autoplay","","playsInline",""],["id","qr-canvas"],["id","qr-guide-container"],["id","qr-guide","src","assets/qr-guide.png","height","300px"],["id","join-user-container"],["id","qr-checking-user-container"],["id","qr-checking-user-profile-container"],["id","qr-checking-user-profile-img","height","50px",3,"src"],["id","qr-check-info-container"],[1,"qr-check-info"],["id","join-user-list"],[3,"elements"],["id","qrcode-overay"],["id","qrcode-container"],["id","qrcode","alt","\uC774\uBBF8\uC9C0",3,"src"]],template:function(i,s){i&1&&Gt(0,IT,7,6,"div",10)(1,LT,7,20,"div",10)(2,NT,6,3,"div",10)(3,UT,22,24,"div",10)(4,zT,7,3,"div",10),i&2&&(at("ngIf",s.mode===s.mobileTicketViewMode.APPVIEW),j(),at("ngIf",s.mode===s.mobileTicketViewMode.APPEDITVIEW),j(),at("ngIf",s.mode===s.mobileTicketViewMode.WEBVIEW),j(),at("ngIf",s.mode===s.mobileTicketViewMode.QRCHECKVIEW),j(),at("ngIf",s.mode===s.mobileTicketViewMode.QRSHOWVIEW))},dependencies:[Y1,J1,Q1,sC,Rl,We],styles:[".container[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;position:relative}.horizontal-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}#qrcode-overay[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;top:0;left:0;background-color:#000c;display:flex;justify-content:center;align-items:center}#qrcode-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:150px;height:150px;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#fff;border-radius:10px}#qrcode[_ngcontent-%COMP%]{width:130px;height:130px}#qr-detector[_ngcontent-%COMP%]{width:100%;height:300px;position:relative}#qr-guide-container[_ngcontent-%COMP%]{position:absolute;top:0;width:100%}#qr-guide[_ngcontent-%COMP%]{position:absolute;top:0;left:50%;transform:translate(-50%)}#qr-checking-user-container[_ngcontent-%COMP%]{display:flex;align-items:center}#qr-checking-user-profile-container[_ngcontent-%COMP%]{margin:5px;border-radius:50%;display:flex;justify-content:center;align-items:center}#qr-checking-user-profile-img[_ngcontent-%COMP%]{border-radius:50%}#qr-check-info-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;margin-left:20px}.qr-check-info[_ngcontent-%COMP%]{font-family:Pretendard;font-size:17px;margin:5px}#join-user-list[_ngcontent-%COMP%]{margin-top:50px}"]});let r=t;return r})();var lC=(()=>{let t=class t{constructor(n){this._location=n,this.title="",this.shareButton=!1,this.backButtonClick=new Ce,this.shareButtonClick=new Ce,this.comeFrom=""}onClickBackButton(){this._location.back()}onClickShareButton(){this.shareButtonClick.emit()}};t.\u0275fac=function(i){return new(i||t)(ge(Dr))},t.\u0275cmp=zt({type:t,selectors:[["app-top-navigator"]],inputs:{title:"title",shareButton:"shareButton"},outputs:{backButtonClick:"backButtonClick",shareButtonClick:"shareButtonClick"},standalone:!0,features:[Vt],decls:5,vars:3,consts:[[1,"container"],["id","back-container","src","assets/icons/left.svg","height","40",3,"click"],["id","title-container"],["id","share-container","src","assets/icons/share.svg","height","24",3,"click"]],template:function(i,s){i&1&&(rt(0,"div",0)(1,"img",1),Lt("click",function(){return s.onClickBackButton()}),ot(),rt(2,"div",2),fe(3),ot(),rt(4,"img",3),Lt("click",function(){return s.onClickShareButton()}),ot()()),i&2&&(j(3),ln(s.title),j(),Wt("visibility",s.shareButton?"visible":"hidden"))},styles:[".container[_ngcontent-%COMP%]{width:350px;height:60px;display:flex;flex-direction:row;justify-content:space-between;align-items:center;background-color:#fff}#back-container[_ngcontent-%COMP%]{margin-left:10px}#title-container[_ngcontent-%COMP%]{font-size:18px;font-weight:600;font-family:Pretendard}#share-container[_ngcontent-%COMP%]{margin-right:10px}"]});let r=t;return r})();function VT(r,t){if(r&1){let e=Me();fn(0),rt(1,"div",2),Lt("click",function(){let i=Yt(e).$implicit,s=gt();return qt(s.onClickTab(i.value))}),fe(2),ot(),pn()}if(r&2){let e=t.$implicit,n=gt();j(),Wt("width",350/n.tabs.length,"px"),at("ngClass",n.getClass(e.value)),j(),ln(e.label)}}var hC=(()=>{let t=class t{constructor(){this.tabs=[{selected:!0,value:0,label:"Tab 1"},{selected:!1,value:1,label:"Tab 2"},{selected:!1,value:2,label:"Tab 3"}],this.onClickTabEvent=new Ce}onClickTab(n){this.onClickTabEvent.emit(n),this.tabs=this.tabs.map(i=>dn(Ot({},i),{selected:i.value===n}))}getClass(n){return this.tabs.find(i=>i.value===n).selected?"selected-tab":"unselected-tab"}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-tab-group"]],inputs:{tabs:"tabs"},outputs:{onClickTabEvent:"onClickTabEvent"},standalone:!0,features:[Vt],decls:2,vars:1,consts:[[1,"container"],[4,"ngFor","ngForOf"],[3,"click","ngClass"]],template:function(i,s){i&1&&(rt(0,"div",0),Gt(1,VT,3,4,"ng-container",1),ot()),i&2&&(j(),at("ngForOf",s.tabs))},dependencies:[rn,io],styles:[".container[_ngcontent-%COMP%]{width:350px;height:30px;display:flex;flex-direction:row}.unselected-tab[_ngcontent-%COMP%]{border-bottom:2px solid #BCBCBC;display:flex;justify-content:center;align-items:center;font-family:Pretendard;font-weight:500;font-size:14px;color:#bcbcbc}.selected-tab[_ngcontent-%COMP%]{border-bottom:2px solid black;display:flex;justify-content:center;align-items:center;font-family:Pretendard;font-weight:500;font-size:14px}"]});let r=t;return r})();function HT(r,t){if(r&1&&(rt(0,"div"),Dt(1,"app-image-row-container",4),ot()),r&2){let e=gt();Wt("margin-top",16,"px"),j(),at("images",e.images)("imageHeight",100)("isTicketContainer",!1)}}var uC=(()=>{let t=class t{constructor(){this.title="",this.content="",this.images=[]}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-simple-content"]],inputs:{title:"title",content:"content",images:"images"},standalone:!0,features:[Vt],decls:6,vars:3,consts:[[1,"container"],["id","title-container"],[3,"margin-top",4,"ngIf"],["id","content-container"],[3,"images","imageHeight","isTicketContainer"]],template:function(i,s){i&1&&(rt(0,"div",0)(1,"div",1),fe(2),ot(),Gt(3,HT,2,5,"div",2),rt(4,"div",3),fe(5),ot()()),i&2&&(j(2),vn(" ",s.title," "),j(),at("ngIf",s.images.length>0),j(2),vn(" ",s.content," "))},dependencies:[We,Ol],styles:[".container[_ngcontent-%COMP%]{width:350px;display:flex;flex-direction:column}#title-container[_ngcontent-%COMP%]{width:100%;font-size:18px;font-weight:600;font-family:Pretendard}#content-container[_ngcontent-%COMP%]{width:100%;height:auto;word-wrap:break-word;margin-top:16px;font-size:16px;font-weight:400;font-family:Pretendard;margin-bottom:16px}"]});let r=t;return r})();var dC=(()=>{let t=class t{constructor(n){this._apiExecutorService=n,this.moimId="",this.moimInfo={}}ngOnInit(){return Ut(this,null,function*(){})}getDate(){let n=new Date(this.moimInfo.meetingDate),i=n.getFullYear(),s=n.getMonth()+1,o=n.getDate(),a=n.getHours(),c=n.getMinutes();return`${`${i}\uB144 ${s}\uC6D4 ${o}\uC77C ${a}\uC2DC ${c}\uBD84`}`}getBill(){let n=this.moimInfo.payment!==void 0?this.moimInfo.payment:"1000";return`${Number(n).toLocaleString("en-US")} \uC6D0`}};t.\u0275fac=function(i){return new(i||t)(ge(Yn))},t.\u0275cmp=zt({type:t,selectors:[["app-moim-info"]],inputs:{moimId:"moimId",moimInfo:"moimInfo"},standalone:!0,features:[Vt],decls:6,vars:10,consts:[[1,"container"],[3,"title","content"]],template:function(i,s){i&1&&(rt(0,"div",0),Dt(1,"app-simple-content",1)(2,"app-simple-content",1)(3,"app-simple-content",1)(4,"app-simple-content",1)(5,"app-simple-content",1),ot()),i&2&&(j(),at("title","\uAC1C\uCD5C\uC790")("content",s.moimInfo.creator),j(),at("title","\uBAA8\uC784 \uB0A0\uC9DC")("content",s.getDate()),j(),at("title","\uBAA8\uC784 \uC7A5\uC18C")("content",s.moimInfo.location),j(),at("title","\uBAA8\uC784\uC18C\uAC1C")("content",s.moimInfo.description),j(),at("title","\uCC38\uAC00\uBE44")("content",s.getBill()))},dependencies:[uC],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;overflow-y:scroll;height:100%;width:100%;position:relative}"]});let r=t;return r})();var xC=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=zt({type:t,selectors:[["app-chatting"]],standalone:!0,features:[Vt],decls:2,vars:0,template:function(i,s){i&1&&(rt(0,"p"),fe(1,"chatting works!"),ot())}});let r=t;return r})();function GT(r,t){if(r&1){let e=Me();rt(0,"div")(1,"img",5),Lt("click",function(){Yt(e);let i=gt();return qt(i.onClickTicket())}),ot()()}r&2&&(j(),at("height",550))}function WT(r,t){if(r&1&&(rt(0,"div"),Dt(1,"app-moim-info",6),ot()),r&2){let e=gt();j(),at("moimId",e.moimId)("moimInfo",e.moimInfo)}}function jT(r,t){r&1&&(rt(0,"div"),Dt(1,"app-chatting"),ot())}var fC=function(r){return r[r.TICKET=0]="TICKET",r[r.INFO=1]="INFO",r[r.CHATTING=2]="CHATTING",r[r.REVIEW=3]="REVIEW",r}(fC||{}),pC=(()=>{let t=class t{constructor(n,i,s){this._route=n,this._router=i,this._apiExecutorService=s,this.moimId="",this.moimInfo={},this._joined=!1,this.meetingInfoTabEnum=fC,this.tabs=this.getTabs(),this.nowTab=this.tabs.find(o=>o.selected).value,this.joinButtonElements=[{selected:!1,value:0,label:"\uCC38\uAC00\uD558\uAE30"}],this._route.queryParams.subscribe(o=>{this.moimId=o.moimId})}ngOnInit(){return Ut(this,null,function*(){this.moimInfo=yield this._apiExecutorService.getMoimInfo(this.moimId),console.log(yield this._apiExecutorService.getMoims())})}getTabs(){return[{selected:!0,value:0,label:"\uC99D\uD45C \uBCF4\uAE30"},{selected:!1,value:1,label:"\uBAA8\uC784 \uC815\uBCF4"}]}onClickTicket(){this._router.navigate(["/web/ticket"],{queryParams:{moimId:this.moimId,viewType:"view"}})}};t.\u0275fac=function(i){return new(i||t)(ge(Gn),ge(Gi),ge(Yn))},t.\u0275cmp=zt({type:t,selectors:[["app-meeting-info"]],standalone:!0,features:[Vt],decls:8,vars:6,consts:[[1,"container"],[3,"title","shareButton"],[3,"onClickTabEvent","tabs"],["id","tab-container"],[4,"ngIf"],["src","assets/ticket.png",1,"image-container",3,"click","height"],[3,"moimId","moimInfo"]],template:function(i,s){i&1&&(rt(0,"div",0),Dt(1,"app-top-navigator",1),rt(2,"app-tab-group",2),Lt("onClickTabEvent",function(a){return s.nowTab=a}),ot(),rt(3,"div",3),Gt(4,GT,2,1,"div",4)(5,WT,2,2,"div",4)(6,jT,2,0,"div",4),ot(),Dt(7,"app-square-button"),ot()),i&2&&(j(),at("title",s.moimInfo.title)("shareButton",!0),j(),at("tabs",s.tabs),j(2),at("ngIf",s.nowTab===s.meetingInfoTabEnum.TICKET),j(),at("ngIf",s.nowTab===s.meetingInfoTabEnum.INFO),j(),at("ngIf",s.nowTab===s.meetingInfoTabEnum.CHATTING))},dependencies:[We,lC,hC,dC,xC,kl],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;height:100%;width:100%;position:relative}#tab-container[_ngcontent-%COMP%]{margin-top:24px;overflow-y:scroll}#tab-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}"]});let r=t;return r})();var mC=(()=>{let t=class t{constructor(n){this._router=n,this.loginButtonElements=[{selected:!1,value:0,label:"Google\uB85C \uC2DC\uC791\uD558\uAE30",solid:!1,imgSrc:"assets/login-icons/google.png"},{selected:!1,value:1,label:"Kakao\uB85C \uC2DC\uC791\uD558\uAE30",solid:!0,backgroundColor:"#FEE500",fontColor:"#000000",imgSrc:"assets/login-icons/kakao.png"},{selected:!1,value:2,label:"Naver\uB85C \uC2DC\uC791\uD558\uAE30",solid:!0,backgroundColor:"#03C75A",fontColor:"#ffffff",imgSrc:"assets/login-icons/naver.png"}]}onClickLoginButton(n){let i;n===0?i="https://ssalon.co.kr/oauth2/authorization/google":n===1?i="https://ssalon.co.kr/oauth2/authorization/kakao":i="https://ssalon.co.kr/oauth2/authorization/naver",window.location.href=i}};t.\u0275fac=function(i){return new(i||t)(ge(Gi))},t.\u0275cmp=zt({type:t,selectors:[["app-ssalon-login"]],standalone:!0,features:[Vt],decls:4,vars:3,consts:[[1,"container"],["id","logo-container","src","assets/ssalon_logo_hand.svg","height","65"],["id","login-buttons-container"],[3,"onClickToggleButtonEvent","align","columnNum","buttonElements"]],template:function(i,s){i&1&&(rt(0,"div",0),Dt(1,"img",1),rt(2,"div",2)(3,"app-simple-toggle",3),Lt("onClickToggleButtonEvent",function(a){return s.onClickLoginButton(a)}),ot()()()),i&2&&(j(3),at("align","center")("columnNum",1)("buttonElements",s.loginButtonElements))},dependencies:[xo],styles:[".container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;position:relative}#logo-container[_ngcontent-%COMP%]{position:absolute;top:120px;width:350px}#login-buttons-container[_ngcontent-%COMP%]{position:absolute;top:450px;width:350px}.login-button-container[_ngcontent-%COMP%]{margin-bottom:10px}"]});let r=t;return r})();var Z0=(()=>{let t=class t{constructor(n){this._apiExecutorService=n;let s=("; "+document.cookie).split("; token=");console.log(document.cookie,s)}};t.\u0275fac=function(i){return new(i||t)(ge(Yn))},t.\u0275cmp=zt({type:t,selectors:[["app-ssalon-login-redirect"]],standalone:!0,features:[Vt],decls:2,vars:0,template:function(i,s){i&1&&(rt(0,"p"),fe(1,"ssalon-login-redirect works!"),ot())}});let r=t;return r})();var gC=[{path:"web/ssalon-login",component:mC},{path:"login/oauth2/code/google",component:Z0},{path:"login/oauth2/code/kakao",component:Z0},{path:"login/oauth2/code/naver",component:Z0},{path:"web/onboarding",component:Km},{path:"web/main",component:tg},{path:"web/meeting-info",component:pC},{path:"web/ticket",component:cC}];var XT="@",YT=(()=>{let t=class t{constructor(n,i,s,o,a){this.doc=n,this.delegate=i,this.zone=s,this.animationType=o,this.moduleImpl=a,this._rendererFactoryPromise=null,this.scheduler=ie(Xp,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-LTX5R3K2.js")).catch(i=>{throw new nn(5300,!1)}).then(({\u0275createEngine:i,\u0275AnimationRendererFactory:s})=>{this._engine=i(this.animationType,this.doc,this.scheduler);let o=new s(this.delegate,this._engine,this.zone);return this.delegate=o,o})}createRenderer(n,i){let s=this.delegate.createRenderer(n,i);if(s.\u0275type===0)return s;typeof s.throwOnSyntheticProps=="boolean"&&(s.throwOnSyntheticProps=!1);let o=new gp(s);return i?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(a=>{let c=a.createRenderer(n,i);o.use(c)}).catch(a=>{o.use(s)}),o}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};t.\u0275fac=function(i){uu()},t.\u0275prov=Ae({token:t,factory:t.\u0275fac});let r=t;return r})(),gp=class{constructor(t){this.delegate=t,this.replay=[],this.\u0275type=1}use(t){if(this.delegate=t,this.replay!==null){for(let e of this.replay)e(t);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}get destroyNode(){return this.delegate.destroyNode}appendChild(t,e){this.delegate.appendChild(t,e)}insertBefore(t,e,n,i){this.delegate.insertBefore(t,e,n,i)}removeChild(t,e,n){this.delegate.removeChild(t,e,n)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,n,i){this.delegate.setAttribute(t,e,n,i)}removeAttribute(t,e,n){this.delegate.removeAttribute(t,e,n)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,n,i){this.delegate.setStyle(t,e,n,i)}removeStyle(t,e,n){this.delegate.removeStyle(t,e,n)}setProperty(t,e,n){this.shouldReplay(e)&&this.replay.push(i=>i.setProperty(t,e,n)),this.delegate.setProperty(t,e,n)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,n){return this.shouldReplay(e)&&this.replay.push(i=>i.listen(t,e,n)),this.delegate.listen(t,e,n)}shouldReplay(t){return this.replay!==null&&t.startsWith(XT)}};function vC(r="animations"){return Yp("NgAsyncAnimations"),Va([{provide:dl,useFactory:(t,e,n)=>new YT(t,e,n,r),deps:[oi,pl,Ai]},{provide:jp,useValue:r==="noop"?"NoopAnimations":"BrowserAnimations"}])}var EC={providers:[qm(gC),vC()]};var _C=(()=>{let t=class t{constructor(n,i){this._route=n,this._ssalonConfigService=i}ngOnInit(){let n=this._route.snapshot.data.data;this._ssalonConfigService.MOIM_ID=n.moimId,this._ssalonConfigService.VIEW_TYPE=n.viewType,this._ssalonConfigService.FACE_TYPE=n.faceType}ngAfterViewInit(){console.log(this._ssalonConfigService)}};t.\u0275fac=function(i){return new(i||t)(ge(Gn),ge(hs))},t.\u0275cmp=zt({type:t,selectors:[["app-root"]],standalone:!0,features:[Vt],decls:1,vars:0,template:function(i,s){i&1&&Dt(0,"router-outlet")},dependencies:[rd,Wa],styles:["#ticket-component[_ngcontent-%COMP%]{width:100%;height:100%}"]});let r=t;return r})();xm(_C,EC).catch(r=>console.error(r));
